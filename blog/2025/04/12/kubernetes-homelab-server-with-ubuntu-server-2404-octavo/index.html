<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://stibbons1990.github.io/hex/blog/2025/04/12/kubernetes-homelab-server-with-ubuntu-server-2404-octavo/">
      
      
        <link rel="prev" href="../../../03/28/remote-access-options-for-self-hosted-services/">
      
      
        <link rel="next" href="../../18/synology-ds423-for-the-homelab-luggage/">
      
      
        
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Kubernetes homelab server with Ubuntu Server 24.04 (octavo) - Inadvisably Applied Magic</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-Y167L3ZVGY"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-Y167L3ZVGY",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-Y167L3ZVGY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
  <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hardware" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Inadvisably Applied Magic" class="md-header__button md-logo" aria-label="Inadvisably Applied Magic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m64 400 85.7-208.2c17-41.3 47.8-75.3 87.2-96.3l146.9-78.3c12.3-6.6 26.5 4.7 23 18.2l-37.2 142.4c-1.1 4.1-1.6 8.3-1.6 12.6 0 6.3 1.2 12.6 3.6 18.5L448 400H240.9l11.8-35.4 40.4-13.5c6.5-2.2 10.9-8.3 10.9-15.2s-4.4-13-10.9-15.2l-40.4-13.5-13.5-40.4c-2.2-6.4-8.3-10.8-15.2-10.8s-13 4.4-15.2 10.9l-13.5 40.4-40.4 13.5c-6.5 2.2-10.9 8.3-10.9 15.2s4.4 13 10.9 15.2l40.4 13.5 11.8 35.4H64zm215.6-258.5c-1.1-3.3-4.1-5.5-7.6-5.5s-6.5 2.2-7.6 5.5l-6.7 20.2-20.2 6.7c-3.3 1.1-5.5 4.1-5.5 7.6s2.2 6.5 5.5 7.6l20.2 6.7 6.7 20.2c1.1 3.3 4.1 5.5 7.6 5.5s6.5-2.2 7.6-5.5l6.7-20.2 20.2-6.7c3.3-1.1 5.5-4.1 5.5-7.6s-2.2-6.5-5.5-7.6l-20.2-6.7zM32 448h448c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32"></path></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Inadvisably Applied Magic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Kubernetes homelab server with Ubuntu Server 24.04 (octavo)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="green" aria-label="Dark mode" type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="green" aria-label="Light mode" type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Inadvisably Applied Magic" class="md-nav__button md-logo" aria-label="Inadvisably Applied Magic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="m64 400 85.7-208.2c17-41.3 47.8-75.3 87.2-96.3l146.9-78.3c12.3-6.6 26.5 4.7 23 18.2l-37.2 142.4c-1.1 4.1-1.6 8.3-1.6 12.6 0 6.3 1.2 12.6 3.6 18.5L448 400H240.9l11.8-35.4 40.4-13.5c6.5-2.2 10.9-8.3 10.9-15.2s-4.4-13-10.9-15.2l-40.4-13.5-13.5-40.4c-2.2-6.4-8.3-10.8-15.2-10.8s-13 4.4-15.2 10.9l-13.5 40.4-40.4 13.5c-6.5 2.2-10.9 8.3-10.9 15.2s4.4 13 10.9 15.2l40.4 13.5 11.8 35.4H64zm215.6-258.5c-1.1-3.3-4.1-5.5-7.6-5.5s-6.5 2.2-7.6 5.5l-6.7 20.2-20.2 6.7c-3.3 1.1-5.5 4.1-5.5 7.6s2.2 6.5 5.5 7.6l20.2 6.7 6.7 20.2c1.1 3.3 4.1 5.5 7.6 5.5s6.5-2.2 7.6-5.5l6.7-20.2 20.2-6.7c3.3-1.1 5.5-4.1 5.5-7.6s-2.2-6.5-5.5-7.6l-20.2-6.7zM32 448h448c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32"></path></svg>

    </a>
    Inadvisably Applied Magic
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About This Place
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2">
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Projects
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Projects
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../projects/conmon/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Continuous Monitoring
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../projects/self-hosting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Self-hosting
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Unexpected Linux Adventures
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hardware" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hardware
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Hardware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bootable-usb-stick" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bootable USB stick
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-ubuntu-server-2404" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install Ubuntu Server 24.04
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install Ubuntu Server 24.04">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disable-swap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Disable swap
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tweak-openssh-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tweak OpenSSH server
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tweak OpenSSH server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setup-fail2ban" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup Fail2Ban
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tweak-network-config" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tweak network config
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#set-correct-timezone" class="md-nav__link">
    <span class="md-ellipsis">
      
        Set correct timezone
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#update-system-packages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Update system packages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tweak-bash-prompt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tweak Bash prompt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upgrade-to-ubuntu-pro" class="md-nav__link">
    <span class="md-ellipsis">
      
        Upgrade to Ubuntu Pro
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weekly-btrfs-scrub" class="md-nav__link">
    <span class="md-ellipsis">
      
        Weekly btrfs scrub
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stop-apparmor-spew-in-the-logs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Stop apparmor spew in the logs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nas-nfs-mount" class="md-nav__link">
    <span class="md-ellipsis">
      
        NAS NFS mount
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#continuous-monitoring" class="md-nav__link">
    <span class="md-ellipsis">
      
        Continuous Monitoring
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#remote-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        Remote Access
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Remote Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cloudflare-tunnel" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cloudflare Tunnel
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tailscale" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tailscale
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#github-repository" class="md-nav__link">
    <span class="md-ellipsis">
      
        GitHub Repository
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#storage-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Storage Requirements
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-helm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install Helm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install Kubernetes
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install Kubernetes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enable-the-kubelet-service" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enable the kubelet service
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-container-runtime" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install container runtime
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Install container runtime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#networking-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Networking setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-containerd" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install containerd
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-containerd-for-kubernetes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure containerd for Kubernetes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bootstrap-with-kubeadm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bootstrap with kubeadm
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bootstrap with kubeadm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialize-the-control-plane" class="md-nav__link">
    <span class="md-ellipsis">
      
        Initialize the control-plane
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-kubectl-access" class="md-nav__link">
    <span class="md-ellipsis">
      
        Setup kubectl access
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup kubectl access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#troubleshooting-bootstrap" class="md-nav__link">
    <span class="md-ellipsis">
      
        Troubleshooting bootstrap
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-plugin" class="md-nav__link">
    <span class="md-ellipsis">
      
        Network plugin
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-single-node-cluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        Enable single-node cluster
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Enable single-node cluster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#allow-external-load-balancers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Allow external load balancers
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-pod-scheduling" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test pod scheduling
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logs-reader-helper" class="md-nav__link">
    <span class="md-ellipsis">
      
        Logs reader helper
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#metallb-load-balancer" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetalLB Load Balancer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetalLB Load Balancer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#2026-upgrade-to-helm-chart" class="md-nav__link">
    <span class="md-ellipsis">
      
        2026 Upgrade to Helm chart
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kubernets-dashboard" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernets Dashboard
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#new-in-2026-headlamp" class="md-nav__link">
    <span class="md-ellipsis">
      
        New in 2026: Headlamp
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ingress-controller" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ingress Controller
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ingress Controller">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kubernetes-dashboard-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      
        Kubernetes Dashboard Ingress
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudflare-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      
        Cloudflare Ingress
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tailscale-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tailscale Ingress
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#https-certificates" class="md-nav__link">
    <span class="md-ellipsis">
      
        HTTPS certificates
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="HTTPS certificates">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-cert-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Install cert-manager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-cert-manager" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test cert-manager
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configure-lets-encrypt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Configure Let's Encrypt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#end-to-end-test-lets-encrypt" class="md-nav__link">
    <span class="md-ellipsis">
      
        End-to-end test Let's Encrypt
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#automatic-renewal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Automatic renewal
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#test-automatic-renewal" class="md-nav__link">
    <span class="md-ellipsis">
      
        Test automatic renewal
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-from-lexicon" class="md-nav__link">
    <span class="md-ellipsis">
      
        Migration from Lexicon
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration from Lexicon">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#audiobookshelf" class="md-nav__link">
    <span class="md-ellipsis">
      
        Audiobookshelf
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#home-assistant" class="md-nav__link">
    <span class="md-ellipsis">
      
        Home Assistant
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Home Assistant">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bluetooth-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bluetooth setup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restore-backup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Restore backup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hardcore-migration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hardcore migration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#influxdb" class="md-nav__link">
    <span class="md-ellipsis">
      
        InfluxDB
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synology-dsm" class="md-nav__link">
    <span class="md-ellipsis">
      
        Synology DSM
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#influxdb-and-grafana" class="md-nav__link">
    <span class="md-ellipsis">
      
        InfluxDB and Grafana
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="InfluxDB and Grafana">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clean-up-lexicon" class="md-nav__link">
    <span class="md-ellipsis">
      
        Clean up lexicon
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#komga" class="md-nav__link">
    <span class="md-ellipsis">
      
        Komga
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#navidrome" class="md-nav__link">
    <span class="md-ellipsis">
      
        Navidrome
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visual-studio-code-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visual Studio Code Server
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#plex-media-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Plex Media Server
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#minecraft-server" class="md-nav__link">
    <span class="md-ellipsis">
      
        Minecraft Server
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#firefly-iii" class="md-nav__link">
    <span class="md-ellipsis">
      
        Firefly III
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#new-services-post-migration" class="md-nav__link">
    <span class="md-ellipsis">
      
        New services (post migration)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#migration-to-new-isp" class="md-nav__link">
    <span class="md-ellipsis">
      
        Migration to new ISP
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Migration to new ISP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#take-1-unifi-network-application-on-new-lan" class="md-nav__link">
    <span class="md-ellipsis">
      
        Take 1: Unifi Network Application on new LAN
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#take-2-old-router-on-new-lan" class="md-nav__link">
    <span class="md-ellipsis">
      
        Take 2: Old router on new LAN
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bridging-wireless" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bridging wireless
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bridging wireless">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    <span class="md-ellipsis">
      
        Prerequisites
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bridge" class="md-nav__link">
    <span class="md-ellipsis">
      
        Bridge
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2ghz-ap-works" class="md-nav__link">
    <span class="md-ellipsis">
      
        2GHz AP (works)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5ghz-ap-does-not-work" class="md-nav__link">
    <span class="md-ellipsis">
      
        5GHz AP (does not work)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5GHz AP (does not work)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#confimed-failed-attempt" class="md-nav__link">
    <span class="md-ellipsis">
      
        Confimed failed attempt
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"></path></svg>
                        <time datetime="2025-04-12 00:00:00+00:00" class="md-ellipsis">April 12, 2025</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"></path></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../../../../category/linux/">linux</a>, 
                              <a href="../../../../category/hardware/">Hardware</a>, 
                              <a href="../../../../category/ubuntu/">Ubuntu</a>, 
                              <a href="../../../../category/server/">Server</a>, 
                              <a href="../../../../category/btrfs/">Btrfs</a>, 
                              <a href="../../../../category/intel-nuc/">Intel NUC</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"></path></svg>
                          <span class="md-ellipsis">
                            
                              146 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  




  <h1>Kubernetes homelab server with Ubuntu Server 24.04 (octavo)</h1>

<p><em>Need. More. Server. Need. More. POWER!!!</em></p>
<p>Just a bit more, maybe <em>quite a bit</em> more, to run services that are more
CPU-intensive than those already running in the current 
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/">Single-node Kubernetes cluster on an Intel NUC: lexicon</a>.</p>
<!-- more -->

<h2 id="hardware">Hardware</h2>
<p>Ubuntu's list of
<a href="https://ubuntu.com/appliance/hardware#intel-nuc">Recommended and Certified Hardware</a>
is just as short and <em>ancient</em> as it was 2 years ago, but NUC systems have a now
long history of being well suppored under Linux, so this time I'm taking chances:</p>
<ul>
<li><a href="https://webshop.asus.com/de/Mini-PCs/ASUS-NUC-13-Pro-Tall-PC-Kit-RNUC13ANHI700000I/90AR00C1-M000F0">ASUS NUC 13 Pro Tall PC Kit RNUC13ANHI700000I w/ Intel Core i7-1360P</a> ($570)</li>
<li><a href="https://www.kingston.com/en/memory/gaming/kingston-fury-impact-ddr4-memory?speed=3200mt%2Fs&amp;total%20(kit)%20capacity=32gb&amp;kit=single%20module&amp;dram%20density=16gbit">Kingston FURY Impact 1x 32GB, 3200 MHz, DDR4-RAM, SODIMM</a> ($110)</li>
<li><a href="https://www.kingston.com/en/ssd/gaming/kingston-fury-renegade-nvme-m2-ssd">Kingston FURY Renegade 4000 GB, M.2 2280</a> ($250)</li>
</ul>
<h3 id="bootable-usb-stick">Bootable USB stick</h3>
<p><a href="https://ubuntu.com/download/server">Get Ubuntu Server</a> (24.04.<strong>2</strong> LTS) and 
<a href="https://ubuntu.com/tutorials/create-a-usb-stick-on-ubuntu#1-overview">create a bootable USB stick on Ubuntu</a>.</p>
<h2 id="install-ubuntu-server-2404">Install Ubuntu Server 24.04</h2>
<p><a href="https://ubuntu.com/tutorials/install-ubuntu-server">Installing Ubuntu Server 24.04</a>
went smoothly and without any problems, the NUC booted from the USB stick and secure
boot, enabled by default, never presented any problem. Screen and USB keyword worked
seamlessly through a DisplayPort+USB+Ethernet
<a href="https://www.cablematters.com/pc-940-126-usb-c-dual-monitor-hub-with-dual-4k-displayport-2x-usb-20-fast-ethernet-and-60w-power-delivery.aspx#">Cable Matters Hub</a>
on a Thunderbolt port in the NUC.</p>
<p>Once the intaller boots, the installation steps were:</p>
<ol>
<li>Choose language and keyboard layout.</li>
<li>Choose <strong>Ubuntu Server</strong> (default, not <em>(minimized)</em>).<ul>
<li>Checked the option to <em>Search for third-party drivers</em>.</li>
</ul>
</li>
<li>Networking: DHCP on wired network.<ul>
<li>IP address <code>.155</code> is assgined to the <code>enx5c857e3e1129</code> interface, the
   RTL8153 Gigabit Ethernet NIC in the Cable Matters Hub.</li>
<li>The <code>enp86s0</code> interface is the NUC's integrated 2.5Gbps NIC (Intel I226-V),
   which during the installation had no network cable attached.</li>
</ul>
</li>
<li>Pick a local Ubuntu mirror to install packages from.</li>
<li>Setup a <strong>Custom storage layout</strong> as follows<ol>
<li>Select the disk (Kingston FURY Renegade 4000 GB) to <strong>Use As Boot Device</strong>.
    This automatically creates a 1GB partition for <code>/boot/efi</code> (formatted as <code>btrfs</code>).</li>
<li>Create a 60G partition to mount as <code>/</code> (formatted as <code>btrfs</code>).</li>
<li>Create a 60G partition to reverse for a future OS.</li>
<li>Create a 60G partition to mount as <code>/var/lib</code> (formatted as <code>btrfs</code>).</li>
<li>Create a  partition using all remaining space (3.46T) to mount as <code>/home</code>
    (formatted as <code>btrfs</code>).</li>
</ol>
</li>
<li>Confirm partitions &amp; changes.</li>
<li>Set up a Profile: username (<code>ponder</code>), hostname (<code>octavo</code>) and password.</li>
<li>Skip Upgrade to Ubuntu Pro (to be done later).</li>
<li>Install OpenSSH server and allow password authentication (for now).</li>
<li>A selection of snap packages is available at this point, none were selected.</li>
<li>Confirm all previous choices and start to <strong>install software</strong>.</li>
<li>Once the installation is complete, remove the UBS stick and hit Enter to reboot.</li>
</ol>
<h3 id="disable-swap">Disable swap</h3>
<p>With 32 GB on a single DIMM and the possiblity to double that in the future, there is
no need for <code>swap</code> and it can be
<a href="#troubleshooting-kubeadm-init">problematic for Kubernetes</a> later, so this should be
disabled: remove the relevant line in <code>/etc/fstab</code>, reboot and delete the swap file
(typically <code>/swap.img</code> or <code>/swapfile</code>).</p>
<h3 id="tweak-openssh-server">Tweak OpenSSH server</h3>
<p>Set the <code>root</code> password by first escalating with <code>sudo su -</code> and then using the
<code>passwd</code> command to set the password. This password will hardly ever be used, but
should be set so that it can be use in case of emergency.</p>
<p>Copy SSH public keys into the <code>.ssh/authorized_keys</code> of both <code>ponder</code> and <code>root</code>,
then disable password authentication in the OpenSSH server:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp"># </span>vi<span class="w"> </span>/etc/ssh/sshd_config
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="go">PasswordAuthentication no</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp"># </span>systemctl<span class="w"> </span>restart<span class="w"> </span>ssh
</span></code></pre></div>
<p>Test SSH connections as both <code>ponder</code> and <code>root</code> from all the relevant hosts in the LAN.</p>
<h4 id="setup-fail2ban">Setup Fail2Ban</h4>
<p>On top of disabling password authentication, the SSH server will be less busy is those
pesky <em>bad actors</em> are blocked from reaching it's port. To do this, install
<a href="https://github.com/fail2ban/fail2ban">fail2ban</a>:</p>
<details class="terminal">
<summary><code>apt install fail2ban -y</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="gp"># </span>apt<span class="w"> </span>install<span class="w"> </span>fail2ban<span class="w"> </span>-y
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="go">The following additional packages will be installed:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="go">  python3-pyasyncore python3-pyinotify whois</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="go">Suggested packages:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="go">  mailx monit sqlite3 python-pyinotify-doc</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="go">The following NEW packages will be installed:</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="go">  fail2ban python3-pyasyncore python3-pyinotify whois</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="go">0 upgraded, 4 newly installed, 0 to remove and 1 not upgraded.</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="go">Need to get 496 kB of archives.</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="go">After this operation, 2,572 kB of additional disk space will be used.</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="go">Get:1 http://ch.archive.ubuntu.com/ubuntu noble/main amd64 python3-pyasyncore all 1.0.2-2 [10.1 kB]</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="go">Get:2 http://ch.archive.ubuntu.com/ubuntu noble-updates/universe amd64 fail2ban all 1.0.2-3ubuntu0.1 [409 kB]</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="go">Get:3 http://ch.archive.ubuntu.com/ubuntu noble/main amd64 python3-pyinotify all 0.9.6-2ubuntu1 [25.0 kB]</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="go">Get:4 http://ch.archive.ubuntu.com/ubuntu noble/main amd64 whois amd64 5.5.22 [51.7 kB]</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="go">Fetched 496 kB in 0s (2,059 kB/s) </span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="go">Selecting previously unselected package python3-pyasyncore.</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="gp gp-VirtualEnv">(Reading database ... 86910 files and directories currently installed.)</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="go">Preparing to unpack .../python3-pyasyncore_1.0.2-2_all.deb ...</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="go">Unpacking python3-pyasyncore (1.0.2-2) ...</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="go">Selecting previously unselected package fail2ban.</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="go">Preparing to unpack .../fail2ban_1.0.2-3ubuntu0.1_all.deb ...</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="go">Unpacking fail2ban (1.0.2-3ubuntu0.1) ...</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="go">Selecting previously unselected package python3-pyinotify.</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="go">Preparing to unpack .../python3-pyinotify_0.9.6-2ubuntu1_all.deb ...</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="go">Unpacking python3-pyinotify (0.9.6-2ubuntu1) ...</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="go">Selecting previously unselected package whois.</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="go">Preparing to unpack .../whois_5.5.22_amd64.deb ...</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="go">Unpacking whois (5.5.22) ...</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="go">Setting up whois (5.5.22) ...</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="go">Setting up python3-pyasyncore (1.0.2-2) ...</span>
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="go">Setting up fail2ban (1.0.2-3ubuntu0.1) ...</span>
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="go">/usr/lib/python3/dist-packages/fail2ban/tests/fail2banregextestcase.py:224: SyntaxWarning: invalid escape sequence '\s'</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="go">  "1490349000 test failed.dns.ch", "^\s*test &lt;F-ID&gt;\S+&lt;/F-ID&gt;"</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a><span class="go">/usr/lib/python3/dist-packages/fail2ban/tests/fail2banregextestcase.py:435: SyntaxWarning: invalid escape sequence '\S'</span>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a><span class="go">  '^'+prefix+'&lt;F-ID&gt;User &lt;F-USER&gt;\S+&lt;/F-USER&gt;&lt;/F-ID&gt; not allowed\n'</span>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a><span class="go">/usr/lib/python3/dist-packages/fail2ban/tests/fail2banregextestcase.py:443: SyntaxWarning: invalid escape sequence '\S'</span>
</span><span id="__span-1-40"><a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a><span class="go">  '^'+prefix+'User &lt;F-USER&gt;\S+&lt;/F-USER&gt; not allowed\n'</span>
</span><span id="__span-1-41"><a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a><span class="go">/usr/lib/python3/dist-packages/fail2ban/tests/fail2banregextestcase.py:444: SyntaxWarning: invalid escape sequence '\d'</span>
</span><span id="__span-1-42"><a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a><span class="go">  '^'+prefix+'Received disconnect from &lt;F-ID&gt;&lt;ADDR&gt; port \d+&lt;/F-ID&gt;'</span>
</span><span id="__span-1-43"><a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a><span class="go">/usr/lib/python3/dist-packages/fail2ban/tests/fail2banregextestcase.py:451: SyntaxWarning: invalid escape sequence '\s'</span>
</span><span id="__span-1-44"><a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a><span class="go">  _test_variants('common', prefix="\s*\S+ sshd\[&lt;F-MLFID&gt;\d+&lt;/F-MLFID&gt;\]:\s+")</span>
</span><span id="__span-1-45"><a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a><span class="go">/usr/lib/python3/dist-packages/fail2ban/tests/fail2banregextestcase.py:537: SyntaxWarning: invalid escape sequence '\['</span>
</span><span id="__span-1-46"><a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a><span class="go">  'common[prefregex="^svc\[&lt;F-MLFID&gt;\d+&lt;/F-MLFID&gt;\] connect &lt;F-CONTENT&gt;.+&lt;/F-CONTENT&gt;$"'</span>
</span><span id="__span-1-47"><a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a><span class="go">/usr/lib/python3/dist-packages/fail2ban/tests/servertestcase.py:1375: SyntaxWarning: invalid escape sequence '\s'</span>
</span><span id="__span-1-48"><a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a><span class="go">  "`{ nft -a list chain inet f2b-table f2b-chain | grep -oP '@addr-set-j-w-nft-mp\s+.*\s+\Khandle\s+(\d+)$'; } | while read -r hdl; do`",</span>
</span><span id="__span-1-49"><a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a><span class="go">/usr/lib/python3/dist-packages/fail2ban/tests/servertestcase.py:1378: SyntaxWarning: invalid escape sequence '\s'</span>
</span><span id="__span-1-50"><a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a><span class="go">  "`{ nft -a list chain inet f2b-table f2b-chain | grep -oP '@addr6-set-j-w-nft-mp\s+.*\s+\Khandle\s+(\d+)$'; } | while read -r hdl; do`",</span>
</span><span id="__span-1-51"><a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a><span class="go">/usr/lib/python3/dist-packages/fail2ban/tests/servertestcase.py:1421: SyntaxWarning: invalid escape sequence '\s'</span>
</span><span id="__span-1-52"><a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a><span class="go">  "`{ nft -a list chain inet f2b-table f2b-chain | grep -oP '@addr-set-j-w-nft-ap\s+.*\s+\Khandle\s+(\d+)$'; } | while read -r hdl; do`",</span>
</span><span id="__span-1-53"><a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a><span class="go">/usr/lib/python3/dist-packages/fail2ban/tests/servertestcase.py:1424: SyntaxWarning: invalid escape sequence '\s'</span>
</span><span id="__span-1-54"><a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a><span class="go">  "`{ nft -a list chain inet f2b-table f2b-chain | grep -oP '@addr6-set-j-w-nft-ap\s+.*\s+\Khandle\s+(\d+)$'; } | while read -r hdl; do`",</span>
</span><span id="__span-1-55"><a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a><span class="go">Created symlink /etc/systemd/system/multi-user.target.wants/fail2ban.service  /usr/lib/systemd/system/fail2ban.service.</span>
</span><span id="__span-1-56"><a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a><span class="go">Setting up python3-pyinotify (0.9.6-2ubuntu1) ...</span>
</span><span id="__span-1-57"><a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a><span class="go">Processing triggers for man-db (2.12.0-4build2) ...</span>
</span><span id="__span-1-58"><a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a><span class="go">Scanning processes...                                                                                         </span>
</span><span id="__span-1-59"><a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a><span class="go">Scanning processor microcode...                                                                               </span>
</span><span id="__span-1-60"><a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a><span class="go">Scanning linux images...                                                                                      </span>
</span><span id="__span-1-61"><a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>
</span><span id="__span-1-62"><a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a><span class="go">Running kernel seems to be up-to-date.</span>
</span><span id="__span-1-63"><a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a>
</span><span id="__span-1-64"><a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a><span class="go">The processor microcode seems to be up-to-date.</span>
</span><span id="__span-1-65"><a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>
</span><span id="__span-1-66"><a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a><span class="go">No services need to be restarted.</span>
</span><span id="__span-1-67"><a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>
</span><span id="__span-1-68"><a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a><span class="go">No containers need to be restarted.</span>
</span><span id="__span-1-69"><a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>
</span><span id="__span-1-70"><a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a><span class="go">No user sessions are running outdated binaries.</span>
</span><span id="__span-1-71"><a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a>
</span><span id="__span-1-72"><a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a><span class="go">No VM guests are running outdated hypervisor (qemu) binaries on this host.</span>
</span></code></pre></div>
</details>
<p>Enable the service so it starts after each system restart:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="gp"># </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>fail2ban
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="go">Synchronizing state of fail2ban.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.</span>
</span></code></pre></div>
<p>The default configuration should be enough because this system will probably not expose
its port 22 to the Internet, but instead accessed remotely via <a href="#tailscale">Tailscale</a>.
If port 22 is later expoed to the Internet, see
<a href="../../../../2022/07/03/low-effort-homelab-server-with-ubuntu-server-on-intel-nuc/#setup-fail2ban">lexicon's Fail2ban setup</a>.</p>
<h3 id="tweak-network-config">Tweak network config</h3>
<p>This system will use static IP addresses <code>.8</code> so they can be added to the <code>/etc/hosts</code>
file of the relevant hosts in the LAN, then the file can be copied into the new server,
preserving the line that points <code>127.0.0.1</code> to itself.</p>
<p>While using the Cable Matters hub, the LAN IP address is setup on the <code>enx5c857e3e1129</code>
interface:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="gp"># </span>ip<span class="w"> </span>a
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="go">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="go">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="go">    inet 127.0.0.1/8 scope host lo</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="go">    inet6 ::1/128 scope host noprefixroute </span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="go">2: enp86s0: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="go">    link/ether 48:21:0b:6d:3e:9b brd ff:ff:ff:ff:ff:ff</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="hll"><span class="go">3: enx5c857e3e1129: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span>
</span></span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="go">    link/ether 5c:85:7e:3e:11:29 brd ff:ff:ff:ff:ff:ff</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="hll"><span class="go">    inet 192.168.0.155/24 metric 100 brd 192.168.0.255 scope global dynamic enx5c857e3e1129</span>
</span></span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="go">       valid_lft 85920sec preferred_lft 85920sec</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="go">    inet6 fe80::5e85:7eff:fe3e:1129/64 scope link </span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="go">4: wlo1: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="go">    link/ether d0:65:78:a5:8b:dd brd ff:ff:ff:ff:ff:ff</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="go">    altname wlp0s20f3</span>
</span></code></pre></div>
<details class="terminal">
<summary><code>dmesg</code> lines for Intel I226-V 2.5Gbps NIC (<code>igc</code>) and USB NIC (<code>r8152</code>):</summary>
<div class="language-dmesg highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="m">[    1.736823] </span>Intel(R) 2.5G Ethernet Linux Driver
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="m">[    1.738154] </span>Copyright(c) 2018 Intel Corporation.
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="m">[    1.741460] </span><span class="k">igc 0000:</span>56:00.0: enabling device (0000 -&gt; 0002)
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="m">[    1.744312] </span><span class="k">igc 0000:</span>56:00.0: PTM enabled, 4ns granularity
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="m">[    1.756421] </span><span class="k">ahci 0000:</span>00:17.0: version 3.0
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="m">[    1.756759] </span><span class="k">xhci_hcd 0000:</span>00:0d.0: xHCI Host Controller
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>--
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="m">[    1.821412] </span><span class="k">intel-lpss 0000:</span>00:15.1: enabling device (0004 -&gt; 0006)
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="m">[    1.823953] </span><span class="k">idma64 idma64.1:</span> Found Intel integrated DMA 64-bit
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="m">[    1.842492] </span><span class="k">igc 0000:</span>56:00.0: 4.000 Gb/s available PCIe bandwidth (5.0 GT/s PCIe x1 link)
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="m">[    1.843094] </span><span class="k">igc 0000:</span>56:00.0 eth0: MAC: 48:21:0b:6d:3e:9b
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="m">[    2.056525] </span><span class="k">typec port0:</span> bound usb3-port6 (ops connector_ops)
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="m">[    2.058975] </span><span class="k">typec port0:</span> bound usb2-port1 (ops connector_ops)
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="m">[    2.061054] </span><span class="k">usb 3-1:</span> new full-speed USB device number 2 using xhci_hcd
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="m">[    2.086270] </span><span class="k">ata2:</span> SATA link down (SStatus 4 SControl 300)
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="m">[    2.092729] </span><span class="k">igc 0000:</span>56:00.0 enp86s0: renamed from eth0
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="m">[    2.100868] </span><span class="k">ucsi_acpi USBC000:</span><span class="gr">00: UCSI_GET_PDOS failed (-95)</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="m">[    2.114965] </span><span class="k">nvme 0000:</span>01:00.0: platform quirk: setting simple suspend
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="m">[    2.116031] </span><span class="k">nvme nvme0:</span> pci function 0000:01:00.0
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="m">[    2.125670] </span><span class="k">nvme nvme0:</span> Shutdown timeout set to 10 seconds
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="m">[    2.129358] </span><span class="k">nvme nvme0:</span> 16/0/0 default/read/poll queues
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>--
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="m">[    4.164720] </span><span class="k">usbcore:</span> registered new device driver r8152-cfgselector
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="m">[    4.352207] </span><span class="k">r8152-cfgselector 3-6.2:</span> reset high-speed USB device number 6 using xhci_hcd
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="m">[    4.581005] </span><span class="k">r8152 3-6.2:</span>1.0: load rtl8153a-4 v2 02/07/20 successfully
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="m">[    4.621215] </span><span class="k">r8152 3-6.2:</span>1.0 eth0: v1.12.13
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="m">[    4.624728] </span><span class="k">usbcore:</span> registered new interface driver r8152
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="m">[    4.660226] </span><span class="k">usbcore:</span> registered new interface driver cdc_ether
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="m">[    4.669749] </span><span class="k">r8152 3-6.2:</span>1.0 enx5c857e3e1129: renamed from eth0
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="m">[    4.720488] </span><span class="k">usb 3-6.4.1:</span> new high-speed USB device number 8 using xhci_hcd
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="m">[    4.808357] </span><span class="k">raid6:</span> avx2x4   gen() 29500 MB/s
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="m">[    4.825355] </span><span class="k">raid6:</span> avx2x2   gen() 36875 MB/s
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="m">[    4.842356] </span><span class="k">raid6:</span> avx2x1   gen() 35157 MB/s
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="m">[    4.842362] </span><span class="k">raid6:</span> using algorithm avx2x2 gen() 36875 MB/s
</span></code></pre></div>
</details>
<p>Servers are better setup with static IP addresses in a know range, and for this system
the <code>.8</code>addresses have been reserved and can be setup in the Netplan configuration:</p>
<div class="language-yaml highlight"><span class="filename">/etc/netplan/50-cloud-init.yaml</span><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="c1"># Dual static IP on LAN, nothing else.</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nt">network</span><span class="p">:</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="hll"><span class="w">  </span><span class="nt">renderer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networkd</span>
</span></span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">  </span><span class="nt">ethernets</span><span class="p">:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="w">    </span><span class="nt">enp86s0</span><span class="p">:</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="hll"><span class="w">      </span><span class="nt">dhcp6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span></span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">      </span><span class="c1"># Ser IP address &amp; subnet mask</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">      </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">10.0.0.8/24</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">192.168.0.8/24</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="nt">enx5c857e3e1129</span><span class="p">:</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">      </span><span class="nt">dhcp6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">      </span><span class="c1"># Ser IP address &amp; subnet mask</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="w">      </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">10.0.0.9/24</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">192.168.0.9/24</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="hll"><span class="w">      </span><span class="c1"># Set default gateway</span>
</span></span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a><span class="w">      </span><span class="nt">routes</span><span class="p">:</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a><span class="w">         </span><span class="nt">via</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.1</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a><span class="hll"><span class="w">      </span><span class="c1"># Set DNS name servers</span>
</span></span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a><span class="w">      </span><span class="nt">nameservers</span><span class="p">:</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a><span class="w">        </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">77.109.128.2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">213.144.129.20</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Adding <code>routes</code> to both Ethernet interfaces will result in warnings, and is not
necessary so long as one can SSH in from another host in the LAN.</p>
</div>
<p>After applying the configuration with <code>netplan apply</code> both Ethernet NICs will always have
static IP addresses:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="gp"># </span>ip<span class="w"> </span>a
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="go">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="go">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="go">    inet 127.0.0.1/8 scope host lo</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="go">    inet6 ::1/128 scope host noprefixroute </span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="go">2: enp86s0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq state DOWN group default qlen 1000</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="go">    link/ether 48:21:0b:6d:3e:9b brd ff:ff:ff:ff:ff:ff</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="hll"><span class="go">3: enx5c857e3e1129: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span>
</span></span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="go">    link/ether 5c:85:7e:3e:11:29 brd ff:ff:ff:ff:ff:ff</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="go">    inet 10.0.0.7/24 brd 10.0.0.255 scope global enx5c857e3e1129</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="hll"><span class="go">    inet 192.168.0.7/24 brd 192.168.0.255 scope global enx5c857e3e1129</span>
</span></span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="go">    inet6 fe80::5e85:7eff:fe3e:1129/64 scope link </span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="go">4: wlo1: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="go">    link/ether d0:65:78:a5:8b:dd brd ff:ff:ff:ff:ff:ff</span>
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="go">    altname wlp0s20f3</span>
</span></code></pre></div>
<p>The server can now be relocated to the <strong>2.5Gbps</strong> network, where no screen is available.
Once relocated to the 2.5Gbps network, no longer using the Cable Matters hub, and finished
booting, SSH back into the server using the <code>.8</code> address:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="gp"># </span>ip<span class="w"> </span>a
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="go">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="go">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="go">    inet 127.0.0.1/8 scope host lo</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="go">    inet6 ::1/128 scope host noprefixroute </span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="hll"><span class="go">2: enp86s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span>
</span></span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="go">    link/ether 48:21:0b:6d:3e:9b brd ff:ff:ff:ff:ff:ff</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="hll"><span class="go">    inet 10.0.0.8/24 brd 10.0.0.255 scope global enp86s0</span>
</span></span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="go">    inet 192.168.0.8/24 brd 192.168.0.255 scope global enp86s0</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="go">    inet6 fe80::4a21:bff:fe6d:3e9b/64 scope link </span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="go">3: wlo1: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default qlen 1000</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="go">    link/ether d0:65:78:a5:8b:dd brd ff:ff:ff:ff:ff:ff</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="go">    altname wlp0s20f3</span>
</span></code></pre></div>
<p>To re-enable the server's access to the Internet, move the <code>routes</code> to the <code>enp86s0</code>
interface and <code>netplan apply</code> once again:</p>
<div class="language-yaml highlight"><span class="filename">/etc/netplan/50-cloud-init.yaml</span><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># Dual static IP on LAN, nothing else.</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nt">network</span><span class="p">:</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="nt">renderer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networkd</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">  </span><span class="nt">ethernets</span><span class="p">:</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="nt">enp86s0</span><span class="p">:</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">      </span><span class="nt">dhcp6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">      </span><span class="c1"># Ser IP address &amp; subnet mask</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">      </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">10.0.0.8/24</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">192.168.0.8/24</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">      </span><span class="c1"># Set default gateway</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">      </span><span class="nt">routes</span><span class="p">:</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">       </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">         </span><span class="nt">via</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.1</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">      </span><span class="c1"># Set DNS name servers</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">      </span><span class="nt">nameservers</span><span class="p">:</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">        </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">77.109.128.2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">213.144.129.20</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">    </span><span class="nt">enx5c857e3e1129</span><span class="p">:</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a><span class="w">      </span><span class="nt">dhcp6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">      </span><span class="c1"># Ser IP address &amp; subnet mask</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">      </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">10.0.0.9/24</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">192.168.0.9/24</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span></code></pre></div>
<p>At this point the network configuration is finalized.</p>
<h3 id="set-correct-timezone">Set correct timezone</h3>
<p>The installation process does not offer setting the system timezone and defaults to UTC:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="gp"># </span>timedatectl
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="go">               Local time: Sun 2025-04-13 20:47:28 UTC</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="go">           Universal time: Sun 2025-04-13 20:47:28 UTC</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="go">                 RTC time: Sun 2025-04-13 20:47:28</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="go">                Time zone: Etc/UTC (UTC, +0000)</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="go">System clock synchronized: yes</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="go">              NTP service: active</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="go">          RTC in local TZ: no</span>
</span></code></pre></div>
<p>Since this is not the local timezone anywhere, it is better (more convenient) to set the
local timezone, e.g.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="gp"># </span>timedatectl<span class="w"> </span>set-timezone<span class="w"> </span><span class="s2">"Europe/Amsterdam"</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="gp"># </span>timedatectl
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="go">               Local time: Sun 2025-04-13 22:48:45 CEST</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="go">           Universal time: Sun 2025-04-13 20:48:45 UTC</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="go">                 RTC time: Sun 2025-04-13 20:48:45</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="go">                Time zone: Europe/Amsterdam (CEST, +0200)</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="go">System clock synchronized: yes</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="go">              NTP service: active</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="go">          RTC in local TZ: no</span>
</span></code></pre></div>
<h3 id="update-system-packages">Update system packages</h3>
<p>Updating system packages is recommended after installing from USB media:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="gp"># </span>apt<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>apt<span class="w"> </span>full-upgrade<span class="w"> </span>-y
</span></code></pre></div>
<h3 id="tweak-bash-prompt">Tweak Bash prompt</h3>
<p>Tweak Bash prompt for <code>root</code> to make user name
<span style="color: red">red</span>,
host name
<span style="color: blue">blue</span>
and path
<span style="color: green">green</span>;
with this in <code>.bashrc</code>:</p>
<div class="language-bash highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">.bashrc</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-36">36</a></span>
<span class="normal"><a href="#__codelineno-12-37">37</a></span>
<span class="normal"><a href="#__codelineno-12-38">38</a></span>
<span class="normal"><a href="#__codelineno-12-39">39</a></span>
<span class="normal"><a href="#__codelineno-12-40">40</a></span>
<span class="normal"><a href="#__codelineno-12-41">41</a></span>
<span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span>
<span class="normal"><a href="#__codelineno-12-44">44</a></span>
<span class="normal"><a href="#__codelineno-12-45">45</a></span>
<span class="normal"><a href="#__codelineno-12-46">46</a></span>
<span class="normal"><a href="#__codelineno-12-47">47</a></span>
<span class="normal"><a href="#__codelineno-12-48">48</a></span>
<span class="normal"><a href="#__codelineno-12-49">49</a></span>
<span class="normal"><a href="#__codelineno-12-50">50</a></span>
<span class="normal"><a href="#__codelineno-12-51">51</a></span>
<span class="normal"><a href="#__codelineno-12-52">52</a></span>
<span class="normal"><a href="#__codelineno-12-53">53</a></span>
<span class="normal"><a href="#__codelineno-12-54">54</a></span>
<span class="normal"><a href="#__codelineno-12-55">55</a></span>
<span class="normal"><a href="#__codelineno-12-56">56</a></span>
<span class="normal"><a href="#__codelineno-12-57">57</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="c1"># uncomment for a colored prompt, if the terminal has the capability; turned</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="c1"># off by default to not distract the user: the focus in a terminal window</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="c1"># should be on the output of commands, not on the prompt</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="hll"><span class="nv">force_color_prompt</span><span class="o">=</span>yes
</span></span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40"></a>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">"</span><span class="nv">$force_color_prompt</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-x<span class="w"> </span>/usr/bin/tput<span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>tput<span class="w"> </span>setaf<span class="w"> </span><span class="m">1</span><span class="w"> </span>&gt;<span class="p">&amp;</span>/dev/null<span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43"></a><span class="w">        </span><span class="c1"># We have color support; assume it's compliant with Ecma-48</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44"></a><span class="w">        </span><span class="c1"># (ISO/IEC-6429). (Lack of such support is extremely rare, and such</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45"></a><span class="w">        </span><span class="c1"># a case would tend to support setf rather than setaf.)</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46"></a><span class="w">        </span><span class="nv">color_prompt</span><span class="o">=</span>yes
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48"></a><span class="w">        </span><span class="nv">color_prompt</span><span class="o">=</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50"></a><span class="k">fi</span>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51"></a>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">"</span><span class="nv">$color_prompt</span><span class="s2">"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>yes<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53"></a><span class="hll"><span class="w">    </span><span class="nv">PS1</span><span class="o">=</span><span class="s1">'\[\e]0;\u@\h: \w\a\]${debian_chroot:+($debian_chroot)}\[\033[01;31m\]\u@\[\033[01;34m\]\h\[\033[00m\] \[\033[01;32m\]\w \$\[\033[00m\] '</span>
</span></span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54"></a><span class="k">else</span>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55"></a><span class="hll"><span class="w">    </span><span class="nv">PS1</span><span class="o">=</span><span class="s1">'${debian_chroot:+($debian_chroot)}\u@\h \w \$ '</span>
</span></span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56"></a><span class="k">fi</span>
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57"></a><span class="nb">unset</span><span class="w"> </span>color_prompt<span class="w"> </span>force_color_prompt
</span></code></pre></div></td></tr></tbody></table></div>
<p>Other users' Bash prompt is left as default, which renders all
green. The idea is that <code>root</code>'s prompt is visually different,
to remind me that <em>with great power comes great responsibility</em>.</p>
<h3 id="upgrade-to-ubuntu-pro">Upgrade to Ubuntu Pro</h3>
<p>This step was skipped during the
<a href="#install-ubuntu-server-2404">installation process</a>
so the server is not attached to an Ubuntu Pro account:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="gp"># </span>pro<span class="w"> </span>security-status
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="go">684 packages installed:</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="go">    684 packages from Ubuntu Main/Restricted repository</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="go">To get more information about the packages, run</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="go">    pro security-status --help</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="go">for a list of available options.</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="go">This machine is receiving security patching for Ubuntu Main/Restricted</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="go">repository until 2029.</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="go">This machine is NOT attached to an Ubuntu Pro subscription.</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="go">Ubuntu Pro with 'esm-infra' enabled provides security updates for</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="go">Main/Restricted packages until 2034.</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="go">Try Ubuntu Pro with a free personal subscription on up to 5 machines.</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="go">Learn more at https://ubuntu.com/pro</span>
</span></code></pre></div>
<p>Take the command and token from <a href="https://ubuntu.com/pro/dashboard">https://ubuntu.com/pro/dashboard</a> and
attach the server to an active Ubuntu Pro account:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="gp"># </span>pro<span class="w"> </span>attach<span class="w"> </span>______________________________
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="go">Enabling Ubuntu Pro: ESM Apps</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="go">Ubuntu Pro: ESM Apps enabled</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="go">Enabling Ubuntu Pro: ESM Infra</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="go">Ubuntu Pro: ESM Infra enabled</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="go">Enabling Livepatch</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="go">Livepatch enabled</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="go">This machine is now attached to 'Ubuntu Pro - free personal subscription'</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="go">SERVICE          ENTITLED  STATUS       DESCRIPTION</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="go">anbox-cloud      yes       disabled     Scalable Android in the cloud</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="go">esm-apps         yes       enabled      Expanded Security Maintenance for Applications</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="go">esm-infra        yes       enabled      Expanded Security Maintenance for Infrastructure</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="go">landscape        yes       disabled     Management and administration tool for Ubuntu</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="go">livepatch        yes       enabled      Canonical Livepatch service</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="go">realtime-kernel* yes       disabled     Ubuntu kernel with PREEMPT_RT patches integrated</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="go">usg              yes       disabled     Security compliance and audit tools</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="go"> * Service has variants</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="go">NOTICES</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="go">Operation in progress: pro attach</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="go">For a list of all Ubuntu Pro services and variants, run 'pro status --all'</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a><span class="go">Enable services with: pro enable &lt;service&gt;</span>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="go">     Account: ponder.stibbons@uu.am</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a><span class="go">Subscription: Ubuntu Pro - free personal subscription</span>
</span></code></pre></div>
<h3 id="weekly-btrfs-scrub">Weekly btrfs scrub</h3>
<p>To keep BTRFS file systems healthy, it is recommended to
<a href="http://marc.merlins.org/perso/btrfs/post_2014-03-19_Btrfs-Tips_-Btrfs-Scrub-and-Btrfs-Filesystem-Repair.html">run a weekly scrub</a>
to check everything for consistency. For this, run
<a href="https://marc.merlins.org/linux/scripts/btrfs-scrub">the script</a>
from <code>crontab</code> every Saturday morning, early enough that it will
be done by the time anyone wakes up:</p>
<details class="code">
<summary><code>/usr/local/bin/btrfs-scrub-all</code></summary>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="ch">#! /bin/bash</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="c1"># By Marc MERLIN &lt;marc_soft@merlins.org&gt; 2014/03/20</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="c1"># License: Apache-2.0</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="c1"># http://marc.merlins.org/perso/btrfs/post_2014-03-19_Btrfs-Tips_-Btrfs-Scrub-and-Btrfs-Filesystem-Repair.html</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>which<span class="w"> </span>btrfs<span class="w"> </span>&gt;/dev/null<span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">exit</span><span class="w"> </span><span class="m">0</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span>/usr/local/bin:/sbin:<span class="nv">$PATH</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="nv">FILTER</span><span class="o">=</span><span class="s1">'(^Dumping|balancing, usage)'</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="nb">test</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">"</span><span class="nv">$DEVS</span><span class="s2">"</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nv">DEVS</span><span class="o">=</span><span class="k">$(</span>grep<span class="w"> </span><span class="s1">'\&lt;btrfs\&gt;'</span><span class="w"> </span>/proc/mounts<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'{ print $1 }'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-u<span class="k">)</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="k">for</span><span class="w"> </span>btrfs<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$DEVS</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="k">do</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="w">    </span>tail<span class="w"> </span>-n<span class="w"> </span><span class="m">0</span><span class="w"> </span>-f<span class="w"> </span>/var/log/syslog<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span><span class="s2">"BTRFS"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-Evi<span class="w"> </span><span class="s1">'(disk space caching is enabled|unlinked .* orphans|turning on discard|device label .* devid .* transid|enabling SSD mode|BTRFS: has skinny extents|BTRFS: device label)'</span><span class="w"> </span><span class="p">&amp;</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="w">    </span><span class="nv">mountpoint</span><span class="o">=</span><span class="s2">"</span><span class="k">$(</span>grep<span class="w"> </span><span class="s2">"</span><span class="nv">$btrfs</span><span class="s2">"</span><span class="w"> </span>/proc/mounts<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'{ print $2 }'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span><span class="s2">"</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="w">    </span>logger<span class="w"> </span>-s<span class="w"> </span><span class="s2">"Quick Metadata and Data Balance of </span><span class="nv">$mountpoint</span><span class="s2"> (</span><span class="nv">$btrfs</span><span class="s2">)"</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="c1"># Even in 4.3 kernels, you can still get in places where balance</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">    </span><span class="c1"># won't work (no place left, until you run a -m0 one first)</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">    </span>btrfs<span class="w"> </span>balance<span class="w"> </span>start<span class="w"> </span>-musage<span class="o">=</span><span class="m">0</span><span class="w"> </span>-v<span class="w"> </span><span class="nv">$mountpoint</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-Ev<span class="w"> </span><span class="s2">"</span><span class="nv">$FILTER</span><span class="s2">"</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">    </span>btrfs<span class="w"> </span>balance<span class="w"> </span>start<span class="w"> </span>-musage<span class="o">=</span><span class="m">20</span><span class="w"> </span>-v<span class="w"> </span><span class="nv">$mountpoint</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-Ev<span class="w"> </span><span class="s2">"</span><span class="nv">$FILTER</span><span class="s2">"</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="c1"># After metadata, let's do data:</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">    </span>btrfs<span class="w"> </span>balance<span class="w"> </span>start<span class="w"> </span>-dusage<span class="o">=</span><span class="m">0</span><span class="w"> </span>-v<span class="w"> </span><span class="nv">$mountpoint</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-Ev<span class="w"> </span><span class="s2">"</span><span class="nv">$FILTER</span><span class="s2">"</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">    </span>btrfs<span class="w"> </span>balance<span class="w"> </span>start<span class="w"> </span>-dusage<span class="o">=</span><span class="m">20</span><span class="w"> </span>-v<span class="w"> </span><span class="nv">$mountpoint</span><span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-Ev<span class="w"> </span><span class="s2">"</span><span class="nv">$FILTER</span><span class="s2">"</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">    </span><span class="c1"># And now we do scrub. Note that scrub can fail with "no space left</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">    </span><span class="c1"># on device" if you're very out of balance.</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">    </span>logger<span class="w"> </span>-s<span class="w"> </span><span class="s2">"Starting scrub of </span><span class="nv">$mountpoint</span><span class="s2">"</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>btrfs<span class="w"> </span>scrub<span class="w"> </span>start<span class="w"> </span>-Bd<span class="w"> </span><span class="nv">$mountpoint</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">    </span>ionice<span class="w"> </span>-c<span class="w"> </span><span class="m">3</span><span class="w"> </span>nice<span class="w"> </span>-10<span class="w"> </span>btrfs<span class="w"> </span>scrub<span class="w"> </span>start<span class="w"> </span>-Bd<span class="w"> </span><span class="nv">$mountpoint</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">    </span>pkill<span class="w"> </span>-f<span class="w"> </span><span class="s1">'tail -n 0 -f /var/log/syslog'</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">    </span>logger<span class="w"> </span><span class="s2">"Ended scrub of </span><span class="nv">$mountpoint</span><span class="s2">"</span><span class="w"> </span>&gt;<span class="p">&amp;</span><span class="m">2</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="k">done</span>
</span></code></pre></div>
</details>
<div class="language-console highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="gp"># </span>crontab<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>btrfs
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="gp"># </span>m<span class="w"> </span>h<span class="w">  </span>dom<span class="w"> </span>mon<span class="w"> </span>dow<span class="w">   </span><span class="nb">command</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="go">50 5 * * 6 /usr/local/bin/btrfs-scrub-all</span>
</span></code></pre></div>
<h3 id="stop-apparmor-spew-in-the-logs">Stop <code>apparmor</code> spew in the logs</h3>
<p>As seen in previous installs of Ubuntu 24.04 on Rapture and Raven, there is some
log spam from <code>audit</code> in the <code>dmesg</code> logs.
<a href="../../../../2024/11/03/ubuntu-studio-2404-on-rapture-gaming-pc-and-more/#stop-apparmor-spew-in-the-logs">To stop this</a> 
simply install <code>auditd</code>:</p>
<details class="terminal">
<summary><code>apt install auditd</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="gp"># </span>apt<span class="w"> </span>install<span class="w"> </span>auditd<span class="w"> </span>-y
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="go">The following additional packages will be installed:</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="go">  libauparse0t64</span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="go">Suggested packages:</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="go">  audispd-plugins</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="go">The following NEW packages will be installed:</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="go">  auditd libauparse0t64</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="go">0 upgraded, 2 newly installed, 0 to remove and 1 not upgraded.</span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="go">Need to get 274 kB of archives.</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="go">After this operation, 893 kB of additional disk space will be used.</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="go">Get:1 http://ch.archive.ubuntu.com/ubuntu noble-updates/main amd64 libauparse0t64 amd64 1:3.1.2-2.1build1.1 [58.9 kB]</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a><span class="go">Get:2 http://ch.archive.ubuntu.com/ubuntu noble-updates/main amd64 auditd amd64 1:3.1.2-2.1build1.1 [215 kB]</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="go">Fetched 274 kB in 0s (1,148 kB/s)</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="go">Selecting previously unselected package libauparse0t64:amd64.</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="gp gp-VirtualEnv">(Reading database ... 87398 files and directories currently installed.)</span>
</span><span id="__span-17-19"><a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="go">Preparing to unpack .../libauparse0t64_1%3a3.1.2-2.1build1.1_amd64.deb ...</span>
</span><span id="__span-17-20"><a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="go">Adding 'diversion of /lib/x86_64-linux-gnu/libauparse.so.0 to /lib/x86_64-linux-gnu/libauparse.so.0.usr-is-merged by libauparse0t64'</span>
</span><span id="__span-17-21"><a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="go">Adding 'diversion of /lib/x86_64-linux-gnu/libauparse.so.0.0.0 to /lib/x86_64-linux-gnu/libauparse.so.0.0.0.usr-is-merged by libauparse0t64'</span>
</span><span id="__span-17-22"><a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="go">Unpacking libauparse0t64:amd64 (1:3.1.2-2.1build1.1) ...</span>
</span><span id="__span-17-23"><a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a><span class="go">Selecting previously unselected package auditd.</span>
</span><span id="__span-17-24"><a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="go">Preparing to unpack .../auditd_1%3a3.1.2-2.1build1.1_amd64.deb ...</span>
</span><span id="__span-17-25"><a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="go">Unpacking auditd (1:3.1.2-2.1build1.1) ...</span>
</span><span id="__span-17-26"><a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="go">Setting up libauparse0t64:amd64 (1:3.1.2-2.1build1.1) ...</span>
</span><span id="__span-17-27"><a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="go">Setting up auditd (1:3.1.2-2.1build1.1) ...</span>
</span><span id="__span-17-28"><a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="go">Created symlink /etc/systemd/system/multi-user.target.wants/auditd.service  /usr/lib/systemd/system/auditd.service.</span>
</span><span id="__span-17-29"><a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="go">Processing triggers for man-db (2.12.0-4build2) ...</span>
</span><span id="__span-17-30"><a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="go">Processing triggers for libc-bin (2.39-0ubuntu8.4) ...</span>
</span><span id="__span-17-31"><a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="go">Scanning processes...                                                                                         </span>
</span><span id="__span-17-32"><a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="go">Scanning processor microcode...                                                                               </span>
</span><span id="__span-17-33"><a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="go">Scanning linux images...                                                                                      </span>
</span><span id="__span-17-34"><a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a>
</span><span id="__span-17-35"><a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="go">Running kernel seems to be up-to-date.</span>
</span><span id="__span-17-36"><a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a>
</span><span id="__span-17-37"><a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a><span class="go">The processor microcode seems to be up-to-date.</span>
</span><span id="__span-17-38"><a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a>
</span><span id="__span-17-39"><a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="go">No services need to be restarted.</span>
</span><span id="__span-17-40"><a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a>
</span><span id="__span-17-41"><a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="go">No containers need to be restarted.</span>
</span><span id="__span-17-42"><a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a>
</span><span id="__span-17-43"><a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="go">No user sessions are running outdated binaries.</span>
</span><span id="__span-17-44"><a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>
</span><span id="__span-17-45"><a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a><span class="go">No VM guests are running outdated hypervisor (qemu) binaries on this host.</span>
</span></code></pre></div>
</details>
<h3 id="nas-nfs-mount">NAS NFS mount</h3>
<p>Add the <a href="../../18/synology-ds423-for-the-homelab-luggage/#nfs">NFS mount</a>
in <code>/etc/fstab</code> to mount <code>/home/nas</code>, create the directory and mount it.</p>
<h3 id="continuous-monitoring">Continuous Monitoring</h3>
<p><a href="../../../../../projects/conmon/#install-conmon">Install Continuous Monitoring</a> and
report metrics to <code>lexicon</code> on its <code>NodePort</code> (30086).</p>
<h2 id="remote-access">Remote Access</h2>
<p><a href="../../../03/28/remote-access-options-for-self-hosted-services/">Remote access options for self-hosted services</a>
may no longer require opening any ports in the router for this server,
although that option remains available should it become necessary.</p>
<h3 id="cloudflare-tunnel">Cloudflare Tunnel</h3>
<p><a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#cloudflare-tunnel">Cloudflare Tunnels in <code>alfred</code></a>
proved to be a good solution for making web sites externally available but still
<a href="../../../03/28/remote-access-options-for-self-hosted-services/#cloudflare-access">protected behind SSO with Zero Trust Web Access</a>.
Since all that was already setup, and there are no services running in this server yet,
all there is to do here and now is just install <code>cloudflared</code> and join.</p>
<p>Install the latest <code>cloudflared</code> using the instructions provided for
<a href="https://pkg.cloudflare.com/index.html#debian-any">Ubuntu 24.04</a>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="gp"># </span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://pkg.cloudflare.com/cloudflare-main.gpg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/usr/share/keyrings/cloudflare-main.gpg<span class="w"> </span>&gt;/dev/null
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="gp"># </span><span class="nb">echo</span><span class="w"> </span><span class="s1">'deb [signed-by=/usr/share/keyrings/cloudflare-main.gpg] https://pkg.cloudflare.com/cloudflared noble main'</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/cloudflared.list
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="gp"># </span>install<span class="w"> </span>cloudflared
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="go">sudo apt-get update &amp;&amp; sudo apt-get install cloudflared</span>
</span></code></pre></div>
<p>Then run the command to connect to the new tunnel:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="gp"># </span>cloudflared<span class="w"> </span>service<span class="w"> </span>install<span class="w"> </span>eyJhIjoiMD...
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="go">2025-04-18T21:45:27Z INF Using Systemd</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="go">2025-04-18T21:45:27Z INF Linux service for cloudflared installed successfully</span>
</span></code></pre></div>
<p>Although a public hostname is not yet necessary for this tunnel, create one for
<a href="https://kubernetes-octavo.very-very-dark-gray.top/">https://kubernetes-octavo.very-very-dark-gray.top/</a> to be used later for the
Kubernetes Dashboard, just pointing to <a href="https://localhost">https://localhost</a> for now. Make sure to <strong>enable</strong> the <strong>TLS</strong> option <strong>No TLS Verify</strong>, so the tunnel can be used <strong>without</strong>
<a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#https-certificates">HTTPS certificates</a>
since they do not seem to be necessary when using Cloudflare tunnels.</p>
<h3 id="tailscale">Tailscale</h3>
<p><a href="../../../03/28/remote-access-options-for-self-hosted-services/#tailscale">Install Tailscale</a>
and connect the server to the alredy existing tailnet:</p>
<details class="terminal">
<summary>Installation of Tailscale on <strong>octavo</strong></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="gp"># </span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://tailscale.com/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="go">Installing Tailscale for ubuntu noble, using method apt</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="go">+ mkdir -p --mode=0755 /usr/share/keyrings</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="go">+ curl -fsSL https://pkgs.tailscale.com/stable/ubuntu/noble.noarmor.gpg</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="go">+ tee /usr/share/keyrings/tailscale-archive-keyring.gpg</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="go">+ chmod 0644 /usr/share/keyrings/tailscale-archive-keyring.gpg</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="go">+ curl -fsSL https://pkgs.tailscale.com/stable/ubuntu/noble.tailscale-keyring.list</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="go">+ tee /etc/apt/sources.list.d/tailscale.list</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="gp"># </span>Tailscale<span class="w"> </span>packages<span class="w"> </span><span class="k">for</span><span class="w"> </span>ubuntu<span class="w"> </span>noble
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="go">deb [signed-by=/usr/share/keyrings/tailscale-archive-keyring.gpg] https://pkgs.tailscale.com/stable/ubuntu noble main</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="go">+ chmod 0644 /etc/apt/sources.list.d/tailscale.list</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="go">+ apt-get update</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="go">Hit:1 http://ch.archive.ubuntu.com/ubuntu noble InRelease</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="go">Get:2 http://ch.archive.ubuntu.com/ubuntu noble-updates InRelease [126 kB]                                   </span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a><span class="go">Hit:3 https://pkg.cloudflare.com/cloudflared noble InRelease                                                 </span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a><span class="go">Hit:4 http://ch.archive.ubuntu.com/ubuntu noble-backports InRelease                                          </span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#__codelineno-20-17"></a><span class="go">Hit:5 http://security.ubuntu.com/ubuntu noble-security InRelease                                             </span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#__codelineno-20-18"></a><span class="go">Get:6 https://pkgs.tailscale.com/stable/ubuntu noble InRelease                                            </span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#__codelineno-20-19"></a><span class="go">Get:7 https://pkgs.tailscale.com/stable/ubuntu noble/main all Packages [354 B]</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#__codelineno-20-20"></a><span class="go">Get:8 https://pkgs.tailscale.com/stable/ubuntu noble/main amd64 Packages [12.8 kB]</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#__codelineno-20-21"></a><span class="go">Get:9 https://esm.ubuntu.com/apps/ubuntu noble-apps-security InRelease [7,595 B]</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#__codelineno-20-22"></a><span class="go">Get:10 https://esm.ubuntu.com/apps/ubuntu noble-apps-updates InRelease [7,480 B]</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#__codelineno-20-23"></a><span class="go">Get:11 https://esm.ubuntu.com/infra/ubuntu noble-infra-security InRelease [7,474 B]</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#__codelineno-20-24"></a><span class="go">Get:12 https://esm.ubuntu.com/infra/ubuntu noble-infra-updates InRelease [7,473 B]</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#__codelineno-20-25"></a><span class="go">Fetched 176 kB in 3s (64.1 kB/s)      </span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#__codelineno-20-26"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#__codelineno-20-27"></a><span class="go">+ apt-get install -y tailscale tailscale-archive-keyring</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#__codelineno-20-28"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#__codelineno-20-29"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#__codelineno-20-30"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#__codelineno-20-31"></a><span class="go">The following NEW packages will be installed:</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#__codelineno-20-32"></a><span class="go">  tailscale tailscale-archive-keyring</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#__codelineno-20-33"></a><span class="go">0 upgraded, 2 newly installed, 0 to remove and 1 not upgraded.</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#__codelineno-20-34"></a><span class="go">Need to get 31.5 MB of archives.</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#__codelineno-20-35"></a><span class="go">After this operation, 59.1 MB of additional disk space will be used.</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#__codelineno-20-36"></a><span class="go">Get:2 https://pkgs.tailscale.com/stable/ubuntu noble/main all tailscale-archive-keyring all 1.35.181 [3,082 B]</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#__codelineno-20-37"></a><span class="go">Get:1 https://pkgs.tailscale.com/stable/ubuntu noble/main amd64 tailscale amd64 1.82.5 [31.5 MB]</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#__codelineno-20-38"></a><span class="go">Fetched 31.5 MB in 13s (2,462 kB/s)                                                                          </span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#__codelineno-20-39"></a><span class="go">Selecting previously unselected package tailscale.</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#__codelineno-20-40"></a><span class="gp gp-VirtualEnv">(Reading database ... 125870 files and directories currently installed.)</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#__codelineno-20-41"></a><span class="go">Preparing to unpack .../tailscale_1.82.5_amd64.deb ...</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#__codelineno-20-42"></a><span class="go">Unpacking tailscale (1.82.5) ...</span>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#__codelineno-20-43"></a><span class="go">Selecting previously unselected package tailscale-archive-keyring.</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#__codelineno-20-44"></a><span class="go">Preparing to unpack .../tailscale-archive-keyring_1.35.181_all.deb ...</span>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45" href="#__codelineno-20-45"></a><span class="go">Unpacking tailscale-archive-keyring (1.35.181) ...</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46" href="#__codelineno-20-46"></a><span class="go">Setting up tailscale-archive-keyring (1.35.181) ...</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47" href="#__codelineno-20-47"></a><span class="go">Setting up tailscale (1.82.5) ...</span>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48" href="#__codelineno-20-48"></a><span class="go">Created symlink /etc/systemd/system/multi-user.target.wants/tailscaled.service  /usr/lib/systemd/system/tailscaled.service.</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49" href="#__codelineno-20-49"></a><span class="go">Scanning processes...                                                                                         </span>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50" href="#__codelineno-20-50"></a><span class="go">Scanning processor microcode...                                                                               </span>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51" href="#__codelineno-20-51"></a><span class="go">Scanning linux images...                                                                                      </span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52" href="#__codelineno-20-52"></a>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53" href="#__codelineno-20-53"></a><span class="go">Running kernel seems to be up-to-date.</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54" href="#__codelineno-20-54"></a>
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55" href="#__codelineno-20-55"></a><span class="go">The processor microcode seems to be up-to-date.</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56" href="#__codelineno-20-56"></a>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57" href="#__codelineno-20-57"></a><span class="go">No services need to be restarted.</span>
</span><span id="__span-20-58"><a id="__codelineno-20-58" name="__codelineno-20-58" href="#__codelineno-20-58"></a>
</span><span id="__span-20-59"><a id="__codelineno-20-59" name="__codelineno-20-59" href="#__codelineno-20-59"></a><span class="go">No containers need to be restarted.</span>
</span><span id="__span-20-60"><a id="__codelineno-20-60" name="__codelineno-20-60" href="#__codelineno-20-60"></a>
</span><span id="__span-20-61"><a id="__codelineno-20-61" name="__codelineno-20-61" href="#__codelineno-20-61"></a><span class="go">No user sessions are running outdated binaries.</span>
</span><span id="__span-20-62"><a id="__codelineno-20-62" name="__codelineno-20-62" href="#__codelineno-20-62"></a>
</span><span id="__span-20-63"><a id="__codelineno-20-63" name="__codelineno-20-63" href="#__codelineno-20-63"></a><span class="go">No VM guests are running outdated hypervisor (qemu) binaries on this host.</span>
</span><span id="__span-20-64"><a id="__codelineno-20-64" name="__codelineno-20-64" href="#__codelineno-20-64"></a><span class="go">+ [ false = true ]</span>
</span><span id="__span-20-65"><a id="__codelineno-20-65" name="__codelineno-20-65" href="#__codelineno-20-65"></a><span class="go">+ set +x</span>
</span><span id="__span-20-66"><a id="__codelineno-20-66" name="__codelineno-20-66" href="#__codelineno-20-66"></a><span class="go">Installation complete! Log in to start using Tailscale by running:</span>
</span><span id="__span-20-67"><a id="__codelineno-20-67" name="__codelineno-20-67" href="#__codelineno-20-67"></a>
</span><span id="__span-20-68"><a id="__codelineno-20-68" name="__codelineno-20-68" href="#__codelineno-20-68"></a><span class="go">tailscale up</span>
</span></code></pre></div>
</details>
<p>After installing the software, running <code>tailscale up</code> will provide a URL to 
authenticate and add the server to the tailnet:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="gp"># </span>tailscale<span class="w"> </span>up
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="go">To authenticate, visit:</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="go">        https://login.tailscale.com/a/______________</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="go">Success.</span>
</span></code></pre></div>
<p>Once added to the tailnet, an SSH connection to <code>octavo.royal-penny.ts.net</code> instantly
connects to <code>octavo</code> and SSH key authentication just works (after accepting this new
hostname).</p>
<p>Additional setup will be needed later on, once services are running on Kubernetes:</p>
<ol>
<li>Install the <a href="../../../03/28/remote-access-options-for-self-hosted-services/#tailscale-kubernetes-operator">Tailscale Kubernetes operator</a>
    and add an <code>Ingress</code> to use it.</li>
<li>Optional: enable <a href="../../../03/28/remote-access-options-for-self-hosted-services/#public-access-through-funnel">Public access through Funnel</a>
    for services that need to be accessible from outside the tailnet.</li>
</ol>
<h2 id="kubernetes">Kubernetes</h2>
<p><a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#kubernetes">Kubernetes on Raspberry Pi 5 (<code>alfred</code>)</a>
showed quite a few <em>new hurdles</em> caused by newer versions of Kubernetes (v1.32.2) and
a few components; this most recent installation will be the main guide this time. On top
of that, <a href="../../../../../projects/self-hosting/#applications-installed">Applications Installed</a>
and each application-specific post linked from there, will provide most of the guidance
to install those applications to be <em>migrated</em> (here) to the new server. The old
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/">Single-node Kubernetes cluster on an Intel NUC: lexicon</a>
may not add much at this point.</p>
<h3 id="github-repository">GitHub Repository</h3>
<p>Use the same <a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#github-repository">GitHub Repository</a>
as before and create a new directory for the new server:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="gp">$ </span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:xxxx/kubernetes-deployments.git
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>kubernetes-deployments/
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="gp">$ </span>mkdir<span class="w"> </span>octavo
</span></code></pre></div>
<details class="note">
<summary>Initial Git+SSH setup</summary>
<p>Each new server requires an initial setup to authenticate with GitHub, using 
<a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent">a new SSH key</a>,
adding to the authorized SSH keys in the GitHub account, and coping <code>.gitconfig</code>
from a previous server.</p>
</details>
<h3 id="storage-requirements">Storage Requirements</h3>
<p>Docker and <code>containerd</code> store images under <code>/var/lib</code> by default, which is why the
<a href="#install-ubuntu-server-2404">when installing Ubuntu Server</a> a dedicated partition
is created for <code>/var/lib</code>, so that it will (should) not be necessary to move images
to the <code>/home</code> partition.</p>
<h3 id="install-helm">Install Helm</h3>
<p><a href="https://helm.sh/docs/intro/install/#from-apt-debianubuntu">Install helm from APT</a>
because it will be required to install certain components later
(e.g. <a href="#kubernets-dashboard">Kubernetes Dashboard</a>):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="gp">$ </span>curl<span class="w"> </span>https://baltocdn.com/helm/signing.asc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/etc/apt/keyrings/helm.gpg
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="s2">"deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/etc/apt/keyrings/helm.gpg] https://baltocdn.com/helm/stable/debian/ all main"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/helm-stable-debian.list
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>helm
</span></code></pre></div>
<h3 id="install-kubernetes">Install Kubernetes</h3>
<p><a href="https://cdn.dl.k8s.io/release/stable.txt">Kubernetes current stable release</a> is now
v1.33.<strong>0</strong> which is only the <strong>1st</strong> patch in 1.33 and came out only a few days ago,
so instead install the more stable <strong>v1.32</strong>.
<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl">Install kubeadm, kubelet and kubectl</a> from Debian packages:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="gp">$ </span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://pkgs.k8s.io/core:/stable:/v1.32/deb/Release.key<span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/etc/apt/keyrings/kubernetes-apt-keyring.gpg
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="gp">$ </span>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">644</span><span class="w"> </span>/etc/apt/keyrings/kubernetes-apt-keyring.gpg
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="s1">'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.32/deb/ /'</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/kubernetes.list
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span></code></pre></div>
<p>Once the APT repository is ready, install the packages:</p>
<details class="terminal">
<summary><code>$ sudo apt-get install -y kubelet kubeadm kubectl</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>kubelet<span class="w"> </span>kubeadm<span class="w"> </span>kubectl
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="go">The following additional packages will be installed:</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="go">  conntrack cri-tools kubernetes-cni</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="go">The following NEW packages will be installed:</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="go">  conntrack cri-tools kubeadm kubectl kubelet kubernetes-cni</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="go">0 upgraded, 6 newly installed, 0 to remove and 1 not upgraded.</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="go">Need to get 92.7 MB of archives.</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="go">After this operation, 338 MB of additional disk space will be used.</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="go">Get:1 http://ch.archive.ubuntu.com/ubuntu noble/main amd64 conntrack amd64 1:1.4.8-1ubuntu1 [37.9 kB]</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="go">Get:2 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.32/deb  cri-tools 1.32.0-1.1 [16.3 MB]</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="go">Get:3 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.32/deb  kubeadm 1.32.4-1.1 [12.2 MB]</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="go">Get:4 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.32/deb  kubectl 1.32.4-1.1 [11.2 MB]</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="go">Get:5 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.32/deb  kubernetes-cni 1.6.0-1.1 [37.8 MB]</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="go">Get:6 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.32/deb  kubelet 1.32.4-1.1 [15.2 MB]</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="go">Fetched 92.7 MB in 1s (66.3 MB/s)</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="go">Selecting previously unselected package conntrack.</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="gp gp-VirtualEnv">(Reading database ... 140718 files and directories currently installed.)</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="go">Preparing to unpack .../0-conntrack_1%3a1.4.8-1ubuntu1_amd64.deb ...</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="go">Unpacking conntrack (1:1.4.8-1ubuntu1) ...</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="go">Selecting previously unselected package cri-tools.</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="go">Preparing to unpack .../1-cri-tools_1.32.0-1.1_amd64.deb ...</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#__codelineno-25-25"></a><span class="go">Unpacking cri-tools (1.32.0-1.1) ...</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#__codelineno-25-26"></a><span class="go">Selecting previously unselected package kubeadm.</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#__codelineno-25-27"></a><span class="go">Preparing to unpack .../2-kubeadm_1.32.4-1.1_amd64.deb ...</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#__codelineno-25-28"></a><span class="go">Unpacking kubeadm (1.32.4-1.1) ...</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#__codelineno-25-29"></a><span class="go">Selecting previously unselected package kubectl.</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#__codelineno-25-30"></a><span class="go">Preparing to unpack .../3-kubectl_1.32.4-1.1_amd64.deb ...</span>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#__codelineno-25-31"></a><span class="go">Unpacking kubectl (1.32.4-1.1) ...</span>
</span><span id="__span-25-32"><a id="__codelineno-25-32" name="__codelineno-25-32" href="#__codelineno-25-32"></a><span class="go">Selecting previously unselected package kubernetes-cni.</span>
</span><span id="__span-25-33"><a id="__codelineno-25-33" name="__codelineno-25-33" href="#__codelineno-25-33"></a><span class="go">Preparing to unpack .../4-kubernetes-cni_1.6.0-1.1_amd64.deb ...</span>
</span><span id="__span-25-34"><a id="__codelineno-25-34" name="__codelineno-25-34" href="#__codelineno-25-34"></a><span class="go">Unpacking kubernetes-cni (1.6.0-1.1) ...</span>
</span><span id="__span-25-35"><a id="__codelineno-25-35" name="__codelineno-25-35" href="#__codelineno-25-35"></a><span class="go">Selecting previously unselected package kubelet.</span>
</span><span id="__span-25-36"><a id="__codelineno-25-36" name="__codelineno-25-36" href="#__codelineno-25-36"></a><span class="go">Preparing to unpack .../5-kubelet_1.32.4-1.1_amd64.deb ...</span>
</span><span id="__span-25-37"><a id="__codelineno-25-37" name="__codelineno-25-37" href="#__codelineno-25-37"></a><span class="go">Unpacking kubelet (1.32.4-1.1) ...</span>
</span><span id="__span-25-38"><a id="__codelineno-25-38" name="__codelineno-25-38" href="#__codelineno-25-38"></a><span class="go">Setting up conntrack (1:1.4.8-1ubuntu1) ...</span>
</span><span id="__span-25-39"><a id="__codelineno-25-39" name="__codelineno-25-39" href="#__codelineno-25-39"></a><span class="go">Setting up kubectl (1.32.4-1.1) ...</span>
</span><span id="__span-25-40"><a id="__codelineno-25-40" name="__codelineno-25-40" href="#__codelineno-25-40"></a><span class="go">Setting up cri-tools (1.32.0-1.1) ...</span>
</span><span id="__span-25-41"><a id="__codelineno-25-41" name="__codelineno-25-41" href="#__codelineno-25-41"></a><span class="go">Setting up kubernetes-cni (1.6.0-1.1) ...</span>
</span><span id="__span-25-42"><a id="__codelineno-25-42" name="__codelineno-25-42" href="#__codelineno-25-42"></a><span class="go">Setting up kubeadm (1.32.4-1.1) ...</span>
</span><span id="__span-25-43"><a id="__codelineno-25-43" name="__codelineno-25-43" href="#__codelineno-25-43"></a><span class="go">Setting up kubelet (1.32.4-1.1) ...</span>
</span><span id="__span-25-44"><a id="__codelineno-25-44" name="__codelineno-25-44" href="#__codelineno-25-44"></a><span class="go">Processing triggers for man-db (2.12.0-4build2) ...</span>
</span><span id="__span-25-45"><a id="__codelineno-25-45" name="__codelineno-25-45" href="#__codelineno-25-45"></a><span class="go">Scanning processes...                                                                                         </span>
</span><span id="__span-25-46"><a id="__codelineno-25-46" name="__codelineno-25-46" href="#__codelineno-25-46"></a><span class="go">Scanning processor microcode...                                                                               </span>
</span><span id="__span-25-47"><a id="__codelineno-25-47" name="__codelineno-25-47" href="#__codelineno-25-47"></a><span class="go">Scanning linux images...                                                                                      </span>
</span><span id="__span-25-48"><a id="__codelineno-25-48" name="__codelineno-25-48" href="#__codelineno-25-48"></a>
</span><span id="__span-25-49"><a id="__codelineno-25-49" name="__codelineno-25-49" href="#__codelineno-25-49"></a><span class="go">Running kernel seems to be up-to-date.</span>
</span><span id="__span-25-50"><a id="__codelineno-25-50" name="__codelineno-25-50" href="#__codelineno-25-50"></a>
</span><span id="__span-25-51"><a id="__codelineno-25-51" name="__codelineno-25-51" href="#__codelineno-25-51"></a><span class="go">The processor microcode seems to be up-to-date.</span>
</span><span id="__span-25-52"><a id="__codelineno-25-52" name="__codelineno-25-52" href="#__codelineno-25-52"></a>
</span><span id="__span-25-53"><a id="__codelineno-25-53" name="__codelineno-25-53" href="#__codelineno-25-53"></a><span class="go">No services need to be restarted.</span>
</span><span id="__span-25-54"><a id="__codelineno-25-54" name="__codelineno-25-54" href="#__codelineno-25-54"></a>
</span><span id="__span-25-55"><a id="__codelineno-25-55" name="__codelineno-25-55" href="#__codelineno-25-55"></a><span class="go">No containers need to be restarted.</span>
</span><span id="__span-25-56"><a id="__codelineno-25-56" name="__codelineno-25-56" href="#__codelineno-25-56"></a>
</span><span id="__span-25-57"><a id="__codelineno-25-57" name="__codelineno-25-57" href="#__codelineno-25-57"></a><span class="go">No user sessions are running outdated binaries.</span>
</span><span id="__span-25-58"><a id="__codelineno-25-58" name="__codelineno-25-58" href="#__codelineno-25-58"></a>
</span><span id="__span-25-59"><a id="__codelineno-25-59" name="__codelineno-25-59" href="#__codelineno-25-59"></a><span class="go">No VM guests are running outdated hypervisor (qemu) binaries on this host.</span>
</span></code></pre></div>
</details>
<p>And then, because updating Kubernetes is a rather involved process, hold them:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt-mark<span class="w"> </span>hold<span class="w"> </span>kubelet<span class="w"> </span>kubeadm<span class="w"> </span>kubectl
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="go">kubelet set on hold.</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="go">kubeadm set on hold.</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="go">kubectl set on hold.</span>
</span></code></pre></div>
<p>Note that the latest patch at this time is v1.32.<strong>4</strong>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="gp"># </span>kubectl<span class="w"> </span>version<span class="w"> </span>--output<span class="o">=</span>yaml
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="go">clientVersion:</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="go">  buildDate: "2025-04-22T16:03:58Z"</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="go">  compiler: gc</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="go">  gitCommit: 59526cd4867447956156ae3a602fcbac10a2c335</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="go">  gitTreeState: clean</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="hll"><span class="go">  gitVersion: v1.32.4</span>
</span></span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="go">  goVersion: go1.23.6</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="go">  major: "1"</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="go">  minor: "32"</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="go">  platform: linux/amd64</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="go">kustomizeVersion: v5.5.0</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="go">The connection to the server localhost:8080 was refused - did you specify the right host or port?</span>
</span></code></pre></div>
<p><a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#enable-kubectl-autocompletion">Enabling shell autocompletion</a>
for <code>kubectl</code> is very easy, since bash-completion is already installed:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>completion<span class="w"> </span>bash<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/bash_completion.d/kubectl<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="gp">$ </span>sudo<span class="w"> </span>chmod<span class="w"> </span>a+r<span class="w"> </span>/etc/bash_completion.d/kubectl
</span></code></pre></div>
<h4 id="enable-the-kubelet-service">Enable the kubelet service</h4>
<p>This step is only really necessary later, before 
<a href="#bootstrap-with-kubeadm">bootstrapping the cluster with <code>kubeadm</code></a>,
but it can be done any time; the service will just be waiting:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>kubelet
</span></code></pre></div>
<h3 id="install-container-runtime">Install container runtime</h3>
<h4 id="networking-setup">Networking setup</h4>
<p><a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/#prerequisite-ipv4-forwarding-optional">Enabling IPv4 packet forwarding</a>
is required for Kubernetes network and is <strong>not</strong> enabled by default:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>net.ipv4.ip_forward
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="hll"><span class="go">net.ipv4.ip_forward = 0</span>
</span></span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="gp">$ </span>cat<span class="w"> </span>&lt;&lt;EOF<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/sysctl.d/k8s.conf
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="go">net.ipv4.ip_forward = 1</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a><span class="go">EOF</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a><span class="gp">$ </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>--system
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a><span class="go">* Applying /usr/lib/sysctl.d/10-apparmor.conf ...</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a><span class="go">* Applying /etc/sysctl.d/10-bufferbloat.conf ...</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a><span class="go">* Applying /etc/sysctl.d/10-console-messages.conf ...</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a><span class="go">* Applying /etc/sysctl.d/10-ipv6-privacy.conf ...</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a><span class="go">* Applying /etc/sysctl.d/10-kernel-hardening.conf ...</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a><span class="go">* Applying /etc/sysctl.d/10-magic-sysrq.conf ...</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="go">* Applying /etc/sysctl.d/10-map-count.conf ...</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#__codelineno-30-16"></a><span class="go">* Applying /etc/sysctl.d/10-network-security.conf ...</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#__codelineno-30-17"></a><span class="go">* Applying /etc/sysctl.d/10-ptrace.conf ...</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#__codelineno-30-18"></a><span class="go">* Applying /etc/sysctl.d/10-zeropage.conf ...</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#__codelineno-30-19"></a><span class="go">* Applying /usr/lib/sysctl.d/50-pid-max.conf ...</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#__codelineno-30-20"></a><span class="go">* Applying /usr/lib/sysctl.d/99-protect-links.conf ...</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#__codelineno-30-21"></a><span class="go">* Applying /etc/sysctl.d/99-sysctl.conf ...</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#__codelineno-30-22"></a><span class="go">* Applying /etc/sysctl.d/k8s.conf ...</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#__codelineno-30-23"></a><span class="go">* Applying /etc/sysctl.conf ...</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#__codelineno-30-24"></a><span class="go">kernel.apparmor_restrict_unprivileged_userns = 1</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#__codelineno-30-25"></a><span class="go">net.core.default_qdisc = fq_codel</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#__codelineno-30-26"></a><span class="go">kernel.printk = 4 4 1 7</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#__codelineno-30-27"></a><span class="go">net.ipv6.conf.all.use_tempaddr = 2</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#__codelineno-30-28"></a><span class="go">net.ipv6.conf.default.use_tempaddr = 2</span>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#__codelineno-30-29"></a><span class="go">kernel.kptr_restrict = 1</span>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#__codelineno-30-30"></a><span class="go">kernel.sysrq = 176</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#__codelineno-30-31"></a><span class="go">vm.max_map_count = 1048576</span>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32" href="#__codelineno-30-32"></a><span class="go">net.ipv4.conf.default.rp_filter = 2</span>
</span><span id="__span-30-33"><a id="__codelineno-30-33" name="__codelineno-30-33" href="#__codelineno-30-33"></a><span class="go">net.ipv4.conf.all.rp_filter = 2</span>
</span><span id="__span-30-34"><a id="__codelineno-30-34" name="__codelineno-30-34" href="#__codelineno-30-34"></a><span class="go">kernel.yama.ptrace_scope = 1</span>
</span><span id="__span-30-35"><a id="__codelineno-30-35" name="__codelineno-30-35" href="#__codelineno-30-35"></a><span class="go">vm.mmap_min_addr = 65536</span>
</span><span id="__span-30-36"><a id="__codelineno-30-36" name="__codelineno-30-36" href="#__codelineno-30-36"></a><span class="go">kernel.pid_max = 4194304</span>
</span><span id="__span-30-37"><a id="__codelineno-30-37" name="__codelineno-30-37" href="#__codelineno-30-37"></a><span class="go">fs.protected_fifos = 1</span>
</span><span id="__span-30-38"><a id="__codelineno-30-38" name="__codelineno-30-38" href="#__codelineno-30-38"></a><span class="go">fs.protected_hardlinks = 1</span>
</span><span id="__span-30-39"><a id="__codelineno-30-39" name="__codelineno-30-39" href="#__codelineno-30-39"></a><span class="go">fs.protected_regular = 2</span>
</span><span id="__span-30-40"><a id="__codelineno-30-40" name="__codelineno-30-40" href="#__codelineno-30-40"></a><span class="go">fs.protected_symlinks = 1</span>
</span><span id="__span-30-41"><a id="__codelineno-30-41" name="__codelineno-30-41" href="#__codelineno-30-41"></a><span class="hll"><span class="go">net.ipv4.ip_forward = 1</span>
</span></span></code></pre></div>
<p>This alone <em>was not enough</em> for the successful deployment of the 
<a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#network-plugin">Network plugin in <code>alfred</code></a>
required after bootstraping the cluster. Additional setup proved to be required to
<a href="https://v1-29.docs.kubernetes.io/docs/setup/production-environment/container-runtimes/#forwarding-ipv4-and-letting-iptables-see-bridged-traffic">let iptables see bridged traffic</a>,
supposedly required only up to <strong>v1.29</strong>, when omitting these steps led to
<a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#troubleshooting-flannel">the <code>kube-flannel</code> deployment failing to start up</a>
(stuck in a crash loop):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>modprobe<span class="w"> </span>overlay
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="gp">$ </span>sudo<span class="w"> </span>modprobe<span class="w"> </span>br_netfilter
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="gp">$ </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/modules-load.d/k8s.conf&lt;&lt;EOF
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="go">br_netfilter</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="go">overlay</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="go">EOF</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="gp">$ </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/sysctl.d/k8s.conf&lt;&lt;EOF
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="go">net.bridge.bridge-nf-call-ip6tables = 1</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="go">net.bridge.bridge-nf-call-iptables = 1</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="go">net.ipv4.ip_forward = 1</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="go">EOF</span>
</span></code></pre></div>
<p>Reboot the system to make sure that the changes are permanent:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>sysctl<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s1">'net.ipv4.ip_forward |net.bridge.bridge-nf-call-ip'</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="go">net.bridge.bridge-nf-call-ip6tables = 1</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="go">net.bridge.bridge-nf-call-iptables = 1</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="go">net.ipv4.ip_forward = 1</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="gp">$ </span>lsmod<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s1">'overlay|bridge'</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="go">overlay               212992  0</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="go">bridge                421888  1 br_netfilter</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="go">stp                    12288  1 bridge</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="go">llc                    16384  2 bridge,stp</span>
</span></code></pre></div>
<h4 id="install-containerd">Install containerd</h4>
<p><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-runtime">Installing a container runtime</a>
comes next, with <code>containerd</code> being the runtime of choice.
<a href="https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository">Install using the apt repository</a>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">  </span>-o<span class="w"> </span>/etc/apt/keyrings/docker.asc
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="gp">$ </span>sudo<span class="w"> </span>chmod<span class="w"> </span>a+r<span class="w"> </span>/etc/apt/keyrings/docker.asc
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="w">  </span><span class="s2">"deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="gp">  $</span><span class="s2">(. /etc/os-release &amp;&amp; echo "</span><span class="nv">$VERSION_CODENAME</span><span class="s2">") stable"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="w">  </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/docker.list<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span></code></pre></div>
<p>Once the APT repository is ready, install the packages:</p>
<details class="terminal">
<summary><code>$ sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io<span class="w"> </span>docker-buildx-plugin<span class="w"> </span>docker-compose-plugin
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="go">The following additional packages will be installed:</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="go">  docker-ce-rootless-extras libltdl7 libslirp0 pigz slirp4netns</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="go">Suggested packages:</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="go">  cgroupfs-mount | cgroup-lite</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="go">The following NEW packages will be installed:</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="go">  containerd.io docker-buildx-plugin docker-ce docker-ce-cli docker-ce-rootless-extras docker-compose-plugin</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="go">  libltdl7 libslirp0 pigz slirp4netns</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="go">0 upgraded, 10 newly installed, 0 to remove and 1 not upgraded.</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="go">Need to get 120 MB of archives.</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="go">After this operation, 440 MB of additional disk space will be used.</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="go">Get:1 http://ch.archive.ubuntu.com/ubuntu noble/universe amd64 pigz amd64 2.8-1 [65.6 kB]</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="go">Get:2 https://download.docker.com/linux/ubuntu noble/stable amd64 containerd.io amd64 1.7.27-1 [30.5 MB]</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="go">Get:3 http://ch.archive.ubuntu.com/ubuntu noble/main amd64 libltdl7 amd64 2.4.7-7build1 [40.3 kB]</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="go">Get:4 http://ch.archive.ubuntu.com/ubuntu noble/main amd64 libslirp0 amd64 4.7.0-1ubuntu3 [63.8 kB]</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="go">Get:5 http://ch.archive.ubuntu.com/ubuntu noble/universe amd64 slirp4netns amd64 1.2.1-1build2 [34.9 kB]</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="go">Get:6 https://download.docker.com/linux/ubuntu noble/stable amd64 docker-buildx-plugin amd64 0.23.0-1~ubuntu.24.04~noble [34.6 MB]</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="go">Get:7 https://download.docker.com/linux/ubuntu noble/stable amd64 docker-ce-cli amd64 5:28.1.1-1~ubuntu.24.04~noble [15.8 MB]</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="go">Get:8 https://download.docker.com/linux/ubuntu noble/stable amd64 docker-ce amd64 5:28.1.1-1~ubuntu.24.04~noble [19.2 MB]</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="go">Get:9 https://download.docker.com/linux/ubuntu noble/stable amd64 docker-ce-rootless-extras amd64 5:28.1.1-1~ubuntu.24.04~noble [6,092 kB]</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="go">Get:10 https://download.docker.com/linux/ubuntu noble/stable amd64 docker-compose-plugin amd64 2.35.1-1~ubuntu.24.04~noble [13.8 MB]</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="go">Fetched 120 MB in 1s (94.1 MB/s)             </span>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="go">Selecting previously unselected package pigz.</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="gp gp-VirtualEnv">(Reading database ... 140777 files and directories currently installed.)</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="go">Preparing to unpack .../0-pigz_2.8-1_amd64.deb ...</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="go">Unpacking pigz (2.8-1) ...</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="go">Selecting previously unselected package containerd.io.</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="go">Preparing to unpack .../1-containerd.io_1.7.27-1_amd64.deb ...</span>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="go">Unpacking containerd.io (1.7.27-1) ...</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="go">Selecting previously unselected package docker-buildx-plugin.</span>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="go">Preparing to unpack .../2-docker-buildx-plugin_0.23.0-1~ubuntu.24.04~noble_amd64.deb ...</span>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#__codelineno-34-35"></a><span class="go">Unpacking docker-buildx-plugin (0.23.0-1~ubuntu.24.04~noble) ...</span>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36" href="#__codelineno-34-36"></a><span class="go">Selecting previously unselected package docker-ce-cli.</span>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37" href="#__codelineno-34-37"></a><span class="go">Preparing to unpack .../3-docker-ce-cli_5%3a28.1.1-1~ubuntu.24.04~noble_amd64.deb ...</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38" href="#__codelineno-34-38"></a><span class="go">Unpacking docker-ce-cli (5:28.1.1-1~ubuntu.24.04~noble) ...</span>
</span><span id="__span-34-39"><a id="__codelineno-34-39" name="__codelineno-34-39" href="#__codelineno-34-39"></a><span class="go">Selecting previously unselected package docker-ce.</span>
</span><span id="__span-34-40"><a id="__codelineno-34-40" name="__codelineno-34-40" href="#__codelineno-34-40"></a><span class="go">Preparing to unpack .../4-docker-ce_5%3a28.1.1-1~ubuntu.24.04~noble_amd64.deb ...</span>
</span><span id="__span-34-41"><a id="__codelineno-34-41" name="__codelineno-34-41" href="#__codelineno-34-41"></a><span class="go">Unpacking docker-ce (5:28.1.1-1~ubuntu.24.04~noble) ...</span>
</span><span id="__span-34-42"><a id="__codelineno-34-42" name="__codelineno-34-42" href="#__codelineno-34-42"></a><span class="go">Selecting previously unselected package docker-ce-rootless-extras.</span>
</span><span id="__span-34-43"><a id="__codelineno-34-43" name="__codelineno-34-43" href="#__codelineno-34-43"></a><span class="go">Preparing to unpack .../5-docker-ce-rootless-extras_5%3a28.1.1-1~ubuntu.24.04~noble_amd64.deb ...</span>
</span><span id="__span-34-44"><a id="__codelineno-34-44" name="__codelineno-34-44" href="#__codelineno-34-44"></a><span class="go">Unpacking docker-ce-rootless-extras (5:28.1.1-1~ubuntu.24.04~noble) ...</span>
</span><span id="__span-34-45"><a id="__codelineno-34-45" name="__codelineno-34-45" href="#__codelineno-34-45"></a><span class="go">Selecting previously unselected package docker-compose-plugin.</span>
</span><span id="__span-34-46"><a id="__codelineno-34-46" name="__codelineno-34-46" href="#__codelineno-34-46"></a><span class="go">Preparing to unpack .../6-docker-compose-plugin_2.35.1-1~ubuntu.24.04~noble_amd64.deb ...</span>
</span><span id="__span-34-47"><a id="__codelineno-34-47" name="__codelineno-34-47" href="#__codelineno-34-47"></a><span class="go">Unpacking docker-compose-plugin (2.35.1-1~ubuntu.24.04~noble) ...</span>
</span><span id="__span-34-48"><a id="__codelineno-34-48" name="__codelineno-34-48" href="#__codelineno-34-48"></a><span class="go">Selecting previously unselected package libltdl7:amd64.</span>
</span><span id="__span-34-49"><a id="__codelineno-34-49" name="__codelineno-34-49" href="#__codelineno-34-49"></a><span class="go">Preparing to unpack .../7-libltdl7_2.4.7-7build1_amd64.deb ...</span>
</span><span id="__span-34-50"><a id="__codelineno-34-50" name="__codelineno-34-50" href="#__codelineno-34-50"></a><span class="go">Unpacking libltdl7:amd64 (2.4.7-7build1) ...</span>
</span><span id="__span-34-51"><a id="__codelineno-34-51" name="__codelineno-34-51" href="#__codelineno-34-51"></a><span class="go">Selecting previously unselected package libslirp0:amd64.</span>
</span><span id="__span-34-52"><a id="__codelineno-34-52" name="__codelineno-34-52" href="#__codelineno-34-52"></a><span class="go">Preparing to unpack .../8-libslirp0_4.7.0-1ubuntu3_amd64.deb ...</span>
</span><span id="__span-34-53"><a id="__codelineno-34-53" name="__codelineno-34-53" href="#__codelineno-34-53"></a><span class="go">Unpacking libslirp0:amd64 (4.7.0-1ubuntu3) ...</span>
</span><span id="__span-34-54"><a id="__codelineno-34-54" name="__codelineno-34-54" href="#__codelineno-34-54"></a><span class="go">Selecting previously unselected package slirp4netns.</span>
</span><span id="__span-34-55"><a id="__codelineno-34-55" name="__codelineno-34-55" href="#__codelineno-34-55"></a><span class="go">Preparing to unpack .../9-slirp4netns_1.2.1-1build2_amd64.deb ...</span>
</span><span id="__span-34-56"><a id="__codelineno-34-56" name="__codelineno-34-56" href="#__codelineno-34-56"></a><span class="go">Unpacking slirp4netns (1.2.1-1build2) ...</span>
</span><span id="__span-34-57"><a id="__codelineno-34-57" name="__codelineno-34-57" href="#__codelineno-34-57"></a><span class="go">Setting up docker-buildx-plugin (0.23.0-1~ubuntu.24.04~noble) ...</span>
</span><span id="__span-34-58"><a id="__codelineno-34-58" name="__codelineno-34-58" href="#__codelineno-34-58"></a><span class="go">Setting up containerd.io (1.7.27-1) ...</span>
</span><span id="__span-34-59"><a id="__codelineno-34-59" name="__codelineno-34-59" href="#__codelineno-34-59"></a><span class="go">Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service  /usr/lib/systemd/system/containerd.service.</span>
</span><span id="__span-34-60"><a id="__codelineno-34-60" name="__codelineno-34-60" href="#__codelineno-34-60"></a><span class="go">Setting up docker-compose-plugin (2.35.1-1~ubuntu.24.04~noble) ...</span>
</span><span id="__span-34-61"><a id="__codelineno-34-61" name="__codelineno-34-61" href="#__codelineno-34-61"></a><span class="go">Setting up libltdl7:amd64 (2.4.7-7build1) ...</span>
</span><span id="__span-34-62"><a id="__codelineno-34-62" name="__codelineno-34-62" href="#__codelineno-34-62"></a><span class="go">Setting up docker-ce-cli (5:28.1.1-1~ubuntu.24.04~noble) ...</span>
</span><span id="__span-34-63"><a id="__codelineno-34-63" name="__codelineno-34-63" href="#__codelineno-34-63"></a><span class="go">Setting up libslirp0:amd64 (4.7.0-1ubuntu3) ...</span>
</span><span id="__span-34-64"><a id="__codelineno-34-64" name="__codelineno-34-64" href="#__codelineno-34-64"></a><span class="go">Setting up pigz (2.8-1) ...</span>
</span><span id="__span-34-65"><a id="__codelineno-34-65" name="__codelineno-34-65" href="#__codelineno-34-65"></a><span class="go">Setting up docker-ce-rootless-extras (5:28.1.1-1~ubuntu.24.04~noble) ...</span>
</span><span id="__span-34-66"><a id="__codelineno-34-66" name="__codelineno-34-66" href="#__codelineno-34-66"></a><span class="go">Setting up slirp4netns (1.2.1-1build2) ...</span>
</span><span id="__span-34-67"><a id="__codelineno-34-67" name="__codelineno-34-67" href="#__codelineno-34-67"></a><span class="go">Setting up docker-ce (5:28.1.1-1~ubuntu.24.04~noble) ...</span>
</span><span id="__span-34-68"><a id="__codelineno-34-68" name="__codelineno-34-68" href="#__codelineno-34-68"></a><span class="go">Created symlink /etc/systemd/system/multi-user.target.wants/docker.service  /usr/lib/systemd/system/docker.service.</span>
</span><span id="__span-34-69"><a id="__codelineno-34-69" name="__codelineno-34-69" href="#__codelineno-34-69"></a><span class="go">Created symlink /etc/systemd/system/sockets.target.wants/docker.socket  /usr/lib/systemd/system/docker.socket.</span>
</span><span id="__span-34-70"><a id="__codelineno-34-70" name="__codelineno-34-70" href="#__codelineno-34-70"></a><span class="go">Processing triggers for man-db (2.12.0-4build2) ...</span>
</span><span id="__span-34-71"><a id="__codelineno-34-71" name="__codelineno-34-71" href="#__codelineno-34-71"></a><span class="go">Processing triggers for libc-bin (2.39-0ubuntu8.4) ...</span>
</span><span id="__span-34-72"><a id="__codelineno-34-72" name="__codelineno-34-72" href="#__codelineno-34-72"></a><span class="go">Scanning processes...                                                                                         </span>
</span><span id="__span-34-73"><a id="__codelineno-34-73" name="__codelineno-34-73" href="#__codelineno-34-73"></a><span class="go">Scanning processor microcode...                                                                               </span>
</span><span id="__span-34-74"><a id="__codelineno-34-74" name="__codelineno-34-74" href="#__codelineno-34-74"></a><span class="go">Scanning linux images...                                                                                      </span>
</span><span id="__span-34-75"><a id="__codelineno-34-75" name="__codelineno-34-75" href="#__codelineno-34-75"></a>
</span><span id="__span-34-76"><a id="__codelineno-34-76" name="__codelineno-34-76" href="#__codelineno-34-76"></a><span class="go">Running kernel seems to be up-to-date.</span>
</span><span id="__span-34-77"><a id="__codelineno-34-77" name="__codelineno-34-77" href="#__codelineno-34-77"></a>
</span><span id="__span-34-78"><a id="__codelineno-34-78" name="__codelineno-34-78" href="#__codelineno-34-78"></a><span class="go">The processor microcode seems to be up-to-date.</span>
</span><span id="__span-34-79"><a id="__codelineno-34-79" name="__codelineno-34-79" href="#__codelineno-34-79"></a>
</span><span id="__span-34-80"><a id="__codelineno-34-80" name="__codelineno-34-80" href="#__codelineno-34-80"></a><span class="go">No services need to be restarted.</span>
</span><span id="__span-34-81"><a id="__codelineno-34-81" name="__codelineno-34-81" href="#__codelineno-34-81"></a>
</span><span id="__span-34-82"><a id="__codelineno-34-82" name="__codelineno-34-82" href="#__codelineno-34-82"></a><span class="go">No containers need to be restarted.</span>
</span><span id="__span-34-83"><a id="__codelineno-34-83" name="__codelineno-34-83" href="#__codelineno-34-83"></a>
</span><span id="__span-34-84"><a id="__codelineno-34-84" name="__codelineno-34-84" href="#__codelineno-34-84"></a><span class="go">No user sessions are running outdated binaries.</span>
</span><span id="__span-34-85"><a id="__codelineno-34-85" name="__codelineno-34-85" href="#__codelineno-34-85"></a>
</span><span id="__span-34-86"><a id="__codelineno-34-86" name="__codelineno-34-86" href="#__codelineno-34-86"></a><span class="go">No VM guests are running outdated hypervisor (qemu) binaries on this host.</span>
</span></code></pre></div>
</details>
<p>In just a few moments <code>docker</code> is already running:</p>
<details class="terminal">
<summary><code>$ systemctl status docker</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="gp">$ </span>systemctl<span class="w"> </span>status<span class="w"> </span>docker
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="go"> docker.service - Docker Application Container Engine</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="go">    Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; preset: enabled)</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="go">    Active: active (running) since Sat 2025-04-26 15:17:27 CEST; 52s ago</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="go">TriggeredBy:  docker.socket</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="go">      Docs: https://docs.docker.com</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="go">  Main PID: 198205 (dockerd)</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="go">      Tasks: 22</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="go">    Memory: 25.1M (peak: 27.5M)</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="go">        CPU: 335ms</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="go">    CGroup: /system.slice/docker.service</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="go">            198205 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="go">Apr 26 15:17:27 octavo dockerd[198205]: time="2025-04-26T15:17:27.329995883+02:00" level=info msg="detected 127.0.0.53 nameserver, assuming systemd-resolved, so using resolv.conf: /run/systemd/resolve/resolv.conf"</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="go">Apr 26 15:17:27 octavo dockerd[198205]: time="2025-04-26T15:17:27.356938837+02:00" level=info msg="Creating a containerd client" address=/run/containerd/containerd.sock timeout=1m0s</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="go">Apr 26 15:17:27 octavo dockerd[198205]: time="2025-04-26T15:17:27.391167891+02:00" level=info msg="Loading containers: start."</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="go">Apr 26 15:17:27 octavo dockerd[198205]: time="2025-04-26T15:17:27.623474369+02:00" level=info msg="Loading containers: done."</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="go">Apr 26 15:17:27 octavo dockerd[198205]: time="2025-04-26T15:17:27.651891549+02:00" level=info msg="Docker daemon" commit=01f442b containerd-snapshotter=false storage-driver=overlay2 version=28.1.1</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="go">Apr 26 15:17:27 octavo dockerd[198205]: time="2025-04-26T15:17:27.652003229+02:00" level=info msg="Initializing buildkit"</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="go">Apr 26 15:17:27 octavo dockerd[198205]: time="2025-04-26T15:17:27.686521864+02:00" level=info msg="Completed buildkit initialization"</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="go">Apr 26 15:17:27 octavo dockerd[198205]: time="2025-04-26T15:17:27.694113345+02:00" level=info msg="Daemon has completed initialization"</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a><span class="go">Apr 26 15:17:27 octavo dockerd[198205]: time="2025-04-26T15:17:27.694180217+02:00" level=info msg="API listen on /run/docker.sock"</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a><span class="go">Apr 26 15:17:27 octavo systemd[1]: Started docker.service - Docker Application Container Engine.</span>
</span></code></pre></div>
</details>
<p>The server is indeed reachable and its version can be checked:</p>
<details class="terminal">
<summary><code>$ sudo docker version</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>docker<span class="w"> </span>version
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="go">Client: Docker Engine - Community</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="go">Version:           28.1.1</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="go">API version:       1.49</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="go">Go version:        go1.23.8</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="go">Git commit:        4eba377</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="go">Built:             Fri Apr 18 09:52:14 2025</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#__codelineno-36-8"></a><span class="go">OS/Arch:           linux/amd64</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#__codelineno-36-9"></a><span class="go">Context:           default</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#__codelineno-36-10"></a>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#__codelineno-36-11"></a><span class="go">Server: Docker Engine - Community</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#__codelineno-36-12"></a><span class="go">Engine:</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#__codelineno-36-13"></a><span class="go">  Version:          28.1.1</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#__codelineno-36-14"></a><span class="go">  API version:      1.49 (minimum version 1.24)</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#__codelineno-36-15"></a><span class="go">  Go version:       go1.23.8</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#__codelineno-36-16"></a><span class="go">  Git commit:       01f442b</span>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#__codelineno-36-17"></a><span class="go">  Built:            Fri Apr 18 09:52:14 2025</span>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#__codelineno-36-18"></a><span class="go">  OS/Arch:          linux/amd64</span>
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#__codelineno-36-19"></a><span class="go">  Experimental:     false</span>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#__codelineno-36-20"></a><span class="go">containerd:</span>
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#__codelineno-36-21"></a><span class="go">  Version:          1.7.27</span>
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#__codelineno-36-22"></a><span class="go">  GitCommit:        05044ec0a9a75232cad458027ca83437aae3f4da</span>
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#__codelineno-36-23"></a><span class="go">runc:</span>
</span><span id="__span-36-24"><a id="__codelineno-36-24" name="__codelineno-36-24" href="#__codelineno-36-24"></a><span class="go">  Version:          1.2.5</span>
</span><span id="__span-36-25"><a id="__codelineno-36-25" name="__codelineno-36-25" href="#__codelineno-36-25"></a><span class="go">  GitCommit:        v1.2.5-0-g59923ef</span>
</span><span id="__span-36-26"><a id="__codelineno-36-26" name="__codelineno-36-26" href="#__codelineno-36-26"></a><span class="go">docker-init:</span>
</span><span id="__span-36-27"><a id="__codelineno-36-27" name="__codelineno-36-27" href="#__codelineno-36-27"></a><span class="go">  Version:          0.19.0</span>
</span><span id="__span-36-28"><a id="__codelineno-36-28" name="__codelineno-36-28" href="#__codelineno-36-28"></a><span class="go">  GitCommit:        de40ad0</span>
</span></code></pre></div>
</details>
<p>And the basic <code>hello-world</code> example just works:</p>
<details class="terminal">
<summary><code>$ sudo docker run hello-world</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>hello-world
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="go">Unable to find image 'hello-world:latest' locally</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="go">latest: Pulling from library/hello-world</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="go">e6590344b1a5: Pull complete </span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="go">Digest: sha256:c41088499908a59aae84b0a49c70e86f4731e588a737f1637e73c8c09d995654</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="go">Status: Downloaded newer image for hello-world:latest</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="go">Hello from Docker!</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a><span class="go">This message shows that your installation appears to be working correctly.</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="go">To generate this message, Docker took the following steps:</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a><span class="go">1. The Docker client contacted the Docker daemon.</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="go">2. The Docker daemon pulled the "hello-world" image from the Docker Hub.</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#__codelineno-37-14"></a><span class="go">    (amd64)</span>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#__codelineno-37-15"></a><span class="go">3. The Docker daemon created a new container from that image which runs the</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#__codelineno-37-16"></a><span class="go">    executable that produces the output you are currently reading.</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#__codelineno-37-17"></a><span class="go">4. The Docker daemon streamed that output to the Docker client, which sent it</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#__codelineno-37-18"></a><span class="go">    to your terminal.</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#__codelineno-37-19"></a>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#__codelineno-37-20"></a><span class="go">To try something more ambitious, you can run an Ubuntu container with:</span>
</span><span id="__span-37-21"><a id="__codelineno-37-21" name="__codelineno-37-21" href="#__codelineno-37-21"></a><span class="gp"> $ </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>ubuntu<span class="w"> </span>bash
</span><span id="__span-37-22"><a id="__codelineno-37-22" name="__codelineno-37-22" href="#__codelineno-37-22"></a>
</span><span id="__span-37-23"><a id="__codelineno-37-23" name="__codelineno-37-23" href="#__codelineno-37-23"></a><span class="go">Share images, automate workflows, and more with a free Docker ID:</span>
</span><span id="__span-37-24"><a id="__codelineno-37-24" name="__codelineno-37-24" href="#__codelineno-37-24"></a><span class="go"> https://hub.docker.com/</span>
</span><span id="__span-37-25"><a id="__codelineno-37-25" name="__codelineno-37-25" href="#__codelineno-37-25"></a>
</span><span id="__span-37-26"><a id="__codelineno-37-26" name="__codelineno-37-26" href="#__codelineno-37-26"></a><span class="go">For more examples and ideas, visit:</span>
</span><span id="__span-37-27"><a id="__codelineno-37-27" name="__codelineno-37-27" href="#__codelineno-37-27"></a><span class="go"> https://docs.docker.com/get-started/</span>
</span></code></pre></div>
</details>
<h4 id="configure-containerd-for-kubernetes">Configure containerd for Kubernetes</h4>
<p>The default configutation that comes with <code>containerd</code>, at least when installed from
the APT repository, needs two adjustments to work with Kubernetes:</p>
<ol>
<li>Enable the use of
     <a href="https://kubernetes.io/docs/setup/production-environment/container-runtimes/#systemd-cgroup-driver"><code>systemd</code> cgroup driver</a>,
     because Ubuntu (22.04+) uses both <code>systemd</code> and
     <a href="https://kubernetes.io/docs/concepts/architecture/cgroups/#using-cgroupv2">cgroup v2</a>.</li>
<li>Enable CRI integration, disabled in <code>/etc/containerd/config.toml</code>,
     but needed to use <code>containerd</code> with Kubernetes.</li>
</ol>
<p>The safest method to set these configurations is to do it based off of the default configuration:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="gp">$ </span>containerd<span class="w"> </span>config<span class="w"> </span>default<span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">'s/disabled_plugins.*/disabled_plugins = []/'</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">'s/SystemdCgroup = false/SystemdCgroup = true/'</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/containerd/config.toml<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>containerd
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>kubelet
</span></code></pre></div>
<details class="code">
<summary>Resulting <code>/etc/containerd/config.toml</code></summary>
<p>The resulting configuration enables <code>SystemdCgroup</code> under
<code>plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options</code>:</p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="hll"><span class="na">disabled_plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span></span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="na">imports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="na">oom_score</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="na">plugin_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="na">required_plugins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="na">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/var/lib/containerd"</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="na">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/run/containerd"</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a><span class="na">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="na">version</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">2</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="k">[cgroup]</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="w">  </span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="k">[debug]</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="w">  </span><span class="na">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">  </span><span class="na">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">  </span><span class="na">gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">  </span><span class="na">level</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="w">  </span><span class="na">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="k">[grpc]</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a><span class="w">  </span><span class="na">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/run/containerd/containerd.sock"</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a><span class="w">  </span><span class="na">gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a><span class="w">  </span><span class="na">max_recv_message_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">16777216</span>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="w">  </span><span class="na">max_send_message_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">16777216</span>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="w">  </span><span class="na">tcp_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a><span class="w">  </span><span class="na">tcp_tls_ca</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a><span class="w">  </span><span class="na">tcp_tls_cert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="w">  </span><span class="na">tcp_tls_key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a><span class="w">  </span><span class="na">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a><span class="k">[metrics]</span>
</span><span id="__span-39-33"><a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a><span class="w">  </span><span class="na">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-34"><a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a><span class="w">  </span><span class="na">grpc_histogram</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-35"><a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a>
</span><span id="__span-39-36"><a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a><span class="k">[plugins]</span>
</span><span id="__span-39-37"><a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a>
</span><span id="__span-39-38"><a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a><span class="w">  </span><span class="k">[plugins."io.containerd.gc.v1.scheduler"]</span>
</span><span id="__span-39-39"><a id="__codelineno-39-39" name="__codelineno-39-39" href="#__codelineno-39-39"></a><span class="w">    </span><span class="na">deletion_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-40"><a id="__codelineno-39-40" name="__codelineno-39-40" href="#__codelineno-39-40"></a><span class="w">    </span><span class="na">mutation_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">100</span>
</span><span id="__span-39-41"><a id="__codelineno-39-41" name="__codelineno-39-41" href="#__codelineno-39-41"></a><span class="w">    </span><span class="na">pause_threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0.02</span>
</span><span id="__span-39-42"><a id="__codelineno-39-42" name="__codelineno-39-42" href="#__codelineno-39-42"></a><span class="w">    </span><span class="na">schedule_delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"0s"</span>
</span><span id="__span-39-43"><a id="__codelineno-39-43" name="__codelineno-39-43" href="#__codelineno-39-43"></a><span class="w">    </span><span class="na">startup_delay</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"100ms"</span>
</span><span id="__span-39-44"><a id="__codelineno-39-44" name="__codelineno-39-44" href="#__codelineno-39-44"></a>
</span><span id="__span-39-45"><a id="__codelineno-39-45" name="__codelineno-39-45" href="#__codelineno-39-45"></a><span class="hll"><span class="w">  </span><span class="k">[plugins."io.containerd.grpc.v1.cri"]</span>
</span></span><span id="__span-39-46"><a id="__codelineno-39-46" name="__codelineno-39-46" href="#__codelineno-39-46"></a><span class="w">    </span><span class="na">cdi_spec_dirs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">["/etc/cdi", "/var/run/cdi"]</span>
</span><span id="__span-39-47"><a id="__codelineno-39-47" name="__codelineno-39-47" href="#__codelineno-39-47"></a><span class="w">    </span><span class="na">device_ownership_from_security_context</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-48"><a id="__codelineno-39-48" name="__codelineno-39-48" href="#__codelineno-39-48"></a><span class="w">    </span><span class="na">disable_apparmor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-49"><a id="__codelineno-39-49" name="__codelineno-39-49" href="#__codelineno-39-49"></a><span class="w">    </span><span class="na">disable_cgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-50"><a id="__codelineno-39-50" name="__codelineno-39-50" href="#__codelineno-39-50"></a><span class="w">    </span><span class="na">disable_hugetlb_controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</span><span id="__span-39-51"><a id="__codelineno-39-51" name="__codelineno-39-51" href="#__codelineno-39-51"></a><span class="w">    </span><span class="na">disable_proc_mount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-52"><a id="__codelineno-39-52" name="__codelineno-39-52" href="#__codelineno-39-52"></a><span class="w">    </span><span class="na">disable_tcp_service</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</span><span id="__span-39-53"><a id="__codelineno-39-53" name="__codelineno-39-53" href="#__codelineno-39-53"></a><span class="w">    </span><span class="na">drain_exec_sync_io_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"0s"</span>
</span><span id="__span-39-54"><a id="__codelineno-39-54" name="__codelineno-39-54" href="#__codelineno-39-54"></a><span class="w">    </span><span class="na">enable_cdi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-55"><a id="__codelineno-39-55" name="__codelineno-39-55" href="#__codelineno-39-55"></a><span class="w">    </span><span class="na">enable_selinux</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-56"><a id="__codelineno-39-56" name="__codelineno-39-56" href="#__codelineno-39-56"></a><span class="w">    </span><span class="na">enable_tls_streaming</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-57"><a id="__codelineno-39-57" name="__codelineno-39-57" href="#__codelineno-39-57"></a><span class="w">    </span><span class="na">enable_unprivileged_icmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-58"><a id="__codelineno-39-58" name="__codelineno-39-58" href="#__codelineno-39-58"></a><span class="w">    </span><span class="na">enable_unprivileged_ports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-59"><a id="__codelineno-39-59" name="__codelineno-39-59" href="#__codelineno-39-59"></a><span class="w">    </span><span class="na">ignore_deprecation_warnings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-60"><a id="__codelineno-39-60" name="__codelineno-39-60" href="#__codelineno-39-60"></a><span class="w">    </span><span class="na">ignore_image_defined_volumes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-61"><a id="__codelineno-39-61" name="__codelineno-39-61" href="#__codelineno-39-61"></a><span class="w">    </span><span class="na">image_pull_progress_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"5m0s"</span>
</span><span id="__span-39-62"><a id="__codelineno-39-62" name="__codelineno-39-62" href="#__codelineno-39-62"></a><span class="w">    </span><span class="na">image_pull_with_sync_fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-63"><a id="__codelineno-39-63" name="__codelineno-39-63" href="#__codelineno-39-63"></a><span class="w">    </span><span class="na">max_concurrent_downloads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span>
</span><span id="__span-39-64"><a id="__codelineno-39-64" name="__codelineno-39-64" href="#__codelineno-39-64"></a><span class="w">    </span><span class="na">max_container_log_line_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">16384</span>
</span><span id="__span-39-65"><a id="__codelineno-39-65" name="__codelineno-39-65" href="#__codelineno-39-65"></a><span class="w">    </span><span class="na">netns_mounts_under_state_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-66"><a id="__codelineno-39-66" name="__codelineno-39-66" href="#__codelineno-39-66"></a><span class="w">    </span><span class="na">restrict_oom_score_adj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-67"><a id="__codelineno-39-67" name="__codelineno-39-67" href="#__codelineno-39-67"></a><span class="w">    </span><span class="na">sandbox_image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"registry.k8s.io/pause:3.8"</span>
</span><span id="__span-39-68"><a id="__codelineno-39-68" name="__codelineno-39-68" href="#__codelineno-39-68"></a><span class="w">    </span><span class="na">selinux_category_range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1024</span>
</span><span id="__span-39-69"><a id="__codelineno-39-69" name="__codelineno-39-69" href="#__codelineno-39-69"></a><span class="w">    </span><span class="na">stats_collect_period</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">10</span>
</span><span id="__span-39-70"><a id="__codelineno-39-70" name="__codelineno-39-70" href="#__codelineno-39-70"></a><span class="w">    </span><span class="na">stream_idle_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"4h0m0s"</span>
</span><span id="__span-39-71"><a id="__codelineno-39-71" name="__codelineno-39-71" href="#__codelineno-39-71"></a><span class="w">    </span><span class="na">stream_server_address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"127.0.0.1"</span>
</span><span id="__span-39-72"><a id="__codelineno-39-72" name="__codelineno-39-72" href="#__codelineno-39-72"></a><span class="w">    </span><span class="na">stream_server_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"0"</span>
</span><span id="__span-39-73"><a id="__codelineno-39-73" name="__codelineno-39-73" href="#__codelineno-39-73"></a><span class="hll"><span class="w">    </span><span class="na">systemd_cgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span></span><span id="__span-39-74"><a id="__codelineno-39-74" name="__codelineno-39-74" href="#__codelineno-39-74"></a><span class="w">    </span><span class="na">tolerate_missing_hugetlb_controller</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</span><span id="__span-39-75"><a id="__codelineno-39-75" name="__codelineno-39-75" href="#__codelineno-39-75"></a><span class="w">    </span><span class="na">unset_seccomp_profile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-76"><a id="__codelineno-39-76" name="__codelineno-39-76" href="#__codelineno-39-76"></a>
</span><span id="__span-39-77"><a id="__codelineno-39-77" name="__codelineno-39-77" href="#__codelineno-39-77"></a><span class="w">    </span><span class="k">[plugins."io.containerd.grpc.v1.cri".cni]</span>
</span><span id="__span-39-78"><a id="__codelineno-39-78" name="__codelineno-39-78" href="#__codelineno-39-78"></a><span class="w">      </span><span class="na">bin_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/opt/cni/bin"</span>
</span><span id="__span-39-79"><a id="__codelineno-39-79" name="__codelineno-39-79" href="#__codelineno-39-79"></a><span class="w">      </span><span class="na">conf_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/etc/cni/net.d"</span>
</span><span id="__span-39-80"><a id="__codelineno-39-80" name="__codelineno-39-80" href="#__codelineno-39-80"></a><span class="w">      </span><span class="na">conf_template</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-81"><a id="__codelineno-39-81" name="__codelineno-39-81" href="#__codelineno-39-81"></a><span class="w">      </span><span class="na">ip_pref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-82"><a id="__codelineno-39-82" name="__codelineno-39-82" href="#__codelineno-39-82"></a><span class="w">      </span><span class="na">max_conf_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">1</span>
</span><span id="__span-39-83"><a id="__codelineno-39-83" name="__codelineno-39-83" href="#__codelineno-39-83"></a><span class="w">      </span><span class="na">setup_serially</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-84"><a id="__codelineno-39-84" name="__codelineno-39-84" href="#__codelineno-39-84"></a>
</span><span id="__span-39-85"><a id="__codelineno-39-85" name="__codelineno-39-85" href="#__codelineno-39-85"></a><span class="w">    </span><span class="k">[plugins."io.containerd.grpc.v1.cri".containerd]</span>
</span><span id="__span-39-86"><a id="__codelineno-39-86" name="__codelineno-39-86" href="#__codelineno-39-86"></a><span class="w">      </span><span class="na">default_runtime_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"runc"</span>
</span><span id="__span-39-87"><a id="__codelineno-39-87" name="__codelineno-39-87" href="#__codelineno-39-87"></a><span class="w">      </span><span class="na">disable_snapshot_annotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</span><span id="__span-39-88"><a id="__codelineno-39-88" name="__codelineno-39-88" href="#__codelineno-39-88"></a><span class="w">      </span><span class="na">discard_unpacked_layers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-89"><a id="__codelineno-39-89" name="__codelineno-39-89" href="#__codelineno-39-89"></a><span class="w">      </span><span class="na">ignore_blockio_not_enabled_errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-90"><a id="__codelineno-39-90" name="__codelineno-39-90" href="#__codelineno-39-90"></a><span class="w">      </span><span class="na">ignore_rdt_not_enabled_errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-91"><a id="__codelineno-39-91" name="__codelineno-39-91" href="#__codelineno-39-91"></a><span class="w">      </span><span class="na">no_pivot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-92"><a id="__codelineno-39-92" name="__codelineno-39-92" href="#__codelineno-39-92"></a><span class="w">      </span><span class="na">snapshotter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"overlayfs"</span>
</span><span id="__span-39-93"><a id="__codelineno-39-93" name="__codelineno-39-93" href="#__codelineno-39-93"></a>
</span><span id="__span-39-94"><a id="__codelineno-39-94" name="__codelineno-39-94" href="#__codelineno-39-94"></a><span class="w">      </span><span class="k">[plugins."io.containerd.grpc.v1.cri".containerd.default_runtime]</span>
</span><span id="__span-39-95"><a id="__codelineno-39-95" name="__codelineno-39-95" href="#__codelineno-39-95"></a><span class="w">        </span><span class="na">base_runtime_spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-96"><a id="__codelineno-39-96" name="__codelineno-39-96" href="#__codelineno-39-96"></a><span class="w">        </span><span class="na">cni_conf_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-97"><a id="__codelineno-39-97" name="__codelineno-39-97" href="#__codelineno-39-97"></a><span class="w">        </span><span class="na">cni_max_conf_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-98"><a id="__codelineno-39-98" name="__codelineno-39-98" href="#__codelineno-39-98"></a><span class="w">        </span><span class="na">container_annotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-99"><a id="__codelineno-39-99" name="__codelineno-39-99" href="#__codelineno-39-99"></a><span class="w">        </span><span class="na">pod_annotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-100"><a id="__codelineno-39-100" name="__codelineno-39-100" href="#__codelineno-39-100"></a><span class="w">        </span><span class="na">privileged_without_host_devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-101"><a id="__codelineno-39-101" name="__codelineno-39-101" href="#__codelineno-39-101"></a><span class="w">        </span><span class="na">privileged_without_host_devices_all_devices_allowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-102"><a id="__codelineno-39-102" name="__codelineno-39-102" href="#__codelineno-39-102"></a><span class="w">        </span><span class="na">runtime_engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-103"><a id="__codelineno-39-103" name="__codelineno-39-103" href="#__codelineno-39-103"></a><span class="w">        </span><span class="na">runtime_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-104"><a id="__codelineno-39-104" name="__codelineno-39-104" href="#__codelineno-39-104"></a><span class="w">        </span><span class="na">runtime_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-105"><a id="__codelineno-39-105" name="__codelineno-39-105" href="#__codelineno-39-105"></a><span class="w">        </span><span class="na">runtime_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-106"><a id="__codelineno-39-106" name="__codelineno-39-106" href="#__codelineno-39-106"></a><span class="w">        </span><span class="na">sandbox_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-107"><a id="__codelineno-39-107" name="__codelineno-39-107" href="#__codelineno-39-107"></a><span class="w">        </span><span class="na">snapshotter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-108"><a id="__codelineno-39-108" name="__codelineno-39-108" href="#__codelineno-39-108"></a>
</span><span id="__span-39-109"><a id="__codelineno-39-109" name="__codelineno-39-109" href="#__codelineno-39-109"></a><span class="w">        </span><span class="k">[plugins."io.containerd.grpc.v1.cri".containerd.default_runtime.options]</span>
</span><span id="__span-39-110"><a id="__codelineno-39-110" name="__codelineno-39-110" href="#__codelineno-39-110"></a>
</span><span id="__span-39-111"><a id="__codelineno-39-111" name="__codelineno-39-111" href="#__codelineno-39-111"></a><span class="w">      </span><span class="k">[plugins."io.containerd.grpc.v1.cri".containerd.runtimes]</span>
</span><span id="__span-39-112"><a id="__codelineno-39-112" name="__codelineno-39-112" href="#__codelineno-39-112"></a>
</span><span id="__span-39-113"><a id="__codelineno-39-113" name="__codelineno-39-113" href="#__codelineno-39-113"></a><span class="w">        </span><span class="k">[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]</span>
</span><span id="__span-39-114"><a id="__codelineno-39-114" name="__codelineno-39-114" href="#__codelineno-39-114"></a><span class="w">          </span><span class="na">base_runtime_spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-115"><a id="__codelineno-39-115" name="__codelineno-39-115" href="#__codelineno-39-115"></a><span class="w">          </span><span class="na">cni_conf_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-116"><a id="__codelineno-39-116" name="__codelineno-39-116" href="#__codelineno-39-116"></a><span class="w">          </span><span class="na">cni_max_conf_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-117"><a id="__codelineno-39-117" name="__codelineno-39-117" href="#__codelineno-39-117"></a><span class="w">          </span><span class="na">container_annotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-118"><a id="__codelineno-39-118" name="__codelineno-39-118" href="#__codelineno-39-118"></a><span class="w">          </span><span class="na">pod_annotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-119"><a id="__codelineno-39-119" name="__codelineno-39-119" href="#__codelineno-39-119"></a><span class="w">          </span><span class="na">privileged_without_host_devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-120"><a id="__codelineno-39-120" name="__codelineno-39-120" href="#__codelineno-39-120"></a><span class="w">          </span><span class="na">privileged_without_host_devices_all_devices_allowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-121"><a id="__codelineno-39-121" name="__codelineno-39-121" href="#__codelineno-39-121"></a><span class="w">          </span><span class="na">runtime_engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-122"><a id="__codelineno-39-122" name="__codelineno-39-122" href="#__codelineno-39-122"></a><span class="w">          </span><span class="na">runtime_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-123"><a id="__codelineno-39-123" name="__codelineno-39-123" href="#__codelineno-39-123"></a><span class="w">          </span><span class="na">runtime_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-124"><a id="__codelineno-39-124" name="__codelineno-39-124" href="#__codelineno-39-124"></a><span class="w">          </span><span class="na">runtime_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"io.containerd.runc.v2"</span>
</span><span id="__span-39-125"><a id="__codelineno-39-125" name="__codelineno-39-125" href="#__codelineno-39-125"></a><span class="w">          </span><span class="na">sandbox_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"podsandbox"</span>
</span><span id="__span-39-126"><a id="__codelineno-39-126" name="__codelineno-39-126" href="#__codelineno-39-126"></a><span class="w">          </span><span class="na">snapshotter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-127"><a id="__codelineno-39-127" name="__codelineno-39-127" href="#__codelineno-39-127"></a>
</span><span id="__span-39-128"><a id="__codelineno-39-128" name="__codelineno-39-128" href="#__codelineno-39-128"></a><span class="hll"><span class="w">          </span><span class="k">[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]</span>
</span></span><span id="__span-39-129"><a id="__codelineno-39-129" name="__codelineno-39-129" href="#__codelineno-39-129"></a><span class="w">            </span><span class="na">BinaryName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-130"><a id="__codelineno-39-130" name="__codelineno-39-130" href="#__codelineno-39-130"></a><span class="w">            </span><span class="na">CriuImagePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-131"><a id="__codelineno-39-131" name="__codelineno-39-131" href="#__codelineno-39-131"></a><span class="w">            </span><span class="na">CriuPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-132"><a id="__codelineno-39-132" name="__codelineno-39-132" href="#__codelineno-39-132"></a><span class="w">            </span><span class="na">CriuWorkPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-133"><a id="__codelineno-39-133" name="__codelineno-39-133" href="#__codelineno-39-133"></a><span class="w">            </span><span class="na">IoGid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-134"><a id="__codelineno-39-134" name="__codelineno-39-134" href="#__codelineno-39-134"></a><span class="w">            </span><span class="na">IoUid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-135"><a id="__codelineno-39-135" name="__codelineno-39-135" href="#__codelineno-39-135"></a><span class="w">            </span><span class="na">NoNewKeyring</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-136"><a id="__codelineno-39-136" name="__codelineno-39-136" href="#__codelineno-39-136"></a><span class="w">            </span><span class="na">NoPivotRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-137"><a id="__codelineno-39-137" name="__codelineno-39-137" href="#__codelineno-39-137"></a><span class="w">            </span><span class="na">Root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-138"><a id="__codelineno-39-138" name="__codelineno-39-138" href="#__codelineno-39-138"></a><span class="w">            </span><span class="na">ShimCgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-139"><a id="__codelineno-39-139" name="__codelineno-39-139" href="#__codelineno-39-139"></a><span class="hll"><span class="w">            </span><span class="na">SystemdCgroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</span></span><span id="__span-39-140"><a id="__codelineno-39-140" name="__codelineno-39-140" href="#__codelineno-39-140"></a>
</span><span id="__span-39-141"><a id="__codelineno-39-141" name="__codelineno-39-141" href="#__codelineno-39-141"></a><span class="w">      </span><span class="k">[plugins."io.containerd.grpc.v1.cri".containerd.untrusted_workload_runtime]</span>
</span><span id="__span-39-142"><a id="__codelineno-39-142" name="__codelineno-39-142" href="#__codelineno-39-142"></a><span class="w">        </span><span class="na">base_runtime_spec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-143"><a id="__codelineno-39-143" name="__codelineno-39-143" href="#__codelineno-39-143"></a><span class="w">        </span><span class="na">cni_conf_dir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-144"><a id="__codelineno-39-144" name="__codelineno-39-144" href="#__codelineno-39-144"></a><span class="w">        </span><span class="na">cni_max_conf_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-145"><a id="__codelineno-39-145" name="__codelineno-39-145" href="#__codelineno-39-145"></a><span class="w">        </span><span class="na">container_annotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-146"><a id="__codelineno-39-146" name="__codelineno-39-146" href="#__codelineno-39-146"></a><span class="w">        </span><span class="na">pod_annotations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-147"><a id="__codelineno-39-147" name="__codelineno-39-147" href="#__codelineno-39-147"></a><span class="w">        </span><span class="na">privileged_without_host_devices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-148"><a id="__codelineno-39-148" name="__codelineno-39-148" href="#__codelineno-39-148"></a><span class="w">        </span><span class="na">privileged_without_host_devices_all_devices_allowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-149"><a id="__codelineno-39-149" name="__codelineno-39-149" href="#__codelineno-39-149"></a><span class="w">        </span><span class="na">runtime_engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-150"><a id="__codelineno-39-150" name="__codelineno-39-150" href="#__codelineno-39-150"></a><span class="w">        </span><span class="na">runtime_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-151"><a id="__codelineno-39-151" name="__codelineno-39-151" href="#__codelineno-39-151"></a><span class="w">        </span><span class="na">runtime_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-152"><a id="__codelineno-39-152" name="__codelineno-39-152" href="#__codelineno-39-152"></a><span class="w">        </span><span class="na">runtime_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-153"><a id="__codelineno-39-153" name="__codelineno-39-153" href="#__codelineno-39-153"></a><span class="w">        </span><span class="na">sandbox_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-154"><a id="__codelineno-39-154" name="__codelineno-39-154" href="#__codelineno-39-154"></a><span class="w">        </span><span class="na">snapshotter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-155"><a id="__codelineno-39-155" name="__codelineno-39-155" href="#__codelineno-39-155"></a>
</span><span id="__span-39-156"><a id="__codelineno-39-156" name="__codelineno-39-156" href="#__codelineno-39-156"></a><span class="w">        </span><span class="k">[plugins."io.containerd.grpc.v1.cri".containerd.untrusted_workload_runtime.options]</span>
</span><span id="__span-39-157"><a id="__codelineno-39-157" name="__codelineno-39-157" href="#__codelineno-39-157"></a>
</span><span id="__span-39-158"><a id="__codelineno-39-158" name="__codelineno-39-158" href="#__codelineno-39-158"></a><span class="w">    </span><span class="k">[plugins."io.containerd.grpc.v1.cri".image_decryption]</span>
</span><span id="__span-39-159"><a id="__codelineno-39-159" name="__codelineno-39-159" href="#__codelineno-39-159"></a><span class="w">      </span><span class="na">key_model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"node"</span>
</span><span id="__span-39-160"><a id="__codelineno-39-160" name="__codelineno-39-160" href="#__codelineno-39-160"></a>
</span><span id="__span-39-161"><a id="__codelineno-39-161" name="__codelineno-39-161" href="#__codelineno-39-161"></a><span class="w">    </span><span class="k">[plugins."io.containerd.grpc.v1.cri".registry]</span>
</span><span id="__span-39-162"><a id="__codelineno-39-162" name="__codelineno-39-162" href="#__codelineno-39-162"></a><span class="w">      </span><span class="na">config_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-163"><a id="__codelineno-39-163" name="__codelineno-39-163" href="#__codelineno-39-163"></a>
</span><span id="__span-39-164"><a id="__codelineno-39-164" name="__codelineno-39-164" href="#__codelineno-39-164"></a><span class="w">      </span><span class="k">[plugins."io.containerd.grpc.v1.cri".registry.auths]</span>
</span><span id="__span-39-165"><a id="__codelineno-39-165" name="__codelineno-39-165" href="#__codelineno-39-165"></a>
</span><span id="__span-39-166"><a id="__codelineno-39-166" name="__codelineno-39-166" href="#__codelineno-39-166"></a><span class="w">      </span><span class="k">[plugins."io.containerd.grpc.v1.cri".registry.configs]</span>
</span><span id="__span-39-167"><a id="__codelineno-39-167" name="__codelineno-39-167" href="#__codelineno-39-167"></a>
</span><span id="__span-39-168"><a id="__codelineno-39-168" name="__codelineno-39-168" href="#__codelineno-39-168"></a><span class="w">      </span><span class="k">[plugins."io.containerd.grpc.v1.cri".registry.headers]</span>
</span><span id="__span-39-169"><a id="__codelineno-39-169" name="__codelineno-39-169" href="#__codelineno-39-169"></a>
</span><span id="__span-39-170"><a id="__codelineno-39-170" name="__codelineno-39-170" href="#__codelineno-39-170"></a><span class="w">      </span><span class="k">[plugins."io.containerd.grpc.v1.cri".registry.mirrors]</span>
</span><span id="__span-39-171"><a id="__codelineno-39-171" name="__codelineno-39-171" href="#__codelineno-39-171"></a>
</span><span id="__span-39-172"><a id="__codelineno-39-172" name="__codelineno-39-172" href="#__codelineno-39-172"></a><span class="w">    </span><span class="k">[plugins."io.containerd.grpc.v1.cri".x509_key_pair_streaming]</span>
</span><span id="__span-39-173"><a id="__codelineno-39-173" name="__codelineno-39-173" href="#__codelineno-39-173"></a><span class="w">      </span><span class="na">tls_cert_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-174"><a id="__codelineno-39-174" name="__codelineno-39-174" href="#__codelineno-39-174"></a><span class="w">      </span><span class="na">tls_key_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-175"><a id="__codelineno-39-175" name="__codelineno-39-175" href="#__codelineno-39-175"></a>
</span><span id="__span-39-176"><a id="__codelineno-39-176" name="__codelineno-39-176" href="#__codelineno-39-176"></a><span class="w">  </span><span class="k">[plugins."io.containerd.internal.v1.opt"]</span>
</span><span id="__span-39-177"><a id="__codelineno-39-177" name="__codelineno-39-177" href="#__codelineno-39-177"></a><span class="w">    </span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/opt/containerd"</span>
</span><span id="__span-39-178"><a id="__codelineno-39-178" name="__codelineno-39-178" href="#__codelineno-39-178"></a>
</span><span id="__span-39-179"><a id="__codelineno-39-179" name="__codelineno-39-179" href="#__codelineno-39-179"></a><span class="w">  </span><span class="k">[plugins."io.containerd.internal.v1.restart"]</span>
</span><span id="__span-39-180"><a id="__codelineno-39-180" name="__codelineno-39-180" href="#__codelineno-39-180"></a><span class="w">    </span><span class="na">interval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"10s"</span>
</span><span id="__span-39-181"><a id="__codelineno-39-181" name="__codelineno-39-181" href="#__codelineno-39-181"></a>
</span><span id="__span-39-182"><a id="__codelineno-39-182" name="__codelineno-39-182" href="#__codelineno-39-182"></a><span class="w">  </span><span class="k">[plugins."io.containerd.internal.v1.tracing"]</span>
</span><span id="__span-39-183"><a id="__codelineno-39-183" name="__codelineno-39-183" href="#__codelineno-39-183"></a>
</span><span id="__span-39-184"><a id="__codelineno-39-184" name="__codelineno-39-184" href="#__codelineno-39-184"></a><span class="w">  </span><span class="k">[plugins."io.containerd.metadata.v1.bolt"]</span>
</span><span id="__span-39-185"><a id="__codelineno-39-185" name="__codelineno-39-185" href="#__codelineno-39-185"></a><span class="w">    </span><span class="na">content_sharing_policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"shared"</span>
</span><span id="__span-39-186"><a id="__codelineno-39-186" name="__codelineno-39-186" href="#__codelineno-39-186"></a>
</span><span id="__span-39-187"><a id="__codelineno-39-187" name="__codelineno-39-187" href="#__codelineno-39-187"></a><span class="w">  </span><span class="k">[plugins."io.containerd.monitor.v1.cgroups"]</span>
</span><span id="__span-39-188"><a id="__codelineno-39-188" name="__codelineno-39-188" href="#__codelineno-39-188"></a><span class="w">    </span><span class="na">no_prometheus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-189"><a id="__codelineno-39-189" name="__codelineno-39-189" href="#__codelineno-39-189"></a>
</span><span id="__span-39-190"><a id="__codelineno-39-190" name="__codelineno-39-190" href="#__codelineno-39-190"></a><span class="w">  </span><span class="k">[plugins."io.containerd.nri.v1.nri"]</span>
</span><span id="__span-39-191"><a id="__codelineno-39-191" name="__codelineno-39-191" href="#__codelineno-39-191"></a><span class="w">    </span><span class="na">disable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span>
</span><span id="__span-39-192"><a id="__codelineno-39-192" name="__codelineno-39-192" href="#__codelineno-39-192"></a><span class="w">    </span><span class="na">disable_connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-193"><a id="__codelineno-39-193" name="__codelineno-39-193" href="#__codelineno-39-193"></a><span class="w">    </span><span class="na">plugin_config_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/etc/nri/conf.d"</span>
</span><span id="__span-39-194"><a id="__codelineno-39-194" name="__codelineno-39-194" href="#__codelineno-39-194"></a><span class="w">    </span><span class="na">plugin_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/opt/nri/plugins"</span>
</span><span id="__span-39-195"><a id="__codelineno-39-195" name="__codelineno-39-195" href="#__codelineno-39-195"></a><span class="w">    </span><span class="na">plugin_registration_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"5s"</span>
</span><span id="__span-39-196"><a id="__codelineno-39-196" name="__codelineno-39-196" href="#__codelineno-39-196"></a><span class="w">    </span><span class="na">plugin_request_timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"2s"</span>
</span><span id="__span-39-197"><a id="__codelineno-39-197" name="__codelineno-39-197" href="#__codelineno-39-197"></a><span class="w">    </span><span class="na">socket_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"/var/run/nri/nri.sock"</span>
</span><span id="__span-39-198"><a id="__codelineno-39-198" name="__codelineno-39-198" href="#__codelineno-39-198"></a>
</span><span id="__span-39-199"><a id="__codelineno-39-199" name="__codelineno-39-199" href="#__codelineno-39-199"></a><span class="w">  </span><span class="k">[plugins."io.containerd.runtime.v1.linux"]</span>
</span><span id="__span-39-200"><a id="__codelineno-39-200" name="__codelineno-39-200" href="#__codelineno-39-200"></a><span class="w">    </span><span class="na">no_shim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-201"><a id="__codelineno-39-201" name="__codelineno-39-201" href="#__codelineno-39-201"></a><span class="w">    </span><span class="na">runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"runc"</span>
</span><span id="__span-39-202"><a id="__codelineno-39-202" name="__codelineno-39-202" href="#__codelineno-39-202"></a><span class="w">    </span><span class="na">runtime_root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-203"><a id="__codelineno-39-203" name="__codelineno-39-203" href="#__codelineno-39-203"></a><span class="w">    </span><span class="na">shim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"containerd-shim"</span>
</span><span id="__span-39-204"><a id="__codelineno-39-204" name="__codelineno-39-204" href="#__codelineno-39-204"></a><span class="w">    </span><span class="na">shim_debug</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-205"><a id="__codelineno-39-205" name="__codelineno-39-205" href="#__codelineno-39-205"></a>
</span><span id="__span-39-206"><a id="__codelineno-39-206" name="__codelineno-39-206" href="#__codelineno-39-206"></a><span class="w">  </span><span class="k">[plugins."io.containerd.runtime.v2.task"]</span>
</span><span id="__span-39-207"><a id="__codelineno-39-207" name="__codelineno-39-207" href="#__codelineno-39-207"></a><span class="w">    </span><span class="na">platforms</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">["linux/amd64"]</span>
</span><span id="__span-39-208"><a id="__codelineno-39-208" name="__codelineno-39-208" href="#__codelineno-39-208"></a><span class="w">    </span><span class="na">sched_core</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-209"><a id="__codelineno-39-209" name="__codelineno-39-209" href="#__codelineno-39-209"></a>
</span><span id="__span-39-210"><a id="__codelineno-39-210" name="__codelineno-39-210" href="#__codelineno-39-210"></a><span class="w">  </span><span class="k">[plugins."io.containerd.service.v1.diff-service"]</span>
</span><span id="__span-39-211"><a id="__codelineno-39-211" name="__codelineno-39-211" href="#__codelineno-39-211"></a><span class="w">    </span><span class="na">default</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">["walking"]</span>
</span><span id="__span-39-212"><a id="__codelineno-39-212" name="__codelineno-39-212" href="#__codelineno-39-212"></a><span class="w">    </span><span class="na">sync_fs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-213"><a id="__codelineno-39-213" name="__codelineno-39-213" href="#__codelineno-39-213"></a>
</span><span id="__span-39-214"><a id="__codelineno-39-214" name="__codelineno-39-214" href="#__codelineno-39-214"></a><span class="w">  </span><span class="k">[plugins."io.containerd.service.v1.tasks-service"]</span>
</span><span id="__span-39-215"><a id="__codelineno-39-215" name="__codelineno-39-215" href="#__codelineno-39-215"></a><span class="w">    </span><span class="na">blockio_config_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-216"><a id="__codelineno-39-216" name="__codelineno-39-216" href="#__codelineno-39-216"></a><span class="w">    </span><span class="na">rdt_config_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-217"><a id="__codelineno-39-217" name="__codelineno-39-217" href="#__codelineno-39-217"></a>
</span><span id="__span-39-218"><a id="__codelineno-39-218" name="__codelineno-39-218" href="#__codelineno-39-218"></a><span class="w">  </span><span class="k">[plugins."io.containerd.snapshotter.v1.aufs"]</span>
</span><span id="__span-39-219"><a id="__codelineno-39-219" name="__codelineno-39-219" href="#__codelineno-39-219"></a><span class="w">    </span><span class="na">root_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-220"><a id="__codelineno-39-220" name="__codelineno-39-220" href="#__codelineno-39-220"></a>
</span><span id="__span-39-221"><a id="__codelineno-39-221" name="__codelineno-39-221" href="#__codelineno-39-221"></a><span class="w">  </span><span class="k">[plugins."io.containerd.snapshotter.v1.blockfile"]</span>
</span><span id="__span-39-222"><a id="__codelineno-39-222" name="__codelineno-39-222" href="#__codelineno-39-222"></a><span class="w">    </span><span class="na">fs_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-223"><a id="__codelineno-39-223" name="__codelineno-39-223" href="#__codelineno-39-223"></a><span class="w">    </span><span class="na">mount_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-224"><a id="__codelineno-39-224" name="__codelineno-39-224" href="#__codelineno-39-224"></a><span class="w">    </span><span class="na">root_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-225"><a id="__codelineno-39-225" name="__codelineno-39-225" href="#__codelineno-39-225"></a><span class="w">    </span><span class="na">scratch_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-226"><a id="__codelineno-39-226" name="__codelineno-39-226" href="#__codelineno-39-226"></a>
</span><span id="__span-39-227"><a id="__codelineno-39-227" name="__codelineno-39-227" href="#__codelineno-39-227"></a><span class="w">  </span><span class="k">[plugins."io.containerd.snapshotter.v1.btrfs"]</span>
</span><span id="__span-39-228"><a id="__codelineno-39-228" name="__codelineno-39-228" href="#__codelineno-39-228"></a><span class="w">    </span><span class="na">root_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-229"><a id="__codelineno-39-229" name="__codelineno-39-229" href="#__codelineno-39-229"></a>
</span><span id="__span-39-230"><a id="__codelineno-39-230" name="__codelineno-39-230" href="#__codelineno-39-230"></a><span class="w">  </span><span class="k">[plugins."io.containerd.snapshotter.v1.devmapper"]</span>
</span><span id="__span-39-231"><a id="__codelineno-39-231" name="__codelineno-39-231" href="#__codelineno-39-231"></a><span class="w">    </span><span class="na">async_remove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-232"><a id="__codelineno-39-232" name="__codelineno-39-232" href="#__codelineno-39-232"></a><span class="w">    </span><span class="na">base_image_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-233"><a id="__codelineno-39-233" name="__codelineno-39-233" href="#__codelineno-39-233"></a><span class="w">    </span><span class="na">discard_blocks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-234"><a id="__codelineno-39-234" name="__codelineno-39-234" href="#__codelineno-39-234"></a><span class="w">    </span><span class="na">fs_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-235"><a id="__codelineno-39-235" name="__codelineno-39-235" href="#__codelineno-39-235"></a><span class="w">    </span><span class="na">fs_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-236"><a id="__codelineno-39-236" name="__codelineno-39-236" href="#__codelineno-39-236"></a><span class="w">    </span><span class="na">pool_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-237"><a id="__codelineno-39-237" name="__codelineno-39-237" href="#__codelineno-39-237"></a><span class="w">    </span><span class="na">root_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-238"><a id="__codelineno-39-238" name="__codelineno-39-238" href="#__codelineno-39-238"></a>
</span><span id="__span-39-239"><a id="__codelineno-39-239" name="__codelineno-39-239" href="#__codelineno-39-239"></a><span class="w">  </span><span class="k">[plugins."io.containerd.snapshotter.v1.native"]</span>
</span><span id="__span-39-240"><a id="__codelineno-39-240" name="__codelineno-39-240" href="#__codelineno-39-240"></a><span class="w">    </span><span class="na">root_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-241"><a id="__codelineno-39-241" name="__codelineno-39-241" href="#__codelineno-39-241"></a>
</span><span id="__span-39-242"><a id="__codelineno-39-242" name="__codelineno-39-242" href="#__codelineno-39-242"></a><span class="w">  </span><span class="k">[plugins."io.containerd.snapshotter.v1.overlayfs"]</span>
</span><span id="__span-39-243"><a id="__codelineno-39-243" name="__codelineno-39-243" href="#__codelineno-39-243"></a><span class="w">    </span><span class="na">mount_options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">[]</span>
</span><span id="__span-39-244"><a id="__codelineno-39-244" name="__codelineno-39-244" href="#__codelineno-39-244"></a><span class="w">    </span><span class="na">root_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-245"><a id="__codelineno-39-245" name="__codelineno-39-245" href="#__codelineno-39-245"></a><span class="w">    </span><span class="na">sync_remove</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-246"><a id="__codelineno-39-246" name="__codelineno-39-246" href="#__codelineno-39-246"></a><span class="w">    </span><span class="na">upperdir_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">false</span>
</span><span id="__span-39-247"><a id="__codelineno-39-247" name="__codelineno-39-247" href="#__codelineno-39-247"></a>
</span><span id="__span-39-248"><a id="__codelineno-39-248" name="__codelineno-39-248" href="#__codelineno-39-248"></a><span class="w">  </span><span class="k">[plugins."io.containerd.snapshotter.v1.zfs"]</span>
</span><span id="__span-39-249"><a id="__codelineno-39-249" name="__codelineno-39-249" href="#__codelineno-39-249"></a><span class="w">    </span><span class="na">root_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-250"><a id="__codelineno-39-250" name="__codelineno-39-250" href="#__codelineno-39-250"></a>
</span><span id="__span-39-251"><a id="__codelineno-39-251" name="__codelineno-39-251" href="#__codelineno-39-251"></a><span class="w">  </span><span class="k">[plugins."io.containerd.tracing.processor.v1.otlp"]</span>
</span><span id="__span-39-252"><a id="__codelineno-39-252" name="__codelineno-39-252" href="#__codelineno-39-252"></a>
</span><span id="__span-39-253"><a id="__codelineno-39-253" name="__codelineno-39-253" href="#__codelineno-39-253"></a><span class="w">  </span><span class="k">[plugins."io.containerd.transfer.v1.local"]</span>
</span><span id="__span-39-254"><a id="__codelineno-39-254" name="__codelineno-39-254" href="#__codelineno-39-254"></a><span class="w">    </span><span class="na">config_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-255"><a id="__codelineno-39-255" name="__codelineno-39-255" href="#__codelineno-39-255"></a><span class="w">    </span><span class="na">max_concurrent_downloads</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span>
</span><span id="__span-39-256"><a id="__codelineno-39-256" name="__codelineno-39-256" href="#__codelineno-39-256"></a><span class="w">    </span><span class="na">max_concurrent_uploaded_layers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">3</span>
</span><span id="__span-39-257"><a id="__codelineno-39-257" name="__codelineno-39-257" href="#__codelineno-39-257"></a>
</span><span id="__span-39-258"><a id="__codelineno-39-258" name="__codelineno-39-258" href="#__codelineno-39-258"></a><span class="w">    </span><span class="k">[[plugins."io.containerd.transfer.v1.local".unpack_config]]</span>
</span><span id="__span-39-259"><a id="__codelineno-39-259" name="__codelineno-39-259" href="#__codelineno-39-259"></a><span class="w">      </span><span class="na">differ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-260"><a id="__codelineno-39-260" name="__codelineno-39-260" href="#__codelineno-39-260"></a><span class="w">      </span><span class="na">platform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"linux/amd64"</span>
</span><span id="__span-39-261"><a id="__codelineno-39-261" name="__codelineno-39-261" href="#__codelineno-39-261"></a><span class="w">      </span><span class="na">snapshotter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"overlayfs"</span>
</span><span id="__span-39-262"><a id="__codelineno-39-262" name="__codelineno-39-262" href="#__codelineno-39-262"></a>
</span><span id="__span-39-263"><a id="__codelineno-39-263" name="__codelineno-39-263" href="#__codelineno-39-263"></a><span class="k">[proxy_plugins]</span>
</span><span id="__span-39-264"><a id="__codelineno-39-264" name="__codelineno-39-264" href="#__codelineno-39-264"></a>
</span><span id="__span-39-265"><a id="__codelineno-39-265" name="__codelineno-39-265" href="#__codelineno-39-265"></a><span class="k">[stream_processors]</span>
</span><span id="__span-39-266"><a id="__codelineno-39-266" name="__codelineno-39-266" href="#__codelineno-39-266"></a>
</span><span id="__span-39-267"><a id="__codelineno-39-267" name="__codelineno-39-267" href="#__codelineno-39-267"></a><span class="w">  </span><span class="k">[stream_processors."io.containerd.ocicrypt.decoder.v1.tar"]</span>
</span><span id="__span-39-268"><a id="__codelineno-39-268" name="__codelineno-39-268" href="#__codelineno-39-268"></a><span class="w">    </span><span class="na">accepts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">["application/vnd.oci.image.layer.v1.tar+encrypted"]</span>
</span><span id="__span-39-269"><a id="__codelineno-39-269" name="__codelineno-39-269" href="#__codelineno-39-269"></a><span class="w">    </span><span class="na">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">["--decryption-keys-path", "/etc/containerd/ocicrypt/keys"]</span>
</span><span id="__span-39-270"><a id="__codelineno-39-270" name="__codelineno-39-270" href="#__codelineno-39-270"></a><span class="w">    </span><span class="na">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">["OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf"]</span>
</span><span id="__span-39-271"><a id="__codelineno-39-271" name="__codelineno-39-271" href="#__codelineno-39-271"></a><span class="w">    </span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"ctd-decoder"</span>
</span><span id="__span-39-272"><a id="__codelineno-39-272" name="__codelineno-39-272" href="#__codelineno-39-272"></a><span class="w">    </span><span class="na">returns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"application/vnd.oci.image.layer.v1.tar"</span>
</span><span id="__span-39-273"><a id="__codelineno-39-273" name="__codelineno-39-273" href="#__codelineno-39-273"></a>
</span><span id="__span-39-274"><a id="__codelineno-39-274" name="__codelineno-39-274" href="#__codelineno-39-274"></a><span class="w">  </span><span class="k">[stream_processors."io.containerd.ocicrypt.decoder.v1.tar.gzip"]</span>
</span><span id="__span-39-275"><a id="__codelineno-39-275" name="__codelineno-39-275" href="#__codelineno-39-275"></a><span class="w">    </span><span class="na">accepts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">["application/vnd.oci.image.layer.v1.tar+gzip+encrypted"]</span>
</span><span id="__span-39-276"><a id="__codelineno-39-276" name="__codelineno-39-276" href="#__codelineno-39-276"></a><span class="w">    </span><span class="na">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">["--decryption-keys-path", "/etc/containerd/ocicrypt/keys"]</span>
</span><span id="__span-39-277"><a id="__codelineno-39-277" name="__codelineno-39-277" href="#__codelineno-39-277"></a><span class="w">    </span><span class="na">env</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">["OCICRYPT_KEYPROVIDER_CONFIG=/etc/containerd/ocicrypt/ocicrypt_keyprovider.conf"]</span>
</span><span id="__span-39-278"><a id="__codelineno-39-278" name="__codelineno-39-278" href="#__codelineno-39-278"></a><span class="w">    </span><span class="na">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"ctd-decoder"</span>
</span><span id="__span-39-279"><a id="__codelineno-39-279" name="__codelineno-39-279" href="#__codelineno-39-279"></a><span class="w">    </span><span class="na">returns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"application/vnd.oci.image.layer.v1.tar+gzip"</span>
</span><span id="__span-39-280"><a id="__codelineno-39-280" name="__codelineno-39-280" href="#__codelineno-39-280"></a>
</span><span id="__span-39-281"><a id="__codelineno-39-281" name="__codelineno-39-281" href="#__codelineno-39-281"></a><span class="k">[timeouts]</span>
</span><span id="__span-39-282"><a id="__codelineno-39-282" name="__codelineno-39-282" href="#__codelineno-39-282"></a><span class="w">  </span><span class="na">"io.containerd.timeout.bolt.open"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"0s"</span>
</span><span id="__span-39-283"><a id="__codelineno-39-283" name="__codelineno-39-283" href="#__codelineno-39-283"></a><span class="w">  </span><span class="na">"io.containerd.timeout.metrics.shimstats"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"2s"</span>
</span><span id="__span-39-284"><a id="__codelineno-39-284" name="__codelineno-39-284" href="#__codelineno-39-284"></a><span class="w">  </span><span class="na">"io.containerd.timeout.shim.cleanup"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"5s"</span>
</span><span id="__span-39-285"><a id="__codelineno-39-285" name="__codelineno-39-285" href="#__codelineno-39-285"></a><span class="w">  </span><span class="na">"io.containerd.timeout.shim.load"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"5s"</span>
</span><span id="__span-39-286"><a id="__codelineno-39-286" name="__codelineno-39-286" href="#__codelineno-39-286"></a><span class="w">  </span><span class="na">"io.containerd.timeout.shim.shutdown"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"3s"</span>
</span><span id="__span-39-287"><a id="__codelineno-39-287" name="__codelineno-39-287" href="#__codelineno-39-287"></a><span class="w">  </span><span class="na">"io.containerd.timeout.task.state"</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"2s"</span>
</span><span id="__span-39-288"><a id="__codelineno-39-288" name="__codelineno-39-288" href="#__codelineno-39-288"></a>
</span><span id="__span-39-289"><a id="__codelineno-39-289" name="__codelineno-39-289" href="#__codelineno-39-289"></a><span class="k">[ttrpc]</span>
</span><span id="__span-39-290"><a id="__codelineno-39-290" name="__codelineno-39-290" href="#__codelineno-39-290"></a><span class="w">  </span><span class="na">address</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">""</span>
</span><span id="__span-39-291"><a id="__codelineno-39-291" name="__codelineno-39-291" href="#__codelineno-39-291"></a><span class="w">  </span><span class="na">gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span><span id="__span-39-292"><a id="__codelineno-39-292" name="__codelineno-39-292" href="#__codelineno-39-292"></a><span class="w">  </span><span class="na">uid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">0</span>
</span></code></pre></div>
</details>
<h3 id="bootstrap-with-kubeadm">Bootstrap with <code>kubeadm</code></h3>
<p><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">Creating a cluster with <code>kubeadm</code></a>
is the next big step towards creating the Kubernetes cluster.</p>
<h4 id="initialize-the-control-plane">Initialize the control-plane</h4>
<p>Having reviewed the requirements and installed all the components already,
<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#initializing-your-control-plane-node">initialize the control-plane node</a>
with flags:</p>
<ul>
<li><code>--cri-socket=unix:/run/containerd/containerd.sock</code> to make sure Kubernetes uses the containerd runtime.</li>
<li><code>--pod-network-cidr=10.244.0.0/16</code> as 
    <a href="https://github.com/flannel-io/flannel/blob/master/Documentation/kubernetes.md">required by flannel</a>,
    which is the <a href="#network-plugin">network plugin</a> to be installed later.</li>
</ul>
<details class="terminal">
<summary><code>$ sudo kubeadm init</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>kubeadm<span class="w"> </span>init<span class="w"> </span><span class="se">\</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="w">  </span>--cri-socket<span class="o">=</span>unix:/run/containerd/containerd.sock<span class="w"> </span><span class="se">\</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">  </span>--pod-network-cidr<span class="o">=</span><span class="m">10</span>.244.0.0/16
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="go">I0426 16:55:42.979255   33862 version.go:261] remote version is much newer: v1.33.0; falling back to: stable-1.32</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="go">[init] Using Kubernetes version: v1.32.4</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="go">[preflight] Running pre-flight checks</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="go">[preflight] Pulling images required for setting up a Kubernetes cluster</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="go">[preflight] This might take a minute or two, depending on the speed of your internet connection</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="go">[preflight] You can also perform this action beforehand using 'kubeadm config images pull'</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="go">W0426 16:55:43.482424   33862 checks.go:846] detected that the sandbox image "registry.k8s.io/pause:3.8" of the container runtime is inconsistent with that used by kubeadm.It is recommended to use "registry.k8s.io/pause:3.10" as the CRI sandbox image.</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="go">[certs] Using certificateDir folder "/etc/kubernetes/pki"</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="go">[certs] Generating "ca" certificate and key</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="go">[certs] Generating "apiserver" certificate and key</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="go">[certs] apiserver serving cert is signed for DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local octavo] and IPs [10.96.0.1 10.0.0.8]</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="go">[certs] Generating "apiserver-kubelet-client" certificate and key</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="go">[certs] Generating "front-proxy-ca" certificate and key</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="go">[certs] Generating "front-proxy-client" certificate and key</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="go">[certs] Generating "etcd/ca" certificate and key</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="go">[certs] Generating "etcd/server" certificate and key</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a><span class="go">[certs] etcd/server serving cert is signed for DNS names [localhost octavo] and IPs [10.0.0.8 127.0.0.1 ::1]</span>
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="go">[certs] Generating "etcd/peer" certificate and key</span>
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a><span class="go">[certs] etcd/peer serving cert is signed for DNS names [localhost octavo] and IPs [10.0.0.8 127.0.0.1 ::1]</span>
</span><span id="__span-40-23"><a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a><span class="go">[certs] Generating "etcd/healthcheck-client" certificate and key</span>
</span><span id="__span-40-24"><a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a><span class="go">[certs] Generating "apiserver-etcd-client" certificate and key</span>
</span><span id="__span-40-25"><a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a><span class="go">[certs] Generating "sa" key and public key</span>
</span><span id="__span-40-26"><a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a><span class="go">[kubeconfig] Using kubeconfig folder "/etc/kubernetes"</span>
</span><span id="__span-40-27"><a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a><span class="go">[kubeconfig] Writing "admin.conf" kubeconfig file</span>
</span><span id="__span-40-28"><a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a><span class="go">[kubeconfig] Writing "super-admin.conf" kubeconfig file</span>
</span><span id="__span-40-29"><a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a><span class="go">[kubeconfig] Writing "kubelet.conf" kubeconfig file</span>
</span><span id="__span-40-30"><a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a><span class="go">[kubeconfig] Writing "controller-manager.conf" kubeconfig file</span>
</span><span id="__span-40-31"><a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a><span class="go">[kubeconfig] Writing "scheduler.conf" kubeconfig file</span>
</span><span id="__span-40-32"><a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a><span class="go">[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"</span>
</span><span id="__span-40-33"><a id="__codelineno-40-33" name="__codelineno-40-33" href="#__codelineno-40-33"></a><span class="go">[control-plane] Using manifest folder "/etc/kubernetes/manifests"</span>
</span><span id="__span-40-34"><a id="__codelineno-40-34" name="__codelineno-40-34" href="#__codelineno-40-34"></a><span class="go">[control-plane] Creating static Pod manifest for "kube-apiserver"</span>
</span><span id="__span-40-35"><a id="__codelineno-40-35" name="__codelineno-40-35" href="#__codelineno-40-35"></a><span class="go">[control-plane] Creating static Pod manifest for "kube-controller-manager"</span>
</span><span id="__span-40-36"><a id="__codelineno-40-36" name="__codelineno-40-36" href="#__codelineno-40-36"></a><span class="go">[control-plane] Creating static Pod manifest for "kube-scheduler"</span>
</span><span id="__span-40-37"><a id="__codelineno-40-37" name="__codelineno-40-37" href="#__codelineno-40-37"></a><span class="go">[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"</span>
</span><span id="__span-40-38"><a id="__codelineno-40-38" name="__codelineno-40-38" href="#__codelineno-40-38"></a><span class="go">[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"</span>
</span><span id="__span-40-39"><a id="__codelineno-40-39" name="__codelineno-40-39" href="#__codelineno-40-39"></a><span class="go">[kubelet-start] Starting the kubelet</span>
</span><span id="__span-40-40"><a id="__codelineno-40-40" name="__codelineno-40-40" href="#__codelineno-40-40"></a><span class="go">[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests"</span>
</span><span id="__span-40-41"><a id="__codelineno-40-41" name="__codelineno-40-41" href="#__codelineno-40-41"></a><span class="go">[kubelet-check] Waiting for a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s</span>
</span><span id="__span-40-42"><a id="__codelineno-40-42" name="__codelineno-40-42" href="#__codelineno-40-42"></a><span class="go">[kubelet-check] The kubelet is healthy after 501.89299ms</span>
</span><span id="__span-40-43"><a id="__codelineno-40-43" name="__codelineno-40-43" href="#__codelineno-40-43"></a><span class="go">[api-check] Waiting for a healthy API server. This can take up to 4m0s</span>
</span><span id="__span-40-44"><a id="__codelineno-40-44" name="__codelineno-40-44" href="#__codelineno-40-44"></a><span class="go">[api-check] The API server is healthy after 3.503255484s</span>
</span><span id="__span-40-45"><a id="__codelineno-40-45" name="__codelineno-40-45" href="#__codelineno-40-45"></a><span class="go">[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace</span>
</span><span id="__span-40-46"><a id="__codelineno-40-46" name="__codelineno-40-46" href="#__codelineno-40-46"></a><span class="go">[kubelet] Creating a ConfigMap "kubelet-config" in namespace kube-system with the configuration for the kubelets in the cluster</span>
</span><span id="__span-40-47"><a id="__codelineno-40-47" name="__codelineno-40-47" href="#__codelineno-40-47"></a><span class="go">[upload-certs] Skipping phase. Please see --upload-certs</span>
</span><span id="__span-40-48"><a id="__codelineno-40-48" name="__codelineno-40-48" href="#__codelineno-40-48"></a><span class="go">[mark-control-plane] Marking the node octavo as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]</span>
</span><span id="__span-40-49"><a id="__codelineno-40-49" name="__codelineno-40-49" href="#__codelineno-40-49"></a><span class="go">[mark-control-plane] Marking the node octavo as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]</span>
</span><span id="__span-40-50"><a id="__codelineno-40-50" name="__codelineno-40-50" href="#__codelineno-40-50"></a><span class="go">[bootstrap-token] Using token: 7k3y4k.r8ebhonqgtm6anyr</span>
</span><span id="__span-40-51"><a id="__codelineno-40-51" name="__codelineno-40-51" href="#__codelineno-40-51"></a><span class="go">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span>
</span><span id="__span-40-52"><a id="__codelineno-40-52" name="__codelineno-40-52" href="#__codelineno-40-52"></a><span class="go">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes</span>
</span><span id="__span-40-53"><a id="__codelineno-40-53" name="__codelineno-40-53" href="#__codelineno-40-53"></a><span class="go">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span>
</span><span id="__span-40-54"><a id="__codelineno-40-54" name="__codelineno-40-54" href="#__codelineno-40-54"></a><span class="go">[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span>
</span><span id="__span-40-55"><a id="__codelineno-40-55" name="__codelineno-40-55" href="#__codelineno-40-55"></a><span class="go">[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span>
</span><span id="__span-40-56"><a id="__codelineno-40-56" name="__codelineno-40-56" href="#__codelineno-40-56"></a><span class="go">[bootstrap-token] Creating the "cluster-info" ConfigMap in the "kube-public" namespace</span>
</span><span id="__span-40-57"><a id="__codelineno-40-57" name="__codelineno-40-57" href="#__codelineno-40-57"></a><span class="go">[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key</span>
</span><span id="__span-40-58"><a id="__codelineno-40-58" name="__codelineno-40-58" href="#__codelineno-40-58"></a><span class="go">[addons] Applied essential addon: CoreDNS</span>
</span><span id="__span-40-59"><a id="__codelineno-40-59" name="__codelineno-40-59" href="#__codelineno-40-59"></a><span class="go">[addons] Applied essential addon: kube-proxy</span>
</span><span id="__span-40-60"><a id="__codelineno-40-60" name="__codelineno-40-60" href="#__codelineno-40-60"></a>
</span><span id="__span-40-61"><a id="__codelineno-40-61" name="__codelineno-40-61" href="#__codelineno-40-61"></a><span class="go">Your Kubernetes control-plane has initialized successfully!</span>
</span><span id="__span-40-62"><a id="__codelineno-40-62" name="__codelineno-40-62" href="#__codelineno-40-62"></a>
</span><span id="__span-40-63"><a id="__codelineno-40-63" name="__codelineno-40-63" href="#__codelineno-40-63"></a><span class="go">To start using your cluster, you need to run the following as a regular user:</span>
</span><span id="__span-40-64"><a id="__codelineno-40-64" name="__codelineno-40-64" href="#__codelineno-40-64"></a>
</span><span id="__span-40-65"><a id="__codelineno-40-65" name="__codelineno-40-65" href="#__codelineno-40-65"></a><span class="go">  mkdir -p $HOME/.kube</span>
</span><span id="__span-40-66"><a id="__codelineno-40-66" name="__codelineno-40-66" href="#__codelineno-40-66"></a><span class="go">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span>
</span><span id="__span-40-67"><a id="__codelineno-40-67" name="__codelineno-40-67" href="#__codelineno-40-67"></a><span class="go">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span>
</span><span id="__span-40-68"><a id="__codelineno-40-68" name="__codelineno-40-68" href="#__codelineno-40-68"></a>
</span><span id="__span-40-69"><a id="__codelineno-40-69" name="__codelineno-40-69" href="#__codelineno-40-69"></a><span class="go">Alternatively, if you are the root user, you can run:</span>
</span><span id="__span-40-70"><a id="__codelineno-40-70" name="__codelineno-40-70" href="#__codelineno-40-70"></a>
</span><span id="__span-40-71"><a id="__codelineno-40-71" name="__codelineno-40-71" href="#__codelineno-40-71"></a><span class="go">  export KUBECONFIG=/etc/kubernetes/admin.conf</span>
</span><span id="__span-40-72"><a id="__codelineno-40-72" name="__codelineno-40-72" href="#__codelineno-40-72"></a>
</span><span id="__span-40-73"><a id="__codelineno-40-73" name="__codelineno-40-73" href="#__codelineno-40-73"></a><span class="go">You should now deploy a pod network to the cluster.</span>
</span><span id="__span-40-74"><a id="__codelineno-40-74" name="__codelineno-40-74" href="#__codelineno-40-74"></a><span class="go">Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:</span>
</span><span id="__span-40-75"><a id="__codelineno-40-75" name="__codelineno-40-75" href="#__codelineno-40-75"></a><span class="go">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span>
</span><span id="__span-40-76"><a id="__codelineno-40-76" name="__codelineno-40-76" href="#__codelineno-40-76"></a>
</span><span id="__span-40-77"><a id="__codelineno-40-77" name="__codelineno-40-77" href="#__codelineno-40-77"></a><span class="go">Then you can join any number of worker nodes by running the following on each as root:</span>
</span><span id="__span-40-78"><a id="__codelineno-40-78" name="__codelineno-40-78" href="#__codelineno-40-78"></a>
</span><span id="__span-40-79"><a id="__codelineno-40-79" name="__codelineno-40-79" href="#__codelineno-40-79"></a><span class="go">kubeadm join 10.0.0.8:6443 --token 7k3y4k.r8ebhonqgtm6anyr \</span>
</span><span id="__span-40-80"><a id="__codelineno-40-80" name="__codelineno-40-80" href="#__codelineno-40-80"></a><span class="go">        --discovery-token-ca-cert-hash sha256:18d968e92516e1a2808166d90a7d7c8b6f7b37cbac6328c49793863f9ae2b982 </span>
</span></code></pre></div>
</details>
<p>Once this is done, Kubernetes control plane is running at <code>10.0.0.8:6443</code></p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="gp"># </span><span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="gp"># </span>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="go">Kubernetes control plane is running at https://10.0.0.8:6443</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a><span class="go">CoreDNS is running at https://10.0.0.8:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="go">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="gp"># </span>kubectl<span class="w"> </span>version<span class="w"> </span>--output<span class="o">=</span>yaml
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="go">clientVersion:</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="go">  buildDate: "2025-04-22T16:03:58Z"</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="go">  compiler: gc</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="go">  gitCommit: 59526cd4867447956156ae3a602fcbac10a2c335</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="go">  gitTreeState: clean</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="go">  gitVersion: v1.32.4</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a><span class="go">  goVersion: go1.23.6</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="go">  major: "1"</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="go">  minor: "32"</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="go">  platform: linux/amd64</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="go">kustomizeVersion: v5.5.0</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a><span class="go">serverVersion:</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="go">  buildDate: "2025-04-22T15:56:15Z"</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="go">  compiler: gc</span>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="go">  gitCommit: 59526cd4867447956156ae3a602fcbac10a2c335</span>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="go">  gitTreeState: clean</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a><span class="go">  gitVersion: v1.32.4</span>
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="go">  goVersion: go1.23.6</span>
</span><span id="__span-41-28"><a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="go">  major: "1"</span>
</span><span id="__span-41-29"><a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a><span class="go">  minor: "32"</span>
</span><span id="__span-41-30"><a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="go">  platform: linux/amd6</span>
</span></code></pre></div>
<h4 id="setup-kubectl-access">Setup <code>kubectl</code> access</h4>
<p>To run <code>kubectl</code> as a non-root user, copy the Kubernetes config file under the
<code>~/.kube</code> directory and set the right permissions to it:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="gp">$ </span>mkdir<span class="w"> </span><span class="nv">$HOME</span>/.kube
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="gp">$ </span>sudo<span class="w"> </span>cp<span class="w"> </span>-f<span class="w"> </span>/etc/kubernetes/admin.conf<span class="w"> </span><span class="nv">$HOME</span>/.kube/config
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="go">[sudo] password for ponder: </span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="gp">$ </span>sudo<span class="w"> </span>chown<span class="w"> </span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span>:<span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="w"> </span><span class="nv">$HOME</span>/.kube/config
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="gp">$ </span>ls<span class="w"> </span>-l<span class="w"> </span><span class="nv">$HOME</span>/.kube/config
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="go">-rw------- 1 ponder ponder 5648 Apr 26 17:03 /home/ponder/.kube/config</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="gp">$ </span>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="go">Kubernetes control plane is running at https://10.0.0.8:6443</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="go">CoreDNS is running at https://10.0.0.8:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="go">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>
</span></code></pre></div>
<h5 id="troubleshooting-bootstrap">Troubleshooting bootstrap</h5>
<p>The first time around, <code>sudo kubeadm init</code> failed. This <em>didn't seem</em> to have been
<a href="#disable-swap">swap not being disabled</a>
at first, but in the end disabling swap seems to have been the (only) solution.</p>
<details class="terminal">
<summary><code>$ sudo kubeadm init</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>kubeadm<span class="w"> </span>init<span class="w"> </span><span class="se">\</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="w">  </span>--cri-socket<span class="o">=</span>unix:/run/containerd/containerd.sock<span class="w"> </span><span class="se">\</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="w">  </span>--pod-network-cidr<span class="o">=</span><span class="m">10</span>.244.0.0/16
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="go">I0426 15:49:34.806666  537229 version.go:261] remote version is much newer: v1.33.0; falling back to: stable-1.32</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="go">[init] Using Kubernetes version: v1.32.4</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="go">[preflight] Running pre-flight checks</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="go">        [WARNING Swap]: swap is supported for cgroup v2 only. The kubelet must be properly configured to use swap. Please refer to https://kubernetes.io/docs/concepts/architecture/nodes/#swap-memory, or disable swap on the node</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="go">[preflight] Pulling images required for setting up a Kubernetes cluster</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="go">[preflight] This might take a minute or two, depending on the speed of your internet connection</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="go">[preflight] You can also perform this action beforehand using 'kubeadm config images pull'</span>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="go">W0426 15:49:35.293520  537229 checks.go:846] detected that the sandbox image "registry.k8s.io/pause:3.8" of the container runtime is inconsistent with that used by kubeadm.It is recommended to use "registry.k8s.io/pause:3.10" as the CRI sandbox image.</span>
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="go">[certs] Using certificateDir folder "/etc/kubernetes/pki"</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="go">[certs] Generating "ca" certificate and key</span>
</span><span id="__span-43-15"><a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="go">[certs] Generating "apiserver" certificate and key</span>
</span><span id="__span-43-16"><a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="go">[certs] apiserver serving cert is signed for DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local octavo] and IPs [10.96.0.1 10.0.0.8]</span>
</span><span id="__span-43-17"><a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="go">[certs] Generating "apiserver-kubelet-client" certificate and key</span>
</span><span id="__span-43-18"><a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="go">[certs] Generating "front-proxy-ca" certificate and key</span>
</span><span id="__span-43-19"><a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="go">[certs] Generating "front-proxy-client" certificate and key</span>
</span><span id="__span-43-20"><a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="go">[certs] Generating "etcd/ca" certificate and key</span>
</span><span id="__span-43-21"><a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a><span class="go">[certs] Generating "etcd/server" certificate and key</span>
</span><span id="__span-43-22"><a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="go">[certs] etcd/server serving cert is signed for DNS names [localhost octavo] and IPs [10.0.0.8 127.0.0.1 ::1]</span>
</span><span id="__span-43-23"><a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a><span class="go">[certs] Generating "etcd/peer" certificate and key</span>
</span><span id="__span-43-24"><a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a><span class="go">[certs] etcd/peer serving cert is signed for DNS names [localhost octavo] and IPs [10.0.0.8 127.0.0.1 ::1]</span>
</span><span id="__span-43-25"><a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a><span class="go">[certs] Generating "etcd/healthcheck-client" certificate and key</span>
</span><span id="__span-43-26"><a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a><span class="go">[certs] Generating "apiserver-etcd-client" certificate and key</span>
</span><span id="__span-43-27"><a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a><span class="go">[certs] Generating "sa" key and public key</span>
</span><span id="__span-43-28"><a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a><span class="go">[kubeconfig] Using kubeconfig folder "/etc/kubernetes"</span>
</span><span id="__span-43-29"><a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a><span class="go">[kubeconfig] Writing "admin.conf" kubeconfig file</span>
</span><span id="__span-43-30"><a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a><span class="go">[kubeconfig] Writing "super-admin.conf" kubeconfig file</span>
</span><span id="__span-43-31"><a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a><span class="go">[kubeconfig] Writing "kubelet.conf" kubeconfig file</span>
</span><span id="__span-43-32"><a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a><span class="go">[kubeconfig] Writing "controller-manager.conf" kubeconfig file</span>
</span><span id="__span-43-33"><a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a><span class="go">[kubeconfig] Writing "scheduler.conf" kubeconfig file</span>
</span><span id="__span-43-34"><a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a><span class="go">[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"</span>
</span><span id="__span-43-35"><a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a><span class="go">[control-plane] Using manifest folder "/etc/kubernetes/manifests"</span>
</span><span id="__span-43-36"><a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a><span class="go">[control-plane] Creating static Pod manifest for "kube-apiserver"</span>
</span><span id="__span-43-37"><a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a><span class="go">[control-plane] Creating static Pod manifest for "kube-controller-manager"</span>
</span><span id="__span-43-38"><a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a><span class="go">[control-plane] Creating static Pod manifest for "kube-scheduler"</span>
</span><span id="__span-43-39"><a id="__codelineno-43-39" name="__codelineno-43-39" href="#__codelineno-43-39"></a><span class="go">[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"</span>
</span><span id="__span-43-40"><a id="__codelineno-43-40" name="__codelineno-43-40" href="#__codelineno-43-40"></a><span class="go">[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"</span>
</span><span id="__span-43-41"><a id="__codelineno-43-41" name="__codelineno-43-41" href="#__codelineno-43-41"></a><span class="go">[kubelet-start] Starting the kubelet</span>
</span><span id="__span-43-42"><a id="__codelineno-43-42" name="__codelineno-43-42" href="#__codelineno-43-42"></a><span class="go">[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests"</span>
</span><span id="__span-43-43"><a id="__codelineno-43-43" name="__codelineno-43-43" href="#__codelineno-43-43"></a><span class="go">[kubelet-check] Waiting for a healthy kubelet at http://127.0.0.1:10248/healthz. This can take up to 4m0s</span>
</span><span id="__span-43-44"><a id="__codelineno-43-44" name="__codelineno-43-44" href="#__codelineno-43-44"></a><span class="go">[kubelet-check] The kubelet is not healthy after 4m0.000397441s</span>
</span><span id="__span-43-45"><a id="__codelineno-43-45" name="__codelineno-43-45" href="#__codelineno-43-45"></a>
</span><span id="__span-43-46"><a id="__codelineno-43-46" name="__codelineno-43-46" href="#__codelineno-43-46"></a><span class="go">Unfortunately, an error has occurred:</span>
</span><span id="__span-43-47"><a id="__codelineno-43-47" name="__codelineno-43-47" href="#__codelineno-43-47"></a><span class="go">        The HTTP call equal to 'curl -sSL http://127.0.0.1:10248/healthz' returned error: Get "http://127.0.0.1:10248/healthz": context deadline exceeded</span>
</span><span id="__span-43-48"><a id="__codelineno-43-48" name="__codelineno-43-48" href="#__codelineno-43-48"></a>
</span><span id="__span-43-49"><a id="__codelineno-43-49" name="__codelineno-43-49" href="#__codelineno-43-49"></a>
</span><span id="__span-43-50"><a id="__codelineno-43-50" name="__codelineno-43-50" href="#__codelineno-43-50"></a><span class="go">This error is likely caused by:</span>
</span><span id="__span-43-51"><a id="__codelineno-43-51" name="__codelineno-43-51" href="#__codelineno-43-51"></a><span class="go">        - The kubelet is not running</span>
</span><span id="__span-43-52"><a id="__codelineno-43-52" name="__codelineno-43-52" href="#__codelineno-43-52"></a><span class="go">        - The kubelet is unhealthy due to a misconfiguration of the node in some way (required cgroups disabled)</span>
</span><span id="__span-43-53"><a id="__codelineno-43-53" name="__codelineno-43-53" href="#__codelineno-43-53"></a>
</span><span id="__span-43-54"><a id="__codelineno-43-54" name="__codelineno-43-54" href="#__codelineno-43-54"></a><span class="go">If you are on a systemd-powered system, you can try to troubleshoot the error with the following commands:</span>
</span><span id="__span-43-55"><a id="__codelineno-43-55" name="__codelineno-43-55" href="#__codelineno-43-55"></a><span class="go">        - 'systemctl status kubelet'</span>
</span><span id="__span-43-56"><a id="__codelineno-43-56" name="__codelineno-43-56" href="#__codelineno-43-56"></a><span class="go">        - 'journalctl -xeu kubelet'</span>
</span><span id="__span-43-57"><a id="__codelineno-43-57" name="__codelineno-43-57" href="#__codelineno-43-57"></a>
</span><span id="__span-43-58"><a id="__codelineno-43-58" name="__codelineno-43-58" href="#__codelineno-43-58"></a><span class="go">Additionally, a control plane component may have crashed or exited when started by the container runtime.</span>
</span><span id="__span-43-59"><a id="__codelineno-43-59" name="__codelineno-43-59" href="#__codelineno-43-59"></a><span class="go">To troubleshoot, list all containers using your preferred container runtimes CLI.</span>
</span><span id="__span-43-60"><a id="__codelineno-43-60" name="__codelineno-43-60" href="#__codelineno-43-60"></a><span class="go">Here is one example how you may list all running Kubernetes containers by using crictl:</span>
</span><span id="__span-43-61"><a id="__codelineno-43-61" name="__codelineno-43-61" href="#__codelineno-43-61"></a><span class="go">        - 'crictl --runtime-endpoint unix:/run/containerd/containerd.sock ps -a | grep kube | grep -v pause'</span>
</span><span id="__span-43-62"><a id="__codelineno-43-62" name="__codelineno-43-62" href="#__codelineno-43-62"></a><span class="go">        Once you have found the failing container, you can inspect its logs with:</span>
</span><span id="__span-43-63"><a id="__codelineno-43-63" name="__codelineno-43-63" href="#__codelineno-43-63"></a><span class="go">        - 'crictl --runtime-endpoint unix:/run/containerd/containerd.sock logs CONTAINERID'</span>
</span><span id="__span-43-64"><a id="__codelineno-43-64" name="__codelineno-43-64" href="#__codelineno-43-64"></a><span class="go">error execution phase wait-control-plane: could not initialize a Kubernetes cluster</span>
</span><span id="__span-43-65"><a id="__codelineno-43-65" name="__codelineno-43-65" href="#__codelineno-43-65"></a><span class="go">To see the stack trace of this error execute with --v=5 or higher</span>
</span></code></pre></div>
</details>
<p>Swap was disabled (and the server was restarted) only after this happened, but it
does not seem likely to have been the cause.</p>
<p>The kubelet is running but possibly unhealthy, <code>systemctl status kubelet</code> shows the
same line every 5 seconds:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>Apr 26 16:11:29 octavo kubelet[3081]: E0426 16:11:29.654554    3081 kubelet.go:3002] "Container runtime network not ready" networkReady="NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized"
</span></code></pre></div>
<p>Many errors and warning are logged and shown by <code>journalctl -xeu kubelet</code>, up to the
point where the above error is repeated every 5 seconds:</p>
<details class="terminal">
<summary><code>$ journalctl -xeu kubelet</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="gp">$ </span>journalctl<span class="w"> </span>-xeu<span class="w"> </span>kubelet
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="go">Apr 26 16:00:24 octavo systemd[1]: Started kubelet.service - kubelet: The Kubernetes Node Agent.</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="go"> Subject: A start job for unit kubelet.service has finished successfully</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="go"> Defined-By: systemd</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="go"> Support: http://www.ubuntu.com/support</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="go"> </span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a><span class="go"> A start job for unit kubelet.service has finished successfully.</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="go"> </span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="go"> The job identifier is 192.</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a><span class="hll"><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: Flag --container-runtime-endpoint has been deprecated, This parameter should be set via the config file specified by the Kubelet's --config flag. See https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/ for more information.</span>
</span></span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="hll"><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: Flag --pod-infra-container-image has been deprecated, will be removed in 1.35. Image garbage collector will get sandbox image information from CRI.</span>
</span></span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.873338    3081 server.go:215] "--pod-infra-container-image will not be pruned by the image garbage collector in kubelet and should also be set in the remote runtime"</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.878116    3081 server.go:520] "Kubelet version" kubeletVersion="v1.32.4"</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.878137    3081 server.go:522] "Golang settings" GOGC="" GOMAXPROCS="" GOTRACEBACK=""</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.878359    3081 server.go:954] "Client rotation is on, will bootstrap in background"</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.879746    3081 certificate_store.go:130] Loading cert/key pair from "/var/lib/kubelet/pki/kubelet-client-current.pem".</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.881693    3081 dynamic_cafile_content.go:161] "Starting controller" name="client-ca-bundle::/etc/kubernetes/pki/ca.crt"</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.884220    3081 log.go:32] "RuntimeConfig from runtime service failed" err="rpc error: code = Unimplemented desc = unknown method RuntimeConfig for service runtime.v1.RuntimeService"</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="hll"><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.884242    3081 server.go:1421] "CRI implementation should be updated to support RuntimeConfig when KubeletCgroupDriverFromCRI feature gate has been enabled. Falling back to using cgroupDriver from kubelet config."</span>
</span></span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.892519    3081 server.go:772] "--cgroups-per-qos enabled, but --cgroup-root was not specified.  defaulting to /"</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.892745    3081 container_manager_linux.go:268] "Container manager verified user specified cgroup-root exists" cgroupRoot=[]</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.892782    3081 container_manager_linux.go:273] "Creating Container Manager object based on Node Config" nodeConfig={"NodeName":"octavo","RuntimeCgroupsName":"","SystemCgroupsName":"","KubeletCgroupsName":"","KubeletOOMScoreAdj":-999,"ContainerRuntime":"","CgroupsPerQOS":true,"CgroupRoot":"/","CgroupDriver":"systemd","Kubele&gt;</span>
</span><span id="__span-45-23"><a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.892963    3081 topology_manager.go:138] "Creating topology manager with none policy"</span>
</span><span id="__span-45-24"><a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.892973    3081 container_manager_linux.go:304] "Creating device plugin manager"</span>
</span><span id="__span-45-25"><a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.893096    3081 state_mem.go:36] "Initialized new in-memory state store"</span>
</span><span id="__span-45-26"><a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.893362    3081 kubelet.go:446] "Attempting to sync node with API server"</span>
</span><span id="__span-45-27"><a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.893383    3081 kubelet.go:341] "Adding static pod path" path="/etc/kubernetes/manifests"</span>
</span><span id="__span-45-28"><a id="__codelineno-45-28" name="__codelineno-45-28" href="#__codelineno-45-28"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.893401    3081 kubelet.go:352] "Adding apiserver pod source"</span>
</span><span id="__span-45-29"><a id="__codelineno-45-29" name="__codelineno-45-29" href="#__codelineno-45-29"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.893412    3081 apiserver.go:42] "Waiting for node sync before watching apiserver pods"</span>
</span><span id="__span-45-30"><a id="__codelineno-45-30" name="__codelineno-45-30" href="#__codelineno-45-30"></a><span class="hll"><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: W0426 16:00:24.893859    3081 reflector.go:569] k8s.io/client-go/informers/factory.go:160: failed to list *v1.Service: Get "https://10.0.0.8:6443/api/v1/services?fieldSelector=spec.clusterIP%21%3DNone&amp;limit=500&amp;resourceVersion=0": dial tcp 10.0.0.8:6443: connect: connection refused</span>
</span></span><span id="__span-45-31"><a id="__codelineno-45-31" name="__codelineno-45-31" href="#__codelineno-45-31"></a><span class="hll"><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: W0426 16:00:24.893887    3081 reflector.go:569] k8s.io/client-go/informers/factory.go:160: failed to list *v1.Node: Get "https://10.0.0.8:6443/api/v1/nodes?fieldSelector=metadata.name%3Doctavo&amp;limit=500&amp;resourceVersion=0": dial tcp 10.0.0.8:6443: connect: connection refused</span>
</span></span><span id="__span-45-32"><a id="__codelineno-45-32" name="__codelineno-45-32" href="#__codelineno-45-32"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.893911    3081 reflector.go:166] "Unhandled Error" err="k8s.io/client-go/informers/factory.go:160: Failed to watch *v1.Service: failed to list *v1.Service: Get \"https://10.0.0.8:6443/api/v1/services?fieldSelector=spec.clusterIP%21%3DNone&amp;limit=500&amp;resourceVersion=0\": dial tcp 10.0.0.8:6443: connect: connection refused" lo&gt;</span>
</span><span id="__span-45-33"><a id="__codelineno-45-33" name="__codelineno-45-33" href="#__codelineno-45-33"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.893993    3081 reflector.go:166] "Unhandled Error" err="k8s.io/client-go/informers/factory.go:160: Failed to watch *v1.Node: failed to list *v1.Node: Get \"https://10.0.0.8:6443/api/v1/nodes?fieldSelector=metadata.name%3Doctavo&amp;limit=500&amp;resourceVersion=0\": dial tcp 10.0.0.8:6443: connect: connection refused" logger="Unhan&gt;</span>
</span><span id="__span-45-34"><a id="__codelineno-45-34" name="__codelineno-45-34" href="#__codelineno-45-34"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.894044    3081 kuberuntime_manager.go:269] "Container runtime initialized" containerRuntime="containerd" version="1.7.27" apiVersion="v1"</span>
</span><span id="__span-45-35"><a id="__codelineno-45-35" name="__codelineno-45-35" href="#__codelineno-45-35"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.894351    3081 kubelet.go:890] "Not starting ClusterTrustBundle informer because we are in static kubelet mode"</span>
</span><span id="__span-45-36"><a id="__codelineno-45-36" name="__codelineno-45-36" href="#__codelineno-45-36"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: W0426 16:00:24.894385    3081 probe.go:272] Flexvolume plugin directory at /usr/libexec/kubernetes/kubelet-plugins/volume/exec/ does not exist. Recreating.</span>
</span><span id="__span-45-37"><a id="__codelineno-45-37" name="__codelineno-45-37" href="#__codelineno-45-37"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.894658    3081 watchdog_linux.go:99] "Systemd watchdog is not enabled"</span>
</span><span id="__span-45-38"><a id="__codelineno-45-38" name="__codelineno-45-38" href="#__codelineno-45-38"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.894673    3081 server.go:1287] "Started kubelet"</span>
</span><span id="__span-45-39"><a id="__codelineno-45-39" name="__codelineno-45-39" href="#__codelineno-45-39"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.894770    3081 server.go:169] "Starting to listen" address="0.0.0.0" port=10250</span>
</span><span id="__span-45-40"><a id="__codelineno-45-40" name="__codelineno-45-40" href="#__codelineno-45-40"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.894761    3081 ratelimit.go:55] "Setting rate limiting for endpoint" service="podresources" qps=100 burstTokens=10</span>
</span><span id="__span-45-41"><a id="__codelineno-45-41" name="__codelineno-45-41" href="#__codelineno-45-41"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.895021    3081 server.go:243] "Starting to serve the podresources API" endpoint="unix:/var/lib/kubelet/pod-resources/kubelet.sock"</span>
</span><span id="__span-45-42"><a id="__codelineno-45-42" name="__codelineno-45-42" href="#__codelineno-45-42"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.895066    3081 event.go:368] "Unable to write event (may retry after sleeping)" err="Post \"https://10.0.0.8:6443/api/v1/namespaces/default/events\": dial tcp 10.0.0.8:6443: connect: connection refused" event="&amp;Event{ObjectMeta:{octavo.1839e3187cc326ed  default    0 0001-01-01 00:00:00 +0000 UTC &lt;nil&gt; &lt;nil&gt; map[] map[] [] [&gt;</span>
</span><span id="__span-45-43"><a id="__codelineno-45-43" name="__codelineno-45-43" href="#__codelineno-45-43"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.895314    3081 fs_resource_analyzer.go:67] "Starting FS ResourceAnalyzer"</span>
</span><span id="__span-45-44"><a id="__codelineno-45-44" name="__codelineno-45-44" href="#__codelineno-45-44"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.895343    3081 dynamic_serving_content.go:135] "Starting controller" name="kubelet-server-cert-files::/var/lib/kubelet/pki/kubelet.crt::/var/lib/kubelet/pki/kubelet.key"</span>
</span><span id="__span-45-45"><a id="__codelineno-45-45" name="__codelineno-45-45" href="#__codelineno-45-45"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.895416    3081 volume_manager.go:297] "Starting Kubelet Volume Manager"</span>
</span><span id="__span-45-46"><a id="__codelineno-45-46" name="__codelineno-45-46" href="#__codelineno-45-46"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.895449    3081 desired_state_of_world_populator.go:150] "Desired state populator starts to run"</span>
</span><span id="__span-45-47"><a id="__codelineno-45-47" name="__codelineno-45-47" href="#__codelineno-45-47"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.895492    3081 kubelet_node_status.go:466] "Error getting the current node from lister" err="node \"octavo\" not found"</span>
</span><span id="__span-45-48"><a id="__codelineno-45-48" name="__codelineno-45-48" href="#__codelineno-45-48"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.895521    3081 reconciler.go:26] "Reconciler: start to sync state"</span>
</span><span id="__span-45-49"><a id="__codelineno-45-49" name="__codelineno-45-49" href="#__codelineno-45-49"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.896004    3081 controller.go:145] "Failed to ensure lease exists, will retry" err="Get \"https://10.0.0.8:6443/apis/coordination.k8s.io/v1/namespaces/kube-node-lease/leases/octavo?timeout=10s\": dial tcp 10.0.0.8:6443: connect: connection refused" interval="200ms"</span>
</span><span id="__span-45-50"><a id="__codelineno-45-50" name="__codelineno-45-50" href="#__codelineno-45-50"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.896248    3081 factory.go:219] Registration of the crio container factory failed: Get "http://%2Fvar%2Frun%2Fcrio%2Fcrio.sock/info": dial unix /var/run/crio/crio.sock: connect: no such file or directory</span>
</span><span id="__span-45-51"><a id="__codelineno-45-51" name="__codelineno-45-51" href="#__codelineno-45-51"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: W0426 16:00:24.897181    3081 reflector.go:569] k8s.io/client-go/informers/factory.go:160: failed to list *v1.CSIDriver: Get "https://10.0.0.8:6443/apis/storage.k8s.io/v1/csidrivers?limit=500&amp;resourceVersion=0": dial tcp 10.0.0.8:6443: connect: connection refused</span>
</span><span id="__span-45-52"><a id="__codelineno-45-52" name="__codelineno-45-52" href="#__codelineno-45-52"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.897377    3081 reflector.go:166] "Unhandled Error" err="k8s.io/client-go/informers/factory.go:160: Failed to watch *v1.CSIDriver: failed to list *v1.CSIDriver: Get \"https://10.0.0.8:6443/apis/storage.k8s.io/v1/csidrivers?limit=500&amp;resourceVersion=0\": dial tcp 10.0.0.8:6443: connect: connection refused" logger="UnhandledEr&gt;</span>
</span><span id="__span-45-53"><a id="__codelineno-45-53" name="__codelineno-45-53" href="#__codelineno-45-53"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.897627    3081 server.go:479] "Adding debug handlers to kubelet server"</span>
</span><span id="__span-45-54"><a id="__codelineno-45-54" name="__codelineno-45-54" href="#__codelineno-45-54"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.898015    3081 factory.go:221] Registration of the containerd container factory successfully</span>
</span><span id="__span-45-55"><a id="__codelineno-45-55" name="__codelineno-45-55" href="#__codelineno-45-55"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.898031    3081 factory.go:221] Registration of the systemd container factory successfully</span>
</span><span id="__span-45-56"><a id="__codelineno-45-56" name="__codelineno-45-56" href="#__codelineno-45-56"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.898126    3081 kubelet.go:1555] "Image garbage collection failed once. Stats initialization may not have completed yet" err="invalid capacity 0 on image filesystem"</span>
</span><span id="__span-45-57"><a id="__codelineno-45-57" name="__codelineno-45-57" href="#__codelineno-45-57"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.907984    3081 cpu_manager.go:221] "Starting CPU manager" policy="none"</span>
</span><span id="__span-45-58"><a id="__codelineno-45-58" name="__codelineno-45-58" href="#__codelineno-45-58"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.907991    3081 cpu_manager.go:222] "Reconciling" reconcilePeriod="10s"</span>
</span><span id="__span-45-59"><a id="__codelineno-45-59" name="__codelineno-45-59" href="#__codelineno-45-59"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.908003    3081 state_mem.go:36] "Initialized new in-memory state store"</span>
</span><span id="__span-45-60"><a id="__codelineno-45-60" name="__codelineno-45-60" href="#__codelineno-45-60"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.909090    3081 policy_none.go:49] "None policy: Start"</span>
</span><span id="__span-45-61"><a id="__codelineno-45-61" name="__codelineno-45-61" href="#__codelineno-45-61"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.909098    3081 memory_manager.go:186] "Starting memorymanager" policy="None"</span>
</span><span id="__span-45-62"><a id="__codelineno-45-62" name="__codelineno-45-62" href="#__codelineno-45-62"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.909104    3081 state_mem.go:35] "Initializing new in-memory state store"</span>
</span><span id="__span-45-63"><a id="__codelineno-45-63" name="__codelineno-45-63" href="#__codelineno-45-63"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.948672    3081 manager.go:519] "Failed to read data from checkpoint" checkpoint="kubelet_internal_checkpoint" err="checkpoint is not found"</span>
</span><span id="__span-45-64"><a id="__codelineno-45-64" name="__codelineno-45-64" href="#__codelineno-45-64"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.948805    3081 eviction_manager.go:189] "Eviction manager: starting control loop"</span>
</span><span id="__span-45-65"><a id="__codelineno-45-65" name="__codelineno-45-65" href="#__codelineno-45-65"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.948817    3081 container_log_manager.go:189] "Initializing container log rotate workers" workers=1 monitorPeriod="10s"</span>
</span><span id="__span-45-66"><a id="__codelineno-45-66" name="__codelineno-45-66" href="#__codelineno-45-66"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.948983    3081 plugin_manager.go:118] "Starting Kubelet Plugin Manager"</span>
</span><span id="__span-45-67"><a id="__codelineno-45-67" name="__codelineno-45-67" href="#__codelineno-45-67"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.949523    3081 eviction_manager.go:267] "eviction manager: failed to check if we have separate container filesystem. Ignoring." err="no imagefs label for configured runtime"</span>
</span><span id="__span-45-68"><a id="__codelineno-45-68" name="__codelineno-45-68" href="#__codelineno-45-68"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.949568    3081 eviction_manager.go:292] "Eviction manager: failed to get summary stats" err="failed to get node info: node \"octavo\" not found"</span>
</span><span id="__span-45-69"><a id="__codelineno-45-69" name="__codelineno-45-69" href="#__codelineno-45-69"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.952661    3081 kubelet_network_linux.go:50] "Initialized iptables rules." protocol="IPv4"</span>
</span><span id="__span-45-70"><a id="__codelineno-45-70" name="__codelineno-45-70" href="#__codelineno-45-70"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.953773    3081 kubelet_network_linux.go:50] "Initialized iptables rules." protocol="IPv6"</span>
</span><span id="__span-45-71"><a id="__codelineno-45-71" name="__codelineno-45-71" href="#__codelineno-45-71"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.953793    3081 status_manager.go:227] "Starting to sync pod status with apiserver"</span>
</span><span id="__span-45-72"><a id="__codelineno-45-72" name="__codelineno-45-72" href="#__codelineno-45-72"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.953815    3081 watchdog_linux.go:127] "Systemd watchdog is not enabled or the interval is invalid, so health checking will not be started."</span>
</span><span id="__span-45-73"><a id="__codelineno-45-73" name="__codelineno-45-73" href="#__codelineno-45-73"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: I0426 16:00:24.953821    3081 kubelet.go:2382] "Starting kubelet main sync loop"</span>
</span><span id="__span-45-74"><a id="__codelineno-45-74" name="__codelineno-45-74" href="#__codelineno-45-74"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.953861    3081 kubelet.go:2406] "Skipping pod synchronization" err="PLEG is not healthy: pleg has yet to be successful"</span>
</span><span id="__span-45-75"><a id="__codelineno-45-75" name="__codelineno-45-75" href="#__codelineno-45-75"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: W0426 16:00:24.954293    3081 reflector.go:569] k8s.io/client-go/informers/factory.go:160: failed to list *v1.RuntimeClass: Get "https://10.0.0.8:6443/apis/node.k8s.io/v1/runtimeclasses?limit=500&amp;resourceVersion=0": dial tcp 10.0.0.8:6443: connect: connection refused</span>
</span><span id="__span-45-76"><a id="__codelineno-45-76" name="__codelineno-45-76" href="#__codelineno-45-76"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.954314    3081 reflector.go:166] "Unhandled Error" err="k8s.io/client-go/informers/factory.go:160: Failed to watch *v1.RuntimeClass: failed to list *v1.RuntimeClass: Get \"https://10.0.0.8:6443/apis/node.k8s.io/v1/runtimeclasses?limit=500&amp;resourceVersion=0\": dial tcp 10.0.0.8:6443: connect: connection refused" logger="Unha&gt;</span>
</span><span id="__span-45-77"><a id="__codelineno-45-77" name="__codelineno-45-77" href="#__codelineno-45-77"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.051160    3081 kubelet_node_status.go:75] "Attempting to register node" node="octavo"</span>
</span><span id="__span-45-78"><a id="__codelineno-45-78" name="__codelineno-45-78" href="#__codelineno-45-78"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.051955    3081 kubelet_node_status.go:107] "Unable to register node with API server" err="Post \"https://10.0.0.8:6443/api/v1/nodes\": dial tcp 10.0.0.8:6443: connect: connection refused" node="octavo"</span>
</span><span id="__span-45-79"><a id="__codelineno-45-79" name="__codelineno-45-79" href="#__codelineno-45-79"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096663    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"ca-certs\" (UniqueName: \"kubernetes.io/host-path/ad9e0985cbbefcb442de36a1fa2a7651-ca-certs\") pod \"kube-controller-manager-octavo\" (UID: \"ad9e0985cbbefcb442de36a1fa2a7651\") " pod="kube-system/kube-controller-&gt;</span>
</span><span id="__span-45-80"><a id="__codelineno-45-80" name="__codelineno-45-80" href="#__codelineno-45-80"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096703    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"usr-local-share-ca-certificates\" (UniqueName: \"kubernetes.io/host-path/ad9e0985cbbefcb442de36a1fa2a7651-usr-local-share-ca-certificates\") pod \"kube-controller-manager-octavo\" (UID: \"ad9e0985cbbefcb442de36a1f&gt;</span>
</span><span id="__span-45-81"><a id="__codelineno-45-81" name="__codelineno-45-81" href="#__codelineno-45-81"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096736    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"ca-certs\" (UniqueName: \"kubernetes.io/host-path/9143a118ddce4da18128e4a82a4a703f-ca-certs\") pod \"kube-apiserver-octavo\" (UID: \"9143a118ddce4da18128e4a82a4a703f\") " pod="kube-system/kube-apiserver-octavo"</span>
</span><span id="__span-45-82"><a id="__codelineno-45-82" name="__codelineno-45-82" href="#__codelineno-45-82"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096755    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"k8s-certs\" (UniqueName: \"kubernetes.io/host-path/9143a118ddce4da18128e4a82a4a703f-k8s-certs\") pod \"kube-apiserver-octavo\" (UID: \"9143a118ddce4da18128e4a82a4a703f\") " pod="kube-system/kube-apiserver-octavo"</span>
</span><span id="__span-45-83"><a id="__codelineno-45-83" name="__codelineno-45-83" href="#__codelineno-45-83"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096790    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"usr-local-share-ca-certificates\" (UniqueName: \"kubernetes.io/host-path/9143a118ddce4da18128e4a82a4a703f-usr-local-share-ca-certificates\") pod \"kube-apiserver-octavo\" (UID: \"9143a118ddce4da18128e4a82a4a703f\"&gt;</span>
</span><span id="__span-45-84"><a id="__codelineno-45-84" name="__codelineno-45-84" href="#__codelineno-45-84"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096824    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"etc-ca-certificates\" (UniqueName: \"kubernetes.io/host-path/ad9e0985cbbefcb442de36a1fa2a7651-etc-ca-certificates\") pod \"kube-controller-manager-octavo\" (UID: \"ad9e0985cbbefcb442de36a1fa2a7651\") " pod="kube-s&gt;</span>
</span><span id="__span-45-85"><a id="__codelineno-45-85" name="__codelineno-45-85" href="#__codelineno-45-85"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096849    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"flexvolume-dir\" (UniqueName: \"kubernetes.io/host-path/ad9e0985cbbefcb442de36a1fa2a7651-flexvolume-dir\") pod \"kube-controller-manager-octavo\" (UID: \"ad9e0985cbbefcb442de36a1fa2a7651\") " pod="kube-system/kube&gt;</span>
</span><span id="__span-45-86"><a id="__codelineno-45-86" name="__codelineno-45-86" href="#__codelineno-45-86"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096876    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"k8s-certs\" (UniqueName: \"kubernetes.io/host-path/ad9e0985cbbefcb442de36a1fa2a7651-k8s-certs\") pod \"kube-controller-manager-octavo\" (UID: \"ad9e0985cbbefcb442de36a1fa2a7651\") " pod="kube-system/kube-controlle&gt;</span>
</span><span id="__span-45-87"><a id="__codelineno-45-87" name="__codelineno-45-87" href="#__codelineno-45-87"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096896    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"etcd-certs\" (UniqueName: \"kubernetes.io/host-path/6a67e3805915a015cc4032245f92dbab-etcd-certs\") pod \"etcd-octavo\" (UID: \"6a67e3805915a015cc4032245f92dbab\") " pod="kube-system/etcd-octavo"</span>
</span><span id="__span-45-88"><a id="__codelineno-45-88" name="__codelineno-45-88" href="#__codelineno-45-88"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096920    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"etcd-data\" (UniqueName: \"kubernetes.io/host-path/6a67e3805915a015cc4032245f92dbab-etcd-data\") pod \"etcd-octavo\" (UID: \"6a67e3805915a015cc4032245f92dbab\") " pod="kube-system/etcd-octavo"</span>
</span><span id="__span-45-89"><a id="__codelineno-45-89" name="__codelineno-45-89" href="#__codelineno-45-89"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.096941    3081 controller.go:145] "Failed to ensure lease exists, will retry" err="Get \"https://10.0.0.8:6443/apis/coordination.k8s.io/v1/namespaces/kube-node-lease/leases/octavo?timeout=10s\": dial tcp 10.0.0.8:6443: connect: connection refused" interval="400ms"</span>
</span><span id="__span-45-90"><a id="__codelineno-45-90" name="__codelineno-45-90" href="#__codelineno-45-90"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.096967    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"kubeconfig\" (UniqueName: \"kubernetes.io/host-path/ad9e0985cbbefcb442de36a1fa2a7651-kubeconfig\") pod \"kube-controller-manager-octavo\" (UID: \"ad9e0985cbbefcb442de36a1fa2a7651\") " pod="kube-system/kube-control&gt;</span>
</span><span id="__span-45-91"><a id="__codelineno-45-91" name="__codelineno-45-91" href="#__codelineno-45-91"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.097001    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"usr-share-ca-certificates\" (UniqueName: \"kubernetes.io/host-path/ad9e0985cbbefcb442de36a1fa2a7651-usr-share-ca-certificates\") pod \"kube-controller-manager-octavo\" (UID: \"ad9e0985cbbefcb442de36a1fa2a7651\") "&gt;</span>
</span><span id="__span-45-92"><a id="__codelineno-45-92" name="__codelineno-45-92" href="#__codelineno-45-92"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.097020    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"kubeconfig\" (UniqueName: \"kubernetes.io/host-path/9a50c799dacb081ee9c958350b51d8ec-kubeconfig\") pod \"kube-scheduler-octavo\" (UID: \"9a50c799dacb081ee9c958350b51d8ec\") " pod="kube-system/kube-scheduler-octavo"</span>
</span><span id="__span-45-93"><a id="__codelineno-45-93" name="__codelineno-45-93" href="#__codelineno-45-93"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.097037    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"etc-ca-certificates\" (UniqueName: \"kubernetes.io/host-path/9143a118ddce4da18128e4a82a4a703f-etc-ca-certificates\") pod \"kube-apiserver-octavo\" (UID: \"9143a118ddce4da18128e4a82a4a703f\") " pod="kube-system/kub&gt;</span>
</span><span id="__span-45-94"><a id="__codelineno-45-94" name="__codelineno-45-94" href="#__codelineno-45-94"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.097054    3081 reconciler_common.go:251] "operationExecutor.VerifyControllerAttachedVolume started for volume \"usr-share-ca-certificates\" (UniqueName: \"kubernetes.io/host-path/9143a118ddce4da18128e4a82a4a703f-usr-share-ca-certificates\") pod \"kube-apiserver-octavo\" (UID: \"9143a118ddce4da18128e4a82a4a703f\") " pod="kub&gt;</span>
</span><span id="__span-45-95"><a id="__codelineno-45-95" name="__codelineno-45-95" href="#__codelineno-45-95"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.247411    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-96"><a id="__codelineno-45-96" name="__codelineno-45-96" href="#__codelineno-45-96"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.251941    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-97"><a id="__codelineno-45-97" name="__codelineno-45-97" href="#__codelineno-45-97"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.253846    3081 kubelet_node_status.go:75] "Attempting to register node" node="octavo"</span>
</span><span id="__span-45-98"><a id="__codelineno-45-98" name="__codelineno-45-98" href="#__codelineno-45-98"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.254394    3081 kubelet_node_status.go:107] "Unable to register node with API server" err="Post \"https://10.0.0.8:6443/api/v1/nodes\": dial tcp 10.0.0.8:6443: connect: connection refused" node="octavo"</span>
</span><span id="__span-45-99"><a id="__codelineno-45-99" name="__codelineno-45-99" href="#__codelineno-45-99"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.275473    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-100"><a id="__codelineno-45-100" name="__codelineno-45-100" href="#__codelineno-45-100"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.301544    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-101"><a id="__codelineno-45-101" name="__codelineno-45-101" href="#__codelineno-45-101"></a><span class="go">Apr 26 16:00:24 octavo kubelet[3081]: E0426 16:00:24.974201    3081 controller.go:145] "Failed to ensure lease exists, will retry" err="Get \"https://10.0.0.8:6443/apis/coordination.k8s.io/v1/namespaces/kube-node-lease/leases/octavo?timeout=10s\": dial tcp 10.0.0.8:6443: connect: connection refused" interval="800ms"</span>
</span><span id="__span-45-102"><a id="__codelineno-45-102" name="__codelineno-45-102" href="#__codelineno-45-102"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.134490    3081 kubelet_node_status.go:75] "Attempting to register node" node="octavo"</span>
</span><span id="__span-45-103"><a id="__codelineno-45-103" name="__codelineno-45-103" href="#__codelineno-45-103"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.135362    3081 kubelet_node_status.go:107] "Unable to register node with API server" err="Post \"https://10.0.0.8:6443/api/v1/nodes\": dial tcp 10.0.0.8:6443: connect: connection refused" node="octavo"</span>
</span><span id="__span-45-104"><a id="__codelineno-45-104" name="__codelineno-45-104" href="#__codelineno-45-104"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: W0426 16:00:25.220172    3081 reflector.go:569] k8s.io/client-go/informers/factory.go:160: failed to list *v1.Node: Get "https://10.0.0.8:6443/api/v1/nodes?fieldSelector=metadata.name%3Doctavo&amp;limit=500&amp;resourceVersion=0": dial tcp 10.0.0.8:6443: connect: connection refused</span>
</span><span id="__span-45-105"><a id="__codelineno-45-105" name="__codelineno-45-105" href="#__codelineno-45-105"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.220349    3081 reflector.go:166] "Unhandled Error" err="k8s.io/client-go/informers/factory.go:160: Failed to watch *v1.Node: failed to list *v1.Node: Get \"https://10.0.0.8:6443/api/v1/nodes?fieldSelector=metadata.name%3Doctavo&amp;limit=500&amp;resourceVersion=0\": dial tcp 10.0.0.8:6443: connect: connection refused" logger="Unhan&gt;</span>
</span><span id="__span-45-106"><a id="__codelineno-45-106" name="__codelineno-45-106" href="#__codelineno-45-106"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: W0426 16:00:25.451675    3081 reflector.go:569] k8s.io/client-go/informers/factory.go:160: failed to list *v1.Service: Get "https://10.0.0.8:6443/api/v1/services?fieldSelector=spec.clusterIP%21%3DNone&amp;limit=500&amp;resourceVersion=0": dial tcp 10.0.0.8:6443: connect: connection refused</span>
</span><span id="__span-45-107"><a id="__codelineno-45-107" name="__codelineno-45-107" href="#__codelineno-45-107"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.451792    3081 reflector.go:166] "Unhandled Error" err="k8s.io/client-go/informers/factory.go:160: Failed to watch *v1.Service: failed to list *v1.Service: Get \"https://10.0.0.8:6443/api/v1/services?fieldSelector=spec.clusterIP%21%3DNone&amp;limit=500&amp;resourceVersion=0\": dial tcp 10.0.0.8:6443: connect: connection refused" lo&gt;</span>
</span><span id="__span-45-108"><a id="__codelineno-45-108" name="__codelineno-45-108" href="#__codelineno-45-108"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: W0426 16:00:25.487336    3081 reflector.go:569] k8s.io/client-go/informers/factory.go:160: failed to list *v1.RuntimeClass: Get "https://10.0.0.8:6443/apis/node.k8s.io/v1/runtimeclasses?limit=500&amp;resourceVersion=0": dial tcp 10.0.0.8:6443: connect: connection refused</span>
</span><span id="__span-45-109"><a id="__codelineno-45-109" name="__codelineno-45-109" href="#__codelineno-45-109"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.487463    3081 reflector.go:166] "Unhandled Error" err="k8s.io/client-go/informers/factory.go:160: Failed to watch *v1.RuntimeClass: failed to list *v1.RuntimeClass: Get \"https://10.0.0.8:6443/apis/node.k8s.io/v1/runtimeclasses?limit=500&amp;resourceVersion=0\": dial tcp 10.0.0.8:6443: connect: connection refused" logger="Unha&gt;</span>
</span><span id="__span-45-110"><a id="__codelineno-45-110" name="__codelineno-45-110" href="#__codelineno-45-110"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: W0426 16:00:25.504868    3081 reflector.go:569] k8s.io/client-go/informers/factory.go:160: failed to list *v1.CSIDriver: Get "https://10.0.0.8:6443/apis/storage.k8s.io/v1/csidrivers?limit=500&amp;resourceVersion=0": dial tcp 10.0.0.8:6443: connect: connection refused</span>
</span><span id="__span-45-111"><a id="__codelineno-45-111" name="__codelineno-45-111" href="#__codelineno-45-111"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.504969    3081 reflector.go:166] "Unhandled Error" err="k8s.io/client-go/informers/factory.go:160: Failed to watch *v1.CSIDriver: failed to list *v1.CSIDriver: Get \"https://10.0.0.8:6443/apis/storage.k8s.io/v1/csidrivers?limit=500&amp;resourceVersion=0\": dial tcp 10.0.0.8:6443: connect: connection refused" logger="UnhandledEr&gt;</span>
</span><span id="__span-45-112"><a id="__codelineno-45-112" name="__codelineno-45-112" href="#__codelineno-45-112"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.775421    3081 controller.go:145] "Failed to ensure lease exists, will retry" err="Get \"https://10.0.0.8:6443/apis/coordination.k8s.io/v1/namespaces/kube-node-lease/leases/octavo?timeout=10s\": dial tcp 10.0.0.8:6443: connect: connection refused" interval="1.6s"</span>
</span><span id="__span-45-113"><a id="__codelineno-45-113" name="__codelineno-45-113" href="#__codelineno-45-113"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: I0426 16:00:25.938373    3081 kubelet_node_status.go:75] "Attempting to register node" node="octavo"</span>
</span><span id="__span-45-114"><a id="__codelineno-45-114" name="__codelineno-45-114" href="#__codelineno-45-114"></a><span class="go">Apr 26 16:00:25 octavo kubelet[3081]: E0426 16:00:25.939217    3081 kubelet_node_status.go:107] "Unable to register node with API server" err="Post \"https://10.0.0.8:6443/api/v1/nodes\": dial tcp 10.0.0.8:6443: connect: connection refused" node="octavo"</span>
</span><span id="__span-45-115"><a id="__codelineno-45-115" name="__codelineno-45-115" href="#__codelineno-45-115"></a><span class="go">Apr 26 16:00:26 octavo kubelet[3081]: E0426 16:00:26.436928    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-116"><a id="__codelineno-45-116" name="__codelineno-45-116" href="#__codelineno-45-116"></a><span class="go">Apr 26 16:00:26 octavo kubelet[3081]: E0426 16:00:26.438217    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-117"><a id="__codelineno-45-117" name="__codelineno-45-117" href="#__codelineno-45-117"></a><span class="go">Apr 26 16:00:26 octavo kubelet[3081]: E0426 16:00:26.439369    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-118"><a id="__codelineno-45-118" name="__codelineno-45-118" href="#__codelineno-45-118"></a><span class="go">Apr 26 16:00:26 octavo kubelet[3081]: E0426 16:00:26.440112    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-119"><a id="__codelineno-45-119" name="__codelineno-45-119" href="#__codelineno-45-119"></a><span class="go">Apr 26 16:00:27 octavo kubelet[3081]: E0426 16:00:27.442281    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-120"><a id="__codelineno-45-120" name="__codelineno-45-120" href="#__codelineno-45-120"></a><span class="go">Apr 26 16:00:27 octavo kubelet[3081]: E0426 16:00:27.442300    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-121"><a id="__codelineno-45-121" name="__codelineno-45-121" href="#__codelineno-45-121"></a><span class="go">Apr 26 16:00:27 octavo kubelet[3081]: E0426 16:00:27.442354    3081 kubelet.go:3190] "No need to create a mirror pod, since failed to get node info from the cluster" err="node \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-122"><a id="__codelineno-45-122" name="__codelineno-45-122" href="#__codelineno-45-122"></a><span class="go">Apr 26 16:00:27 octavo kubelet[3081]: I0426 16:00:27.540869    3081 kubelet_node_status.go:75] "Attempting to register node" node="octavo"</span>
</span><span id="__span-45-123"><a id="__codelineno-45-123" name="__codelineno-45-123" href="#__codelineno-45-123"></a><span class="go">Apr 26 16:00:27 octavo kubelet[3081]: E0426 16:00:27.804881    3081 nodelease.go:49] "Failed to get node when trying to set owner ref to the node lease" err="nodes \"octavo\" not found" node="octavo"</span>
</span><span id="__span-45-124"><a id="__codelineno-45-124" name="__codelineno-45-124" href="#__codelineno-45-124"></a><span class="go">Apr 26 16:00:27 octavo kubelet[3081]: I0426 16:00:27.998050    3081 kubelet_node_status.go:78] "Successfully registered node" node="octavo"</span>
</span><span id="__span-45-125"><a id="__codelineno-45-125" name="__codelineno-45-125" href="#__codelineno-45-125"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: I0426 16:00:28.072723    3081 kubelet.go:3194] "Creating a mirror pod for static pod" pod="kube-system/etcd-octavo"</span>
</span><span id="__span-45-126"><a id="__codelineno-45-126" name="__codelineno-45-126" href="#__codelineno-45-126"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: E0426 16:00:28.079480    3081 kubelet.go:3196] "Failed creating a mirror pod" err="pods \"etcd-octavo\" is forbidden: no PriorityClass with name system-node-critical was found" pod="kube-system/etcd-octavo"</span>
</span><span id="__span-45-127"><a id="__codelineno-45-127" name="__codelineno-45-127" href="#__codelineno-45-127"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: I0426 16:00:28.079531    3081 kubelet.go:3194] "Creating a mirror pod for static pod" pod="kube-system/kube-apiserver-octavo"</span>
</span><span id="__span-45-128"><a id="__codelineno-45-128" name="__codelineno-45-128" href="#__codelineno-45-128"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: E0426 16:00:28.086877    3081 kubelet.go:3196] "Failed creating a mirror pod" err="pods \"kube-apiserver-octavo\" is forbidden: no PriorityClass with name system-node-critical was found" pod="kube-system/kube-apiserver-octavo"</span>
</span><span id="__span-45-129"><a id="__codelineno-45-129" name="__codelineno-45-129" href="#__codelineno-45-129"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: I0426 16:00:28.086955    3081 kubelet.go:3194] "Creating a mirror pod for static pod" pod="kube-system/kube-controller-manager-octavo"</span>
</span><span id="__span-45-130"><a id="__codelineno-45-130" name="__codelineno-45-130" href="#__codelineno-45-130"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: E0426 16:00:28.092824    3081 kubelet.go:3196] "Failed creating a mirror pod" err="pods \"kube-controller-manager-octavo\" is forbidden: no PriorityClass with name system-node-critical was found" pod="kube-system/kube-controller-manager-octavo"</span>
</span><span id="__span-45-131"><a id="__codelineno-45-131" name="__codelineno-45-131" href="#__codelineno-45-131"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: I0426 16:00:28.092885    3081 kubelet.go:3194] "Creating a mirror pod for static pod" pod="kube-system/kube-scheduler-octavo"</span>
</span><span id="__span-45-132"><a id="__codelineno-45-132" name="__codelineno-45-132" href="#__codelineno-45-132"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: E0426 16:00:28.094961    3081 kubelet.go:3196] "Failed creating a mirror pod" err="pods \"kube-scheduler-octavo\" is forbidden: no PriorityClass with name system-node-critical was found" pod="kube-system/kube-scheduler-octavo"</span>
</span><span id="__span-45-133"><a id="__codelineno-45-133" name="__codelineno-45-133" href="#__codelineno-45-133"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: I0426 16:00:28.372556    3081 apiserver.go:52] "Watching apiserver"</span>
</span><span id="__span-45-134"><a id="__codelineno-45-134" name="__codelineno-45-134" href="#__codelineno-45-134"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: I0426 16:00:28.442538    3081 kubelet.go:3194] "Creating a mirror pod for static pod" pod="kube-system/kube-apiserver-octavo"</span>
</span><span id="__span-45-135"><a id="__codelineno-45-135" name="__codelineno-45-135" href="#__codelineno-45-135"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: E0426 16:00:28.444604    3081 kubelet.go:3196] "Failed creating a mirror pod" err="pods \"kube-apiserver-octavo\" is forbidden: no PriorityClass with name system-node-critical was found" pod="kube-system/kube-apiserver-octavo"</span>
</span><span id="__span-45-136"><a id="__codelineno-45-136" name="__codelineno-45-136" href="#__codelineno-45-136"></a><span class="go">Apr 26 16:00:28 octavo kubelet[3081]: I0426 16:00:28.472896    3081 desired_state_of_world_populator.go:158] "Finished populating initial desired state of world"</span>
</span><span id="__span-45-137"><a id="__codelineno-45-137" name="__codelineno-45-137" href="#__codelineno-45-137"></a><span class="go">Apr 26 16:00:29 octavo kubelet[3081]: I0426 16:00:29.338842    3081 kubelet.go:3194] "Creating a mirror pod for static pod" pod="kube-system/etcd-octavo"</span>
</span><span id="__span-45-138"><a id="__codelineno-45-138" name="__codelineno-45-138" href="#__codelineno-45-138"></a><span class="go">Apr 26 16:00:31 octavo kubelet[3081]: I0426 16:00:31.031022    3081 kubelet.go:3194] "Creating a mirror pod for static pod" pod="kube-system/kube-controller-manager-octavo"</span>
</span><span id="__span-45-139"><a id="__codelineno-45-139" name="__codelineno-45-139" href="#__codelineno-45-139"></a><span class="go">Apr 26 16:00:32 octavo kubelet[3081]: I0426 16:00:32.884678    3081 kubelet.go:3194] "Creating a mirror pod for static pod" pod="kube-system/kube-scheduler-octavo"</span>
</span><span id="__span-45-140"><a id="__codelineno-45-140" name="__codelineno-45-140" href="#__codelineno-45-140"></a><span class="go">Apr 26 16:00:34 octavo kubelet[3081]: I0426 16:00:34.459610    3081 pod_startup_latency_tracker.go:104] "Observed pod startup duration" pod="kube-system/etcd-octavo" podStartSLOduration=5.459582191 podStartE2EDuration="5.459582191s" podCreationTimestamp="2025-04-26 16:00:29 +0200 CEST" firstStartedPulling="0001-01-01 00:00:00 +0000 UTC" lastFinishedPulling="0001-01-01 00:00:0&gt;</span>
</span><span id="__span-45-141"><a id="__codelineno-45-141" name="__codelineno-45-141" href="#__codelineno-45-141"></a><span class="go">Apr 26 16:00:34 octavo kubelet[3081]: I0426 16:00:34.483008    3081 pod_startup_latency_tracker.go:104] "Observed pod startup duration" pod="kube-system/kube-controller-manager-octavo" podStartSLOduration=3.482988267 podStartE2EDuration="3.482988267s" podCreationTimestamp="2025-04-26 16:00:31 +0200 CEST" firstStartedPulling="0001-01-01 00:00:00 +0000 UTC" lastFinishedPulling=&gt;</span>
</span><span id="__span-45-142"><a id="__codelineno-45-142" name="__codelineno-45-142" href="#__codelineno-45-142"></a><span class="go">Apr 26 16:00:34 octavo kubelet[3081]: I0426 16:00:34.483102    3081 pod_startup_latency_tracker.go:104] "Observed pod startup duration" pod="kube-system/kube-scheduler-octavo" podStartSLOduration=2.483094445 podStartE2EDuration="2.483094445s" podCreationTimestamp="2025-04-26 16:00:32 +0200 CEST" firstStartedPulling="0001-01-01 00:00:00 +0000 UTC" lastFinishedPulling="0001-01-&gt;</span>
</span><span id="__span-45-143"><a id="__codelineno-45-143" name="__codelineno-45-143" href="#__codelineno-45-143"></a><span class="go">Apr 26 16:00:35 octavo kubelet[3081]: I0426 16:00:35.015311    3081 kuberuntime_manager.go:1702] "Updating runtime config through cri with podcidr" CIDR="10.244.0.0/24"</span>
</span><span id="__span-45-144"><a id="__codelineno-45-144" name="__codelineno-45-144" href="#__codelineno-45-144"></a><span class="go">Apr 26 16:00:35 octavo kubelet[3081]: I0426 16:00:35.016020    3081 kubelet_network.go:61] "Updating Pod CIDR" originalPodCIDR="" newPodCIDR="10.244.0.0/24"</span>
</span><span id="__span-45-145"><a id="__codelineno-45-145" name="__codelineno-45-145" href="#__codelineno-45-145"></a><span class="go">Apr 26 16:00:36 octavo kubelet[3081]: I0426 16:00:36.698529    3081 kubelet.go:3194] "Creating a mirror pod for static pod" pod="kube-system/kube-apiserver-octavo"</span>
</span><span id="__span-45-146"><a id="__codelineno-45-146" name="__codelineno-45-146" href="#__codelineno-45-146"></a><span class="go">Apr 26 16:00:36 octavo kubelet[3081]: I0426 16:00:36.724746    3081 pod_startup_latency_tracker.go:104] "Observed pod startup duration" pod="kube-system/kube-apiserver-octavo" podStartSLOduration=0.724721039 podStartE2EDuration="724.721039ms" podCreationTimestamp="2025-04-26 16:00:36 +0200 CEST" firstStartedPulling="0001-01-01 00:00:00 +0000 UTC" lastFinishedPulling="0001-01-&gt;</span>
</span><span id="__span-45-147"><a id="__codelineno-45-147" name="__codelineno-45-147" href="#__codelineno-45-147"></a><span class="go">Apr 26 16:02:24 octavo kubelet[3081]: E0426 16:02:24.440322    3081 kubelet_node_status.go:460] "Node not becoming ready in time after startup"</span>
</span><span id="__span-45-148"><a id="__codelineno-45-148" name="__codelineno-45-148" href="#__codelineno-45-148"></a><span class="go">Apr 26 16:02:24 octavo kubelet[3081]: E0426 16:02:24.460985    3081 kubelet.go:3002] "Container runtime network not ready" networkReady="NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized"</span>
</span><span id="__span-45-149"><a id="__codelineno-45-149" name="__codelineno-45-149" href="#__codelineno-45-149"></a><span class="go">Apr 26 16:02:29 octavo kubelet[3081]: E0426 16:02:29.463219    3081 kubelet.go:3002] "Container runtime network not ready" networkReady="NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized"</span>
</span><span id="__span-45-150"><a id="__codelineno-45-150" name="__codelineno-45-150" href="#__codelineno-45-150"></a><span class="go">Apr 26 16:02:34 octavo kubelet[3081]: E0426 16:02:34.465049    3081 kubelet.go:3002] "Container runtime network not ready" networkReady="NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized"</span>
</span><span id="__span-45-151"><a id="__codelineno-45-151" name="__codelineno-45-151" href="#__codelineno-45-151"></a><span class="go">Apr 26 16:02:39 octavo kubelet[3081]: E0426 16:02:39.467066    3081 kubelet.go:3002] "Container runtime network not ready" networkReady="NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized"</span>
</span><span id="__span-45-152"><a id="__codelineno-45-152" name="__codelineno-45-152" href="#__codelineno-45-152"></a><span class="go">Apr 26 16:02:44 octavo kubelet[3081]: E0426 16:02:44.468109    3081 kubelet.go:3002] "Container runtime network not ready" networkReady="NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized"</span>
</span><span id="__span-45-153"><a id="__codelineno-45-153" name="__codelineno-45-153" href="#__codelineno-45-153"></a><span class="go">...</span>
</span></code></pre></div>
</details>
<p>Despite all these errors, <code>kubelet</code> and <code>containerd</code> are running, and <em>something</em> is
listening on port 6443, but the <code>kubernetes-admin</code> has no access in any way.
<a href="https://stackoverflow.com/a/70892009">Regenerating <code>kubeconfig</code> file for the admin user</a>
did not help either. Running <code>kubectl proxy</code> starts serving on port 8001 but all
requests are still denied:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="gp">$ </span>curl<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="se">\</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">  </span>http://127.0.0.1:8001/api/v1/nodes/octavo/proxy/configz<span class="w"> </span><span class="se">\</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="go">{</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="go">  "kind": "Status",</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="go">  "apiVersion": "v1",</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="go">  "metadata": {},</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="go">  "status": "Failure",</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="go">  "message": "nodes \"octavo\" is forbidden: User \"kubernetes-admin\" cannot get resource \"nodes/proxy\" in API group \"\" at the cluster scope",</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="go">  "reason": "Forbidden",</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="go">  "details": {</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a><span class="go">    "name": "octavo",</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="go">    "kind": "nodes"</span>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="go">  },</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="go">  "code": 403</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a><span class="go">}</span>
</span></code></pre></div>
<p>At this point all that was left to do was
<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#tear-down"><em>tear down</em> the cluster</a>:</p>
<details class="terminal">
<summary><code>$ sudo kubeadm reset</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>kubeadm<span class="w"> </span>reset<span class="w"> </span>-f<span class="w"> </span><span class="se">\</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="w">  </span>--cri-socket<span class="o">=</span>unix:/run/containerd/containerd.sock<span class="w"> </span><span class="se">\</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="w">  </span>--cleanup-tmp-dir
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="go">[reset] Reading configuration from the "kubeadm-config" ConfigMap in namespace "kube-system"...</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="go">[reset] Use 'kubeadm init phase upload-config --config your-config.yaml' to re-upload it.</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="go">W0426 16:44:31.464050  537333 reset.go:143] [reset] Unable to fetch the kubeadm-config ConfigMap from cluster: failed to get config map: configmaps "kubeadm-config" is forbidden: User "kubernetes-admin" cannot get resource "configmaps" in API group "" in the namespace "kube-system"</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a><span class="go">[preflight] Running pre-flight checks</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="go">W0426 16:44:31.464336  537333 removeetcdmember.go:106] [reset] No kubeadm config, using etcd pod spec to get data directory</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="go">[reset] Deleted contents of the etcd data directory: /var/lib/etcd</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a><span class="go">[reset] Stopping the kubelet service</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="go">[reset] Unmounting mounted directories in "/var/lib/kubelet"</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="go">[reset] Deleting contents of directories: [/etc/kubernetes/manifests /var/lib/kubelet /etc/kubernetes/pki /etc/kubernetes/tmp]</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a><span class="go">[reset] Deleting files: [/etc/kubernetes/admin.conf /etc/kubernetes/super-admin.conf /etc/kubernetes/kubelet.conf /etc/kubernetes/bootstrap-kubelet.conf /etc/kubernetes/controller-manager.conf /etc/kubernetes/scheduler.conf]</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="go">The reset process does not clean CNI configuration. To do so, you must remove /etc/cni/net.d</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="go">The reset process does not reset or clean up iptables rules or IPVS tables.</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="go">If you wish to reset iptables, you must do so manually by using the "iptables" command.</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a><span class="go">If your cluster was setup to utilize IPVS, run ipvsadm --clear (or similar)</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a><span class="go">to reset your system's IPVS tables.</span>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a><span class="go">The reset process does not clean your kubeconfig files and you must remove them manually.</span>
</span><span id="__span-47-24"><a id="__codelineno-47-24" name="__codelineno-47-24" href="#__codelineno-47-24"></a><span class="go">Please, check the contents of the $HOME/.kube/config file.</span>
</span><span id="__span-47-25"><a id="__codelineno-47-25" name="__codelineno-47-25" href="#__codelineno-47-25"></a>
</span><span id="__span-47-26"><a id="__codelineno-47-26" name="__codelineno-47-26" href="#__codelineno-47-26"></a><span class="gp">$ </span>sudo<span class="w"> </span>mv<span class="w"> </span>/etc/kubernetes/<span class="w"> </span>/etc/bad-kubernetes/
</span><span id="__span-47-27"><a id="__codelineno-47-27" name="__codelineno-47-27" href="#__codelineno-47-27"></a><span class="gp">$ </span>sudo<span class="w"> </span>mv<span class="w"> </span>/etc/cni<span class="w"> </span>/etc/bad-cni
</span><span id="__span-47-28"><a id="__codelineno-47-28" name="__codelineno-47-28" href="#__codelineno-47-28"></a>
</span><span id="__span-47-29"><a id="__codelineno-47-29" name="__codelineno-47-29" href="#__codelineno-47-29"></a><span class="gp">$ </span>sudo<span class="w"> </span>iptables<span class="w"> </span>-L
</span><span id="__span-47-30"><a id="__codelineno-47-30" name="__codelineno-47-30" href="#__codelineno-47-30"></a><span class="go">Chain INPUT (policy ACCEPT)</span>
</span><span id="__span-47-31"><a id="__codelineno-47-31" name="__codelineno-47-31" href="#__codelineno-47-31"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-32"><a id="__codelineno-47-32" name="__codelineno-47-32" href="#__codelineno-47-32"></a><span class="go">ts-input   all  --  anywhere             anywhere            </span>
</span><span id="__span-47-33"><a id="__codelineno-47-33" name="__codelineno-47-33" href="#__codelineno-47-33"></a><span class="go">KUBE-FIREWALL  all  --  anywhere             anywhere            </span>
</span><span id="__span-47-34"><a id="__codelineno-47-34" name="__codelineno-47-34" href="#__codelineno-47-34"></a>
</span><span id="__span-47-35"><a id="__codelineno-47-35" name="__codelineno-47-35" href="#__codelineno-47-35"></a><span class="go">Chain FORWARD (policy ACCEPT)</span>
</span><span id="__span-47-36"><a id="__codelineno-47-36" name="__codelineno-47-36" href="#__codelineno-47-36"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-37"><a id="__codelineno-47-37" name="__codelineno-47-37" href="#__codelineno-47-37"></a><span class="go">ts-forward  all  --  anywhere             anywhere            </span>
</span><span id="__span-47-38"><a id="__codelineno-47-38" name="__codelineno-47-38" href="#__codelineno-47-38"></a><span class="go">DOCKER-USER  all  --  anywhere             anywhere            </span>
</span><span id="__span-47-39"><a id="__codelineno-47-39" name="__codelineno-47-39" href="#__codelineno-47-39"></a><span class="go">DOCKER-FORWARD  all  --  anywhere             anywhere            </span>
</span><span id="__span-47-40"><a id="__codelineno-47-40" name="__codelineno-47-40" href="#__codelineno-47-40"></a>
</span><span id="__span-47-41"><a id="__codelineno-47-41" name="__codelineno-47-41" href="#__codelineno-47-41"></a><span class="go">Chain OUTPUT (policy ACCEPT)</span>
</span><span id="__span-47-42"><a id="__codelineno-47-42" name="__codelineno-47-42" href="#__codelineno-47-42"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-43"><a id="__codelineno-47-43" name="__codelineno-47-43" href="#__codelineno-47-43"></a><span class="go">KUBE-FIREWALL  all  --  anywhere             anywhere            </span>
</span><span id="__span-47-44"><a id="__codelineno-47-44" name="__codelineno-47-44" href="#__codelineno-47-44"></a>
</span><span id="__span-47-45"><a id="__codelineno-47-45" name="__codelineno-47-45" href="#__codelineno-47-45"></a><span class="go">Chain DOCKER (1 references)</span>
</span><span id="__span-47-46"><a id="__codelineno-47-46" name="__codelineno-47-46" href="#__codelineno-47-46"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-47"><a id="__codelineno-47-47" name="__codelineno-47-47" href="#__codelineno-47-47"></a><span class="go">DROP       all  --  anywhere             anywhere            </span>
</span><span id="__span-47-48"><a id="__codelineno-47-48" name="__codelineno-47-48" href="#__codelineno-47-48"></a>
</span><span id="__span-47-49"><a id="__codelineno-47-49" name="__codelineno-47-49" href="#__codelineno-47-49"></a><span class="go">Chain DOCKER-BRIDGE (1 references)</span>
</span><span id="__span-47-50"><a id="__codelineno-47-50" name="__codelineno-47-50" href="#__codelineno-47-50"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-51"><a id="__codelineno-47-51" name="__codelineno-47-51" href="#__codelineno-47-51"></a><span class="go">DOCKER     all  --  anywhere             anywhere            </span>
</span><span id="__span-47-52"><a id="__codelineno-47-52" name="__codelineno-47-52" href="#__codelineno-47-52"></a>
</span><span id="__span-47-53"><a id="__codelineno-47-53" name="__codelineno-47-53" href="#__codelineno-47-53"></a><span class="go">Chain DOCKER-CT (1 references)</span>
</span><span id="__span-47-54"><a id="__codelineno-47-54" name="__codelineno-47-54" href="#__codelineno-47-54"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-55"><a id="__codelineno-47-55" name="__codelineno-47-55" href="#__codelineno-47-55"></a><span class="go">ACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED</span>
</span><span id="__span-47-56"><a id="__codelineno-47-56" name="__codelineno-47-56" href="#__codelineno-47-56"></a>
</span><span id="__span-47-57"><a id="__codelineno-47-57" name="__codelineno-47-57" href="#__codelineno-47-57"></a><span class="go">Chain DOCKER-FORWARD (1 references)</span>
</span><span id="__span-47-58"><a id="__codelineno-47-58" name="__codelineno-47-58" href="#__codelineno-47-58"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-59"><a id="__codelineno-47-59" name="__codelineno-47-59" href="#__codelineno-47-59"></a><span class="go">DOCKER-CT  all  --  anywhere             anywhere            </span>
</span><span id="__span-47-60"><a id="__codelineno-47-60" name="__codelineno-47-60" href="#__codelineno-47-60"></a><span class="go">DOCKER-ISOLATION-STAGE-1  all  --  anywhere             anywhere            </span>
</span><span id="__span-47-61"><a id="__codelineno-47-61" name="__codelineno-47-61" href="#__codelineno-47-61"></a><span class="go">DOCKER-BRIDGE  all  --  anywhere             anywhere            </span>
</span><span id="__span-47-62"><a id="__codelineno-47-62" name="__codelineno-47-62" href="#__codelineno-47-62"></a><span class="go">ACCEPT     all  --  anywhere             anywhere            </span>
</span><span id="__span-47-63"><a id="__codelineno-47-63" name="__codelineno-47-63" href="#__codelineno-47-63"></a>
</span><span id="__span-47-64"><a id="__codelineno-47-64" name="__codelineno-47-64" href="#__codelineno-47-64"></a><span class="go">Chain DOCKER-ISOLATION-STAGE-1 (1 references)</span>
</span><span id="__span-47-65"><a id="__codelineno-47-65" name="__codelineno-47-65" href="#__codelineno-47-65"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-66"><a id="__codelineno-47-66" name="__codelineno-47-66" href="#__codelineno-47-66"></a><span class="go">DOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            </span>
</span><span id="__span-47-67"><a id="__codelineno-47-67" name="__codelineno-47-67" href="#__codelineno-47-67"></a>
</span><span id="__span-47-68"><a id="__codelineno-47-68" name="__codelineno-47-68" href="#__codelineno-47-68"></a><span class="go">Chain DOCKER-ISOLATION-STAGE-2 (1 references)</span>
</span><span id="__span-47-69"><a id="__codelineno-47-69" name="__codelineno-47-69" href="#__codelineno-47-69"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-70"><a id="__codelineno-47-70" name="__codelineno-47-70" href="#__codelineno-47-70"></a><span class="go">DROP       all  --  anywhere             anywhere            </span>
</span><span id="__span-47-71"><a id="__codelineno-47-71" name="__codelineno-47-71" href="#__codelineno-47-71"></a>
</span><span id="__span-47-72"><a id="__codelineno-47-72" name="__codelineno-47-72" href="#__codelineno-47-72"></a><span class="go">Chain DOCKER-USER (1 references)</span>
</span><span id="__span-47-73"><a id="__codelineno-47-73" name="__codelineno-47-73" href="#__codelineno-47-73"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-74"><a id="__codelineno-47-74" name="__codelineno-47-74" href="#__codelineno-47-74"></a><span class="go">RETURN     all  --  anywhere             anywhere            </span>
</span><span id="__span-47-75"><a id="__codelineno-47-75" name="__codelineno-47-75" href="#__codelineno-47-75"></a>
</span><span id="__span-47-76"><a id="__codelineno-47-76" name="__codelineno-47-76" href="#__codelineno-47-76"></a><span class="go">Chain KUBE-FIREWALL (2 references)</span>
</span><span id="__span-47-77"><a id="__codelineno-47-77" name="__codelineno-47-77" href="#__codelineno-47-77"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-78"><a id="__codelineno-47-78" name="__codelineno-47-78" href="#__codelineno-47-78"></a><span class="go">DROP       all  -- !localhost/8          localhost/8          /* block incoming localnet connections */ ! ctstate RELATED,ESTABLISHED,DNAT</span>
</span><span id="__span-47-79"><a id="__codelineno-47-79" name="__codelineno-47-79" href="#__codelineno-47-79"></a>
</span><span id="__span-47-80"><a id="__codelineno-47-80" name="__codelineno-47-80" href="#__codelineno-47-80"></a><span class="go">Chain KUBE-KUBELET-CANARY (0 references)</span>
</span><span id="__span-47-81"><a id="__codelineno-47-81" name="__codelineno-47-81" href="#__codelineno-47-81"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-82"><a id="__codelineno-47-82" name="__codelineno-47-82" href="#__codelineno-47-82"></a>
</span><span id="__span-47-83"><a id="__codelineno-47-83" name="__codelineno-47-83" href="#__codelineno-47-83"></a><span class="go">Chain ts-forward (1 references)</span>
</span><span id="__span-47-84"><a id="__codelineno-47-84" name="__codelineno-47-84" href="#__codelineno-47-84"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-85"><a id="__codelineno-47-85" name="__codelineno-47-85" href="#__codelineno-47-85"></a><span class="go">MARK       all  --  anywhere             anywhere             MARK xset 0x40000/0xff0000</span>
</span><span id="__span-47-86"><a id="__codelineno-47-86" name="__codelineno-47-86" href="#__codelineno-47-86"></a><span class="go">ACCEPT     all  --  anywhere             anywhere             mark match 0x40000/0xff0000</span>
</span><span id="__span-47-87"><a id="__codelineno-47-87" name="__codelineno-47-87" href="#__codelineno-47-87"></a><span class="go">DROP       all  --  100.64.0.0/10        anywhere            </span>
</span><span id="__span-47-88"><a id="__codelineno-47-88" name="__codelineno-47-88" href="#__codelineno-47-88"></a><span class="go">ACCEPT     all  --  anywhere             anywhere            </span>
</span><span id="__span-47-89"><a id="__codelineno-47-89" name="__codelineno-47-89" href="#__codelineno-47-89"></a>
</span><span id="__span-47-90"><a id="__codelineno-47-90" name="__codelineno-47-90" href="#__codelineno-47-90"></a><span class="go">Chain ts-input (1 references)</span>
</span><span id="__span-47-91"><a id="__codelineno-47-91" name="__codelineno-47-91" href="#__codelineno-47-91"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-92"><a id="__codelineno-47-92" name="__codelineno-47-92" href="#__codelineno-47-92"></a><span class="go">ACCEPT     all  --  octavo.royal-penny.ts.net  anywhere            </span>
</span><span id="__span-47-93"><a id="__codelineno-47-93" name="__codelineno-47-93" href="#__codelineno-47-93"></a><span class="go">RETURN     all  --  100.115.92.0/23      anywhere            </span>
</span><span id="__span-47-94"><a id="__codelineno-47-94" name="__codelineno-47-94" href="#__codelineno-47-94"></a><span class="go">DROP       all  --  100.64.0.0/10        anywhere            </span>
</span><span id="__span-47-95"><a id="__codelineno-47-95" name="__codelineno-47-95" href="#__codelineno-47-95"></a><span class="go">ACCEPT     all  --  anywhere             anywhere            </span>
</span><span id="__span-47-96"><a id="__codelineno-47-96" name="__codelineno-47-96" href="#__codelineno-47-96"></a><span class="go">ACCEPT     udp  --  anywhere             anywhere             udp dpt:41641</span>
</span><span id="__span-47-97"><a id="__codelineno-47-97" name="__codelineno-47-97" href="#__codelineno-47-97"></a>
</span><span id="__span-47-98"><a id="__codelineno-47-98" name="__codelineno-47-98" href="#__codelineno-47-98"></a><span class="gp">$ </span>sudo<span class="w"> </span>iptables<span class="w"> </span>-L<span class="w"> </span>-t<span class="w"> </span>nat
</span><span id="__span-47-99"><a id="__codelineno-47-99" name="__codelineno-47-99" href="#__codelineno-47-99"></a><span class="go">Chain PREROUTING (policy ACCEPT)</span>
</span><span id="__span-47-100"><a id="__codelineno-47-100" name="__codelineno-47-100" href="#__codelineno-47-100"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-101"><a id="__codelineno-47-101" name="__codelineno-47-101" href="#__codelineno-47-101"></a><span class="go">DOCKER     all  --  anywhere             anywhere             ADDRTYPE match dst-type LOCAL</span>
</span><span id="__span-47-102"><a id="__codelineno-47-102" name="__codelineno-47-102" href="#__codelineno-47-102"></a>
</span><span id="__span-47-103"><a id="__codelineno-47-103" name="__codelineno-47-103" href="#__codelineno-47-103"></a><span class="go">Chain INPUT (policy ACCEPT)</span>
</span><span id="__span-47-104"><a id="__codelineno-47-104" name="__codelineno-47-104" href="#__codelineno-47-104"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-105"><a id="__codelineno-47-105" name="__codelineno-47-105" href="#__codelineno-47-105"></a>
</span><span id="__span-47-106"><a id="__codelineno-47-106" name="__codelineno-47-106" href="#__codelineno-47-106"></a><span class="go">Chain OUTPUT (policy ACCEPT)</span>
</span><span id="__span-47-107"><a id="__codelineno-47-107" name="__codelineno-47-107" href="#__codelineno-47-107"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-108"><a id="__codelineno-47-108" name="__codelineno-47-108" href="#__codelineno-47-108"></a><span class="go">DOCKER     all  --  anywhere            !localhost/8          ADDRTYPE match dst-type LOCAL</span>
</span><span id="__span-47-109"><a id="__codelineno-47-109" name="__codelineno-47-109" href="#__codelineno-47-109"></a>
</span><span id="__span-47-110"><a id="__codelineno-47-110" name="__codelineno-47-110" href="#__codelineno-47-110"></a><span class="go">Chain POSTROUTING (policy ACCEPT)</span>
</span><span id="__span-47-111"><a id="__codelineno-47-111" name="__codelineno-47-111" href="#__codelineno-47-111"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-112"><a id="__codelineno-47-112" name="__codelineno-47-112" href="#__codelineno-47-112"></a><span class="go">ts-postrouting  all  --  anywhere             anywhere            </span>
</span><span id="__span-47-113"><a id="__codelineno-47-113" name="__codelineno-47-113" href="#__codelineno-47-113"></a><span class="go">MASQUERADE  all  --  172.17.0.0/16        anywhere            </span>
</span><span id="__span-47-114"><a id="__codelineno-47-114" name="__codelineno-47-114" href="#__codelineno-47-114"></a>
</span><span id="__span-47-115"><a id="__codelineno-47-115" name="__codelineno-47-115" href="#__codelineno-47-115"></a><span class="go">Chain DOCKER (2 references)</span>
</span><span id="__span-47-116"><a id="__codelineno-47-116" name="__codelineno-47-116" href="#__codelineno-47-116"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-117"><a id="__codelineno-47-117" name="__codelineno-47-117" href="#__codelineno-47-117"></a><span class="go">RETURN     all  --  anywhere             anywhere            </span>
</span><span id="__span-47-118"><a id="__codelineno-47-118" name="__codelineno-47-118" href="#__codelineno-47-118"></a>
</span><span id="__span-47-119"><a id="__codelineno-47-119" name="__codelineno-47-119" href="#__codelineno-47-119"></a><span class="go">Chain KUBE-KUBELET-CANARY (0 references)</span>
</span><span id="__span-47-120"><a id="__codelineno-47-120" name="__codelineno-47-120" href="#__codelineno-47-120"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-121"><a id="__codelineno-47-121" name="__codelineno-47-121" href="#__codelineno-47-121"></a>
</span><span id="__span-47-122"><a id="__codelineno-47-122" name="__codelineno-47-122" href="#__codelineno-47-122"></a><span class="go">Chain ts-postrouting (1 references)</span>
</span><span id="__span-47-123"><a id="__codelineno-47-123" name="__codelineno-47-123" href="#__codelineno-47-123"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-124"><a id="__codelineno-47-124" name="__codelineno-47-124" href="#__codelineno-47-124"></a><span class="go">MASQUERADE  all  --  anywhere             anywhere             mark match 0x40000/0xff0000</span>
</span><span id="__span-47-125"><a id="__codelineno-47-125" name="__codelineno-47-125" href="#__codelineno-47-125"></a>
</span><span id="__span-47-126"><a id="__codelineno-47-126" name="__codelineno-47-126" href="#__codelineno-47-126"></a><span class="gp">$ </span>sudo<span class="w"> </span>iptables<span class="w"> </span>-L<span class="w"> </span>-t<span class="w"> </span>mangle
</span><span id="__span-47-127"><a id="__codelineno-47-127" name="__codelineno-47-127" href="#__codelineno-47-127"></a><span class="go">Chain PREROUTING (policy ACCEPT)</span>
</span><span id="__span-47-128"><a id="__codelineno-47-128" name="__codelineno-47-128" href="#__codelineno-47-128"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-129"><a id="__codelineno-47-129" name="__codelineno-47-129" href="#__codelineno-47-129"></a>
</span><span id="__span-47-130"><a id="__codelineno-47-130" name="__codelineno-47-130" href="#__codelineno-47-130"></a><span class="go">Chain INPUT (policy ACCEPT)</span>
</span><span id="__span-47-131"><a id="__codelineno-47-131" name="__codelineno-47-131" href="#__codelineno-47-131"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-132"><a id="__codelineno-47-132" name="__codelineno-47-132" href="#__codelineno-47-132"></a>
</span><span id="__span-47-133"><a id="__codelineno-47-133" name="__codelineno-47-133" href="#__codelineno-47-133"></a><span class="go">Chain FORWARD (policy ACCEPT)</span>
</span><span id="__span-47-134"><a id="__codelineno-47-134" name="__codelineno-47-134" href="#__codelineno-47-134"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-135"><a id="__codelineno-47-135" name="__codelineno-47-135" href="#__codelineno-47-135"></a>
</span><span id="__span-47-136"><a id="__codelineno-47-136" name="__codelineno-47-136" href="#__codelineno-47-136"></a><span class="go">Chain OUTPUT (policy ACCEPT)</span>
</span><span id="__span-47-137"><a id="__codelineno-47-137" name="__codelineno-47-137" href="#__codelineno-47-137"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-138"><a id="__codelineno-47-138" name="__codelineno-47-138" href="#__codelineno-47-138"></a>
</span><span id="__span-47-139"><a id="__codelineno-47-139" name="__codelineno-47-139" href="#__codelineno-47-139"></a><span class="go">Chain POSTROUTING (policy ACCEPT)</span>
</span><span id="__span-47-140"><a id="__codelineno-47-140" name="__codelineno-47-140" href="#__codelineno-47-140"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-141"><a id="__codelineno-47-141" name="__codelineno-47-141" href="#__codelineno-47-141"></a>
</span><span id="__span-47-142"><a id="__codelineno-47-142" name="__codelineno-47-142" href="#__codelineno-47-142"></a><span class="go">Chain KUBE-IPTABLES-HINT (0 references)</span>
</span><span id="__span-47-143"><a id="__codelineno-47-143" name="__codelineno-47-143" href="#__codelineno-47-143"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-144"><a id="__codelineno-47-144" name="__codelineno-47-144" href="#__codelineno-47-144"></a>
</span><span id="__span-47-145"><a id="__codelineno-47-145" name="__codelineno-47-145" href="#__codelineno-47-145"></a><span class="go">Chain KUBE-KUBELET-CANARY (0 references)</span>
</span><span id="__span-47-146"><a id="__codelineno-47-146" name="__codelineno-47-146" href="#__codelineno-47-146"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-147"><a id="__codelineno-47-147" name="__codelineno-47-147" href="#__codelineno-47-147"></a>
</span><span id="__span-47-148"><a id="__codelineno-47-148" name="__codelineno-47-148" href="#__codelineno-47-148"></a>
</span><span id="__span-47-149"><a id="__codelineno-47-149" name="__codelineno-47-149" href="#__codelineno-47-149"></a><span class="gp">$ </span>sudo<span class="w"> </span>iptables<span class="w"> </span>-F
</span><span id="__span-47-150"><a id="__codelineno-47-150" name="__codelineno-47-150" href="#__codelineno-47-150"></a><span class="gp">$ </span>sudo<span class="w"> </span>iptables<span class="w"> </span>-t<span class="w"> </span>nat<span class="w"> </span>-F
</span><span id="__span-47-151"><a id="__codelineno-47-151" name="__codelineno-47-151" href="#__codelineno-47-151"></a><span class="gp">$ </span>sudo<span class="w"> </span>iptables<span class="w"> </span>-t<span class="w"> </span>mangle<span class="w"> </span>-F
</span><span id="__span-47-152"><a id="__codelineno-47-152" name="__codelineno-47-152" href="#__codelineno-47-152"></a><span class="gp">$ </span>sudo<span class="w"> </span>iptables<span class="w"> </span>-X
</span><span id="__span-47-153"><a id="__codelineno-47-153" name="__codelineno-47-153" href="#__codelineno-47-153"></a>
</span><span id="__span-47-154"><a id="__codelineno-47-154" name="__codelineno-47-154" href="#__codelineno-47-154"></a>
</span><span id="__span-47-155"><a id="__codelineno-47-155" name="__codelineno-47-155" href="#__codelineno-47-155"></a><span class="gp">$ </span>sudo<span class="w"> </span>iptables<span class="w"> </span>-L
</span><span id="__span-47-156"><a id="__codelineno-47-156" name="__codelineno-47-156" href="#__codelineno-47-156"></a><span class="go">Chain INPUT (policy ACCEPT)</span>
</span><span id="__span-47-157"><a id="__codelineno-47-157" name="__codelineno-47-157" href="#__codelineno-47-157"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-158"><a id="__codelineno-47-158" name="__codelineno-47-158" href="#__codelineno-47-158"></a>
</span><span id="__span-47-159"><a id="__codelineno-47-159" name="__codelineno-47-159" href="#__codelineno-47-159"></a><span class="go">Chain FORWARD (policy ACCEPT)</span>
</span><span id="__span-47-160"><a id="__codelineno-47-160" name="__codelineno-47-160" href="#__codelineno-47-160"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-161"><a id="__codelineno-47-161" name="__codelineno-47-161" href="#__codelineno-47-161"></a>
</span><span id="__span-47-162"><a id="__codelineno-47-162" name="__codelineno-47-162" href="#__codelineno-47-162"></a><span class="go">Chain OUTPUT (policy ACCEPT)</span>
</span><span id="__span-47-163"><a id="__codelineno-47-163" name="__codelineno-47-163" href="#__codelineno-47-163"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-164"><a id="__codelineno-47-164" name="__codelineno-47-164" href="#__codelineno-47-164"></a>
</span><span id="__span-47-165"><a id="__codelineno-47-165" name="__codelineno-47-165" href="#__codelineno-47-165"></a><span class="gp">$ </span>sudo<span class="w"> </span>iptables<span class="w"> </span>-t<span class="w"> </span>nat
</span><span id="__span-47-166"><a id="__codelineno-47-166" name="__codelineno-47-166" href="#__codelineno-47-166"></a><span class="go">Chain PREROUTING (policy ACCEPT)</span>
</span><span id="__span-47-167"><a id="__codelineno-47-167" name="__codelineno-47-167" href="#__codelineno-47-167"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-168"><a id="__codelineno-47-168" name="__codelineno-47-168" href="#__codelineno-47-168"></a>
</span><span id="__span-47-169"><a id="__codelineno-47-169" name="__codelineno-47-169" href="#__codelineno-47-169"></a><span class="go">Chain INPUT (policy ACCEPT)</span>
</span><span id="__span-47-170"><a id="__codelineno-47-170" name="__codelineno-47-170" href="#__codelineno-47-170"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-171"><a id="__codelineno-47-171" name="__codelineno-47-171" href="#__codelineno-47-171"></a>
</span><span id="__span-47-172"><a id="__codelineno-47-172" name="__codelineno-47-172" href="#__codelineno-47-172"></a><span class="go">Chain OUTPUT (policy ACCEPT)</span>
</span><span id="__span-47-173"><a id="__codelineno-47-173" name="__codelineno-47-173" href="#__codelineno-47-173"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-174"><a id="__codelineno-47-174" name="__codelineno-47-174" href="#__codelineno-47-174"></a>
</span><span id="__span-47-175"><a id="__codelineno-47-175" name="__codelineno-47-175" href="#__codelineno-47-175"></a><span class="go">Chain POSTROUTING (policy ACCEPT)</span>
</span><span id="__span-47-176"><a id="__codelineno-47-176" name="__codelineno-47-176" href="#__codelineno-47-176"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-177"><a id="__codelineno-47-177" name="__codelineno-47-177" href="#__codelineno-47-177"></a>
</span><span id="__span-47-178"><a id="__codelineno-47-178" name="__codelineno-47-178" href="#__codelineno-47-178"></a><span class="go">Chain DOCKER (0 references)</span>
</span><span id="__span-47-179"><a id="__codelineno-47-179" name="__codelineno-47-179" href="#__codelineno-47-179"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-180"><a id="__codelineno-47-180" name="__codelineno-47-180" href="#__codelineno-47-180"></a>
</span><span id="__span-47-181"><a id="__codelineno-47-181" name="__codelineno-47-181" href="#__codelineno-47-181"></a><span class="go">Chain KUBE-KUBELET-CANARY (0 references)</span>
</span><span id="__span-47-182"><a id="__codelineno-47-182" name="__codelineno-47-182" href="#__codelineno-47-182"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-183"><a id="__codelineno-47-183" name="__codelineno-47-183" href="#__codelineno-47-183"></a>
</span><span id="__span-47-184"><a id="__codelineno-47-184" name="__codelineno-47-184" href="#__codelineno-47-184"></a><span class="go">Chain ts-postrouting (0 references)</span>
</span><span id="__span-47-185"><a id="__codelineno-47-185" name="__codelineno-47-185" href="#__codelineno-47-185"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-186"><a id="__codelineno-47-186" name="__codelineno-47-186" href="#__codelineno-47-186"></a>
</span><span id="__span-47-187"><a id="__codelineno-47-187" name="__codelineno-47-187" href="#__codelineno-47-187"></a><span class="gp">$ </span>sudo<span class="w"> </span>iptables<span class="w"> </span>-t<span class="w"> </span>mangle
</span><span id="__span-47-188"><a id="__codelineno-47-188" name="__codelineno-47-188" href="#__codelineno-47-188"></a><span class="go">Chain PREROUTING (policy ACCEPT)</span>
</span><span id="__span-47-189"><a id="__codelineno-47-189" name="__codelineno-47-189" href="#__codelineno-47-189"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-190"><a id="__codelineno-47-190" name="__codelineno-47-190" href="#__codelineno-47-190"></a>
</span><span id="__span-47-191"><a id="__codelineno-47-191" name="__codelineno-47-191" href="#__codelineno-47-191"></a><span class="go">Chain INPUT (policy ACCEPT)</span>
</span><span id="__span-47-192"><a id="__codelineno-47-192" name="__codelineno-47-192" href="#__codelineno-47-192"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-193"><a id="__codelineno-47-193" name="__codelineno-47-193" href="#__codelineno-47-193"></a>
</span><span id="__span-47-194"><a id="__codelineno-47-194" name="__codelineno-47-194" href="#__codelineno-47-194"></a><span class="go">Chain FORWARD (policy ACCEPT)</span>
</span><span id="__span-47-195"><a id="__codelineno-47-195" name="__codelineno-47-195" href="#__codelineno-47-195"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-196"><a id="__codelineno-47-196" name="__codelineno-47-196" href="#__codelineno-47-196"></a>
</span><span id="__span-47-197"><a id="__codelineno-47-197" name="__codelineno-47-197" href="#__codelineno-47-197"></a><span class="go">Chain OUTPUT (policy ACCEPT)</span>
</span><span id="__span-47-198"><a id="__codelineno-47-198" name="__codelineno-47-198" href="#__codelineno-47-198"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-199"><a id="__codelineno-47-199" name="__codelineno-47-199" href="#__codelineno-47-199"></a>
</span><span id="__span-47-200"><a id="__codelineno-47-200" name="__codelineno-47-200" href="#__codelineno-47-200"></a><span class="go">Chain POSTROUTING (policy ACCEPT)</span>
</span><span id="__span-47-201"><a id="__codelineno-47-201" name="__codelineno-47-201" href="#__codelineno-47-201"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-202"><a id="__codelineno-47-202" name="__codelineno-47-202" href="#__codelineno-47-202"></a>
</span><span id="__span-47-203"><a id="__codelineno-47-203" name="__codelineno-47-203" href="#__codelineno-47-203"></a><span class="go">Chain KUBE-IPTABLES-HINT (0 references)</span>
</span><span id="__span-47-204"><a id="__codelineno-47-204" name="__codelineno-47-204" href="#__codelineno-47-204"></a><span class="go">target     prot opt source               destination         </span>
</span><span id="__span-47-205"><a id="__codelineno-47-205" name="__codelineno-47-205" href="#__codelineno-47-205"></a>
</span><span id="__span-47-206"><a id="__codelineno-47-206" name="__codelineno-47-206" href="#__codelineno-47-206"></a><span class="go">Chain KUBE-KUBELET-CANARY (0 references)</span>
</span><span id="__span-47-207"><a id="__codelineno-47-207" name="__codelineno-47-207" href="#__codelineno-47-207"></a><span class="go">target     prot opt source               destination</span>
</span></code></pre></div>
</details>
<h3 id="network-plugin">Network plugin</h3>
<p><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network">Installing a Pod network add-on</a>
is the next required step and, once again, in lack of other suggestions,
<a href="https://github.com/flannel-io/flannel#deploying-flannel-manually">deploying flannel manually</a>
like in previous clusters seems the way to go:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="gp">$ </span>wget<span class="w"> </span><span class="se">\</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">  </span>https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>kube-flannel.yml
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="go">namespace/kube-flannel created</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="go">serviceaccount/flannel created</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="go">clusterrole.rbac.authorization.k8s.io/flannel created</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="go">configmap/kube-flannel-cfg created</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="go">daemonset.apps/kube-flannel-ds created</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>kube-flannel<span class="w"> </span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="go">NAME                        READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="go">pod/kube-flannel-ds-m8h8n   1/1     Running   0          8s</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="go">NAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="go">daemonset.apps/kube-flannel-ds   1         1         1       1            1           &lt;none&gt;          8s</span>
</span></code></pre></div>
<h3 id="enable-single-node-cluster">Enable single-node cluster</h3>
<p><a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#control-plane-node-isolation">Control plane node isolation</a>
is required for a single-node cluster, because otherwise a cluster will not schedule
Pods on the control plane nodes for security reasons.
This is reflected in the <strong><code>Taints</code></strong> found in the node details:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>-o<span class="w"> </span>wide
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="go">NAME     STATUS   ROLES           AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION     CONTAINER-RUNTIME</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="go">octavo   Ready    control-plane   14m   v1.32.4   192.168.0.8   &lt;none&gt;        Ubuntu 24.04.2 LTS   6.8.0-58-generic   containerd://1.7.27</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>node<span class="w"> </span>octavo
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="go">Name:               octavo</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="go">Roles:              control-plane</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="go">Labels:             beta.kubernetes.io/arch=amd64</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="go">                    beta.kubernetes.io/os=linux</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="go">                    kubernetes.io/arch=amd64</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="go">                    kubernetes.io/hostname=octavo</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="go">                    kubernetes.io/os=linux</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a><span class="go">                    node-role.kubernetes.io/control-plane=</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a><span class="hll"><span class="go">                    node.kubernetes.io/exclude-from-external-load-balancers=</span>
</span></span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#__codelineno-49-15"></a><span class="go">Annotations:        flannel.alpha.coreos.com/backend-data: {"VNI":1,"VtepMAC":"0a:7f:28:09:c7:77"}</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#__codelineno-49-16"></a><span class="go">                    flannel.alpha.coreos.com/backend-type: vxlan</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#__codelineno-49-17"></a><span class="go">                    flannel.alpha.coreos.com/kube-subnet-manager: true</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#__codelineno-49-18"></a><span class="go">                    flannel.alpha.coreos.com/public-ip: 10.0.0.8</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#__codelineno-49-19"></a><span class="go">                    kubeadm.alpha.kubernetes.io/cri-socket: unix:/run/containerd/containerd.sock</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#__codelineno-49-20"></a><span class="go">                    node.alpha.kubernetes.io/ttl: 0</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#__codelineno-49-21"></a><span class="go">                    volumes.kubernetes.io/controller-managed-attach-detach: true</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#__codelineno-49-22"></a><span class="go">CreationTimestamp:  Sat, 26 Apr 2025 16:55:47 +0200</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#__codelineno-49-23"></a><span class="hll"><span class="go">Taints:             node-role.kubernetes.io/control-plane:NoSchedule</span>
</span></span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#__codelineno-49-24"></a><span class="go">Unschedulable:      false</span>
</span></code></pre></div>
<p>Remove this taint to allow other pods to be scheduled:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>--all<span class="w"> </span>node-role.kubernetes.io/control-plane-
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="go">node/octavo untainted</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>node<span class="w"> </span>octavo<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>taint
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="go">Taints:             &lt;none&gt;</span>
</span></code></pre></div>
<h4 id="allow-external-load-balancers">Allow external load balancers</h4>
<p>The <code>node.kubernetes.io/exclude-from-external-load-balancers</code> label highlighted
above will later lead to the problem of
<a href="https://metallb.universe.tf/troubleshooting/#metallb-is-not-advertising-my-service-from-my-control-plane-nodes-or-from-my-single-node-cluster">MetalLB is not advertising my service from my control-plane nodes or from my single node cluster</a>;
the recommened solution is to remove this label:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>octavo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">  </span>node.kubernetes.io/exclude-from-external-load-balancers-
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="go">node/octavo unlabeled</span>
</span></code></pre></div>
<h4 id="test-pod-scheduling">Test pod scheduling</h4>
<p>Before moving forward, run a test pod to confirm that pods can be scheduled:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://k8s.io/examples/pods/commands.yaml
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="go">pod/command-demo created</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="go">NAME               READY   STATUS              RESTARTS   AGE</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="go">pod/command-demo   0/1     ContainerCreating   0          1s</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="go">NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="go">service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   24m</span>
</span></code></pre></div>
<p>After a minute or two, the pod becomes <code>Completed</code>, indicating a successful run.
With the cluster now ready to run pods and services, move on to installing more components that will be used by the actual services:
<a href="#metallb-load-balancer">MetalLB Load Balancer</a>,
<a href="#kubernets-dashboard">Kubernets Dashboard</a>,
<a href="#ingress-controller">Ingress Controller</a>,
<a href="#https-certificates">HTTPS certificates</a>
with Lets Encrypt, including <a href="#automatic-renewal">automatic renewal</a>.
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/#localpath-pv-provisioner">LocalPath PV provisioner</a>
for simple persistent storage in local file systems would seem unnecessary,
based on experience with previous clusters.</p>
<h4 id="logs-reader-helper">Logs reader helper</h4>
<p>Troubleshooting podcs and services often involves reading or <em>watching</em> the logs,
which involves combining two <code>kubectl</code> commands to find the relevant pod/service
and requesting the logs. To makes this easier, put the following in <code>~/bin/klogs</code>
(and add <code>~/bin/</code> to your path if not there already):</p>
<div class="language-bash highlight"><span class="filename">bin/klogs</span><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="c1">#</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="c1"># Watch logs from Kubernetes pod/service.</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="c1">#</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="c1"># Usage: klogs &lt;namespace&gt; &lt;pod/service&gt;</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a><span class="nv">ns</span><span class="o">=</span><span class="nv">$1</span>
</span><span id="__span-53-8"><a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="nv">pd</span><span class="o">=</span><span class="nv">$2</span>
</span><span id="__span-53-9"><a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span><span class="nv">$ns</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-53-10"><a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a><span class="w">  </span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span><span class="nv">$ns</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="nv">$pd</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="w"> </span>-d<span class="s1">' '</span><span class="k">)</span><span class="w"> </span>-f
</span></code></pre></div>
<h3 id="metallb-load-balancer">MetalLB Load Balancer</h3>
<p>A Load Balancer is going to be necessary for the <a href="#kubernets-dashboard">Dashboard</a>
and other services, to expose individual services via open ports on the server
(<code>NodePort</code>) or virtual IP addresses.
<a href="https://metallb.universe.tf/installation/#installation-by-manifest">Installation By Manifest</a>
is as simple as applying the provided manifest:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="gp">$ </span>wget<span class="w"> </span><span class="se">\</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">  </span>https://raw.githubusercontent.com/metallb/metallb/v0.14.9/config/manifests/metallb-native.yaml
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>metallb/metallb-native.yaml
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="go">namespace/metallb-system created</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bfdprofiles.metallb.io created</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bgpadvertisements.metallb.io created</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bgppeers.metallb.io created</span>
</span><span id="__span-54-9"><a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/communities.metallb.io created</span>
</span><span id="__span-54-10"><a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/ipaddresspools.metallb.io created</span>
</span><span id="__span-54-11"><a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/l2advertisements.metallb.io created</span>
</span><span id="__span-54-12"><a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/servicel2statuses.metallb.io created</span>
</span><span id="__span-54-13"><a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="go">serviceaccount/controller created</span>
</span><span id="__span-54-14"><a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="go">serviceaccount/speaker created</span>
</span><span id="__span-54-15"><a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a><span class="go">role.rbac.authorization.k8s.io/controller created</span>
</span><span id="__span-54-16"><a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a><span class="go">role.rbac.authorization.k8s.io/pod-lister created</span>
</span><span id="__span-54-17"><a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a><span class="go">clusterrole.rbac.authorization.k8s.io/metallb-system:controller created</span>
</span><span id="__span-54-18"><a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a><span class="go">clusterrole.rbac.authorization.k8s.io/metallb-system:speaker created</span>
</span><span id="__span-54-19"><a id="__codelineno-54-19" name="__codelineno-54-19" href="#__codelineno-54-19"></a><span class="go">rolebinding.rbac.authorization.k8s.io/controller created</span>
</span><span id="__span-54-20"><a id="__codelineno-54-20" name="__codelineno-54-20" href="#__codelineno-54-20"></a><span class="go">rolebinding.rbac.authorization.k8s.io/pod-lister created</span>
</span><span id="__span-54-21"><a id="__codelineno-54-21" name="__codelineno-54-21" href="#__codelineno-54-21"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/metallb-system:controller created</span>
</span><span id="__span-54-22"><a id="__codelineno-54-22" name="__codelineno-54-22" href="#__codelineno-54-22"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/metallb-system:speaker created</span>
</span><span id="__span-54-23"><a id="__codelineno-54-23" name="__codelineno-54-23" href="#__codelineno-54-23"></a><span class="go">configmap/metallb-excludel2 created</span>
</span><span id="__span-54-24"><a id="__codelineno-54-24" name="__codelineno-54-24" href="#__codelineno-54-24"></a><span class="go">secret/metallb-webhook-cert created</span>
</span><span id="__span-54-25"><a id="__codelineno-54-25" name="__codelineno-54-25" href="#__codelineno-54-25"></a><span class="go">service/metallb-webhook-service created</span>
</span><span id="__span-54-26"><a id="__codelineno-54-26" name="__codelineno-54-26" href="#__codelineno-54-26"></a><span class="go">deployment.apps/controller created</span>
</span><span id="__span-54-27"><a id="__codelineno-54-27" name="__codelineno-54-27" href="#__codelineno-54-27"></a><span class="go">daemonset.apps/speaker created</span>
</span><span id="__span-54-28"><a id="__codelineno-54-28" name="__codelineno-54-28" href="#__codelineno-54-28"></a><span class="go">validatingwebhookconfiguration.admissionregistration.k8s.io/metallb-webhook-configuration created</span>
</span></code></pre></div>
<p>Soon enough the deployment should have the controller and speaker running:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>metallb-system
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="go">NAME                             READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="go">pod/controller-bb5f47665-vt57w   1/1     Running   0          62s</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="go">pod/speaker-92c2g                1/1     Running   0          62s</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="go">NAME                              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="go">service/metallb-webhook-service   ClusterIP   10.98.162.115   &lt;none&gt;        443/TCP   62s</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="go">NAME                     DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="go">daemonset.apps/speaker   1         1         1       1            1           kubernetes.io/os=linux   62s</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="go">NAME                         READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-55-13"><a id="__codelineno-55-13" name="__codelineno-55-13" href="#__codelineno-55-13"></a><span class="go">deployment.apps/controller   1/1     1            1           62s</span>
</span><span id="__span-55-14"><a id="__codelineno-55-14" name="__codelineno-55-14" href="#__codelineno-55-14"></a>
</span><span id="__span-55-15"><a id="__codelineno-55-15" name="__codelineno-55-15" href="#__codelineno-55-15"></a><span class="go">NAME                                   DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-55-16"><a id="__codelineno-55-16" name="__codelineno-55-16" href="#__codelineno-55-16"></a><span class="go">replicaset.apps/controller-bb5f47665   1         1         1       62s</span>
</span></code></pre></div>
<p>MetalLB remains idle until configured, which is done by deploying resources into its
namespace. A small range of IP addresses is advertised via
<a href="https://metallb.universe.tf/configuration/#layer-2-configuration">Layer 2 Configuration</a>,
which does not not require the IPs to be bound to the network interfaces:</p>
<div class="language-yaml highlight"><span class="filename">metallb/ipaddress-pool-octavo.yaml</span><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb.io/v1beta1</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IPAddressPool</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb-system</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="w">  </span><span class="nt">addresses</span><span class="p">:</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.171-192.168.0.180</span>
</span></span><span id="__span-56-9"><a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="nn">---</span>
</span><span id="__span-56-10"><a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb.io/v1beta1</span>
</span><span id="__span-56-11"><a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">L2Advertisement</span>
</span><span id="__span-56-12"><a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-56-13"><a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">l2-advert</span>
</span><span id="__span-56-14"><a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb-system</span>
</span></code></pre></div>
<p>The range is based on the local DHCP server configuration and which IPs are 
currently in use; this range has just not been leased so far. The reason to
use IPs from the leased range is that the router only allows adding port
forwarding rules for those. This range is intentionally on the same network
range and subnet as the DHCP server so that no routing is needed to reach
MetalLB IPs.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>metallb/ipaddress-pool-octavo.yaml
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="go">ipaddresspool.metallb.io/production created</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="go">l2advertisement.metallb.io/l2-advert created</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ipaddresspool.metallb.io<span class="w"> </span>-n<span class="w"> </span>metallb-system<span class="w"> </span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="go">NAME         AUTO ASSIGN   AVOID BUGGY IPS   ADDRESSES</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#__codelineno-57-7"></a><span class="hll"><span class="go">production   true          false             ["192.168.0.171-192.168.0.180"]</span>
</span></span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#__codelineno-57-8"></a>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#__codelineno-57-9"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>l2advertisement.metallb.io<span class="w"> </span>-n<span class="w"> </span>metallb-system<span class="w"> </span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#__codelineno-57-10"></a><span class="go">NAME        IPADDRESSPOOLS   IPADDRESSPOOL SELECTORS   INTERFACES</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#__codelineno-57-11"></a><span class="go">l2-advert</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#__codelineno-57-12"></a>
</span><span id="__span-57-13"><a id="__codelineno-57-13" name="__codelineno-57-13" href="#__codelineno-57-13"></a><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>ipaddresspool.metallb.io<span class="w"> </span>production<span class="w"> </span>-n<span class="w"> </span>metallb-system<span class="w"> </span>
</span><span id="__span-57-14"><a id="__codelineno-57-14" name="__codelineno-57-14" href="#__codelineno-57-14"></a><span class="go">stem</span>
</span><span id="__span-57-15"><a id="__codelineno-57-15" name="__codelineno-57-15" href="#__codelineno-57-15"></a><span class="go">Name:         production</span>
</span><span id="__span-57-16"><a id="__codelineno-57-16" name="__codelineno-57-16" href="#__codelineno-57-16"></a><span class="go">Namespace:    metallb-system</span>
</span><span id="__span-57-17"><a id="__codelineno-57-17" name="__codelineno-57-17" href="#__codelineno-57-17"></a><span class="go">Labels:       &lt;none&gt;</span>
</span><span id="__span-57-18"><a id="__codelineno-57-18" name="__codelineno-57-18" href="#__codelineno-57-18"></a><span class="go">Annotations:  &lt;none&gt;</span>
</span><span id="__span-57-19"><a id="__codelineno-57-19" name="__codelineno-57-19" href="#__codelineno-57-19"></a><span class="go">API Version:  metallb.io/v1beta1</span>
</span><span id="__span-57-20"><a id="__codelineno-57-20" name="__codelineno-57-20" href="#__codelineno-57-20"></a><span class="go">Kind:         IPAddressPool</span>
</span><span id="__span-57-21"><a id="__codelineno-57-21" name="__codelineno-57-21" href="#__codelineno-57-21"></a><span class="go">Metadata:</span>
</span><span id="__span-57-22"><a id="__codelineno-57-22" name="__codelineno-57-22" href="#__codelineno-57-22"></a><span class="go">  Creation Timestamp:  2025-04-26T15:40:23Z</span>
</span><span id="__span-57-23"><a id="__codelineno-57-23" name="__codelineno-57-23" href="#__codelineno-57-23"></a><span class="go">  Generation:          1</span>
</span><span id="__span-57-24"><a id="__codelineno-57-24" name="__codelineno-57-24" href="#__codelineno-57-24"></a><span class="go">  Resource Version:    3974</span>
</span><span id="__span-57-25"><a id="__codelineno-57-25" name="__codelineno-57-25" href="#__codelineno-57-25"></a><span class="go">  UID:                 3a7c5d52-ab54-4cb8-b339-2a81930bf199</span>
</span><span id="__span-57-26"><a id="__codelineno-57-26" name="__codelineno-57-26" href="#__codelineno-57-26"></a><span class="go">Spec:</span>
</span><span id="__span-57-27"><a id="__codelineno-57-27" name="__codelineno-57-27" href="#__codelineno-57-27"></a><span class="go">  Addresses:</span>
</span><span id="__span-57-28"><a id="__codelineno-57-28" name="__codelineno-57-28" href="#__codelineno-57-28"></a><span class="hll"><span class="go">    192.168.0.171-192.168.0.180</span>
</span></span><span id="__span-57-29"><a id="__codelineno-57-29" name="__codelineno-57-29" href="#__codelineno-57-29"></a><span class="go">  Auto Assign:       true</span>
</span><span id="__span-57-30"><a id="__codelineno-57-30" name="__codelineno-57-30" href="#__codelineno-57-30"></a><span class="go">  Avoid Buggy I Ps:  false</span>
</span><span id="__span-57-31"><a id="__codelineno-57-31" name="__codelineno-57-31" href="#__codelineno-57-31"></a><span class="go">Events:              &lt;none&gt;</span>
</span></code></pre></div>
<h4 id="2026-upgrade-to-helm-chart"><strong>2026</strong> Upgrade to Helm chart</h4>
<p><a href="../../../../2026/01/10/upgrading-single-node-kubernetes-cluster-on-ubuntu-studio-2404-octavo/">Upgrading Kubernetes</a>
eventually reached a point where MetalLB needed to be upgraded too; upgrading to
Kubernetes 1.35 requires MetalLB 0.15 or later.</p>
<p>MetalLb was last using the <code>metallb-native.yaml</code> instead of its Helm chart, and there
is a <code>IPAddressPool</code> defined in a separate manifest, so now in order to migrate to the
Helm chart without losing IP assignments or causing a collision, the migration needs to
perform a "takeover". Kubernetes allows Helm to manage existing resources if they are correctly labeled and annotated. The <code>IPAddressPool</code> and <code>L2Advertisement</code> are Custom
Resources (CRD). Helm will not delete these during the upgrade if the namespace is
handled correctly, but they should be backed up first:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ipaddresspools.metallb.io,l2advertisements.metallb.io<span class="w"> </span>-A<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="se">\</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="w">  </span>&gt;<span class="w"> </span>metallb-config-backup.yaml
</span></code></pre></div>
<p>Install the MetalLB Helm chart:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="gp">$ </span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>metallb<span class="w"> </span>https://metallb.github.io/metallb
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="go">"metallb" has been added to your repositories</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="gp">$ </span>helm<span class="w"> </span>repo<span class="w"> </span>update
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="go">Hang tight while we grab the latest from your chart repositories...</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="go">...Successfully got an update from the "metallb" chart repository</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="go">...</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="go">Update Complete. Happy Helming!</span>
</span></code></pre></div>
<p>To minimize downtime during the takeover, pre-pull the Docker images so that the Helm
installation happens in seconds rather than minutes:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="gp"># </span>docker<span class="w"> </span>pull<span class="w"> </span>quay.io/metallb/speaker:v0.15.3
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="go">v0.15.3: Pulling from metallb/speaker</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="go">fd4aa3667332: Pull complete </span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="go">...</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="go">07003b9acb06: Pull complete </span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="go">Digest: sha256:c6a5b25b2e1fba610a57b2db4bb8141d7c133569d561a8cc29e38ca5113efbc4</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="go">Status: Downloaded newer image for quay.io/metallb/speaker:v0.15.3</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="go">quay.io/metallb/speaker:v0.15.3</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>
</span><span id="__span-60-10"><a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="gp"># </span>docker<span class="w"> </span>pull<span class="w"> </span>quay.io/metallb/controller:v0.15.3
</span><span id="__span-60-11"><a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="go">v0.15.3: Pulling from metallb/controller</span>
</span><span id="__span-60-12"><a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="go">fd4aa3667332: Already exists </span>
</span><span id="__span-60-13"><a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="go">...</span>
</span><span id="__span-60-14"><a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a><span class="go">ddf74a63f7d8: Already exists </span>
</span><span id="__span-60-15"><a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="go">6dff88f058c1: Pull complete </span>
</span><span id="__span-60-16"><a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a><span class="go">db83dd67de88: Pull complete </span>
</span><span id="__span-60-17"><a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a><span class="go">Digest: sha256:6698ccc54c380913816ed1fd0758637ec87dd79da419c4ab170a2c26c158ab89</span>
</span><span id="__span-60-18"><a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a><span class="go">Status: Downloaded newer image for quay.io/metallb/controller:v0.15.3</span>
</span><span id="__span-60-19"><a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a><span class="go">quay.io/metallb/controller:v0.15.3</span>
</span></code></pre></div>
<p>Helm requires specific metadata to "adopt" existing resources. Without this, Helm will
fail with an "already exists" error. To avoid this, annotate and label the namespace:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>namespaces<span class="w"> </span>metallb-system<span class="w"> </span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="go">Name:         metallb-system</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="go">Labels:       kubernetes.io/metadata.name=metallb-system</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="go">              pod-security.kubernetes.io/audit=privileged</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="go">              pod-security.kubernetes.io/enforce=privileged</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="go">              pod-security.kubernetes.io/warn=privileged</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="go">Annotations:  &lt;none&gt;</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="go">Status:       Active</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a><span class="go">No resource quota.</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#__codelineno-61-12"></a><span class="go">No LimitRange resource.</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#__codelineno-61-13"></a>
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#__codelineno-61-14"></a><span class="gp">$ </span>kubectl<span class="w"> </span>annotate<span class="w"> </span>namespace<span class="w"> </span>metallb-system<span class="w"> </span>meta.helm.sh/release-name<span class="o">=</span>metallb
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#__codelineno-61-15"></a><span class="go">namespace/metallb-system annotated</span>
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#__codelineno-61-16"></a>
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#__codelineno-61-17"></a><span class="gp">$ </span>kubectl<span class="w"> </span>annotate<span class="w"> </span>namespace<span class="w"> </span>metallb-system<span class="w"> </span>meta.helm.sh/release-namespace<span class="o">=</span>metallb-system
</span><span id="__span-61-18"><a id="__codelineno-61-18" name="__codelineno-61-18" href="#__codelineno-61-18"></a><span class="go">namespace/metallb-system annotated</span>
</span><span id="__span-61-19"><a id="__codelineno-61-19" name="__codelineno-61-19" href="#__codelineno-61-19"></a>
</span><span id="__span-61-20"><a id="__codelineno-61-20" name="__codelineno-61-20" href="#__codelineno-61-20"></a><span class="gp">$ </span>kubectl<span class="w"> </span>label<span class="w"> </span>namespace<span class="w"> </span>metallb-system<span class="w"> </span>app.kubernetes.io/managed-by<span class="o">=</span>Helm
</span><span id="__span-61-21"><a id="__codelineno-61-21" name="__codelineno-61-21" href="#__codelineno-61-21"></a><span class="go">namespace/metallb-system labeled</span>
</span><span id="__span-61-22"><a id="__codelineno-61-22" name="__codelineno-61-22" href="#__codelineno-61-22"></a>
</span><span id="__span-61-23"><a id="__codelineno-61-23" name="__codelineno-61-23" href="#__codelineno-61-23"></a><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>namespaces<span class="w"> </span>metallb-system
</span><span id="__span-61-24"><a id="__codelineno-61-24" name="__codelineno-61-24" href="#__codelineno-61-24"></a><span class="go">Name:         metallb-system</span>
</span><span id="__span-61-25"><a id="__codelineno-61-25" name="__codelineno-61-25" href="#__codelineno-61-25"></a><span class="go">Labels:       app.kubernetes.io/managed-by=Helm</span>
</span><span id="__span-61-26"><a id="__codelineno-61-26" name="__codelineno-61-26" href="#__codelineno-61-26"></a><span class="go">              kubernetes.io/metadata.name=metallb-system</span>
</span><span id="__span-61-27"><a id="__codelineno-61-27" name="__codelineno-61-27" href="#__codelineno-61-27"></a><span class="go">              pod-security.kubernetes.io/audit=privileged</span>
</span><span id="__span-61-28"><a id="__codelineno-61-28" name="__codelineno-61-28" href="#__codelineno-61-28"></a><span class="go">              pod-security.kubernetes.io/enforce=privileged</span>
</span><span id="__span-61-29"><a id="__codelineno-61-29" name="__codelineno-61-29" href="#__codelineno-61-29"></a><span class="go">              pod-security.kubernetes.io/warn=privileged</span>
</span><span id="__span-61-30"><a id="__codelineno-61-30" name="__codelineno-61-30" href="#__codelineno-61-30"></a><span class="go">Annotations:  meta.helm.sh/release-name: metallb</span>
</span><span id="__span-61-31"><a id="__codelineno-61-31" name="__codelineno-61-31" href="#__codelineno-61-31"></a><span class="go">              meta.helm.sh/release-namespace: metallb-system</span>
</span><span id="__span-61-32"><a id="__codelineno-61-32" name="__codelineno-61-32" href="#__codelineno-61-32"></a><span class="go">Status:       Active</span>
</span><span id="__span-61-33"><a id="__codelineno-61-33" name="__codelineno-61-33" href="#__codelineno-61-33"></a>
</span><span id="__span-61-34"><a id="__codelineno-61-34" name="__codelineno-61-34" href="#__codelineno-61-34"></a><span class="go">No resource quota.</span>
</span><span id="__span-61-35"><a id="__codelineno-61-35" name="__codelineno-61-35" href="#__codelineno-61-35"></a>
</span><span id="__span-61-36"><a id="__codelineno-61-36" name="__codelineno-61-36" href="#__codelineno-61-36"></a><span class="go">No LimitRange resource.</span>
</span></code></pre></div>
<p>Then, to avoid conflicts, delete the existing deployment/daemonset while <strong>keeping</strong> the
<strong>CRDs and Namespace</strong>. It is critical <em>not to delete</em> the namespace, as doing so would
trigger a cascading deletion of <code>IPAddressPools</code> and potentially <code>Services</code> using them.</p>
<p><strong>Do not run</strong> <code>kubectl delete -f</code> on the <code>metallb-native.yaml</code> manifest. Instead, use
the manifest to identify and delete only the functional components (Deployments,
DaemonSets, and RBAC) while leaving the Namespace and CRDs intact. To delete everything
<strong>except</strong> the namespace and the CRDs, use the <code>--selector</code> to target MetalLB's
internal components:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-n<span class="w"> </span>metallb-system<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>metallb<span class="w"> </span><span class="se">\</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="w">  </span>deployment,daemonset,service,serviceaccount,role,rolebinding<span class="w"> </span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="go">deployment.apps "controller" deleted from metallb-system namespace</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="go">daemonset.apps "speaker" deleted from metallb-system namespace</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="go">serviceaccount "controller" deleted from metallb-system namespace</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="go">serviceaccount "speaker" deleted from metallb-system namespace</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="go">role.rbac.authorization.k8s.io "controller" deleted from metallb-system namespace</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="go">role.rbac.authorization.k8s.io "pod-lister" deleted from metallb-system namespace</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="go">rolebinding.rbac.authorization.k8s.io "controller" deleted from metallb-system namespace</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="go">rolebinding.rbac.authorization.k8s.io "pod-lister" deleted from metallb-system namespace</span>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a><span class="gp">$ </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>metallb<span class="w"> </span>clusterrole,clusterrolebinding
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a><span class="go">clusterrole.rbac.authorization.k8s.io "metallb-system:controller" deleted</span>
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a><span class="go">clusterrole.rbac.authorization.k8s.io "metallb-system:speaker" deleted</span>
</span><span id="__span-62-15"><a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io "metallb-system:controller" deleted</span>
</span><span id="__span-62-16"><a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io "metallb-system:speaker" deleted</span>
</span><span id="__span-62-17"><a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a>
</span><span id="__span-62-18"><a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a><span class="gp">$ </span>kubectl<span class="w"> </span>delete<span class="w"> </span>validatingwebhookconfiguration<span class="w"> </span>metallb-webhook-configuration
</span><span id="__span-62-19"><a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a><span class="go">validatingwebhookconfiguration.admissionregistration.k8s.io "metallb-webhook-configuration" deleted</span>
</span></code></pre></div>
<p>The CRDs (<code>IPAddressPool</code> and <code>L2Advertisement</code>) in the 0.14.9 manifest don't have the
<code>app=metallb</code> label, so the commands above will not touch them and thus the IP Pool
configuration is safe.</p>
<p>However, the above deletions are not enough, attempting to install the Helm chart fails
with <code>INSTALLATION FAILED</code> errors due to many other pre-existing
<code>CustomResourceDefinition</code> objects such as <code>bfdprofiles.metallb.io</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="gp">$ </span>helm<span class="w"> </span>install<span class="w"> </span>metallb<span class="w"> </span>metallb/metallb<span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="w">  </span>--namespace<span class="w"> </span>metallb-system<span class="w"> </span><span class="se">\</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="w">  </span>--version<span class="w"> </span><span class="m">0</span>.15.3
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="go">Error: INSTALLATION FAILED: Unable to continue with install: CustomResourceDefinition</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="go">"bfdprofiles.metallb.io" in namespace "" exists and cannot be imported into the</span>
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="go">current release: invalid ownership metadata; label validation error: missing key</span>
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="go">"app.kubernetes.io/managed-by": must be set to "Helm"; annotation validation error:</span>
</span><span id="__span-63-8"><a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="go">missing key "meta.helm.sh/release-name": must be set to "metallb"; annotation</span>
</span><span id="__span-63-9"><a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a><span class="go">validation error: missing key "meta.helm.sh/release-namespace": must be set to</span>
</span><span id="__span-63-10"><a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="go">"metallb-system"</span>
</span></code></pre></div>
<p>So there are two options: <code>delete</code> or <code>annotate</code>; a few need to be deleted:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>delete<span class="w"> </span>secret<span class="w"> </span>metallb-webhook-cert<span class="w"> </span>-n<span class="w"> </span>metallb-system
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="go">secret "metallb-webhook-cert" deleted from metallb-system namespace</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="gp">$ </span>kubectl<span class="w"> </span>delete<span class="w"> </span>configmap<span class="w"> </span>metallb-excludel2<span class="w"> </span>-n<span class="w"> </span>metallb-system
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="go">configmap "metallb-excludel2" deleted from metallb-system namespace</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="gp">$ </span>kubectl<span class="w"> </span>delete<span class="w"> </span>service<span class="w"> </span>metallb-webhook-service<span class="w"> </span>-n<span class="w"> </span>metallb-system
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="go">service "metallb-webhook-service" deleted from metallb-system namespace</span>
</span></code></pre></div>
<p>The rest need to be annotated (to preserve them):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="gp">$ </span><span class="nv">CRDS</span><span class="o">=</span><span class="s2">"bfdprofiles.metallb.io bgpadvertisements.metallb.io bgppeers.metallb.io communities.metallb.io ipaddresspools.metallb.io l2advertisements.metallb.io"</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="gp">$ </span><span class="k">for</span><span class="w"> </span>crd<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$CRDS</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="go">  kubectl annotate crd $crd meta.helm.sh/release-name=metallb --overwrite</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="go">  kubectl annotate crd $crd meta.helm.sh/release-namespace=metallb-system --overwrite</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="go">  kubectl label crd $crd app.kubernetes.io/managed-by=Helm --overwrite</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="go">done</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bfdprofiles.metallb.io annotated</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bfdprofiles.metallb.io annotated</span>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bfdprofiles.metallb.io labeled</span>
</span><span id="__span-65-10"><a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bgpadvertisements.metallb.io annotated</span>
</span><span id="__span-65-11"><a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bgpadvertisements.metallb.io annotated</span>
</span><span id="__span-65-12"><a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bgpadvertisements.metallb.io labeled</span>
</span><span id="__span-65-13"><a id="__codelineno-65-13" name="__codelineno-65-13" href="#__codelineno-65-13"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bgppeers.metallb.io annotated</span>
</span><span id="__span-65-14"><a id="__codelineno-65-14" name="__codelineno-65-14" href="#__codelineno-65-14"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bgppeers.metallb.io annotated</span>
</span><span id="__span-65-15"><a id="__codelineno-65-15" name="__codelineno-65-15" href="#__codelineno-65-15"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bgppeers.metallb.io labeled</span>
</span><span id="__span-65-16"><a id="__codelineno-65-16" name="__codelineno-65-16" href="#__codelineno-65-16"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/communities.metallb.io annotated</span>
</span><span id="__span-65-17"><a id="__codelineno-65-17" name="__codelineno-65-17" href="#__codelineno-65-17"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/communities.metallb.io annotated</span>
</span><span id="__span-65-18"><a id="__codelineno-65-18" name="__codelineno-65-18" href="#__codelineno-65-18"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/communities.metallb.io labeled</span>
</span><span id="__span-65-19"><a id="__codelineno-65-19" name="__codelineno-65-19" href="#__codelineno-65-19"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/ipaddresspools.metallb.io annotated</span>
</span><span id="__span-65-20"><a id="__codelineno-65-20" name="__codelineno-65-20" href="#__codelineno-65-20"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/ipaddresspools.metallb.io annotated</span>
</span><span id="__span-65-21"><a id="__codelineno-65-21" name="__codelineno-65-21" href="#__codelineno-65-21"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/ipaddresspools.metallb.io labeled</span>
</span><span id="__span-65-22"><a id="__codelineno-65-22" name="__codelineno-65-22" href="#__codelineno-65-22"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/l2advertisements.metallb.io annotated</span>
</span><span id="__span-65-23"><a id="__codelineno-65-23" name="__codelineno-65-23" href="#__codelineno-65-23"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/l2advertisements.metallb.io annotated</span>
</span><span id="__span-65-24"><a id="__codelineno-65-24" name="__codelineno-65-24" href="#__codelineno-65-24"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/l2advertisements.metallb.io labeled</span>
</span><span id="__span-65-25"><a id="__codelineno-65-25" name="__codelineno-65-25" href="#__codelineno-65-25"></a>
</span><span id="__span-65-26"><a id="__codelineno-65-26" name="__codelineno-65-26" href="#__codelineno-65-26"></a><span class="gp">$ </span>kubectl<span class="w"> </span>annotate<span class="w"> </span>crd<span class="w"> </span>servicel2statuses.metallb.io<span class="w"> </span>meta.helm.sh/release-name<span class="o">=</span>metallb<span class="w"> </span>--overwrite
</span><span id="__span-65-27"><a id="__codelineno-65-27" name="__codelineno-65-27" href="#__codelineno-65-27"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/servicel2statuses.metallb.io annotated</span>
</span><span id="__span-65-28"><a id="__codelineno-65-28" name="__codelineno-65-28" href="#__codelineno-65-28"></a>
</span><span id="__span-65-29"><a id="__codelineno-65-29" name="__codelineno-65-29" href="#__codelineno-65-29"></a><span class="gp">$ </span>kubectl<span class="w"> </span>annotate<span class="w"> </span>crd<span class="w"> </span>servicel2statuses.metallb.io<span class="w"> </span>meta.helm.sh/release-namespace<span class="o">=</span>metallb-system<span class="w"> </span>--overwrite
</span><span id="__span-65-30"><a id="__codelineno-65-30" name="__codelineno-65-30" href="#__codelineno-65-30"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/servicel2statuses.metallb.io annotated</span>
</span><span id="__span-65-31"><a id="__codelineno-65-31" name="__codelineno-65-31" href="#__codelineno-65-31"></a>
</span><span id="__span-65-32"><a id="__codelineno-65-32" name="__codelineno-65-32" href="#__codelineno-65-32"></a><span class="gp">$ </span>kubectl<span class="w"> </span>label<span class="w"> </span>crd<span class="w"> </span>servicel2statuses.metallb.io<span class="w"> </span>app.kubernetes.io/managed-by<span class="o">=</span>Helm<span class="w"> </span>--overwrite
</span><span id="__span-65-33"><a id="__codelineno-65-33" name="__codelineno-65-33" href="#__codelineno-65-33"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/servicel2statuses.metallb.io labeled</span>
</span></code></pre></div>
<p>Once the old <code>controller</code> and <code>speaker</code> are gone, Helm can install 0.15.3 into
the existing namespace:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="gp">$ </span>helm<span class="w"> </span>install<span class="w"> </span>metallb<span class="w"> </span>metallb/metallb<span class="w"> </span><span class="se">\</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="w">  </span>--namespace<span class="w"> </span>metallb-system<span class="w"> </span><span class="se">\</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="w">  </span>--version<span class="w"> </span><span class="m">0</span>.15.3
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="go">NAME: metallb</span>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="go">LAST DEPLOYED: Fri Jan 30 23:33:07 2026</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="go">NAMESPACE: metallb-system</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="go">STATUS: deployed</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="go">REVISION: 1</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="go">TEST SUITE: None</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a><span class="go">NOTES:</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="go">MetalLB is now running in the cluster.</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a><span class="go">Now you can configure it via its CRs. Please refer to the metallb official docs</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a><span class="go">on how to use the CRs.</span>
</span></code></pre></div>
<p>After the Helm install, the existing <code>IPAddressPool</code> is immediately active:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>-n<span class="w"> </span>metallb-system<span class="w"> </span>get<span class="w"> </span>ipaddresspools
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="go">NAME         AUTO ASSIGN   AVOID BUGGY IPS   ADDRESSES</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="go">production   true          false             ["192.168.0.171-192.168.0.180","192.168.1.171-201.168.1.220"]</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="gp">$ </span>kubectl<span class="w"> </span>-n<span class="w"> </span>metallb-system<span class="w"> </span>describe<span class="w"> </span>ipaddresspools
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="go">Name:         production</span>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="go">Namespace:    metallb-system</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="go">Labels:       &lt;none&gt;</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="go">Annotations:  &lt;none&gt;</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a><span class="go">API Version:  metallb.io/v1beta1</span>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a><span class="go">Kind:         IPAddressPool</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a><span class="go">Metadata:</span>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a><span class="go">  Creation Timestamp:  2025-04-26T15:40:23Z</span>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#__codelineno-67-14"></a><span class="go">  Generation:          4</span>
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#__codelineno-67-15"></a><span class="go">  Resource Version:    62054111</span>
</span><span id="__span-67-16"><a id="__codelineno-67-16" name="__codelineno-67-16" href="#__codelineno-67-16"></a><span class="go">  UID:                 3a7c5d52-ab54-4cb8-b339-2a81930bf199</span>
</span><span id="__span-67-17"><a id="__codelineno-67-17" name="__codelineno-67-17" href="#__codelineno-67-17"></a><span class="go">Spec:</span>
</span><span id="__span-67-18"><a id="__codelineno-67-18" name="__codelineno-67-18" href="#__codelineno-67-18"></a><span class="go">  Addresses:</span>
</span><span id="__span-67-19"><a id="__codelineno-67-19" name="__codelineno-67-19" href="#__codelineno-67-19"></a><span class="go">    192.168.0.171-192.168.0.180</span>
</span><span id="__span-67-20"><a id="__codelineno-67-20" name="__codelineno-67-20" href="#__codelineno-67-20"></a><span class="go">    192.168.1.171-201.168.1.220</span>
</span><span id="__span-67-21"><a id="__codelineno-67-21" name="__codelineno-67-21" href="#__codelineno-67-21"></a><span class="go">  Auto Assign:       true</span>
</span><span id="__span-67-22"><a id="__codelineno-67-22" name="__codelineno-67-22" href="#__codelineno-67-22"></a><span class="go">  Avoid Buggy I Ps:  false</span>
</span><span id="__span-67-23"><a id="__codelineno-67-23" name="__codelineno-67-23" href="#__codelineno-67-23"></a><span class="go">Status:</span>
</span><span id="__span-67-24"><a id="__codelineno-67-24" name="__codelineno-67-24" href="#__codelineno-67-24"></a><span class="go">  assignedIPv4:   3</span>
</span><span id="__span-67-25"><a id="__codelineno-67-25" name="__codelineno-67-25" href="#__codelineno-67-25"></a><span class="go">  assignedIPv6:   0</span>
</span><span id="__span-67-26"><a id="__codelineno-67-26" name="__codelineno-67-26" href="#__codelineno-67-26"></a><span class="go">  availableIPv4:  150995001</span>
</span><span id="__span-67-27"><a id="__codelineno-67-27" name="__codelineno-67-27" href="#__codelineno-67-27"></a><span class="go">  availableIPv6:  0</span>
</span><span id="__span-67-28"><a id="__codelineno-67-28" name="__codelineno-67-28" href="#__codelineno-67-28"></a><span class="go">Events:           &lt;none&gt;</span>
</span></code></pre></div>
<p>Had this not worked, the Speaker pod logs should be inspected. When the pools are
active, the speaker should be announcing services like this:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>metallb-system<span class="w"> </span>metallb-speaker-54w68<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>pool
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="go">...</span>
</span><span id="__span-68-3"><a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="go">{"caller":"main.go:444","event":"serviceAnnounced","ips":["192.168.0.173"],"level":"info","msg":"service has IP, announcing","pool":"production","protocol":"layer2","ts":"2026-01-30T22:33:18Z"}</span>
</span><span id="__span-68-4"><a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="go">{"caller":"main.go:444","event":"serviceAnnounced","ips":["192.168.1.220"],"level":"info","msg":"service has IP, announcing","pool":"production","protocol":"layer2","ts":"2026-01-30T22:33:18Z"}</span>
</span><span id="__span-68-5"><a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="go">{"caller":"main.go:444","event":"serviceAnnounced","ips":["192.168.0.172"],"level":"info","msg":"service has IP, announcing","pool":"production","protocol":"layer2","ts":"2026-01-30T22:33:18Z"}</span>
</span></code></pre></div>
<p>In the event of the logs showing errors about <code>"no pools found"</code>, re-apply the
specific <code>IPAddressPool</code> manifest:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>metallb/ipaddress-pool-octavo.yaml
</span></code></pre></div>
<h3 id="kubernets-dashboard">Kubernets Dashboard</h3>
<p><a href="https://github.com/kubernetes/dashboard?tab=readme-ov-file#installation">Install the Helm repository</a>
for the Kubernetes dashboard (this requires having previously
<a href="#install-helm">installed Helm</a>):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="gp">$ </span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span><span class="se">\</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">  </span>kubernetes-dashboard<span class="w"> </span><span class="se">\</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">  </span>https://kubernetes.github.io/dashboard/
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="go">"kubernetes-dashboard" has been added to your repositories</span>
</span></code></pre></div>
<p>And install the Kubernetes dashboard without any customization:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="gp">$ </span>helm<span class="w"> </span>upgrade<span class="w"> </span><span class="se">\</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="w">  </span>--install<span class="w"> </span>kubernetes-dashboard<span class="w"> </span><span class="se">\</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="w">    </span>kubernetes-dashboard/kubernetes-dashboard<span class="w"> </span><span class="se">\</span>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="w">  </span>--create-namespace<span class="w"> </span><span class="se">\</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="w">  </span>--namespace<span class="w"> </span>kubernetes-dashboard
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="go">Release "kubernetes-dashboard" does not exist. Installing it now.</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="go">NAME: kubernetes-dashboard</span>
</span><span id="__span-71-8"><a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="go">LAST DEPLOYED: Sat Apr 26 17:56:44 2025</span>
</span><span id="__span-71-9"><a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="go">NAMESPACE: kubernetes-dashboard</span>
</span><span id="__span-71-10"><a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="go">STATUS: deployed</span>
</span><span id="__span-71-11"><a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a><span class="go">REVISION: 1</span>
</span><span id="__span-71-12"><a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="go">TEST SUITE: None</span>
</span><span id="__span-71-13"><a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a><span class="go">NOTES:</span>
</span><span id="__span-71-14"><a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a><span class="go">*************************************************************************************************</span>
</span><span id="__span-71-15"><a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a><span class="go">*** PLEASE BE PATIENT: Kubernetes Dashboard may need a few minutes to get up and become ready ***</span>
</span><span id="__span-71-16"><a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a><span class="go">*************************************************************************************************</span>
</span><span id="__span-71-17"><a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a>
</span><span id="__span-71-18"><a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a><span class="go">Congratulations! You have just installed Kubernetes Dashboard in your cluster.</span>
</span><span id="__span-71-19"><a id="__codelineno-71-19" name="__codelineno-71-19" href="#__codelineno-71-19"></a>
</span><span id="__span-71-20"><a id="__codelineno-71-20" name="__codelineno-71-20" href="#__codelineno-71-20"></a><span class="go">To access Dashboard run:</span>
</span><span id="__span-71-21"><a id="__codelineno-71-21" name="__codelineno-71-21" href="#__codelineno-71-21"></a><span class="go">  kubectl -n kubernetes-dashboard port-forward svc/kubernetes-dashboard-kong-proxy 8443:443</span>
</span><span id="__span-71-22"><a id="__codelineno-71-22" name="__codelineno-71-22" href="#__codelineno-71-22"></a>
</span><span id="__span-71-23"><a id="__codelineno-71-23" name="__codelineno-71-23" href="#__codelineno-71-23"></a><span class="go">NOTE: In case port-forward command does not work, make sure that kong service name is correct.</span>
</span><span id="__span-71-24"><a id="__codelineno-71-24" name="__codelineno-71-24" href="#__codelineno-71-24"></a><span class="go">      Check the services in Kubernetes Dashboard namespace using:</span>
</span><span id="__span-71-25"><a id="__codelineno-71-25" name="__codelineno-71-25" href="#__codelineno-71-25"></a><span class="go">        kubectl -n kubernetes-dashboard get svc</span>
</span><span id="__span-71-26"><a id="__codelineno-71-26" name="__codelineno-71-26" href="#__codelineno-71-26"></a>
</span><span id="__span-71-27"><a id="__codelineno-71-27" name="__codelineno-71-27" href="#__codelineno-71-27"></a><span class="go">Dashboard will be available at:</span>
</span><span id="__span-71-28"><a id="__codelineno-71-28" name="__codelineno-71-28" href="#__codelineno-71-28"></a><span class="go">  https://localhost:8443</span>
</span></code></pre></div>
<p>After a minute or two, all services are running:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>kubernetes-dashboard
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="go">NAME                                                        READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="go">pod/kubernetes-dashboard-api-64c997cbcc-cxbjt               1/1     Running   0          30s</span>
</span><span id="__span-72-4"><a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="go">pod/kubernetes-dashboard-auth-5cf6848ffd-5vcm7              1/1     Running   0          30s</span>
</span><span id="__span-72-5"><a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="go">pod/kubernetes-dashboard-kong-79867c9c48-dwncj              1/1     Running   0          30s</span>
</span><span id="__span-72-6"><a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="go">pod/kubernetes-dashboard-metrics-scraper-76df4956c4-bx6wj   1/1     Running   0          30s</span>
</span><span id="__span-72-7"><a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="go">pod/kubernetes-dashboard-web-56df7655d9-jc8ss               1/1     Running   0          30s</span>
</span><span id="__span-72-8"><a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>
</span><span id="__span-72-9"><a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="go">NAME                                           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE</span>
</span><span id="__span-72-10"><a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="go">service/kubernetes-dashboard-api               ClusterIP   10.96.67.106    &lt;none&gt;        8000/TCP   30s</span>
</span><span id="__span-72-11"><a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="go">service/kubernetes-dashboard-auth              ClusterIP   10.110.81.112   &lt;none&gt;        8000/TCP   30s</span>
</span><span id="__span-72-12"><a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a><span class="go">service/kubernetes-dashboard-kong-proxy        ClusterIP   10.97.89.215    &lt;none&gt;        443/TCP    30s</span>
</span><span id="__span-72-13"><a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="go">service/kubernetes-dashboard-metrics-scraper   ClusterIP   10.111.10.215   &lt;none&gt;        8000/TCP   30s</span>
</span><span id="__span-72-14"><a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a><span class="go">service/kubernetes-dashboard-web               ClusterIP   10.99.213.93    &lt;none&gt;        8000/TCP   30s</span>
</span><span id="__span-72-15"><a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a>
</span><span id="__span-72-16"><a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a><span class="go">NAME                                                   READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-72-17"><a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="go">deployment.apps/kubernetes-dashboard-api               1/1     1            1           30s</span>
</span><span id="__span-72-18"><a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a><span class="go">deployment.apps/kubernetes-dashboard-auth              1/1     1            1           30s</span>
</span><span id="__span-72-19"><a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a><span class="go">deployment.apps/kubernetes-dashboard-kong              1/1     1            1           30s</span>
</span><span id="__span-72-20"><a id="__codelineno-72-20" name="__codelineno-72-20" href="#__codelineno-72-20"></a><span class="go">deployment.apps/kubernetes-dashboard-metrics-scraper   1/1     1            1           30s</span>
</span><span id="__span-72-21"><a id="__codelineno-72-21" name="__codelineno-72-21" href="#__codelineno-72-21"></a><span class="go">deployment.apps/kubernetes-dashboard-web               1/1     1            1           30s</span>
</span><span id="__span-72-22"><a id="__codelineno-72-22" name="__codelineno-72-22" href="#__codelineno-72-22"></a>
</span><span id="__span-72-23"><a id="__codelineno-72-23" name="__codelineno-72-23" href="#__codelineno-72-23"></a><span class="go">NAME                                                              DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-72-24"><a id="__codelineno-72-24" name="__codelineno-72-24" href="#__codelineno-72-24"></a><span class="go">replicaset.apps/kubernetes-dashboard-api-64c997cbcc               1         1         1       30s</span>
</span><span id="__span-72-25"><a id="__codelineno-72-25" name="__codelineno-72-25" href="#__codelineno-72-25"></a><span class="go">replicaset.apps/kubernetes-dashboard-auth-5cf6848ffd              1         1         1       30s</span>
</span><span id="__span-72-26"><a id="__codelineno-72-26" name="__codelineno-72-26" href="#__codelineno-72-26"></a><span class="go">replicaset.apps/kubernetes-dashboard-kong-79867c9c48              1         1         1       30s</span>
</span><span id="__span-72-27"><a id="__codelineno-72-27" name="__codelineno-72-27" href="#__codelineno-72-27"></a><span class="go">replicaset.apps/kubernetes-dashboard-metrics-scraper-76df4956c4   1         1         1       30s</span>
</span><span id="__span-72-28"><a id="__codelineno-72-28" name="__codelineno-72-28" href="#__codelineno-72-28"></a><span class="go">replicaset.apps/kubernetes-dashboard-web-56df7655d9               1         1         1       30s</span>
</span></code></pre></div>
<p>The dashboard is now behind the <code>kubernetes-dashboard-kong-proxy</code> service, and
the suggested <code>kubectl port-forward</code> command.can be used to map port 8443 to it:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>-n<span class="w"> </span>kubernetes-dashboard<span class="w"> </span>port-forward<span class="w"> </span><span class="se">\</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">  </span>svc/kubernetes-dashboard-kong-proxy<span class="w"> </span><span class="m">8443</span>:443<span class="w"> </span><span class="se">\</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">  </span>--address<span class="w"> </span><span class="m">0</span>.0.0.0
</span><span id="__span-73-4"><a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="go">Forwarding from 0.0.0.0:8443 -&gt; 8443</span>
</span></code></pre></div>
<p>The dasboard is then available at <a href="https://octavo:8443/">https://octavo:8443/</a>:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../../../media/2025-04-12-kubernetes-homelab-server-with-ubuntu-server-24-04-octavo/kubernetes-dashboard-login.png" data-desc-position="bottom"><img alt="Kubernetes Dashboard login" src="../../../../media/2025-04-12-kubernetes-homelab-server-with-ubuntu-server-24-04-octavo/kubernetes-dashboard-login.png" style="height:342px;width:964px"></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Documentation pages omit the <code>--address 0.0.0.0</code> flag, but without it the
dashboard is either unreachable or non-functional, see
<a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#troubleshooting-dashboard">Troubleshooting Dashboard</a>
for details of how this issue was encountered before.</p>
</div>
<p><a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Accessing the Dashboard UI</a>
requires
<a href="https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md">creating a sample user</a>;
the setup in the tutorial creates an example admin user with all privileges,
good enough for now:</p>
<div class="language-yaml highlight"><span class="filename">dashboard/admin-sa-rbac.yaml</span><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin-user</span>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="nn">---</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
</span><span id="__span-74-8"><a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
</span><span id="__span-74-9"><a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-74-10"><a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-74-11"><a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin-user</span>
</span><span id="__span-74-12"><a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a><span class="nt">roleRef</span><span class="p">:</span>
</span><span id="__span-74-13"><a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</span><span id="__span-74-14"><a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
</span><span id="__span-74-15"><a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster-admin</span>
</span><span id="__span-74-16"><a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="nt">subjects</span><span class="p">:</span>
</span><span id="__span-74-17"><a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
</span><span id="__span-74-18"><a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin-user</span>
</span><span id="__span-74-19"><a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-74-20"><a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a><span class="nn">---</span>
</span><span id="__span-74-21"><a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-74-22"><a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
</span><span id="__span-74-23"><a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-74-24"><a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin-user</span>
</span><span id="__span-74-25"><a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-74-26"><a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-74-27"><a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a><span class="w">    </span><span class="nt">kubernetes.io/service-account.name</span><span class="p">:</span><span class="w"> </span><span class="s">"admin-user"</span><span class="w">   </span>
</span><span id="__span-74-28"><a id="__codelineno-74-28" name="__codelineno-74-28" href="#__codelineno-74-28"></a><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/service-account-token</span>
</span></code></pre></div>
<div class="language-console highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>dashboard/admin-sa-rbac.yaml
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="go">serviceaccount/admin-user created</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/admin-user created</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="go">secret/admin-user created</span>
</span></code></pre></div>
<p>To login on the dashboard as the <code>admin</code> user, each time, generate a new
tokenw with:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>-n<span class="w"> </span>kubernetes-dashboard<span class="w"> </span>create<span class="w"> </span>token<span class="w"> </span>admin-user
</span></code></pre></div>
<p>The next step is to make the dashboard available at a stable URL, without running
the <code>kubectl port-forward</code> command.</p>
<h3 id="new-in-2026-headlamp"><strong>New in 2026:</strong> Headlamp</h3>
<p><a href="https://github.com/kubernetes-retired/dashboard?tab=readme-ov-file#kubernetes-dashboard">Kubernetes Dashboard</a>
was deprecated and archived in January 2026, and is no longer
maintained due to lack of active maintainers and contributors.
The suggested replacement is
<a href="https://github.com/kubernetes-sigs/headlamp?tab=readme-ov-file#------------">Headlamp</a>,
which can be deployed
<a href="https://headlamp.dev/docs/latest/installation/in-cluster/">in-cluster</a>
with a (Pomerium) ingress.</p>
<p>The easiest way to install Headlamp is to use their helm chart:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="gp">$ </span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>headlamp<span class="w"> </span>https://kubernetes-sigs.github.io/headlamp/
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="go">"headlamp" has been added to your repositories</span>
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>
</span><span id="__span-77-4"><a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="gp">$ </span>helm<span class="w"> </span>repo<span class="w"> </span>update
</span><span id="__span-77-5"><a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a>
</span><span id="__span-77-6"><a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="gp">$ </span>helm<span class="w"> </span>install<span class="w"> </span>headlamp<span class="w"> </span>headlamp/headlamp<span class="w"> </span><span class="se">\</span>
</span><span id="__span-77-7"><a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a><span class="w">  </span>--namespace<span class="w"> </span>kube-system<span class="w"> </span><span class="se">\</span>
</span><span id="__span-77-8"><a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w">  </span>-f<span class="w"> </span>headlamp-values.yaml
</span><span id="__span-77-9"><a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="go">NAME: headlamp</span>
</span><span id="__span-77-10"><a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="go">LAST DEPLOYED: Sun Feb  1 00:27:44 2026</span>
</span><span id="__span-77-11"><a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a><span class="go">NAMESPACE: kube-system</span>
</span><span id="__span-77-12"><a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="go">STATUS: deployed</span>
</span><span id="__span-77-13"><a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="go">REVISION: 1</span>
</span><span id="__span-77-14"><a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="go">TEST SUITE: None</span>
</span><span id="__span-77-15"><a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a><span class="go">NOTES:</span>
</span><span id="__span-77-16"><a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="go">1. Get the application URL by running these commands:</span>
</span><span id="__span-77-17"><a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="go">  export POD_NAME=$(kubectl get pods --namespace kube-system -l "app.kubernetes.io/name=headlamp,app.kubernetes.io/instance=headlamp" -o jsonpath="{.items[0].metadata.name}")</span>
</span><span id="__span-77-18"><a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a><span class="go">  export CONTAINER_PORT=$(kubectl get pod --namespace kube-system $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")</span>
</span><span id="__span-77-19"><a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a><span class="go">  echo "Visit http://127.0.0.1:8080 to use your application"</span>
</span><span id="__span-77-20"><a id="__codelineno-77-20" name="__codelineno-77-20" href="#__codelineno-77-20"></a><span class="go">  kubectl --namespace kube-system port-forward $POD_NAME 8080:$CONTAINER_PORT</span>
</span><span id="__span-77-21"><a id="__codelineno-77-21" name="__codelineno-77-21" href="#__codelineno-77-21"></a><span class="go">2. Get the token using</span>
</span><span id="__span-77-22"><a id="__codelineno-77-22" name="__codelineno-77-22" href="#__codelineno-77-22"></a><span class="go">  kubectl create token headlamp --namespace kube-system</span>
</span></code></pre></div>
<div class="admonition k8s">
<p class="admonition-title"><code>headlamp-values.yaml</code></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="nt">config</span><span class="p">:</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">  </span><span class="nt">baseURL</span><span class="p">:</span><span class="w"> </span><span class="s">"https://headlamp.very-very-dark-gray.top/"</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">  </span><span class="nt">watchPlugins</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-78-4"><a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a><span class="nt">pluginsManager</span><span class="p">:</span>
</span><span id="__span-78-5"><a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-78-6"><a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="w">  </span><span class="nt">configContent</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-78-7"><a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="w">    </span><span class="no">plugins:</span>
</span><span id="__span-78-8"><a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w">      </span><span class="no">- name: cert-manager</span>
</span><span id="__span-78-9"><a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a><span class="w">        </span><span class="no">source: https://artifacthub.io/packages/headlamp/headlamp-plugins/headlamp_cert-manager</span>
</span><span id="__span-78-10"><a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">        </span><span class="no">version: 0.1.0</span>
</span><span id="__span-78-11"><a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="w">      </span><span class="no">- name: flux</span>
</span><span id="__span-78-12"><a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a><span class="w">        </span><span class="no">source: https://artifacthub.io/packages/headlamp/headlamp-plugins/headlamp_flux</span>
</span><span id="__span-78-13"><a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a><span class="w">        </span><span class="no">version: 0.5.0</span>
</span><span id="__span-78-14"><a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a><span class="w">      </span><span class="no">- name: trivy</span>
</span><span id="__span-78-15"><a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a><span class="w">        </span><span class="no">source: https://artifacthub.io/packages/headlamp/headlamp-trivy/headlamp_trivy</span>
</span><span id="__span-78-16"><a id="__codelineno-78-16" name="__codelineno-78-16" href="#__codelineno-78-16"></a><span class="w">        </span><span class="no">version: 0.3.1</span>
</span><span id="__span-78-17"><a id="__codelineno-78-17" name="__codelineno-78-17" href="#__codelineno-78-17"></a><span class="w">    </span><span class="no">installOptions:</span>
</span><span id="__span-78-18"><a id="__codelineno-78-18" name="__codelineno-78-18" href="#__codelineno-78-18"></a><span class="w">      </span><span class="no">parallel: true</span>
</span><span id="__span-78-19"><a id="__codelineno-78-19" name="__codelineno-78-19" href="#__codelineno-78-19"></a><span class="w">      </span><span class="no">maxConcurrent: 2</span>
</span><span id="__span-78-20"><a id="__codelineno-78-20" name="__codelineno-78-20" href="#__codelineno-78-20"></a><span class="w">  </span><span class="nt">baseImage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">node:lts-alpine</span>
</span><span id="__span-78-21"><a id="__codelineno-78-21" name="__codelineno-78-21" href="#__codelineno-78-21"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</span><span id="__span-78-22"><a id="__codelineno-78-22" name="__codelineno-78-22" href="#__codelineno-78-22"></a><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-78-23"><a id="__codelineno-78-23" name="__codelineno-78-23" href="#__codelineno-78-23"></a><span class="w">  </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-78-24"><a id="__codelineno-78-24" name="__codelineno-78-24" href="#__codelineno-78-24"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-78-25"><a id="__codelineno-78-25" name="__codelineno-78-25" href="#__codelineno-78-25"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-78-26"><a id="__codelineno-78-26" name="__codelineno-78-26" href="#__codelineno-78-26"></a><span class="w">  </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="s">"1Gi"</span>
</span><span id="__span-78-27"><a id="__codelineno-78-27" name="__codelineno-78-27" href="#__codelineno-78-27"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="s">"longhorn-nvme"</span>
</span><span id="__span-78-28"><a id="__codelineno-78-28" name="__codelineno-78-28" href="#__codelineno-78-28"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span></code></pre></div>
</div>
<p>To make Headlamp available via <a href="../../../12/18/replacing-ingress-nginx-with-pomerium/">Pomerium ingress</a>
on external URL, add an <code>Ingress</code> manifest under <code>pomerium/pomerium-ingress/</code>
(and load it from <code>kustomization.yaml</code>):</p>
<div class="admonition k8s">
<p class="admonition-title"><code>pomerium/pomerium-ingress/headlamp.yaml</code></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-79-4"><a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">headlamp-pomerium-ingress</span>
</span><span id="__span-79-5"><a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</span><span id="__span-79-6"><a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-79-7"><a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-79-8"><a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="w">    </span><span class="nt">ingress.pomerium.io/pass_identity_headers</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-79-9"><a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-79-10"><a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pomerium</span>
</span><span id="__span-79-11"><a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-79-12"><a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">headlamp.very-very-dark-gray.top</span>
</span><span id="__span-79-13"><a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-79-14"><a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-79-15"><a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-79-16"><a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-79-17"><a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-79-18"><a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-79-19"><a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">headlamp</span>
</span><span id="__span-79-20"><a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-79-21"><a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id="__span-79-22"><a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-79-23"><a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret-cloudflare</span>
</span><span id="__span-79-24"><a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-79-25"><a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">headlamp.very-very-dark-gray.top</span>
</span></code></pre></div>
</div>
<p>Finally, to log into the Headlamp dashboard, request a token for <code>headlamp</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>create<span class="w"> </span>token<span class="w"> </span>headlamp<span class="w"> </span>--namespace<span class="w"> </span>kube-system
</span></code></pre></div>
<h3 id="ingress-controller">Ingress Controller</h3>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The Nginx Ingress Controller was deprecated in 2025 and
<a href="../../../12/18/replacing-ingress-nginx-with-pomerium/">replaced with Pomerium</a>.</p>
</div>
<p>An Nginx Ingress Controller will be used to redirect HTTPS requests to different services depending on the <code>Host</code> header, while all those requests will be hitting
the same IP address. The current Nginx
<a href="https://kubernetes.github.io/ingress-nginx/deploy/">Installation Guide</a>
essentially suggests several methods to install Nginx, of which the first is Helm:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="gp">$ </span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span><span class="se">\</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="w">  </span>ingress-nginx<span class="w"> </span><span class="se">\</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="w">  </span>https://kubernetes.github.io/ingress-nginx
</span><span id="__span-81-4"><a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="go">"ingress-nginx" has been added to your repositories</span>
</span></code></pre></div>
<p>To enable the use of snippets annotations, used to hide server headers, override
<a href="https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/#allow-snippet-annotations"><code>allow-snippet-annotations</code></a>
which is set to <code>false</code> by default to mitigate known vulnerability
<a href="https://nvd.nist.gov/vuln/detail/CVE-2021-25742">CVE-2021-25742</a>.
The <code>nginx.ingress.kubernetes.io/configuration-snippet</code> is rated <code>Critical</code>, so the
annotation also requires raisig the <code>annotations-risk-level</code>. To tweak both of these
in the Helm chart, use the following <code>nginx-values.yaml</code>:</p>
<div class="language-yaml highlight"><span class="filename">nginx-values.yaml</span><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="nt">controller</span><span class="p">:</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="w">  </span><span class="nt">allowSnippetAnnotations</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a><span class="w">  </span><span class="nt">config</span><span class="p">:</span>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="w">    </span><span class="nt">annotations-risk-level</span><span class="p">:</span><span class="w"> </span><span class="s">"Critical"</span>
</span></code></pre></div>
<div class="language-console highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="gp">$ </span>helm<span class="w"> </span>upgrade<span class="w"> </span><span class="se">\</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="w">  </span>--install<span class="w"> </span>ingress-nginx<span class="w"> </span><span class="se">\</span>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="w">  </span>ingress-nginx/ingress-nginx<span class="w"> </span><span class="se">\</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="w">  </span>--create-namespace<span class="w"> </span><span class="se">\</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="w">  </span>--namespace<span class="w"> </span>ingress-nginx<span class="w"> </span><span class="se">\</span>
</span><span id="__span-83-6"><a id="__codelineno-83-6" name="__codelineno-83-6" href="#__codelineno-83-6"></a><span class="w">  </span>--values<span class="w"> </span>nginx-values.yaml
</span><span id="__span-83-7"><a id="__codelineno-83-7" name="__codelineno-83-7" href="#__codelineno-83-7"></a><span class="go">Release "ingress-nginx" does not exist. Installing it now.</span>
</span><span id="__span-83-8"><a id="__codelineno-83-8" name="__codelineno-83-8" href="#__codelineno-83-8"></a><span class="go">NAME: ingress-nginx</span>
</span><span id="__span-83-9"><a id="__codelineno-83-9" name="__codelineno-83-9" href="#__codelineno-83-9"></a><span class="go">LAST DEPLOYED: Sat Apr 26 19:31:25 2025</span>
</span><span id="__span-83-10"><a id="__codelineno-83-10" name="__codelineno-83-10" href="#__codelineno-83-10"></a><span class="go">NAMESPACE: ingress-nginx</span>
</span><span id="__span-83-11"><a id="__codelineno-83-11" name="__codelineno-83-11" href="#__codelineno-83-11"></a><span class="go">STATUS: deployed</span>
</span><span id="__span-83-12"><a id="__codelineno-83-12" name="__codelineno-83-12" href="#__codelineno-83-12"></a><span class="go">REVISION: 1</span>
</span><span id="__span-83-13"><a id="__codelineno-83-13" name="__codelineno-83-13" href="#__codelineno-83-13"></a><span class="go">TEST SUITE: None</span>
</span><span id="__span-83-14"><a id="__codelineno-83-14" name="__codelineno-83-14" href="#__codelineno-83-14"></a><span class="go">NOTES:</span>
</span><span id="__span-83-15"><a id="__codelineno-83-15" name="__codelineno-83-15" href="#__codelineno-83-15"></a><span class="go">The ingress-nginx controller has been installed.</span>
</span><span id="__span-83-16"><a id="__codelineno-83-16" name="__codelineno-83-16" href="#__codelineno-83-16"></a><span class="go">It may take a few minutes for the load balancer IP to be available.</span>
</span><span id="__span-83-17"><a id="__codelineno-83-17" name="__codelineno-83-17" href="#__codelineno-83-17"></a><span class="go">You can watch the status by running 'kubectl get service --namespace ingress-nginx ingress-nginx-controller --output wide --watch'</span>
</span><span id="__span-83-18"><a id="__codelineno-83-18" name="__codelineno-83-18" href="#__codelineno-83-18"></a>
</span><span id="__span-83-19"><a id="__codelineno-83-19" name="__codelineno-83-19" href="#__codelineno-83-19"></a><span class="go">An example Ingress that makes use of the controller:</span>
</span><span id="__span-83-20"><a id="__codelineno-83-20" name="__codelineno-83-20" href="#__codelineno-83-20"></a><span class="go">  apiVersion: networking.k8s.io/v1</span>
</span><span id="__span-83-21"><a id="__codelineno-83-21" name="__codelineno-83-21" href="#__codelineno-83-21"></a><span class="go">  kind: Ingress</span>
</span><span id="__span-83-22"><a id="__codelineno-83-22" name="__codelineno-83-22" href="#__codelineno-83-22"></a><span class="go">  metadata:</span>
</span><span id="__span-83-23"><a id="__codelineno-83-23" name="__codelineno-83-23" href="#__codelineno-83-23"></a><span class="go">    name: example</span>
</span><span id="__span-83-24"><a id="__codelineno-83-24" name="__codelineno-83-24" href="#__codelineno-83-24"></a><span class="go">    namespace: foo</span>
</span><span id="__span-83-25"><a id="__codelineno-83-25" name="__codelineno-83-25" href="#__codelineno-83-25"></a><span class="go">  spec:</span>
</span><span id="__span-83-26"><a id="__codelineno-83-26" name="__codelineno-83-26" href="#__codelineno-83-26"></a><span class="go">    ingressClassName: nginx</span>
</span><span id="__span-83-27"><a id="__codelineno-83-27" name="__codelineno-83-27" href="#__codelineno-83-27"></a><span class="go">    rules:</span>
</span><span id="__span-83-28"><a id="__codelineno-83-28" name="__codelineno-83-28" href="#__codelineno-83-28"></a><span class="go">      - host: www.example.com</span>
</span><span id="__span-83-29"><a id="__codelineno-83-29" name="__codelineno-83-29" href="#__codelineno-83-29"></a><span class="go">        http:</span>
</span><span id="__span-83-30"><a id="__codelineno-83-30" name="__codelineno-83-30" href="#__codelineno-83-30"></a><span class="go">          paths:</span>
</span><span id="__span-83-31"><a id="__codelineno-83-31" name="__codelineno-83-31" href="#__codelineno-83-31"></a><span class="go">            - pathType: Prefix</span>
</span><span id="__span-83-32"><a id="__codelineno-83-32" name="__codelineno-83-32" href="#__codelineno-83-32"></a><span class="go">              backend:</span>
</span><span id="__span-83-33"><a id="__codelineno-83-33" name="__codelineno-83-33" href="#__codelineno-83-33"></a><span class="go">                service:</span>
</span><span id="__span-83-34"><a id="__codelineno-83-34" name="__codelineno-83-34" href="#__codelineno-83-34"></a><span class="go">                  name: exampleService</span>
</span><span id="__span-83-35"><a id="__codelineno-83-35" name="__codelineno-83-35" href="#__codelineno-83-35"></a><span class="go">                  port:</span>
</span><span id="__span-83-36"><a id="__codelineno-83-36" name="__codelineno-83-36" href="#__codelineno-83-36"></a><span class="go">                    number: 80</span>
</span><span id="__span-83-37"><a id="__codelineno-83-37" name="__codelineno-83-37" href="#__codelineno-83-37"></a><span class="go">              path: /</span>
</span><span id="__span-83-38"><a id="__codelineno-83-38" name="__codelineno-83-38" href="#__codelineno-83-38"></a><span class="gp">    # </span>This<span class="w"> </span>section<span class="w"> </span>is<span class="w"> </span>only<span class="w"> </span>required<span class="w"> </span><span class="k">if</span><span class="w"> </span>TLS<span class="w"> </span>is<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>enabled<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>Ingress
</span><span id="__span-83-39"><a id="__codelineno-83-39" name="__codelineno-83-39" href="#__codelineno-83-39"></a><span class="go">    tls:</span>
</span><span id="__span-83-40"><a id="__codelineno-83-40" name="__codelineno-83-40" href="#__codelineno-83-40"></a><span class="go">      - hosts:</span>
</span><span id="__span-83-41"><a id="__codelineno-83-41" name="__codelineno-83-41" href="#__codelineno-83-41"></a><span class="go">        - www.example.com</span>
</span><span id="__span-83-42"><a id="__codelineno-83-42" name="__codelineno-83-42" href="#__codelineno-83-42"></a><span class="go">        secretName: example-tls</span>
</span><span id="__span-83-43"><a id="__codelineno-83-43" name="__codelineno-83-43" href="#__codelineno-83-43"></a>
</span><span id="__span-83-44"><a id="__codelineno-83-44" name="__codelineno-83-44" href="#__codelineno-83-44"></a><span class="go">If TLS is enabled for the Ingress, a Secret containing the certificate and key must also be provided:</span>
</span><span id="__span-83-45"><a id="__codelineno-83-45" name="__codelineno-83-45" href="#__codelineno-83-45"></a>
</span><span id="__span-83-46"><a id="__codelineno-83-46" name="__codelineno-83-46" href="#__codelineno-83-46"></a><span class="go">  apiVersion: v1</span>
</span><span id="__span-83-47"><a id="__codelineno-83-47" name="__codelineno-83-47" href="#__codelineno-83-47"></a><span class="go">  kind: Secret</span>
</span><span id="__span-83-48"><a id="__codelineno-83-48" name="__codelineno-83-48" href="#__codelineno-83-48"></a><span class="go">  metadata:</span>
</span><span id="__span-83-49"><a id="__codelineno-83-49" name="__codelineno-83-49" href="#__codelineno-83-49"></a><span class="go">    name: example-tls</span>
</span><span id="__span-83-50"><a id="__codelineno-83-50" name="__codelineno-83-50" href="#__codelineno-83-50"></a><span class="go">    namespace: foo</span>
</span><span id="__span-83-51"><a id="__codelineno-83-51" name="__codelineno-83-51" href="#__codelineno-83-51"></a><span class="go">  data:</span>
</span><span id="__span-83-52"><a id="__codelineno-83-52" name="__codelineno-83-52" href="#__codelineno-83-52"></a><span class="go">    tls.crt: &lt;base64 encoded cert&gt;</span>
</span><span id="__span-83-53"><a id="__codelineno-83-53" name="__codelineno-83-53" href="#__codelineno-83-53"></a><span class="go">    tls.key: &lt;base64 encoded key&gt;</span>
</span><span id="__span-83-54"><a id="__codelineno-83-54" name="__codelineno-83-54" href="#__codelineno-83-54"></a><span class="go">  type: kubernetes.io/tls</span>
</span></code></pre></div>
<p>After just half a minute the service is available on the <code>LoadBalancer</code> IP address:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>ingress-nginx
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="go">NAME                                           READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="go">pod/ingress-nginx-controller-b49d9c7b9-w26hb   1/1     Running   0          25s</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="go">NAME                                         TYPE           CLUSTER-IP      EXTERNAL-IP     PORT(S)                      AGE</span>
</span><span id="__span-84-6"><a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a><span class="go">service/ingress-nginx-controller             LoadBalancer   10.99.252.250   192.168.0.171   80:30278/TCP,443:30974/TCP   25s</span>
</span><span id="__span-84-7"><a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a><span class="go">service/ingress-nginx-controller-admission   ClusterIP      10.96.96.221    &lt;none&gt;          443/TCP                      25s</span>
</span><span id="__span-84-8"><a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a>
</span><span id="__span-84-9"><a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a><span class="go">NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-84-10"><a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="go">deployment.apps/ingress-nginx-controller   1/1     1            1           25s</span>
</span><span id="__span-84-11"><a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a>
</span><span id="__span-84-12"><a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a><span class="go">NAME                                                 DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-84-13"><a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a><span class="go">replicaset.apps/ingress-nginx-controller-b49d9c7b9   1         1         1       25</span>
</span></code></pre></div>
<p>The first virtual IP address is assigned to the <code>ingress-nginx-controller</code> service and
there is NGinx happily returning <code>404 Not found</code> <em>and</em> reachable from other hosts:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="gp">$ </span>curl<span class="w"> </span>-k<span class="w"> </span>https://192.168.0.171/
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="go">&lt;html&gt;</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="go">&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;</span>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="go">&lt;body&gt;</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="go">&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="go">&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="go">&lt;/body&gt;</span>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="go">&lt;/html&gt;</span>
</span></code></pre></div>
<h4 id="kubernetes-dashboard-ingress">Kubernetes Dashboard Ingress</h4>
<p>With both Ngnix and the Kubernetes dashboard up and running, it is now possible to make
the dashboard more conveniently accessible via Nginx. This <code>Ingress</code> is a slightly more
complete one based on the example above, </p>
<div class="language-yaml highlight"><span class="filename">dashboard/octavo-ingress.yaml</span><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-ingress</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/backend-protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-verify-client</span><span class="p">:</span><span class="w"> </span><span class="s">"false"</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/whitelist-source-range</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.244.0.0/16</span>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/configuration-snippet</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="w">      </span><span class="no">more_set_headers "server: hide";</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.octavo</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-86-20"><a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-86-21"><a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-86-22"><a id="__codelineno-86-22" name="__codelineno-86-22" href="#__codelineno-86-22"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-kong-proxy</span>
</span><span id="__span-86-23"><a id="__codelineno-86-23" name="__codelineno-86-23" href="#__codelineno-86-23"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-86-24"><a id="__codelineno-86-24" name="__codelineno-86-24" href="#__codelineno-86-24"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span></code></pre></div>
<p>This points to the <code>kubernetes-dashboard-kong-proxy</code> service which is the one listening
on the standard HTTPS port 443, and the one previously targeted by the
<code>kubectl port-forward</code> command above. After applying this <code>Ingress</code>, adding the
<code>Host: k8s.octavo</code> header will get the request correctly reach the dashboard:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>dashboard/octavo-ingress.yaml
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="go">ingress.networking.k8s.io/kubernetes-dashboard-ingress created</span>
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a><span class="gp">$ </span>curl<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="se">\</span>
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">"Host: k8s.octavo"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="w">  </span>-k<span class="w"> </span>https://192.168.0.171/<span class="w"> </span><span class="se">\</span>
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-2
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="go">&lt;!--</span>
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a><span class="go">Copyright 2017 The Kubernetes Authors.</span>
</span></code></pre></div>
<h4 id="cloudflare-ingress">Cloudflare Ingress</h4>
<p>Having a <a href="#cloudflare-tunnel">Cloudflare Tunnel</a> already setup with 
<a href="https://kubernetes-octavo.very-very-dark-gray.top/">https://kubernetes-octavo.very-very-dark-gray.top/</a> (pointing to <code>https://localhost</code>),
updating this to point to <code>https://192.168.0.171/</code> will make requests reach Nginx, and
updating the <code>host</code> value above to the <code>kubernetes-octavo.very-very-dark-gray.top</code>
makes the dashboard available at that address.</p>
<h4 id="tailscale-ingress">Tailscale Ingress</h4>
<p>To make the dashboard available over <a href="#tailscale">Tailscale</a>, start by installing the
<a href="../../../03/28/remote-access-options-for-self-hosted-services/#tailscale-kubernetes-operator">Tailscale Kubernetes operator</a>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="gp">$ </span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>tailscale<span class="w"> </span>https://pkgs.tailscale.com/helmcharts<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="w">  </span>helm<span class="w"> </span>repo<span class="w"> </span>update
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="go">"tailscale" has been added to your repositories</span>
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a><span class="go">Hang tight while we grab the latest from your chart repositories...</span>
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="go">...Successfully got an update from the "kubernetes-dashboard" chart repository</span>
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="go">...Successfully got an update from the "ingress-nginx" chart repository</span>
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="go">...Successfully got an update from the "tailscale" chart repository</span>
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a><span class="go">Update Complete. Happy Helming!</span>
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="gp">$ </span>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>tailscale
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="go">namespace/tailscale created</span>
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a>
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a><span class="gp">$ </span>kubectl<span class="w"> </span>label<span class="w"> </span>namespace<span class="w"> </span>tailscale<span class="w"> </span>pod-security.kubernetes.io/enforce<span class="o">=</span>privileged
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a><span class="go">namespace/tailscale labeled</span>
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>
</span><span id="__span-88-16"><a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a><span class="gp">$ </span>helm<span class="w"> </span>upgrade<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-17"><a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a><span class="w">  </span>--install<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-18"><a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a><span class="w">  </span>tailscale-operator<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-19"><a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a><span class="w">  </span>tailscale/tailscale-operator<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-20"><a id="__codelineno-88-20" name="__codelineno-88-20" href="#__codelineno-88-20"></a><span class="w">  </span>--namespace<span class="o">=</span>tailscale<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-21"><a id="__codelineno-88-21" name="__codelineno-88-21" href="#__codelineno-88-21"></a><span class="w">  </span>--create-namespace<span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-22"><a id="__codelineno-88-22" name="__codelineno-88-22" href="#__codelineno-88-22"></a><span class="w">  </span>--set-string<span class="w"> </span>oauth.clientId<span class="o">=</span><span class="s2">"_________________"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-23"><a id="__codelineno-88-23" name="__codelineno-88-23" href="#__codelineno-88-23"></a><span class="w">  </span>--set-string<span class="w"> </span>oauth.clientSecret<span class="o">=</span><span class="s2">"tskey-client-_________________-__________________________________"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-88-24"><a id="__codelineno-88-24" name="__codelineno-88-24" href="#__codelineno-88-24"></a><span class="w">  </span>--wait
</span><span id="__span-88-25"><a id="__codelineno-88-25" name="__codelineno-88-25" href="#__codelineno-88-25"></a><span class="go">Release "tailscale-operator" does not exist. Installing it now.</span>
</span><span id="__span-88-26"><a id="__codelineno-88-26" name="__codelineno-88-26" href="#__codelineno-88-26"></a><span class="go">NAME: tailscale-operator</span>
</span><span id="__span-88-27"><a id="__codelineno-88-27" name="__codelineno-88-27" href="#__codelineno-88-27"></a><span class="go">LAST DEPLOYED: Sat Apr 26 20:15:26 2025</span>
</span><span id="__span-88-28"><a id="__codelineno-88-28" name="__codelineno-88-28" href="#__codelineno-88-28"></a><span class="go">NAMESPACE: tailscale</span>
</span><span id="__span-88-29"><a id="__codelineno-88-29" name="__codelineno-88-29" href="#__codelineno-88-29"></a><span class="go">STATUS: deployed</span>
</span><span id="__span-88-30"><a id="__codelineno-88-30" name="__codelineno-88-30" href="#__codelineno-88-30"></a><span class="go">REVISION: 1</span>
</span><span id="__span-88-31"><a id="__codelineno-88-31" name="__codelineno-88-31" href="#__codelineno-88-31"></a><span class="go">TEST SUITE: None</span>
</span><span id="__span-88-32"><a id="__codelineno-88-32" name="__codelineno-88-32" href="#__codelineno-88-32"></a>
</span><span id="__span-88-33"><a id="__codelineno-88-33" name="__codelineno-88-33" href="#__codelineno-88-33"></a><span class="gp">$ </span>sudo<span class="w"> </span>tailscale<span class="w"> </span>cert<span class="w"> </span>octavo.royal-penny.ts.net
</span><span id="__span-88-34"><a id="__codelineno-88-34" name="__codelineno-88-34" href="#__codelineno-88-34"></a><span class="go">Wrote public cert to octavo.royal-penny.ts.net.crt</span>
</span><span id="__span-88-35"><a id="__codelineno-88-35" name="__codelineno-88-35" href="#__codelineno-88-35"></a><span class="go">Wrote private key to octavo.royal-penny.ts.net.key</span>
</span></code></pre></div>
<p>Using the Tailscale Ingress Controller, it is now possible to make the dashboard available at https://kubernetes-octavo.royal-penny.ts.net by adding a new <code>Ingress</code>
(<em>with its own unique <code>metadata.name</code></em>) in <code>octavo-ingress.yaml</code>:</p>
<div class="language-yaml highlight"><span class="filename">dashboard/octavo-ingress.yaml</span><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-89-4"><a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-ingress</span>
</span><span id="__span-89-5"><a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-89-6"><a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-89-7"><a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/backend-protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS</span>
</span><span id="__span-89-8"><a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-verify-client</span><span class="p">:</span><span class="w"> </span><span class="s">"false"</span>
</span><span id="__span-89-9"><a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/whitelist-source-range</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.244.0.0/16</span>
</span><span id="__span-89-10"><a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/configuration-snippet</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-89-11"><a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="w">      </span><span class="no">more_set_headers "server: hide";</span>
</span><span id="__span-89-12"><a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-89-13"><a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-89-14"><a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-89-15"><a id="__codelineno-89-15" name="__codelineno-89-15" href="#__codelineno-89-15"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-octavo.very-very-dark-gray.top</span>
</span></span><span id="__span-89-16"><a id="__codelineno-89-16" name="__codelineno-89-16" href="#__codelineno-89-16"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-89-17"><a id="__codelineno-89-17" name="__codelineno-89-17" href="#__codelineno-89-17"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-89-18"><a id="__codelineno-89-18" name="__codelineno-89-18" href="#__codelineno-89-18"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-89-19"><a id="__codelineno-89-19" name="__codelineno-89-19" href="#__codelineno-89-19"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-89-20"><a id="__codelineno-89-20" name="__codelineno-89-20" href="#__codelineno-89-20"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-89-21"><a id="__codelineno-89-21" name="__codelineno-89-21" href="#__codelineno-89-21"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-89-22"><a id="__codelineno-89-22" name="__codelineno-89-22" href="#__codelineno-89-22"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-kong-proxy</span>
</span><span id="__span-89-23"><a id="__codelineno-89-23" name="__codelineno-89-23" href="#__codelineno-89-23"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-89-24"><a id="__codelineno-89-24" name="__codelineno-89-24" href="#__codelineno-89-24"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span><span id="__span-89-25"><a id="__codelineno-89-25" name="__codelineno-89-25" href="#__codelineno-89-25"></a><span class="nn">---</span>
</span><span id="__span-89-26"><a id="__codelineno-89-26" name="__codelineno-89-26" href="#__codelineno-89-26"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-89-27"><a id="__codelineno-89-27" name="__codelineno-89-27" href="#__codelineno-89-27"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-89-28"><a id="__codelineno-89-28" name="__codelineno-89-28" href="#__codelineno-89-28"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-89-29"><a id="__codelineno-89-29" name="__codelineno-89-29" href="#__codelineno-89-29"></a><span class="hll"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-ingress-tailscale</span>
</span></span><span id="__span-89-30"><a id="__codelineno-89-30" name="__codelineno-89-30" href="#__codelineno-89-30"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-89-31"><a id="__codelineno-89-31" name="__codelineno-89-31" href="#__codelineno-89-31"></a><span class="hll"><span class="nt">spec</span><span class="p">:</span>
</span></span><span id="__span-89-32"><a id="__codelineno-89-32" name="__codelineno-89-32" href="#__codelineno-89-32"></a><span class="hll"><span class="w">  </span><span class="nt">defaultBackend</span><span class="p">:</span>
</span></span><span id="__span-89-33"><a id="__codelineno-89-33" name="__codelineno-89-33" href="#__codelineno-89-33"></a><span class="hll"><span class="w">    </span><span class="nt">service</span><span class="p">:</span>
</span></span><span id="__span-89-34"><a id="__codelineno-89-34" name="__codelineno-89-34" href="#__codelineno-89-34"></a><span class="hll"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-kong-proxy</span>
</span></span><span id="__span-89-35"><a id="__codelineno-89-35" name="__codelineno-89-35" href="#__codelineno-89-35"></a><span class="hll"><span class="w">      </span><span class="nt">port</span><span class="p">:</span>
</span></span><span id="__span-89-36"><a id="__codelineno-89-36" name="__codelineno-89-36" href="#__codelineno-89-36"></a><span class="hll"><span class="w">        </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span></span><span id="__span-89-37"><a id="__codelineno-89-37" name="__codelineno-89-37" href="#__codelineno-89-37"></a><span class="hll"><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tailscale</span>
</span></span><span id="__span-89-38"><a id="__codelineno-89-38" name="__codelineno-89-38" href="#__codelineno-89-38"></a><span class="hll"><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span></span><span id="__span-89-39"><a id="__codelineno-89-39" name="__codelineno-89-39" href="#__codelineno-89-39"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
</span></span><span id="__span-89-40"><a id="__codelineno-89-40" name="__codelineno-89-40" href="#__codelineno-89-40"></a><span class="hll"><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-octavo</span>
</span></span></code></pre></div>
<div class="language-console highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>dashboard/octavo-ingress.yaml
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="go">ingress.networking.k8s.io/kubernetes-dashboard-ingress unchanged</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="go">ingress.networking.k8s.io/kubernetes-dashboard-ingress-tailscale created</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ingress<span class="w"> </span>-A
</span><span id="__span-90-6"><a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="go">NAMESPACE              NAME                                     CLASS       HOSTS                                       ADDRESS                                PORTS     AGE</span>
</span><span id="__span-90-7"><a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a><span class="go">kubernetes-dashboard   kubernetes-dashboard-ingress             nginx       kubernetes-octavo.very-very-dark-gray.top   192.168.0.171                          80        39m</span>
</span><span id="__span-90-8"><a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="go">kubernetes-dashboard   kubernetes-dashboard-ingress-tailscale   tailscale   *                                           kubernetes-octavo.royal-penny.ts.net   80, 443   31s</span>
</span></code></pre></div>
<p>After <em>some time</em> the dashboard is available also at
<a href="https://kubernetes-octavo.royal-penny.ts.net/">https://kubernetes-octavo.royal-penny.ts.net/</a>.</p>
<h3 id="https-certificates">HTTPS certificates</h3>
<p>The Kubernetes dashboard uses a self-signed certificate, and so does Nginx by default,
which works in so far as encrypting traffic, but provides no guarantee that the traffic
is coming from the actual servers and is just very annoying when browsers complain
every time accessing the service. It is now time to get properly signed HTTPS
certificates. <em>This is the way</em>.</p>
<h4 id="install-cert-manager">Install <code>cert-manager</code></h4>
<p><a href="https://cert-manager.io/">cert-manager</a>
is the native Kubernetes certificate management controller of choice to issue certificates from Let's Encrypt to
<a href="https://cert-manager.io/docs/tutorials/acme/nginx-ingress/">secure NGINX-ingress</a>.</p>
<p>Having already installed Helm (3.17), deployed the NGINX
<a href="#ingress-controller">Ingress Controller</a>,
assigned <code>octavo.uu.am</code> to the router's external IP address, and deployed the
<a href="#kubernets-dashboard">Kubernetes dashboard</a>
service, the system is ready for
<a href="https://cert-manager.io/docs/tutorials/acme/nginx-ingress/#step-5---deploy-cert-manager">Step 5 - Deploy cert-manager</a>,
starting with the
<a href="https://cert-manager.io/docs/installation/helm/">installation with Helm</a>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="gp">$ </span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>jetstack<span class="w"> </span>https://charts.jetstack.io<span class="w"> </span>--force-update
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="go">"jetstack" has been added to your repositories</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a>
</span><span id="__span-91-4"><a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a><span class="gp">$ </span>helm<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
</span><span id="__span-91-5"><a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="w">    </span>cert-manager<span class="w"> </span>jetstack/cert-manager<span class="w"> </span><span class="se">\</span>
</span><span id="__span-91-6"><a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">    </span>--namespace<span class="w"> </span>cert-manager<span class="w"> </span><span class="se">\</span>
</span><span id="__span-91-7"><a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="w">    </span>--create-namespace<span class="w"> </span><span class="se">\</span>
</span><span id="__span-91-8"><a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a><span class="w">    </span>--version<span class="w"> </span>v1.17.2<span class="w"> </span><span class="se">\</span>
</span><span id="__span-91-9"><a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="w">    </span>--set<span class="w"> </span>crds.enabled<span class="o">=</span><span class="nb">true</span>
</span><span id="__span-91-10"><a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="go">NAME: cert-manager</span>
</span><span id="__span-91-11"><a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="go">LAST DEPLOYED: Sat Apr 26 21:05:57 2025</span>
</span><span id="__span-91-12"><a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="go">NAMESPACE: cert-manager</span>
</span><span id="__span-91-13"><a id="__codelineno-91-13" name="__codelineno-91-13" href="#__codelineno-91-13"></a><span class="go">STATUS: deployed</span>
</span><span id="__span-91-14"><a id="__codelineno-91-14" name="__codelineno-91-14" href="#__codelineno-91-14"></a><span class="go">REVISION: 1</span>
</span><span id="__span-91-15"><a id="__codelineno-91-15" name="__codelineno-91-15" href="#__codelineno-91-15"></a><span class="go">TEST SUITE: None</span>
</span><span id="__span-91-16"><a id="__codelineno-91-16" name="__codelineno-91-16" href="#__codelineno-91-16"></a><span class="go">NOTES:</span>
</span><span id="__span-91-17"><a id="__codelineno-91-17" name="__codelineno-91-17" href="#__codelineno-91-17"></a><span class="go">cert-manager v1.17.2 has been deployed successfully!</span>
</span><span id="__span-91-18"><a id="__codelineno-91-18" name="__codelineno-91-18" href="#__codelineno-91-18"></a>
</span><span id="__span-91-19"><a id="__codelineno-91-19" name="__codelineno-91-19" href="#__codelineno-91-19"></a><span class="go">In order to begin issuing certificates, you will need to set up a ClusterIssuer</span>
</span><span id="__span-91-20"><a id="__codelineno-91-20" name="__codelineno-91-20" href="#__codelineno-91-20"></a><span class="go">or Issuer resource (for example, by creating a 'letsencrypt-staging' issuer).</span>
</span><span id="__span-91-21"><a id="__codelineno-91-21" name="__codelineno-91-21" href="#__codelineno-91-21"></a>
</span><span id="__span-91-22"><a id="__codelineno-91-22" name="__codelineno-91-22" href="#__codelineno-91-22"></a><span class="go">More information on the different types of issuers and how to configure them</span>
</span><span id="__span-91-23"><a id="__codelineno-91-23" name="__codelineno-91-23" href="#__codelineno-91-23"></a><span class="go">can be found in our documentation:</span>
</span><span id="__span-91-24"><a id="__codelineno-91-24" name="__codelineno-91-24" href="#__codelineno-91-24"></a>
</span><span id="__span-91-25"><a id="__codelineno-91-25" name="__codelineno-91-25" href="#__codelineno-91-25"></a><span class="go">https://cert-manager.io/docs/configuration/</span>
</span><span id="__span-91-26"><a id="__codelineno-91-26" name="__codelineno-91-26" href="#__codelineno-91-26"></a>
</span><span id="__span-91-27"><a id="__codelineno-91-27" name="__codelineno-91-27" href="#__codelineno-91-27"></a><span class="go">For information on how to configure cert-manager to automatically provision</span>
</span><span id="__span-91-28"><a id="__codelineno-91-28" name="__codelineno-91-28" href="#__codelineno-91-28"></a><span class="go">Certificates for Ingress resources, take a look at the `ingress-shim`</span>
</span><span id="__span-91-29"><a id="__codelineno-91-29" name="__codelineno-91-29" href="#__codelineno-91-29"></a><span class="go">documentation:</span>
</span><span id="__span-91-30"><a id="__codelineno-91-30" name="__codelineno-91-30" href="#__codelineno-91-30"></a>
</span><span id="__span-91-31"><a id="__codelineno-91-31" name="__codelineno-91-31" href="#__codelineno-91-31"></a><span class="go">https://cert-manager.io/docs/usage/ingress/</span>
</span></code></pre></div>
<p>The <code>helm install</code> command takes several seconds to come back with the above output,
at which point the pods and services are all up and running:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>cert-manager
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="go">NAME                                           READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="go">pod/cert-manager-7d67448f59-c2fgn              1/1     Running   0          102s</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="go">pod/cert-manager-cainjector-666b8b6b66-fl6rp   1/1     Running   0          102s</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="go">pod/cert-manager-webhook-78cb4cf989-wb4wz      1/1     Running   0          102s</span>
</span><span id="__span-92-6"><a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a>
</span><span id="__span-92-7"><a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a><span class="go">NAME                              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)            AGE</span>
</span><span id="__span-92-8"><a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="go">service/cert-manager              ClusterIP   10.103.213.89   &lt;none&gt;        9402/TCP           102s</span>
</span><span id="__span-92-9"><a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="go">service/cert-manager-cainjector   ClusterIP   10.108.222.22   &lt;none&gt;        9402/TCP           102s</span>
</span><span id="__span-92-10"><a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a><span class="go">service/cert-manager-webhook      ClusterIP   10.108.56.97    &lt;none&gt;        443/TCP,9402/TCP   102s</span>
</span><span id="__span-92-11"><a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a>
</span><span id="__span-92-12"><a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a><span class="go">NAME                                      READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-92-13"><a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a><span class="go">deployment.apps/cert-manager              1/1     1            1           102s</span>
</span><span id="__span-92-14"><a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a><span class="go">deployment.apps/cert-manager-cainjector   1/1     1            1           102s</span>
</span><span id="__span-92-15"><a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a><span class="go">deployment.apps/cert-manager-webhook      1/1     1            1           102s</span>
</span><span id="__span-92-16"><a id="__codelineno-92-16" name="__codelineno-92-16" href="#__codelineno-92-16"></a>
</span><span id="__span-92-17"><a id="__codelineno-92-17" name="__codelineno-92-17" href="#__codelineno-92-17"></a><span class="go">NAME                                                 DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-92-18"><a id="__codelineno-92-18" name="__codelineno-92-18" href="#__codelineno-92-18"></a><span class="go">replicaset.apps/cert-manager-7d67448f59              1         1         1       102s</span>
</span><span id="__span-92-19"><a id="__codelineno-92-19" name="__codelineno-92-19" href="#__codelineno-92-19"></a><span class="go">replicaset.apps/cert-manager-cainjector-666b8b6b66   1         1         1       102s</span>
</span><span id="__span-92-20"><a id="__codelineno-92-20" name="__codelineno-92-20" href="#__codelineno-92-20"></a><span class="go">replicaset.apps/cert-manager-webhook-78cb4cf989      1         1         1       102s</span>
</span></code></pre></div>
<h4 id="test-cert-manager">Test <code>cert-manager</code></h4>
<p><a href="https://cert-manager.io/docs/installation/kubectl/#2-optional-end-to-end-verify-the-installation">Verify the installation</a>
by creating a simple self-signed certificate:</p>
<details class="k8s">
<summary>Test certificate: <code>test-resources.yaml</code></summary>
<div class="language-yaml highlight"><span class="filename">test-resources.yaml</span><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id="__span-93-3"><a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-93-4"><a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager-test</span>
</span><span id="__span-93-5"><a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="nn">---</span>
</span><span id="__span-93-6"><a id="__codelineno-93-6" name="__codelineno-93-6" href="#__codelineno-93-6"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
</span><span id="__span-93-7"><a id="__codelineno-93-7" name="__codelineno-93-7" href="#__codelineno-93-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Issuer</span>
</span><span id="__span-93-8"><a id="__codelineno-93-8" name="__codelineno-93-8" href="#__codelineno-93-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-93-9"><a id="__codelineno-93-9" name="__codelineno-93-9" href="#__codelineno-93-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-selfsigned</span>
</span><span id="__span-93-10"><a id="__codelineno-93-10" name="__codelineno-93-10" href="#__codelineno-93-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager-test</span>
</span><span id="__span-93-11"><a id="__codelineno-93-11" name="__codelineno-93-11" href="#__codelineno-93-11"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-93-12"><a id="__codelineno-93-12" name="__codelineno-93-12" href="#__codelineno-93-12"></a><span class="w">  </span><span class="nt">selfSigned</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-93-13"><a id="__codelineno-93-13" name="__codelineno-93-13" href="#__codelineno-93-13"></a><span class="nn">---</span>
</span><span id="__span-93-14"><a id="__codelineno-93-14" name="__codelineno-93-14" href="#__codelineno-93-14"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
</span><span id="__span-93-15"><a id="__codelineno-93-15" name="__codelineno-93-15" href="#__codelineno-93-15"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Certificate</span>
</span><span id="__span-93-16"><a id="__codelineno-93-16" name="__codelineno-93-16" href="#__codelineno-93-16"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-93-17"><a id="__codelineno-93-17" name="__codelineno-93-17" href="#__codelineno-93-17"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">selfsigned-cert</span>
</span><span id="__span-93-18"><a id="__codelineno-93-18" name="__codelineno-93-18" href="#__codelineno-93-18"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager-test</span>
</span><span id="__span-93-19"><a id="__codelineno-93-19" name="__codelineno-93-19" href="#__codelineno-93-19"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-93-20"><a id="__codelineno-93-20" name="__codelineno-93-20" href="#__codelineno-93-20"></a><span class="w">  </span><span class="nt">dnsNames</span><span class="p">:</span>
</span><span id="__span-93-21"><a id="__codelineno-93-21" name="__codelineno-93-21" href="#__codelineno-93-21"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">example.com</span>
</span><span id="__span-93-22"><a id="__codelineno-93-22" name="__codelineno-93-22" href="#__codelineno-93-22"></a><span class="w">  </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">selfsigned-cert-tls</span>
</span><span id="__span-93-23"><a id="__codelineno-93-23" name="__codelineno-93-23" href="#__codelineno-93-23"></a><span class="w">  </span><span class="nt">issuerRef</span><span class="p">:</span>
</span><span id="__span-93-24"><a id="__codelineno-93-24" name="__codelineno-93-24" href="#__codelineno-93-24"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test-selfsigned</span>
</span></code></pre></div>
</details>
<p>Deploying this succeeds withing seconds, after which it can be cleaned up:</p>
<details class="terminal">
<summary><code>kubectl apply -f test-resources.yaml</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>test-resources.yaml
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="go">namespace/cert-manager-test created</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="go">issuer.cert-manager.io/test-selfsigned created</span>
</span><span id="__span-94-4"><a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="go">certificate.cert-manager.io/selfsigned-cert created</span>
</span><span id="__span-94-5"><a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a>
</span><span id="__span-94-6"><a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>certificate<span class="w"> </span>-n<span class="w"> </span>cert-manager-test
</span><span id="__span-94-7"><a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="go">Name:         selfsigned-cert</span>
</span><span id="__span-94-8"><a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a><span class="go">Namespace:    cert-manager-test</span>
</span><span id="__span-94-9"><a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a><span class="go">Labels:       &lt;none&gt;</span>
</span><span id="__span-94-10"><a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a><span class="go">Annotations:  &lt;none&gt;</span>
</span><span id="__span-94-11"><a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a><span class="go">API Version:  cert-manager.io/v1</span>
</span><span id="__span-94-12"><a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a><span class="go">Kind:         Certificate</span>
</span><span id="__span-94-13"><a id="__codelineno-94-13" name="__codelineno-94-13" href="#__codelineno-94-13"></a><span class="go">Metadata:</span>
</span><span id="__span-94-14"><a id="__codelineno-94-14" name="__codelineno-94-14" href="#__codelineno-94-14"></a><span class="go">  Creation Timestamp:  2025-04-26T19:11:05Z</span>
</span><span id="__span-94-15"><a id="__codelineno-94-15" name="__codelineno-94-15" href="#__codelineno-94-15"></a><span class="go">  Generation:          1</span>
</span><span id="__span-94-16"><a id="__codelineno-94-16" name="__codelineno-94-16" href="#__codelineno-94-16"></a><span class="go">  Resource Version:    21857</span>
</span><span id="__span-94-17"><a id="__codelineno-94-17" name="__codelineno-94-17" href="#__codelineno-94-17"></a><span class="go">  UID:                 e16b3f4e-494b-4866-b328-bb92759fd482</span>
</span><span id="__span-94-18"><a id="__codelineno-94-18" name="__codelineno-94-18" href="#__codelineno-94-18"></a><span class="go">Spec:</span>
</span><span id="__span-94-19"><a id="__codelineno-94-19" name="__codelineno-94-19" href="#__codelineno-94-19"></a><span class="go">  Dns Names:</span>
</span><span id="__span-94-20"><a id="__codelineno-94-20" name="__codelineno-94-20" href="#__codelineno-94-20"></a><span class="go">    example.com</span>
</span><span id="__span-94-21"><a id="__codelineno-94-21" name="__codelineno-94-21" href="#__codelineno-94-21"></a><span class="go">  Issuer Ref:</span>
</span><span id="__span-94-22"><a id="__codelineno-94-22" name="__codelineno-94-22" href="#__codelineno-94-22"></a><span class="go">    Name:       test-selfsigned</span>
</span><span id="__span-94-23"><a id="__codelineno-94-23" name="__codelineno-94-23" href="#__codelineno-94-23"></a><span class="go">  Secret Name:  selfsigned-cert-tls</span>
</span><span id="__span-94-24"><a id="__codelineno-94-24" name="__codelineno-94-24" href="#__codelineno-94-24"></a><span class="go">Status:</span>
</span><span id="__span-94-25"><a id="__codelineno-94-25" name="__codelineno-94-25" href="#__codelineno-94-25"></a><span class="go">  Conditions:</span>
</span><span id="__span-94-26"><a id="__codelineno-94-26" name="__codelineno-94-26" href="#__codelineno-94-26"></a><span class="go">    Last Transition Time:  2025-04-26T19:11:05Z</span>
</span><span id="__span-94-27"><a id="__codelineno-94-27" name="__codelineno-94-27" href="#__codelineno-94-27"></a><span class="go">    Message:               Certificate is up to date and has not expired</span>
</span><span id="__span-94-28"><a id="__codelineno-94-28" name="__codelineno-94-28" href="#__codelineno-94-28"></a><span class="go">    Observed Generation:   1</span>
</span><span id="__span-94-29"><a id="__codelineno-94-29" name="__codelineno-94-29" href="#__codelineno-94-29"></a><span class="go">    Reason:                Ready</span>
</span><span id="__span-94-30"><a id="__codelineno-94-30" name="__codelineno-94-30" href="#__codelineno-94-30"></a><span class="go">    Status:                True</span>
</span><span id="__span-94-31"><a id="__codelineno-94-31" name="__codelineno-94-31" href="#__codelineno-94-31"></a><span class="go">    Type:                  Ready</span>
</span><span id="__span-94-32"><a id="__codelineno-94-32" name="__codelineno-94-32" href="#__codelineno-94-32"></a><span class="go">  Not After:               2025-07-25T19:11:05Z</span>
</span><span id="__span-94-33"><a id="__codelineno-94-33" name="__codelineno-94-33" href="#__codelineno-94-33"></a><span class="go">  Not Before:              2025-04-26T19:11:05Z</span>
</span><span id="__span-94-34"><a id="__codelineno-94-34" name="__codelineno-94-34" href="#__codelineno-94-34"></a><span class="go">  Renewal Time:            2025-06-25T19:11:05Z</span>
</span><span id="__span-94-35"><a id="__codelineno-94-35" name="__codelineno-94-35" href="#__codelineno-94-35"></a><span class="go">  Revision:                1</span>
</span><span id="__span-94-36"><a id="__codelineno-94-36" name="__codelineno-94-36" href="#__codelineno-94-36"></a><span class="go">Events:</span>
</span><span id="__span-94-37"><a id="__codelineno-94-37" name="__codelineno-94-37" href="#__codelineno-94-37"></a><span class="go">  Type    Reason     Age   From                                       Message</span>
</span><span id="__span-94-38"><a id="__codelineno-94-38" name="__codelineno-94-38" href="#__codelineno-94-38"></a><span class="go">  ----    ------     ----  ----                                       -------</span>
</span><span id="__span-94-39"><a id="__codelineno-94-39" name="__codelineno-94-39" href="#__codelineno-94-39"></a><span class="go">  Normal  Issuing    8s    cert-manager-certificates-trigger          Issuing certificate as Secret does not exist</span>
</span><span id="__span-94-40"><a id="__codelineno-94-40" name="__codelineno-94-40" href="#__codelineno-94-40"></a><span class="go">  Normal  Generated  8s    cert-manager-certificates-key-manager      Stored new private key in temporary Secret resource "selfsigned-cert-fzsgh"</span>
</span><span id="__span-94-41"><a id="__codelineno-94-41" name="__codelineno-94-41" href="#__codelineno-94-41"></a><span class="go">  Normal  Requested  8s    cert-manager-certificates-request-manager  Created new CertificateRequest resource "selfsigned-cert-1"</span>
</span><span id="__span-94-42"><a id="__codelineno-94-42" name="__codelineno-94-42" href="#__codelineno-94-42"></a><span class="hll"><span class="go">  Normal  Issuing    8s    cert-manager-certificates-issuing          The certificate has been successfully issued</span>
</span></span></code></pre></div>
</details>
<h4 id="configure-lets-encrypt">Configure Let's Encrypt</h4>
<p><a href="https://cert-manager.io/docs/tutorials/acme/nginx-ingress/#step-6---configure-a-lets-encrypt-issuer">Step 6 - Configure a Let's Encrypt Issuer</a>
shows how to create an <code>Issuer</code>, but in this system with multiple services running in
different namespaces, a <code>ClusterIssuer</code> is needed instead:</p>
<div class="language-yaml highlight"><span class="filename">cert-manager-issuer.yaml</span><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cert-manager.io/v1</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIssuer</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-95-6"><a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="w">  </span><span class="nt">acme</span><span class="p">:</span>
</span><span id="__span-95-7"><a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://acme-v02.api.letsencrypt.org/directory</span>
</span><span id="__span-95-8"><a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="w">    </span><span class="nt">email</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">stibbons@uu.am</span>
</span><span id="__span-95-9"><a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a><span class="w">    </span><span class="nt">privateKeySecretRef</span><span class="p">:</span>
</span><span id="__span-95-10"><a id="__codelineno-95-10" name="__codelineno-95-10" href="#__codelineno-95-10"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-95-11"><a id="__codelineno-95-11" name="__codelineno-95-11" href="#__codelineno-95-11"></a><span class="w">    </span><span class="nt">solvers</span><span class="p">:</span>
</span><span id="__span-95-12"><a id="__codelineno-95-12" name="__codelineno-95-12" href="#__codelineno-95-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">http01</span><span class="p">:</span>
</span><span id="__span-95-13"><a id="__codelineno-95-13" name="__codelineno-95-13" href="#__codelineno-95-13"></a><span class="w">          </span><span class="nt">ingress</span><span class="p">:</span>
</span><span id="__span-95-14"><a id="__codelineno-95-14" name="__codelineno-95-14" href="#__codelineno-95-14"></a><span class="w">            </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span></code></pre></div>
<div class="language-console highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>cert-manager-issuer.yaml
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="go">clusterissuer.cert-manager.io/letsencrypt-prod created</span>
</span><span id="__span-96-3"><a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a>
</span><span id="__span-96-4"><a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>clusterissuer.cert-manager.io/letsencrypt-prod
</span><span id="__span-96-5"><a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="go">Name:         letsencrypt-prod</span>
</span><span id="__span-96-6"><a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="go">Namespace:    </span>
</span><span id="__span-96-7"><a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="go">Labels:       &lt;none&gt;</span>
</span><span id="__span-96-8"><a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a><span class="go">Annotations:  &lt;none&gt;</span>
</span><span id="__span-96-9"><a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="go">API Version:  cert-manager.io/v1</span>
</span><span id="__span-96-10"><a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="go">Kind:         ClusterIssuer</span>
</span><span id="__span-96-11"><a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a><span class="go">Metadata:</span>
</span><span id="__span-96-12"><a id="__codelineno-96-12" name="__codelineno-96-12" href="#__codelineno-96-12"></a><span class="go">  Creation Timestamp:  2025-04-26T19:18:14Z</span>
</span><span id="__span-96-13"><a id="__codelineno-96-13" name="__codelineno-96-13" href="#__codelineno-96-13"></a><span class="go">  Generation:          1</span>
</span><span id="__span-96-14"><a id="__codelineno-96-14" name="__codelineno-96-14" href="#__codelineno-96-14"></a><span class="go">  Resource Version:    22532</span>
</span><span id="__span-96-15"><a id="__codelineno-96-15" name="__codelineno-96-15" href="#__codelineno-96-15"></a><span class="go">  UID:                 c7063ffb-d530-4f72-8b0a-7f323b39c593</span>
</span><span id="__span-96-16"><a id="__codelineno-96-16" name="__codelineno-96-16" href="#__codelineno-96-16"></a><span class="go">Spec:</span>
</span><span id="__span-96-17"><a id="__codelineno-96-17" name="__codelineno-96-17" href="#__codelineno-96-17"></a><span class="go">  Acme:</span>
</span><span id="__span-96-18"><a id="__codelineno-96-18" name="__codelineno-96-18" href="#__codelineno-96-18"></a><span class="go">    Email:  stibbons@uu.am</span>
</span><span id="__span-96-19"><a id="__codelineno-96-19" name="__codelineno-96-19" href="#__codelineno-96-19"></a><span class="go">    Private Key Secret Ref:</span>
</span><span id="__span-96-20"><a id="__codelineno-96-20" name="__codelineno-96-20" href="#__codelineno-96-20"></a><span class="go">      Name:  letsencrypt-prod</span>
</span><span id="__span-96-21"><a id="__codelineno-96-21" name="__codelineno-96-21" href="#__codelineno-96-21"></a><span class="go">    Server:  https://acme-v02.api.letsencrypt.org/directory</span>
</span><span id="__span-96-22"><a id="__codelineno-96-22" name="__codelineno-96-22" href="#__codelineno-96-22"></a><span class="go">    Solvers:</span>
</span><span id="__span-96-23"><a id="__codelineno-96-23" name="__codelineno-96-23" href="#__codelineno-96-23"></a><span class="go">      http01:</span>
</span><span id="__span-96-24"><a id="__codelineno-96-24" name="__codelineno-96-24" href="#__codelineno-96-24"></a><span class="go">        Ingress:</span>
</span><span id="__span-96-25"><a id="__codelineno-96-25" name="__codelineno-96-25" href="#__codelineno-96-25"></a><span class="go">          Class:  nginx</span>
</span><span id="__span-96-26"><a id="__codelineno-96-26" name="__codelineno-96-26" href="#__codelineno-96-26"></a><span class="go">Status:</span>
</span><span id="__span-96-27"><a id="__codelineno-96-27" name="__codelineno-96-27" href="#__codelineno-96-27"></a><span class="go">  Acme:</span>
</span><span id="__span-96-28"><a id="__codelineno-96-28" name="__codelineno-96-28" href="#__codelineno-96-28"></a><span class="go">    Last Private Key Hash:  Qb3v8RLD0ixqgBLKVsI/tEgX16kauzYTQXAaC3pdqCE=</span>
</span><span id="__span-96-29"><a id="__codelineno-96-29" name="__codelineno-96-29" href="#__codelineno-96-29"></a><span class="go">    Last Registered Email:  stibbons@uu.am</span>
</span><span id="__span-96-30"><a id="__codelineno-96-30" name="__codelineno-96-30" href="#__codelineno-96-30"></a><span class="go">    Uri:                    https://acme-v02.api.letsencrypt.org/acme/acct/2364237637</span>
</span><span id="__span-96-31"><a id="__codelineno-96-31" name="__codelineno-96-31" href="#__codelineno-96-31"></a><span class="go">  Conditions:</span>
</span><span id="__span-96-32"><a id="__codelineno-96-32" name="__codelineno-96-32" href="#__codelineno-96-32"></a><span class="go">    Last Transition Time:  2025-04-26T19:18:15Z</span>
</span><span id="__span-96-33"><a id="__codelineno-96-33" name="__codelineno-96-33" href="#__codelineno-96-33"></a><span class="go">    Message:               The ACME account was registered with the ACME server</span>
</span><span id="__span-96-34"><a id="__codelineno-96-34" name="__codelineno-96-34" href="#__codelineno-96-34"></a><span class="go">    Observed Generation:   1</span>
</span><span id="__span-96-35"><a id="__codelineno-96-35" name="__codelineno-96-35" href="#__codelineno-96-35"></a><span class="go">    Reason:                ACMEAccountRegistered</span>
</span><span id="__span-96-36"><a id="__codelineno-96-36" name="__codelineno-96-36" href="#__codelineno-96-36"></a><span class="go">    Status:                True</span>
</span><span id="__span-96-37"><a id="__codelineno-96-37" name="__codelineno-96-37" href="#__codelineno-96-37"></a><span class="go">    Type:                  Ready</span>
</span><span id="__span-96-38"><a id="__codelineno-96-38" name="__codelineno-96-38" href="#__codelineno-96-38"></a><span class="go">Events:                    &lt;none&gt;</span>
</span></code></pre></div>
<h4 id="end-to-end-test-lets-encrypt">End-to-end test Let's Encrypt</h4>
<p><a href="https://cert-manager.io/docs/tutorials/acme/nginx-ingress/#step-7---deploy-a-tls-ingress-resource">Step 7 - Deploy a TLS Ingress Resource</a>
is the last step left to actually make pratical use of all the above. Based on the
provided example, apply the equivalent changes to <code>dashboard/nginx-ingress.yaml</code>,
using <code>cert-manager.io/cluster-issuer</code> instead of <code>cert-manager.io/issuer</code> and adding
the <code>tls</code> section with just the relevant FQDN under <code>hosts</code>:</p>
<div class="language-yaml highlight"><span class="filename">dashboard/nginx-ingress.yaml</span><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-ingress</span>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="hll"><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span></span><span id="__span-97-8"><a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/backend-protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS</span>
</span><span id="__span-97-9"><a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-verify-client</span><span class="p">:</span><span class="w"> </span><span class="s">"false"</span>
</span><span id="__span-97-10"><a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/whitelist-source-range</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.244.0.0/16</span>
</span><span id="__span-97-11"><a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/configuration-snippet</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-97-12"><a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a><span class="w">      </span><span class="no">more_set_headers "server: hide";</span>
</span><span id="__span-97-13"><a id="__codelineno-97-13" name="__codelineno-97-13" href="#__codelineno-97-13"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-97-14"><a id="__codelineno-97-14" name="__codelineno-97-14" href="#__codelineno-97-14"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-97-15"><a id="__codelineno-97-15" name="__codelineno-97-15" href="#__codelineno-97-15"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-97-16"><a id="__codelineno-97-16" name="__codelineno-97-16" href="#__codelineno-97-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-octavo.very-very-dark-gray.top</span>
</span><span id="__span-97-17"><a id="__codelineno-97-17" name="__codelineno-97-17" href="#__codelineno-97-17"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-97-18"><a id="__codelineno-97-18" name="__codelineno-97-18" href="#__codelineno-97-18"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-97-19"><a id="__codelineno-97-19" name="__codelineno-97-19" href="#__codelineno-97-19"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-97-20"><a id="__codelineno-97-20" name="__codelineno-97-20" href="#__codelineno-97-20"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-97-21"><a id="__codelineno-97-21" name="__codelineno-97-21" href="#__codelineno-97-21"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-97-22"><a id="__codelineno-97-22" name="__codelineno-97-22" href="#__codelineno-97-22"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-97-23"><a id="__codelineno-97-23" name="__codelineno-97-23" href="#__codelineno-97-23"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-kong-proxy</span>
</span><span id="__span-97-24"><a id="__codelineno-97-24" name="__codelineno-97-24" href="#__codelineno-97-24"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-97-25"><a id="__codelineno-97-25" name="__codelineno-97-25" href="#__codelineno-97-25"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span><span id="__span-97-26"><a id="__codelineno-97-26" name="__codelineno-97-26" href="#__codelineno-97-26"></a><span class="hll"><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span></span><span id="__span-97-27"><a id="__codelineno-97-27" name="__codelineno-97-27" href="#__codelineno-97-27"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret-cloudflare</span>
</span></span><span id="__span-97-28"><a id="__codelineno-97-28" name="__codelineno-97-28" href="#__codelineno-97-28"></a><span class="hll"><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span></span><span id="__span-97-29"><a id="__codelineno-97-29" name="__codelineno-97-29" href="#__codelineno-97-29"></a><span class="hll"><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-octavo.very-very-dark-gray.top</span>
</span></span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Tailscale <code>Ingress</code> is omitted here because it needs no change; there is
no way to obtain and renew Let's Encrypt certificates on Tailscale hostnames.</p>
</div>
<p>Applying the changes to this <code>Ingress</code> triggers the request for a certificate signed by
Let's Encrypt; there will be a pending order and challenge for a new certificate:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>dashboard/octavo-ingress.yaml
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="go">ingress.networking.k8s.io/kubernetes-dashboard-ingress configured</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="go">ingress.networking.k8s.io/kubernetes-dashboard-ingress-tailscale unchanged</span>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a>
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-A<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>acme
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="go">kubernetes-dashboard   cm-acme-http-solver-pg4lj                         NodePort       10.105.119.248   &lt;none&gt;          8089:31654/TCP               40s</span>
</span></code></pre></div>
<p>The pod behind the service is listening and the logs can be monitored in real time:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="gp">$ </span>klogs<span class="w"> </span>kubernetes-dashboard<span class="w"> </span>kubernetes-dashboard<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>acme<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="w"> </span>-d<span class="s1">' '</span><span class="o">)</span><span class="w"> </span>-f
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="go">I0426 19:51:06.525439       1 solver.go:52] "starting listener" logger="cert-manager.acmesolver" expected_domain="kubernetes-octavo.very-very-dark-gray.top" expected_token="A8NepZWnfMUnjHcB01FaBct-OtTlyevnybrzEu2d2lo" expected_key="A8NepZWnfMUnjHcB01FaBct-OtTlyevnybrzEu2d2lo.iqPqqTpFo6Xc2HKxELaaa6msFZd96MSHPdgrxtrPdwM" listen_port=8089</span>
</span></code></pre></div>
<p>Now, instead of routing requests to the <em>different</em> <code>NodePort</code> assigned each time,
it is more convinient to update route requests always to a fixed port <strong>32080</strong>,
and then <code>patch</code> the ACME resolve service to
<a href="https://stackoverflow.com/questions/65789509/kubernetes-how-to-change-service-ports-using-patch">change the service's NodePort</a>.</p>
<p>The <code>patch</code> command is directed at the specific ACME resolver service in each namespace:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>-n<span class="w"> </span>kubernetes-dashboard<span class="w"> </span>patch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="w">    </span>service<span class="w"> </span>cm-acme-http-solver-pg4lj<span class="w"> </span><span class="se">\</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="w">     </span>-p<span class="w"> </span><span class="s1">'{"spec":{"ports": [{"port": 8089, "nodePort": 32080}]}}'</span>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="go">service/cm-acme-http-solver-pg4lj patched</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a>
</span><span id="__span-100-6"><a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-A<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>acme
</span><span id="__span-100-7"><a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="go">kubernetes-dashboard   cm-acme-http-solver-pg4lj                         NodePort       10.105.119.248   &lt;none&gt;          8089:32080/TCP               2m47s</span>
</span></code></pre></div>
<p>Once the service is patched, external connections can be <em>selectivel</em>y routed to this
port by adding a <strong>public hostname</strong> to route <em>only</em> requests for paths under
<code>/.well-known</code> to port <strong>32080</strong> over plain <strong>HTTP</strong>. Combined with the patching of
the ACME solver above, this makes solvers for <code>HTTP01</code> challenges reachable, so
certificates can be issued and renewed.</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../../../media/2025-04-12-kubernetes-homelab-server-with-ubuntu-server-24-04-octavo/tunnel-kubernetes-octavo-public-hostnames.png" data-desc-position="bottom"><img alt="Public hostnames on Cloudflare tunnel" src="../../../../media/2025-04-12-kubernetes-homelab-server-with-ubuntu-server-24-04-octavo/tunnel-kubernetes-octavo-public-hostnames.png" style="height:230px;width:660px"></a></p>
<p>Very soon after making the ACME solver reachable, the challenge is resolved and a
valid certificate is obtained and installed.</p>
<p>At this point it is no longer necessary to have <strong>No TLS Verify</strong> enable under
because Nginx is now using a certificate signed by Let's Encrypt. To complete the
end-to-end test, disable <strong>No TLS Verify</strong> and set <strong>Origin Server Name</strong>
to the FQDN (<code>kubernetes-octavo.very-very-dark-gray.top</code>) so that Cloudflare accepts
the new certificate.</p>
<p>Although this is not really necessary when accessing services through a
<a href="#cloudflare-tunnel">Cloudflare Tunnel</a>, it does serve as a good end-to-end test
and secures the communication between the Cloudflare connector and Nginx. Later,
the same mechanism will make it possible to obtain and renew Let's Encrypt certificates
for services exposed externally by means of forwarding the router's external port 443
to the <code>LoadBalancer</code> IP address of Nginx on this server, so that services can be
accessed directly, securely and <strong>without bandwidth contraints</strong> through a different
domain, e.g. <a href="https://k8s.octavo.uu.am">https://k8s.octavo.uu.am</a>.</p>
<h4 id="automatic-renewal">Automatic renewal</h4>
<p>The above <code>patch</code> operation can be automated to update <em>each</em> ACME resolver service
when it starts:</p>
<div class="language-bash highlight"><span class="filename">cert-renewal-port-fwd.sh</span><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="c1">#</span>
</span><span id="__span-101-3"><a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a><span class="c1"># Patch the nodePort of running cert-manager renewal challenge, to listen</span>
</span><span id="__span-101-4"><a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="c1"># on port 32080 which is the one the router is forwarding port 80 to.</span>
</span><span id="__span-101-5"><a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a>
</span><span id="__span-101-6"><a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="c1"># Check if there is a LetsEncrypt challenge resolver (acme) running.</span>
</span><span id="__span-101-7"><a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf
</span><span id="__span-101-8"><a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="nv">namespace</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-A<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>acme<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'{print $1}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>
</span><span id="__span-101-9"><a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a><span class="nv">service</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-A<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>acme<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">'{print $2}'</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-1<span class="k">)</span>
</span><span id="__span-101-10"><a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a>
</span><span id="__span-101-11"><a id="__codelineno-101-11" name="__codelineno-101-11" href="#__codelineno-101-11"></a><span class="c1"># Patch the service to listen on port 32080 (set up in router).</span>
</span><span id="__span-101-12"><a id="__codelineno-101-12" name="__codelineno-101-12" href="#__codelineno-101-12"></a><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">namespace</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">service</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
</span><span id="__span-101-13"><a id="__codelineno-101-13" name="__codelineno-101-13" href="#__codelineno-101-13"></a><span class="w">    </span>kubectl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-101-14"><a id="__codelineno-101-14" name="__codelineno-101-14" href="#__codelineno-101-14"></a><span class="w">      </span>-n<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">namespace</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span>patch<span class="w"> </span>service<span class="w"> </span><span class="s2">"</span><span class="si">${</span><span class="nv">service</span><span class="si">}</span><span class="s2">"</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-101-15"><a id="__codelineno-101-15" name="__codelineno-101-15" href="#__codelineno-101-15"></a><span class="w">      </span>-p<span class="w"> </span><span class="s1">'{"spec":{"ports": [{"port": 8089, "nodePort":32080}]}}'</span>
</span><span id="__span-101-16"><a id="__codelineno-101-16" name="__codelineno-101-16" href="#__codelineno-101-16"></a><span class="k">fi</span>
</span></code></pre></div>
<p>Install this script in a convenient location and setup <code>crontab</code> to run it every minute:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a># Hourly patch montly cert renewal solvers.
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a>* * * * * /home/pi/cert-renewal-port-fwd.sh
</span></code></pre></div>
<h4 id="test-automatic-renewal">Test automatic renewal</h4>
<p>Expose the <a href="#kubernets-dashboard">Kubernetes dashboard</a> at <a href="https://k8s.octavo.uu.am">https://k8s.octavo.uu.am</a>
to test the automatic renewal of Let's Encrypt certificates end-to-end. More generally,
this is the process to expose services directly without tunnels for high-bandwidth
applications:</p>
<ol>
<li>Add a DNS record to point <code>k8s.octavo.uu.am</code> to the router's external IP address.</li>
<li>Add a port forwarding rule to redirect port 80 to port 32080 on the server. </li>
<li>Add a port forwarding rule to redirect port 443 to the IP address of Nginx.</li>
<li>In the <code>kubernetes-dashboard-ingress</code> (not a new one),<ul>
<li><strong>duplicate</strong> the <code>host</code> and <code>tls</code> objects,</li>
<li>replace the <code>.top</code> FQDN with the <code>k8s.octavo.uu.am</code> <em>and</em></li>
<li><strong>rename</strong> the new <code>tls.secretName</code> to avoid hitting Let's Encrypt rate limits.</li>
</ul>
</li>
</ol>
<div class="language-yaml highlight"><span class="filename">dashboard/nginx-ingress.yaml</span><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-103-3"><a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-103-4"><a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-ingress</span>
</span><span id="__span-103-5"><a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-103-6"><a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-103-7"><a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-103-8"><a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/backend-protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTPS</span>
</span><span id="__span-103-9"><a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/auth-tls-verify-client</span><span class="p">:</span><span class="w"> </span><span class="s">"false"</span>
</span><span id="__span-103-10"><a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/whitelist-source-range</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.244.0.0/16</span>
</span><span id="__span-103-11"><a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/configuration-snippet</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-103-12"><a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a><span class="w">      </span><span class="no">more_set_headers "server: hide";</span>
</span><span id="__span-103-13"><a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-103-14"><a id="__codelineno-103-14" name="__codelineno-103-14" href="#__codelineno-103-14"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-103-15"><a id="__codelineno-103-15" name="__codelineno-103-15" href="#__codelineno-103-15"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-103-16"><a id="__codelineno-103-16" name="__codelineno-103-16" href="#__codelineno-103-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-octavo.very-very-dark-gray.top</span>
</span><span id="__span-103-17"><a id="__codelineno-103-17" name="__codelineno-103-17" href="#__codelineno-103-17"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-103-18"><a id="__codelineno-103-18" name="__codelineno-103-18" href="#__codelineno-103-18"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-103-19"><a id="__codelineno-103-19" name="__codelineno-103-19" href="#__codelineno-103-19"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-103-20"><a id="__codelineno-103-20" name="__codelineno-103-20" href="#__codelineno-103-20"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-103-21"><a id="__codelineno-103-21" name="__codelineno-103-21" href="#__codelineno-103-21"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-103-22"><a id="__codelineno-103-22" name="__codelineno-103-22" href="#__codelineno-103-22"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-103-23"><a id="__codelineno-103-23" name="__codelineno-103-23" href="#__codelineno-103-23"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-kong-proxy</span>
</span><span id="__span-103-24"><a id="__codelineno-103-24" name="__codelineno-103-24" href="#__codelineno-103-24"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-103-25"><a id="__codelineno-103-25" name="__codelineno-103-25" href="#__codelineno-103-25"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span><span id="__span-103-26"><a id="__codelineno-103-26" name="__codelineno-103-26" href="#__codelineno-103-26"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.octavo.uu.am</span>
</span></span><span id="__span-103-27"><a id="__codelineno-103-27" name="__codelineno-103-27" href="#__codelineno-103-27"></a><span class="hll"><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span></span><span id="__span-103-28"><a id="__codelineno-103-28" name="__codelineno-103-28" href="#__codelineno-103-28"></a><span class="hll"><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span></span><span id="__span-103-29"><a id="__codelineno-103-29" name="__codelineno-103-29" href="#__codelineno-103-29"></a><span class="hll"><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span></span><span id="__span-103-30"><a id="__codelineno-103-30" name="__codelineno-103-30" href="#__codelineno-103-30"></a><span class="hll"><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span></span><span id="__span-103-31"><a id="__codelineno-103-31" name="__codelineno-103-31" href="#__codelineno-103-31"></a><span class="hll"><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span></span><span id="__span-103-32"><a id="__codelineno-103-32" name="__codelineno-103-32" href="#__codelineno-103-32"></a><span class="hll"><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span></span><span id="__span-103-33"><a id="__codelineno-103-33" name="__codelineno-103-33" href="#__codelineno-103-33"></a><span class="hll"><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard-kong-proxy</span>
</span></span><span id="__span-103-34"><a id="__codelineno-103-34" name="__codelineno-103-34" href="#__codelineno-103-34"></a><span class="hll"><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span></span><span id="__span-103-35"><a id="__codelineno-103-35" name="__codelineno-103-35" href="#__codelineno-103-35"></a><span class="hll"><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span></span><span id="__span-103-36"><a id="__codelineno-103-36" name="__codelineno-103-36" href="#__codelineno-103-36"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-103-37"><a id="__codelineno-103-37" name="__codelineno-103-37" href="#__codelineno-103-37"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret-cloudflare</span>
</span><span id="__span-103-38"><a id="__codelineno-103-38" name="__codelineno-103-38" href="#__codelineno-103-38"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-103-39"><a id="__codelineno-103-39" name="__codelineno-103-39" href="#__codelineno-103-39"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-octavo.very-very-dark-gray.top</span>
</span><span id="__span-103-40"><a id="__codelineno-103-40" name="__codelineno-103-40" href="#__codelineno-103-40"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret-uu-am</span>
</span></span><span id="__span-103-41"><a id="__codelineno-103-41" name="__codelineno-103-41" href="#__codelineno-103-41"></a><span class="hll"><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span></span><span id="__span-103-42"><a id="__codelineno-103-42" name="__codelineno-103-42" href="#__codelineno-103-42"></a><span class="hll"><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8s.octavo.uu.am</span>
</span></span></code></pre></div>
<p>Once the DNS record has propagated and port 443 is redirected, the dashboard
is reachable only by adding the <code>Host</code> and ignoring SSL verifycation (<code>-k</code>):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="gp">$ </span>curl<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span>-k<span class="w"> </span><span class="se">\</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">"Host: kubernetes-octavo.very-very-dark-gray.top"</span><span class="se">\</span>
</span><span id="__span-104-3"><a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="w">  </span>https://k8s.octavo.uu.am/<span class="w"> </span><span class="se">\</span>
</span><span id="__span-104-4"><a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-2
</span><span id="__span-104-5"><a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a><span class="go">&lt;!--</span>
</span><span id="__span-104-6"><a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="go">Copyright 2017 The Kubernetes Authors.</span>
</span><span id="__span-104-7"><a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a>
</span><span id="__span-104-8"><a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="gp">$ </span>curl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-104-9"><a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a><span class="w">  </span>-H<span class="w"> </span><span class="s2">"Host: kubernetes-octavo.very-very-dark-gray.top"</span><span class="se">\</span>
</span><span id="__span-104-10"><a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="w">  </span>https://k8s.octavo.uu.am/
</span><span id="__span-104-11"><a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="go">curl: (60) SSL certificate problem: self-signed certificate</span>
</span><span id="__span-104-12"><a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a><span class="go">More details here: https://curl.se/docs/sslcerts.html</span>
</span><span id="__span-104-13"><a id="__codelineno-104-13" name="__codelineno-104-13" href="#__codelineno-104-13"></a>
</span><span id="__span-104-14"><a id="__codelineno-104-14" name="__codelineno-104-14" href="#__codelineno-104-14"></a><span class="go">curl failed to verify the legitimacy of the server and therefore could not</span>
</span><span id="__span-104-15"><a id="__codelineno-104-15" name="__codelineno-104-15" href="#__codelineno-104-15"></a><span class="go">establish a secure connection to it. To learn more about this situation and</span>
</span><span id="__span-104-16"><a id="__codelineno-104-16" name="__codelineno-104-16" href="#__codelineno-104-16"></a><span class="go">how to fix it, please visit the web page mentioned above.</span>
</span></code></pre></div>
<p>Applying the changes to the <code>Ingress</code> will trigger the requests for a new certifiate
and the automatic patching of the service will get the process completed within a couple
of minmutes (provided port 80 is correctly redirected):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>dashboard/octavo-ingress.yaml
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="go">ingress.networking.k8s.io/kubernetes-dashboard-ingress configured</span>
</span><span id="__span-105-3"><a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="go">ingress.networking.k8s.io/kubernetes-dashboard-ingress-tailscale unchanged</span>
</span><span id="__span-105-4"><a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a>
</span><span id="__span-105-5"><a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-A<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>acme
</span><span id="__span-105-6"><a id="__codelineno-105-6" name="__codelineno-105-6" href="#__codelineno-105-6"></a><span class="go">kubernetes-dashboard   cm-acme-http-solver-wlk2b                         NodePort       10.102.244.182   &lt;none&gt;          8089:32562/TCP               0s</span>
</span><span id="__span-105-7"><a id="__codelineno-105-7" name="__codelineno-105-7" href="#__codelineno-105-7"></a>
</span><span id="__span-105-8"><a id="__codelineno-105-8" name="__codelineno-105-8" href="#__codelineno-105-8"></a><span class="gp">$ </span>klogs<span class="w"> </span>kubernetes-dashboard<span class="w"> </span>kubernetes-dashboard<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>acme<span class="w"> </span><span class="p">|</span><span class="w"> </span>cut<span class="w"> </span>-f1<span class="w"> </span>-d<span class="s1">' '</span><span class="o">)</span><span class="w"> </span>-f
</span><span id="__span-105-9"><a id="__codelineno-105-9" name="__codelineno-105-9" href="#__codelineno-105-9"></a><span class="go">I0427 06:42:50.918410       1 solver.go:52] "starting listener" logger="cert-manager.acmesolver" expected_domain="k8s.octavo.uu.am" expected_token="NtYo8LxQxMIGK78bsXvv65RwI4skIolgdtSrWNuLeRs" expected_key="NtYo8LxQxMIGK78bsXvv65RwI4skIolgdtSrWNuLeRs.iqPqqTpFo6Xc2HKxELaaa6msFZd96MSHPdgrxtrPdwM" listen_port=8089</span>
</span><span id="__span-105-10"><a id="__codelineno-105-10" name="__codelineno-105-10" href="#__codelineno-105-10"></a><span class="go">I0427 06:43:09.789648       1 solver.go:89] "validating request" logger="cert-manager.acmesolver" host="k8s.octavo.uu.am" path="/.well-known/acme-challenge/NtYo8LxQxMIGK78bsXvv65RwI4skIolgdtSrWNuLeRs" base_path="/.well-known/acme-challenge" token="NtYo8LxQxMIGK78bsXvv65RwI4skIolgdtSrWNuLeRs" headers={"Accept-Encoding":["gzip"],"Connection":["close"],"User-Agent":["cert-manager-challenges/v1.17.2 (linux/amd64) cert-manager/f3ffb86641f75d94d01e5a2606b9871ff89645ef"]}</span>
</span><span id="__span-105-11"><a id="__codelineno-105-11" name="__codelineno-105-11" href="#__codelineno-105-11"></a><span class="go">...</span>
</span><span id="__span-105-12"><a id="__codelineno-105-12" name="__codelineno-105-12" href="#__codelineno-105-12"></a><span class="go">I0427 06:43:18.934689       1 solver.go:112] "got successful challenge request, writing key" logger="cert-manager.acmesolver" host="k8s.octavo.uu.am" path="/.well-known/acme-challenge/NtYo8LxQxMIGK78bsXvv65RwI4skIolgdtSrWNuLeRs" base_path="/.well-known/acme-challenge" token="NtYo8LxQxMIGK78bsXvv65RwI4skIolgdtSrWNuLeRs" headers={"Accept":["*/*"],"Accept-Encoding":["gzip"],"Connection":["close"],"User-Agent":["Mozilla/5.0 (compatible; Let's Encrypt validation server; +https://www.letsencrypt.org)"]}</span>
</span><span id="__span-105-13"><a id="__codelineno-105-13" name="__codelineno-105-13" href="#__codelineno-105-13"></a><span class="go">E0427 06:43:20.531057       1 main.go:42] "error executing command" err="http: Server closed" logger="cert-manager"</span>
</span></code></pre></div>
<p>With the new certificate installed, the dashboard is now reachable at 
<a href="https://k8s.octavo.uu.am/">https://k8s.octavo.uu.am/</a> without ignoring SSL verifycation (<code>-k</code>):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="gp">$ </span>curl<span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="se">\</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="w">  </span>https://k8s.octavo.uu.am/<span class="w"> </span><span class="se">\</span>
</span><span id="__span-106-3"><a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-2
</span><span id="__span-106-4"><a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="go">&lt;!--</span>
</span><span id="__span-106-5"><a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a><span class="go">Copyright 2017 The Kubernetes Authors.</span>
</span></code></pre></div>
<h2 id="migration-from-lexicon">Migration from Lexicon</h2>
<p>With the new cluster up and running, the next step is to migrate (most of) the
<a href="../../../../../projects/self-hosting/#applications-installed">applications installed</a>
previously in <code>lexicon</code> over to <code>octavo</code>, while preserving their storage and status. </p>
<h3 id="audiobookshelf">Audiobookshelf</h3>
<p><a href="../../../../../projects/self-hosting/#audiobookshelf">Audiobookshelf</a> has been <em>easily</em> my
most used application for over a year, and already migrated it to <code>rapture</code> once as a
<a href="../../../../2024/05/12/single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/#migration-from-lexicon">test</a>,
so the process here is essentially the same. The deployment is only different in the
<code>securityContext</code> UID/GID and FQDN where the service will be available at:</p>
<details class="k8s">
<summary>Kubernetes deployment: <code>audiobookshelf.yaml</code></summary>
<div class="language-yaml highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">audiobookshelf.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-107-1">  1</a></span>
<span class="normal"><a href="#__codelineno-107-2">  2</a></span>
<span class="normal"><a href="#__codelineno-107-3">  3</a></span>
<span class="normal"><a href="#__codelineno-107-4">  4</a></span>
<span class="normal"><a href="#__codelineno-107-5">  5</a></span>
<span class="normal"><a href="#__codelineno-107-6">  6</a></span>
<span class="normal"><a href="#__codelineno-107-7">  7</a></span>
<span class="normal"><a href="#__codelineno-107-8">  8</a></span>
<span class="normal"><a href="#__codelineno-107-9">  9</a></span>
<span class="normal"><a href="#__codelineno-107-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-107-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-107-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-107-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-107-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-107-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-107-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-107-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-107-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-107-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-107-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-107-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-107-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-107-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-107-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-107-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-107-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-107-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-107-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-107-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-107-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-107-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-107-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-107-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-107-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-107-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-107-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-107-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-107-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-107-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-107-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-107-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-107-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-107-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-107-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-107-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-107-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-107-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-107-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-107-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-107-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-107-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-107-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-107-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-107-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-107-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-107-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-107-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-107-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-107-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-107-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-107-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-107-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-107-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-107-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-107-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-107-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-107-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-107-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-107-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-107-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-107-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-107-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-107-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-107-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-107-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-107-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-107-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-107-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-107-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-107-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-107-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-107-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-107-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-107-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-107-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-107-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-107-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-107-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-107-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-107-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-107-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-107-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-107-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-107-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-107-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-107-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-107-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-107-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-107-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-107-100">100</a></span>
<span class="normal"><a href="#__codelineno-107-101">101</a></span>
<span class="normal"><a href="#__codelineno-107-102">102</a></span>
<span class="normal"><a href="#__codelineno-107-103">103</a></span>
<span class="normal"><a href="#__codelineno-107-104">104</a></span>
<span class="normal"><a href="#__codelineno-107-105">105</a></span>
<span class="normal"><a href="#__codelineno-107-106">106</a></span>
<span class="normal"><a href="#__codelineno-107-107">107</a></span>
<span class="normal"><a href="#__codelineno-107-108">108</a></span>
<span class="normal"><a href="#__codelineno-107-109">109</a></span>
<span class="normal"><a href="#__codelineno-107-110">110</a></span>
<span class="normal"><a href="#__codelineno-107-111">111</a></span>
<span class="normal"><a href="#__codelineno-107-112">112</a></span>
<span class="normal"><a href="#__codelineno-107-113">113</a></span>
<span class="normal"><a href="#__codelineno-107-114">114</a></span>
<span class="normal"><a href="#__codelineno-107-115">115</a></span>
<span class="normal"><a href="#__codelineno-107-116">116</a></span>
<span class="normal"><a href="#__codelineno-107-117">117</a></span>
<span class="normal"><a href="#__codelineno-107-118">118</a></span>
<span class="normal"><a href="#__codelineno-107-119">119</a></span>
<span class="normal"><a href="#__codelineno-107-120">120</a></span>
<span class="normal"><a href="#__codelineno-107-121">121</a></span>
<span class="normal"><a href="#__codelineno-107-122">122</a></span>
<span class="normal"><a href="#__codelineno-107-123">123</a></span>
<span class="normal"><a href="#__codelineno-107-124">124</a></span>
<span class="normal"><a href="#__codelineno-107-125">125</a></span>
<span class="normal"><a href="#__codelineno-107-126">126</a></span>
<span class="normal"><a href="#__codelineno-107-127">127</a></span>
<span class="normal"><a href="#__codelineno-107-128">128</a></span>
<span class="normal"><a href="#__codelineno-107-129">129</a></span>
<span class="normal"><a href="#__codelineno-107-130">130</a></span>
<span class="normal"><a href="#__codelineno-107-131">131</a></span>
<span class="normal"><a href="#__codelineno-107-132">132</a></span>
<span class="normal"><a href="#__codelineno-107-133">133</a></span>
<span class="normal"><a href="#__codelineno-107-134">134</a></span>
<span class="normal"><a href="#__codelineno-107-135">135</a></span>
<span class="normal"><a href="#__codelineno-107-136">136</a></span>
<span class="normal"><a href="#__codelineno-107-137">137</a></span>
<span class="normal"><a href="#__codelineno-107-138">138</a></span>
<span class="normal"><a href="#__codelineno-107-139">139</a></span>
<span class="normal"><a href="#__codelineno-107-140">140</a></span>
<span class="normal"><a href="#__codelineno-107-141">141</a></span>
<span class="normal"><a href="#__codelineno-107-142">142</a></span>
<span class="normal"><a href="#__codelineno-107-143">143</a></span>
<span class="normal"><a href="#__codelineno-107-144">144</a></span>
<span class="normal"><a href="#__codelineno-107-145">145</a></span>
<span class="normal"><a href="#__codelineno-107-146">146</a></span>
<span class="normal"><a href="#__codelineno-107-147">147</a></span>
<span class="normal"><a href="#__codelineno-107-148">148</a></span>
<span class="normal"><a href="#__codelineno-107-149">149</a></span>
<span class="normal"><a href="#__codelineno-107-150">150</a></span>
<span class="normal"><a href="#__codelineno-107-151">151</a></span>
<span class="normal"><a href="#__codelineno-107-152">152</a></span>
<span class="normal"><a href="#__codelineno-107-153">153</a></span>
<span class="normal"><a href="#__codelineno-107-154">154</a></span>
<span class="normal"><a href="#__codelineno-107-155">155</a></span>
<span class="normal"><a href="#__codelineno-107-156">156</a></span>
<span class="normal"><a href="#__codelineno-107-157">157</a></span>
<span class="normal"><a href="#__codelineno-107-158">158</a></span>
<span class="normal"><a href="#__codelineno-107-159">159</a></span>
<span class="normal"><a href="#__codelineno-107-160">160</a></span>
<span class="normal"><a href="#__codelineno-107-161">161</a></span>
<span class="normal"><a href="#__codelineno-107-162">162</a></span>
<span class="normal"><a href="#__codelineno-107-163">163</a></span>
<span class="normal"><a href="#__codelineno-107-164">164</a></span>
<span class="normal"><a href="#__codelineno-107-165">165</a></span>
<span class="normal"><a href="#__codelineno-107-166">166</a></span>
<span class="normal"><a href="#__codelineno-107-167">167</a></span>
<span class="normal"><a href="#__codelineno-107-168">168</a></span>
<span class="normal"><a href="#__codelineno-107-169">169</a></span>
<span class="normal"><a href="#__codelineno-107-170">170</a></span>
<span class="normal"><a href="#__codelineno-107-171">171</a></span>
<span class="normal"><a href="#__codelineno-107-172">172</a></span>
<span class="normal"><a href="#__codelineno-107-173">173</a></span>
<span class="normal"><a href="#__codelineno-107-174">174</a></span>
<span class="normal"><a href="#__codelineno-107-175">175</a></span>
<span class="normal"><a href="#__codelineno-107-176">176</a></span>
<span class="normal"><a href="#__codelineno-107-177">177</a></span>
<span class="normal"><a href="#__codelineno-107-178">178</a></span>
<span class="normal"><a href="#__codelineno-107-179">179</a></span>
<span class="normal"><a href="#__codelineno-107-180">180</a></span>
<span class="normal"><a href="#__codelineno-107-181">181</a></span>
<span class="normal"><a href="#__codelineno-107-182">182</a></span>
<span class="normal"><a href="#__codelineno-107-183">183</a></span>
<span class="normal"><a href="#__codelineno-107-184">184</a></span>
<span class="normal"><a href="#__codelineno-107-185">185</a></span>
<span class="normal"><a href="#__codelineno-107-186">186</a></span>
<span class="normal"><a href="#__codelineno-107-187">187</a></span>
<span class="normal"><a href="#__codelineno-107-188">188</a></span>
<span class="normal"><a href="#__codelineno-107-189">189</a></span>
<span class="normal"><a href="#__codelineno-107-190">190</a></span>
<span class="normal"><a href="#__codelineno-107-191">191</a></span>
<span class="normal"><a href="#__codelineno-107-192">192</a></span>
<span class="normal"><a href="#__codelineno-107-193">193</a></span>
<span class="normal"><a href="#__codelineno-107-194">194</a></span>
<span class="normal"><a href="#__codelineno-107-195">195</a></span>
<span class="normal"><a href="#__codelineno-107-196">196</a></span>
<span class="normal"><a href="#__codelineno-107-197">197</a></span>
<span class="normal"><a href="#__codelineno-107-198">198</a></span>
<span class="normal"><a href="#__codelineno-107-199">199</a></span>
<span class="normal"><a href="#__codelineno-107-200">200</a></span>
<span class="normal"><a href="#__codelineno-107-201">201</a></span>
<span class="normal"><a href="#__codelineno-107-202">202</a></span>
<span class="normal"><a href="#__codelineno-107-203">203</a></span>
<span class="normal"><a href="#__codelineno-107-204">204</a></span>
<span class="normal"><a href="#__codelineno-107-205">205</a></span>
<span class="normal"><a href="#__codelineno-107-206">206</a></span>
<span class="normal"><a href="#__codelineno-107-207">207</a></span>
<span class="normal"><a href="#__codelineno-107-208">208</a></span>
<span class="normal"><a href="#__codelineno-107-209">209</a></span>
<span class="normal"><a href="#__codelineno-107-210">210</a></span>
<span class="normal"><a href="#__codelineno-107-211">211</a></span>
<span class="normal"><a href="#__codelineno-107-212">212</a></span>
<span class="normal"><a href="#__codelineno-107-213">213</a></span>
<span class="normal"><a href="#__codelineno-107-214">214</a></span>
<span class="normal"><a href="#__codelineno-107-215">215</a></span>
<span class="normal"><a href="#__codelineno-107-216">216</a></span>
<span class="normal"><a href="#__codelineno-107-217">217</a></span>
<span class="normal"><a href="#__codelineno-107-218">218</a></span>
<span class="normal"><a href="#__codelineno-107-219">219</a></span>
<span class="normal"><a href="#__codelineno-107-220">220</a></span>
<span class="normal"><a href="#__codelineno-107-221">221</a></span>
<span class="normal"><a href="#__codelineno-107-222">222</a></span>
<span class="normal"><a href="#__codelineno-107-223">223</a></span>
<span class="normal"><a href="#__codelineno-107-224">224</a></span>
<span class="normal"><a href="#__codelineno-107-225">225</a></span>
<span class="normal"><a href="#__codelineno-107-226">226</a></span>
<span class="normal"><a href="#__codelineno-107-227">227</a></span>
<span class="normal"><a href="#__codelineno-107-228">228</a></span>
<span class="normal"><a href="#__codelineno-107-229">229</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5"></a><span class="nn">---</span>
</span><span id="__span-107-6"><a id="__codelineno-107-6" name="__codelineno-107-6"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-107-7"><a id="__codelineno-107-7" name="__codelineno-107-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-107-8"><a id="__codelineno-107-8" name="__codelineno-107-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-9"><a id="__codelineno-107-9" name="__codelineno-107-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-config</span>
</span><span id="__span-107-10"><a id="__codelineno-107-10" name="__codelineno-107-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-11"><a id="__codelineno-107-11" name="__codelineno-107-11"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-12"><a id="__codelineno-107-12" name="__codelineno-107-12"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-107-13"><a id="__codelineno-107-13" name="__codelineno-107-13"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-107-14"><a id="__codelineno-107-14" name="__codelineno-107-14"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-107-15"><a id="__codelineno-107-15" name="__codelineno-107-15"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-107-16"><a id="__codelineno-107-16" name="__codelineno-107-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-107-17"><a id="__codelineno-107-17" name="__codelineno-107-17"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-107-18"><a id="__codelineno-107-18" name="__codelineno-107-18"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-107-19"><a id="__codelineno-107-19" name="__codelineno-107-19"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/audiobookshelf/config</span>
</span><span id="__span-107-20"><a id="__codelineno-107-20" name="__codelineno-107-20"></a><span class="nn">---</span>
</span><span id="__span-107-21"><a id="__codelineno-107-21" name="__codelineno-107-21"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-107-22"><a id="__codelineno-107-22" name="__codelineno-107-22"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-107-23"><a id="__codelineno-107-23" name="__codelineno-107-23"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-24"><a id="__codelineno-107-24" name="__codelineno-107-24"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-metadata</span>
</span><span id="__span-107-25"><a id="__codelineno-107-25" name="__codelineno-107-25"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-26"><a id="__codelineno-107-26" name="__codelineno-107-26"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-27"><a id="__codelineno-107-27" name="__codelineno-107-27"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-107-28"><a id="__codelineno-107-28" name="__codelineno-107-28"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-107-29"><a id="__codelineno-107-29" name="__codelineno-107-29"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-107-30"><a id="__codelineno-107-30" name="__codelineno-107-30"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-107-31"><a id="__codelineno-107-31" name="__codelineno-107-31"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-107-32"><a id="__codelineno-107-32" name="__codelineno-107-32"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-107-33"><a id="__codelineno-107-33" name="__codelineno-107-33"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-107-34"><a id="__codelineno-107-34" name="__codelineno-107-34"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/audiobookshelf/metadata</span>
</span><span id="__span-107-35"><a id="__codelineno-107-35" name="__codelineno-107-35"></a><span class="nn">---</span>
</span><span id="__span-107-36"><a id="__codelineno-107-36" name="__codelineno-107-36"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-107-37"><a id="__codelineno-107-37" name="__codelineno-107-37"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-107-38"><a id="__codelineno-107-38" name="__codelineno-107-38"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-39"><a id="__codelineno-107-39" name="__codelineno-107-39"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-audiobooks</span>
</span><span id="__span-107-40"><a id="__codelineno-107-40" name="__codelineno-107-40"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-41"><a id="__codelineno-107-41" name="__codelineno-107-41"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-42"><a id="__codelineno-107-42" name="__codelineno-107-42"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-107-43"><a id="__codelineno-107-43" name="__codelineno-107-43"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-107-44"><a id="__codelineno-107-44" name="__codelineno-107-44"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-107-45"><a id="__codelineno-107-45" name="__codelineno-107-45"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-107-46"><a id="__codelineno-107-46" name="__codelineno-107-46"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-107-47"><a id="__codelineno-107-47" name="__codelineno-107-47"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-107-48"><a id="__codelineno-107-48" name="__codelineno-107-48"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-107-49"><a id="__codelineno-107-49" name="__codelineno-107-49"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/nas/public/audio/Audiobooks</span>
</span><span id="__span-107-50"><a id="__codelineno-107-50" name="__codelineno-107-50"></a><span class="nn">---</span>
</span><span id="__span-107-51"><a id="__codelineno-107-51" name="__codelineno-107-51"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-107-52"><a id="__codelineno-107-52" name="__codelineno-107-52"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-107-53"><a id="__codelineno-107-53" name="__codelineno-107-53"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-54"><a id="__codelineno-107-54" name="__codelineno-107-54"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-podcasts</span>
</span><span id="__span-107-55"><a id="__codelineno-107-55" name="__codelineno-107-55"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-56"><a id="__codelineno-107-56" name="__codelineno-107-56"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-57"><a id="__codelineno-107-57" name="__codelineno-107-57"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-107-58"><a id="__codelineno-107-58" name="__codelineno-107-58"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-107-59"><a id="__codelineno-107-59" name="__codelineno-107-59"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-107-60"><a id="__codelineno-107-60" name="__codelineno-107-60"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-107-61"><a id="__codelineno-107-61" name="__codelineno-107-61"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-107-62"><a id="__codelineno-107-62" name="__codelineno-107-62"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-107-63"><a id="__codelineno-107-63" name="__codelineno-107-63"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-107-64"><a id="__codelineno-107-64" name="__codelineno-107-64"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/nas/public/audio/Podcasts</span>
</span><span id="__span-107-65"><a id="__codelineno-107-65" name="__codelineno-107-65"></a><span class="nn">---</span>
</span><span id="__span-107-66"><a id="__codelineno-107-66" name="__codelineno-107-66"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-107-67"><a id="__codelineno-107-67" name="__codelineno-107-67"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-107-68"><a id="__codelineno-107-68" name="__codelineno-107-68"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-69"><a id="__codelineno-107-69" name="__codelineno-107-69"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-config</span>
</span><span id="__span-107-70"><a id="__codelineno-107-70" name="__codelineno-107-70"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-71"><a id="__codelineno-107-71" name="__codelineno-107-71"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-72"><a id="__codelineno-107-72" name="__codelineno-107-72"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-107-73"><a id="__codelineno-107-73" name="__codelineno-107-73"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-config</span>
</span><span id="__span-107-74"><a id="__codelineno-107-74" name="__codelineno-107-74"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-107-75"><a id="__codelineno-107-75" name="__codelineno-107-75"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-107-76"><a id="__codelineno-107-76" name="__codelineno-107-76"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-107-77"><a id="__codelineno-107-77" name="__codelineno-107-77"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-107-78"><a id="__codelineno-107-78" name="__codelineno-107-78"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-107-79"><a id="__codelineno-107-79" name="__codelineno-107-79"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-107-80"><a id="__codelineno-107-80" name="__codelineno-107-80"></a><span class="nn">---</span>
</span><span id="__span-107-81"><a id="__codelineno-107-81" name="__codelineno-107-81"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-107-82"><a id="__codelineno-107-82" name="__codelineno-107-82"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-107-83"><a id="__codelineno-107-83" name="__codelineno-107-83"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-84"><a id="__codelineno-107-84" name="__codelineno-107-84"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-metadata</span>
</span><span id="__span-107-85"><a id="__codelineno-107-85" name="__codelineno-107-85"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-86"><a id="__codelineno-107-86" name="__codelineno-107-86"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-87"><a id="__codelineno-107-87" name="__codelineno-107-87"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-107-88"><a id="__codelineno-107-88" name="__codelineno-107-88"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-metadata</span>
</span><span id="__span-107-89"><a id="__codelineno-107-89" name="__codelineno-107-89"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-107-90"><a id="__codelineno-107-90" name="__codelineno-107-90"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-107-91"><a id="__codelineno-107-91" name="__codelineno-107-91"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-107-92"><a id="__codelineno-107-92" name="__codelineno-107-92"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-107-93"><a id="__codelineno-107-93" name="__codelineno-107-93"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-107-94"><a id="__codelineno-107-94" name="__codelineno-107-94"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-107-95"><a id="__codelineno-107-95" name="__codelineno-107-95"></a><span class="nn">---</span>
</span><span id="__span-107-96"><a id="__codelineno-107-96" name="__codelineno-107-96"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-107-97"><a id="__codelineno-107-97" name="__codelineno-107-97"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-107-98"><a id="__codelineno-107-98" name="__codelineno-107-98"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-99"><a id="__codelineno-107-99" name="__codelineno-107-99"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-audiobooks</span>
</span><span id="__span-107-100"><a id="__codelineno-107-100" name="__codelineno-107-100"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-101"><a id="__codelineno-107-101" name="__codelineno-107-101"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-102"><a id="__codelineno-107-102" name="__codelineno-107-102"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-107-103"><a id="__codelineno-107-103" name="__codelineno-107-103"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-audiobooks</span>
</span><span id="__span-107-104"><a id="__codelineno-107-104" name="__codelineno-107-104"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-107-105"><a id="__codelineno-107-105" name="__codelineno-107-105"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-107-106"><a id="__codelineno-107-106" name="__codelineno-107-106"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-107-107"><a id="__codelineno-107-107" name="__codelineno-107-107"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-107-108"><a id="__codelineno-107-108" name="__codelineno-107-108"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-107-109"><a id="__codelineno-107-109" name="__codelineno-107-109"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-107-110"><a id="__codelineno-107-110" name="__codelineno-107-110"></a><span class="nn">---</span>
</span><span id="__span-107-111"><a id="__codelineno-107-111" name="__codelineno-107-111"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-107-112"><a id="__codelineno-107-112" name="__codelineno-107-112"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-107-113"><a id="__codelineno-107-113" name="__codelineno-107-113"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-114"><a id="__codelineno-107-114" name="__codelineno-107-114"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-podcasts</span>
</span><span id="__span-107-115"><a id="__codelineno-107-115" name="__codelineno-107-115"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-116"><a id="__codelineno-107-116" name="__codelineno-107-116"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-117"><a id="__codelineno-107-117" name="__codelineno-107-117"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-107-118"><a id="__codelineno-107-118" name="__codelineno-107-118"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-podcasts</span>
</span><span id="__span-107-119"><a id="__codelineno-107-119" name="__codelineno-107-119"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-107-120"><a id="__codelineno-107-120" name="__codelineno-107-120"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-107-121"><a id="__codelineno-107-121" name="__codelineno-107-121"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-107-122"><a id="__codelineno-107-122" name="__codelineno-107-122"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-107-123"><a id="__codelineno-107-123" name="__codelineno-107-123"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-107-124"><a id="__codelineno-107-124" name="__codelineno-107-124"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-107-125"><a id="__codelineno-107-125" name="__codelineno-107-125"></a><span class="nn">---</span>
</span><span id="__span-107-126"><a id="__codelineno-107-126" name="__codelineno-107-126"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-107-127"><a id="__codelineno-107-127" name="__codelineno-107-127"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-107-128"><a id="__codelineno-107-128" name="__codelineno-107-128"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-129"><a id="__codelineno-107-129" name="__codelineno-107-129"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-107-130"><a id="__codelineno-107-130" name="__codelineno-107-130"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-131"><a id="__codelineno-107-131" name="__codelineno-107-131"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-132"><a id="__codelineno-107-132" name="__codelineno-107-132"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-133"><a id="__codelineno-107-133" name="__codelineno-107-133"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-134"><a id="__codelineno-107-134" name="__codelineno-107-134"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-107-135"><a id="__codelineno-107-135" name="__codelineno-107-135"></a><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-107-136"><a id="__codelineno-107-136" name="__codelineno-107-136"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-107-137"><a id="__codelineno-107-137" name="__codelineno-107-137"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-107-138"><a id="__codelineno-107-138" name="__codelineno-107-138"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-139"><a id="__codelineno-107-139" name="__codelineno-107-139"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-107-140"><a id="__codelineno-107-140" name="__codelineno-107-140"></a><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span>
</span><span id="__span-107-141"><a id="__codelineno-107-141" name="__codelineno-107-141"></a><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-107-142"><a id="__codelineno-107-142" name="__codelineno-107-142"></a><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-107-143"><a id="__codelineno-107-143" name="__codelineno-107-143"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
</span><span id="__span-107-144"><a id="__codelineno-107-144" name="__codelineno-107-144"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-107-145"><a id="__codelineno-107-145" name="__codelineno-107-145"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-146"><a id="__codelineno-107-146" name="__codelineno-107-146"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-107-147"><a id="__codelineno-107-147" name="__codelineno-107-147"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-148"><a id="__codelineno-107-148" name="__codelineno-107-148"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-149"><a id="__codelineno-107-149" name="__codelineno-107-149"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-107-150"><a id="__codelineno-107-150" name="__codelineno-107-150"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/advplyr/audiobookshelf:latest</span>
</span><span id="__span-107-151"><a id="__codelineno-107-151" name="__codelineno-107-151"></a><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-107-152"><a id="__codelineno-107-152" name="__codelineno-107-152"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-153"><a id="__codelineno-107-153" name="__codelineno-107-153"></a><span class="w">          </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-107-154"><a id="__codelineno-107-154" name="__codelineno-107-154"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PORT</span>
</span><span id="__span-107-155"><a id="__codelineno-107-155" name="__codelineno-107-155"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"13378"</span>
</span><span id="__span-107-156"><a id="__codelineno-107-156" name="__codelineno-107-156"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-107-157"><a id="__codelineno-107-157" name="__codelineno-107-157"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">13378</span>
</span><span id="__span-107-158"><a id="__codelineno-107-158" name="__codelineno-107-158"></a><span class="w">          </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-107-159"><a id="__codelineno-107-159" name="__codelineno-107-159"></a><span class="w">          </span><span class="nt">stdin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-107-160"><a id="__codelineno-107-160" name="__codelineno-107-160"></a><span class="w">          </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-107-161"><a id="__codelineno-107-161" name="__codelineno-107-161"></a><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-107-162"><a id="__codelineno-107-162" name="__codelineno-107-162"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/config</span>
</span><span id="__span-107-163"><a id="__codelineno-107-163" name="__codelineno-107-163"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-config</span>
</span><span id="__span-107-164"><a id="__codelineno-107-164" name="__codelineno-107-164"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/metadata</span>
</span><span id="__span-107-165"><a id="__codelineno-107-165" name="__codelineno-107-165"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-metadata</span>
</span><span id="__span-107-166"><a id="__codelineno-107-166" name="__codelineno-107-166"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/audiobooks</span>
</span><span id="__span-107-167"><a id="__codelineno-107-167" name="__codelineno-107-167"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-audiobooks</span>
</span><span id="__span-107-168"><a id="__codelineno-107-168" name="__codelineno-107-168"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/podcasts</span>
</span><span id="__span-107-169"><a id="__codelineno-107-169" name="__codelineno-107-169"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-podcasts</span>
</span><span id="__span-107-170"><a id="__codelineno-107-170" name="__codelineno-107-170"></a><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span>
</span><span id="__span-107-171"><a id="__codelineno-107-171" name="__codelineno-107-171"></a><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-107-172"><a id="__codelineno-107-172" name="__codelineno-107-172"></a><span class="w">            </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">117</span>
</span><span id="__span-107-173"><a id="__codelineno-107-173" name="__codelineno-107-173"></a><span class="w">            </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">117</span>
</span><span id="__span-107-174"><a id="__codelineno-107-174" name="__codelineno-107-174"></a><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-107-175"><a id="__codelineno-107-175" name="__codelineno-107-175"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-107-176"><a id="__codelineno-107-176" name="__codelineno-107-176"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-config</span>
</span><span id="__span-107-177"><a id="__codelineno-107-177" name="__codelineno-107-177"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-107-178"><a id="__codelineno-107-178" name="__codelineno-107-178"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-config</span>
</span><span id="__span-107-179"><a id="__codelineno-107-179" name="__codelineno-107-179"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-metadata</span>
</span><span id="__span-107-180"><a id="__codelineno-107-180" name="__codelineno-107-180"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-107-181"><a id="__codelineno-107-181" name="__codelineno-107-181"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-metadata</span>
</span><span id="__span-107-182"><a id="__codelineno-107-182" name="__codelineno-107-182"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-audiobooks</span>
</span><span id="__span-107-183"><a id="__codelineno-107-183" name="__codelineno-107-183"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-107-184"><a id="__codelineno-107-184" name="__codelineno-107-184"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-audiobooks</span>
</span><span id="__span-107-185"><a id="__codelineno-107-185" name="__codelineno-107-185"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-podcasts</span>
</span><span id="__span-107-186"><a id="__codelineno-107-186" name="__codelineno-107-186"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-107-187"><a id="__codelineno-107-187" name="__codelineno-107-187"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-podcasts</span>
</span><span id="__span-107-188"><a id="__codelineno-107-188" name="__codelineno-107-188"></a><span class="nn">---</span>
</span><span id="__span-107-189"><a id="__codelineno-107-189" name="__codelineno-107-189"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-107-190"><a id="__codelineno-107-190" name="__codelineno-107-190"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-107-191"><a id="__codelineno-107-191" name="__codelineno-107-191"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-192"><a id="__codelineno-107-192" name="__codelineno-107-192"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-svc</span>
</span><span id="__span-107-193"><a id="__codelineno-107-193" name="__codelineno-107-193"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-194"><a id="__codelineno-107-194" name="__codelineno-107-194"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-195"><a id="__codelineno-107-195" name="__codelineno-107-195"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</span><span id="__span-107-196"><a id="__codelineno-107-196" name="__codelineno-107-196"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-107-197"><a id="__codelineno-107-197" name="__codelineno-107-197"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">13388</span>
</span><span id="__span-107-198"><a id="__codelineno-107-198" name="__codelineno-107-198"></a><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">31378</span>
</span><span id="__span-107-199"><a id="__codelineno-107-199" name="__codelineno-107-199"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">13378</span>
</span><span id="__span-107-200"><a id="__codelineno-107-200" name="__codelineno-107-200"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-107-201"><a id="__codelineno-107-201" name="__codelineno-107-201"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-202"><a id="__codelineno-107-202" name="__codelineno-107-202"></a><span class="nn">---</span>
</span><span id="__span-107-203"><a id="__codelineno-107-203" name="__codelineno-107-203"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-107-204"><a id="__codelineno-107-204" name="__codelineno-107-204"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-107-205"><a id="__codelineno-107-205" name="__codelineno-107-205"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-107-206"><a id="__codelineno-107-206" name="__codelineno-107-206"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-ingress</span>
</span><span id="__span-107-207"><a id="__codelineno-107-207" name="__codelineno-107-207"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-107-208"><a id="__codelineno-107-208" name="__codelineno-107-208"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-107-209"><a id="__codelineno-107-209" name="__codelineno-107-209"></a><span class="w">    </span><span class="nt">acme.cert-manager.io/http01-edit-in-place</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-107-210"><a id="__codelineno-107-210" name="__codelineno-107-210"></a><span class="w">    </span><span class="nt">cert-manager.io/issue-temporary-certificate</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-107-211"><a id="__codelineno-107-211" name="__codelineno-107-211"></a><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-107-212"><a id="__codelineno-107-212" name="__codelineno-107-212"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/websocket-services</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-svc</span>
</span><span id="__span-107-213"><a id="__codelineno-107-213" name="__codelineno-107-213"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-107-214"><a id="__codelineno-107-214" name="__codelineno-107-214"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-107-215"><a id="__codelineno-107-215" name="__codelineno-107-215"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-107-216"><a id="__codelineno-107-216" name="__codelineno-107-216"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf.very-very-dark-gray.top</span>
</span><span id="__span-107-217"><a id="__codelineno-107-217" name="__codelineno-107-217"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-107-218"><a id="__codelineno-107-218" name="__codelineno-107-218"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-107-219"><a id="__codelineno-107-219" name="__codelineno-107-219"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-107-220"><a id="__codelineno-107-220" name="__codelineno-107-220"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-107-221"><a id="__codelineno-107-221" name="__codelineno-107-221"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-107-222"><a id="__codelineno-107-222" name="__codelineno-107-222"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-107-223"><a id="__codelineno-107-223" name="__codelineno-107-223"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-svc</span>
</span><span id="__span-107-224"><a id="__codelineno-107-224" name="__codelineno-107-224"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-107-225"><a id="__codelineno-107-225" name="__codelineno-107-225"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">13378</span>
</span><span id="__span-107-226"><a id="__codelineno-107-226" name="__codelineno-107-226"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-107-227"><a id="__codelineno-107-227" name="__codelineno-107-227"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret</span>
</span><span id="__span-107-228"><a id="__codelineno-107-228" name="__codelineno-107-228"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-107-229"><a id="__codelineno-107-229" name="__codelineno-107-229"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf.very-very-dark-gray.top</span>
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<p>First, stop Audiobookshelf in <code>lexicon</code> (it won't be used moving forward):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>audiobookshelf<span class="w"> </span>deployment<span class="w"> </span>audiobookshelf<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="go">deployment.apps/audiobookshelf scaled</span>
</span></code></pre></div>
<p>Then copy the <code>/config</code> and <code>/metadata</code> directories over from <code>lexicon</code> to <code>octavo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="gp">root@octavo ~ # </span>groupadd<span class="w"> </span>audiobookshelf<span class="w"> </span>-g<span class="w"> </span><span class="m">117</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="gp">root@octavo ~ # </span>useradd<span class="w">  </span>audiobookshelf<span class="w"> </span>-u<span class="w"> </span><span class="m">117</span><span class="w"> </span>-g<span class="w"> </span><span class="m">117</span><span class="w"> </span>-s<span class="w"> </span>/usr/sbin/nologin
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/audiobookshelf<span class="w"> </span>/home/k8s/
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a><span class="gp">root@octavo ~ # </span>chown<span class="w"> </span>-R<span class="w"> </span>audiobookshelf:audiobookshelf<span class="w"> </span>/home/k8s/audiobookshelf
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="gp">root@octavo ~ # </span>ls<span class="w"> </span>-hal<span class="w"> </span>/home/k8s/audiobookshelf
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="go">drwxr-xr-x 1 audiobookshelf audiobookshelf  28 Feb 27  2024 .</span>
</span><span id="__span-109-7"><a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="go">drwxr-xr-x 1 root           root           104 Apr 28 22:22 ..</span>
</span><span id="__span-109-8"><a id="__codelineno-109-8" name="__codelineno-109-8" href="#__codelineno-109-8"></a><span class="go">drwxr-xr-x 1 audiobookshelf audiobookshelf 102 Apr 28 21:27 config</span>
</span><span id="__span-109-9"><a id="__codelineno-109-9" name="__codelineno-109-9" href="#__codelineno-109-9"></a><span class="go">drwxr-xr-x 1 audiobookshelf audiobookshelf 230 Jan 14 20:54 metadata</span>
</span></code></pre></div>
<p>Finally, start the deployment in <code>octavo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>audiobookshelf.yaml
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="go">namespace/audiobookshelf created</span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="go">persistentvolume/audiobookshelf-pv-config created</span>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a><span class="go">persistentvolume/audiobookshelf-pv-metadata created</span>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="go">persistentvolume/audiobookshelf-pv-audiobooks created</span>
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="go">persistentvolume/audiobookshelf-pv-podcasts created</span>
</span><span id="__span-110-7"><a id="__codelineno-110-7" name="__codelineno-110-7" href="#__codelineno-110-7"></a><span class="go">persistentvolumeclaim/audiobookshelf-pvc-config created</span>
</span><span id="__span-110-8"><a id="__codelineno-110-8" name="__codelineno-110-8" href="#__codelineno-110-8"></a><span class="go">persistentvolumeclaim/audiobookshelf-pvc-metadata created</span>
</span><span id="__span-110-9"><a id="__codelineno-110-9" name="__codelineno-110-9" href="#__codelineno-110-9"></a><span class="go">persistentvolumeclaim/audiobookshelf-pvc-audiobooks created</span>
</span><span id="__span-110-10"><a id="__codelineno-110-10" name="__codelineno-110-10" href="#__codelineno-110-10"></a><span class="go">persistentvolumeclaim/audiobookshelf-pvc-podcasts created</span>
</span><span id="__span-110-11"><a id="__codelineno-110-11" name="__codelineno-110-11" href="#__codelineno-110-11"></a><span class="go">deployment.apps/audiobookshelf created</span>
</span><span id="__span-110-12"><a id="__codelineno-110-12" name="__codelineno-110-12" href="#__codelineno-110-12"></a><span class="go">service/audiobookshelf-svc created</span>
</span><span id="__span-110-13"><a id="__codelineno-110-13" name="__codelineno-110-13" href="#__codelineno-110-13"></a><span class="go">ingress.networking.k8s.io/audiobookshelf-ingress created</span>
</span><span id="__span-110-14"><a id="__codelineno-110-14" name="__codelineno-110-14" href="#__codelineno-110-14"></a>
</span><span id="__span-110-15"><a id="__codelineno-110-15" name="__codelineno-110-15" href="#__codelineno-110-15"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>audiobookshelf
</span><span id="__span-110-16"><a id="__codelineno-110-16" name="__codelineno-110-16" href="#__codelineno-110-16"></a><span class="go">NAME                                  READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-110-17"><a id="__codelineno-110-17" name="__codelineno-110-17" href="#__codelineno-110-17"></a><span class="go">pod/audiobookshelf-5b486f64b4-8zd2g   1/1     Running   0          20s</span>
</span><span id="__span-110-18"><a id="__codelineno-110-18" name="__codelineno-110-18" href="#__codelineno-110-18"></a><span class="go">pod/cm-acme-http-solver-wd8rk         1/1     Running   0          16s</span>
</span><span id="__span-110-19"><a id="__codelineno-110-19" name="__codelineno-110-19" href="#__codelineno-110-19"></a>
</span><span id="__span-110-20"><a id="__codelineno-110-20" name="__codelineno-110-20" href="#__codelineno-110-20"></a><span class="go">NAME                                TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)           AGE</span>
</span><span id="__span-110-21"><a id="__codelineno-110-21" name="__codelineno-110-21" href="#__codelineno-110-21"></a><span class="go">service/audiobookshelf-svc          NodePort   10.108.231.47   &lt;none&gt;        13388:31378/TCP   20s</span>
</span><span id="__span-110-22"><a id="__codelineno-110-22" name="__codelineno-110-22" href="#__codelineno-110-22"></a><span class="go">service/cm-acme-http-solver-vblgl   NodePort   10.105.105.53   &lt;none&gt;        8089:31546/TCP    16s</span>
</span><span id="__span-110-23"><a id="__codelineno-110-23" name="__codelineno-110-23" href="#__codelineno-110-23"></a>
</span><span id="__span-110-24"><a id="__codelineno-110-24" name="__codelineno-110-24" href="#__codelineno-110-24"></a><span class="go">NAME                             READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-110-25"><a id="__codelineno-110-25" name="__codelineno-110-25" href="#__codelineno-110-25"></a><span class="go">deployment.apps/audiobookshelf   1/1     1            1           20s</span>
</span><span id="__span-110-26"><a id="__codelineno-110-26" name="__codelineno-110-26" href="#__codelineno-110-26"></a>
</span><span id="__span-110-27"><a id="__codelineno-110-27" name="__codelineno-110-27" href="#__codelineno-110-27"></a><span class="go">NAME                                        DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-110-28"><a id="__codelineno-110-28" name="__codelineno-110-28" href="#__codelineno-110-28"></a><span class="go">replicaset.apps/audiobookshelf-5b486f64b4   1         1         1       20s</span>
</span><span id="__span-110-29"><a id="__codelineno-110-29" name="__codelineno-110-29" href="#__codelineno-110-29"></a>
</span><span id="__span-110-30"><a id="__codelineno-110-30" name="__codelineno-110-30" href="#__codelineno-110-30"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>audiobookshelf
</span><span id="__span-110-31"><a id="__codelineno-110-31" name="__codelineno-110-31" href="#__codelineno-110-31"></a><span class="go">NAME                        TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)           AGE</span>
</span><span id="__span-110-32"><a id="__codelineno-110-32" name="__codelineno-110-32" href="#__codelineno-110-32"></a><span class="go">audiobookshelf-svc          NodePort   10.108.231.47   &lt;none&gt;        13388:31378/TCP   13s</span>
</span><span id="__span-110-33"><a id="__codelineno-110-33" name="__codelineno-110-33" href="#__codelineno-110-33"></a><span class="go">cm-acme-http-solver-vblgl   NodePort   10.105.105.53   &lt;none&gt;        8089:31546/TCP    9s</span>
</span><span id="__span-110-34"><a id="__codelineno-110-34" name="__codelineno-110-34" href="#__codelineno-110-34"></a>
</span><span id="__span-110-35"><a id="__codelineno-110-35" name="__codelineno-110-35" href="#__codelineno-110-35"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ingress<span class="w"> </span>-n<span class="w"> </span>audiobookshelf
</span><span id="__span-110-36"><a id="__codelineno-110-36" name="__codelineno-110-36" href="#__codelineno-110-36"></a><span class="go">NAME                     CLASS   HOSTS                                    ADDRESS         PORTS     AGE</span>
</span><span id="__span-110-37"><a id="__codelineno-110-37" name="__codelineno-110-37" href="#__codelineno-110-37"></a><span class="go">audiobookshelf-ingress   nginx   audiobookshelf.very-very-dark-gray.top   192.168.0.171   80, 443   60s</span>
</span></code></pre></div>
<p>After a couple for minutes Audiobookshelf is available at
<a href="https://audiobookshelf.very-very-dark-gray.top/">https://audiobookshelf.very-very-dark-gray.top/</a> and works fine.</p>
<h3 id="home-assistant">Home Assistant</h3>
<p><a href="https://www.home-assistant.io/">Home Assistant</a>
can be deployed in <code>octavo</code> in very much the same way it was on <code>lexicon</code>, using
<a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#base-deployment">the same base manifests</a>
and a new <code>kustomization.yaml</code> file just to set different hostnames:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">home-assistant/octavo/kustomization.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-111-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-111-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-111-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-111-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-111-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-111-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-111-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-111-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-111-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-111-10">10</a></span>
<span class="normal"><a href="#__codelineno-111-11">11</a></span>
<span class="normal"><a href="#__codelineno-111-12">12</a></span>
<span class="normal"><a href="#__codelineno-111-13">13</a></span>
<span class="normal"><a href="#__codelineno-111-14">14</a></span>
<span class="normal"><a href="#__codelineno-111-15">15</a></span>
<span class="normal"><a href="#__codelineno-111-16">16</a></span>
<span class="normal"><a href="#__codelineno-111-17">17</a></span>
<span class="normal"><a href="#__codelineno-111-18">18</a></span>
<span class="normal"><a href="#__codelineno-111-19">19</a></span>
<span class="normal"><a href="#__codelineno-111-20">20</a></span>
<span class="normal"><a href="#__codelineno-111-21">21</a></span>
<span class="normal"><a href="#__codelineno-111-22">22</a></span>
<span class="normal"><a href="#__codelineno-111-23">23</a></span>
<span class="normal"><a href="#__codelineno-111-24">24</a></span>
<span class="normal"><a href="#__codelineno-111-25">25</a></span>
<span class="normal"><a href="#__codelineno-111-26">26</a></span>
<span class="normal"><a href="#__codelineno-111-27">27</a></span>
<span class="normal"><a href="#__codelineno-111-28">28</a></span>
<span class="normal"><a href="#__codelineno-111-29">29</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3"></a><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-111-4"><a id="__codelineno-111-4" name="__codelineno-111-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../base</span>
</span><span id="__span-111-5"><a id="__codelineno-111-5" name="__codelineno-111-5"></a>
</span><span id="__span-111-6"><a id="__codelineno-111-6" name="__codelineno-111-6"></a><span class="nt">configMapGenerator</span><span class="p">:</span>
</span><span id="__span-111-7"><a id="__codelineno-111-7" name="__codelineno-111-7"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">home-assistant-config</span>
</span><span id="__span-111-8"><a id="__codelineno-111-8" name="__codelineno-111-8"></a><span class="w">  </span><span class="nt">behavior</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replace</span>
</span><span id="__span-111-9"><a id="__codelineno-111-9" name="__codelineno-111-9"></a><span class="w">  </span><span class="nt">literals</span><span class="p">:</span>
</span><span id="__span-111-10"><a id="__codelineno-111-10" name="__codelineno-111-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ="Europe/Amsterdam"</span>
</span><span id="__span-111-11"><a id="__codelineno-111-11" name="__codelineno-111-11"></a>
</span><span id="__span-111-12"><a id="__codelineno-111-12" name="__codelineno-111-12"></a><span class="nt">patches</span><span class="p">:</span>
</span><span id="__span-111-13"><a id="__codelineno-111-13" name="__codelineno-111-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="c1">#FQDN for Cloudflare Tunnel or port-forwarded</span>
</span><span id="__span-111-14"><a id="__codelineno-111-14" name="__codelineno-111-14"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-111-15"><a id="__codelineno-111-15" name="__codelineno-111-15"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">home-assistant-nginx</span>
</span><span id="__span-111-16"><a id="__codelineno-111-16" name="__codelineno-111-16"></a><span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
</span><span id="__span-111-17"><a id="__codelineno-111-17" name="__codelineno-111-17"></a><span class="w">      </span><span class="no">- op: replace</span>
</span><span id="__span-111-18"><a id="__codelineno-111-18" name="__codelineno-111-18"></a><span class="w">        </span><span class="no">path: /spec/rules/0/host</span>
</span><span id="__span-111-19"><a id="__codelineno-111-19" name="__codelineno-111-19"></a><span class="hll"><span class="w">        </span><span class="no">value: home-assistant-octavo.very-very-dark-gray.top</span>
</span></span><span id="__span-111-20"><a id="__codelineno-111-20" name="__codelineno-111-20"></a><span class="w">      </span><span class="no">- op: replace</span>
</span><span id="__span-111-21"><a id="__codelineno-111-21" name="__codelineno-111-21"></a><span class="w">        </span><span class="no">path: /spec/tls/0/hosts/0</span>
</span><span id="__span-111-22"><a id="__codelineno-111-22" name="__codelineno-111-22"></a><span class="hll"><span class="w">        </span><span class="no">value: home-assistant-octavo.very-very-dark-gray.top</span>
</span></span><span id="__span-111-23"><a id="__codelineno-111-23" name="__codelineno-111-23"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="c1"># Hostname-only for Tailscale [Funnel]</span>
</span><span id="__span-111-24"><a id="__codelineno-111-24" name="__codelineno-111-24"></a><span class="w">      </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-111-25"><a id="__codelineno-111-25" name="__codelineno-111-25"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">home-assistant-tailscale</span>
</span><span id="__span-111-26"><a id="__codelineno-111-26" name="__codelineno-111-26"></a><span class="w">    </span><span class="nt">patch</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
</span><span id="__span-111-27"><a id="__codelineno-111-27" name="__codelineno-111-27"></a><span class="w">      </span><span class="no">- op: replace</span>
</span><span id="__span-111-28"><a id="__codelineno-111-28" name="__codelineno-111-28"></a><span class="w">        </span><span class="no">path: /spec/tls/0/hosts/0</span>
</span><span id="__span-111-29"><a id="__codelineno-111-29" name="__codelineno-111-29"></a><span class="hll"><span class="w">        </span><span class="no">value: home-assistant-octavo</span>
</span></span></code></pre></div></td></tr></tbody></table></div>
<p><a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#prepare-remote-access">Prepare remote access</a> 
first, then create <code>/home/k8s/home-assistant/</code> anew and apply the deployment.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>mkdir<span class="w"> </span>/home/k8s/home-assistant
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="gp">$ </span>ls<span class="w"> </span>-lah<span class="w"> </span>/home/k8s/home-assistant
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="go">total 0</span>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="go">drwxr-xr-x 1 root root  0 Apr 27 14:03 .</span>
</span><span id="__span-112-5"><a id="__codelineno-112-5" name="__codelineno-112-5" href="#__codelineno-112-5"></a><span class="go">drwxr-xr-x 1 root root 28 Apr 27 14:03 ..</span>
</span><span id="__span-112-6"><a id="__codelineno-112-6" name="__codelineno-112-6" href="#__codelineno-112-6"></a>
</span><span id="__span-112-7"><a id="__codelineno-112-7" name="__codelineno-112-7" href="#__codelineno-112-7"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-k<span class="w"> </span>octavo
</span><span id="__span-112-8"><a id="__codelineno-112-8" name="__codelineno-112-8" href="#__codelineno-112-8"></a><span class="go">namespace/home-assistant created</span>
</span><span id="__span-112-9"><a id="__codelineno-112-9" name="__codelineno-112-9" href="#__codelineno-112-9"></a><span class="go">configmap/home-assistant-config-59kccc4bcd created</span>
</span><span id="__span-112-10"><a id="__codelineno-112-10" name="__codelineno-112-10" href="#__codelineno-112-10"></a><span class="go">configmap/home-assistant-configmap created</span>
</span><span id="__span-112-11"><a id="__codelineno-112-11" name="__codelineno-112-11" href="#__codelineno-112-11"></a><span class="go">service/home-assistant-svc created</span>
</span><span id="__span-112-12"><a id="__codelineno-112-12" name="__codelineno-112-12" href="#__codelineno-112-12"></a><span class="go">persistentvolume/home-assistant-pv-config created</span>
</span><span id="__span-112-13"><a id="__codelineno-112-13" name="__codelineno-112-13" href="#__codelineno-112-13"></a><span class="go">persistentvolumeclaim/home-assistant-config-root created</span>
</span><span id="__span-112-14"><a id="__codelineno-112-14" name="__codelineno-112-14" href="#__codelineno-112-14"></a><span class="go">deployment.apps/home-assistant created</span>
</span><span id="__span-112-15"><a id="__codelineno-112-15" name="__codelineno-112-15" href="#__codelineno-112-15"></a><span class="go">ingress.networking.k8s.io/home-assistant-nginx created</span>
</span><span id="__span-112-16"><a id="__codelineno-112-16" name="__codelineno-112-16" href="#__codelineno-112-16"></a><span class="go">ingress.networking.k8s.io/home-assistant-tailscale created</span>
</span><span id="__span-112-17"><a id="__codelineno-112-17" name="__codelineno-112-17" href="#__codelineno-112-17"></a>
</span><span id="__span-112-18"><a id="__codelineno-112-18" name="__codelineno-112-18" href="#__codelineno-112-18"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>home-assistant
</span><span id="__span-112-19"><a id="__codelineno-112-19" name="__codelineno-112-19" href="#__codelineno-112-19"></a><span class="go">NAME                                  READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-112-20"><a id="__codelineno-112-20" name="__codelineno-112-20" href="#__codelineno-112-20"></a><span class="go">pod/cm-acme-http-solver-ssftt         1/1     Running   0          54s</span>
</span><span id="__span-112-21"><a id="__codelineno-112-21" name="__codelineno-112-21" href="#__codelineno-112-21"></a><span class="go">pod/home-assistant-77bf44c47b-tqz2s   1/1     Running   0          59s</span>
</span><span id="__span-112-22"><a id="__codelineno-112-22" name="__codelineno-112-22" href="#__codelineno-112-22"></a>
</span><span id="__span-112-23"><a id="__codelineno-112-23" name="__codelineno-112-23" href="#__codelineno-112-23"></a><span class="go">NAME                                TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span>
</span><span id="__span-112-24"><a id="__codelineno-112-24" name="__codelineno-112-24" href="#__codelineno-112-24"></a><span class="go">service/cm-acme-http-solver-f7jbv   NodePort    10.110.189.111   &lt;none&gt;        8089:31135/TCP   54s</span>
</span><span id="__span-112-25"><a id="__codelineno-112-25" name="__codelineno-112-25" href="#__codelineno-112-25"></a><span class="go">service/home-assistant-svc          ClusterIP   10.107.114.233   &lt;none&gt;        8123/TCP         59s</span>
</span><span id="__span-112-26"><a id="__codelineno-112-26" name="__codelineno-112-26" href="#__codelineno-112-26"></a>
</span><span id="__span-112-27"><a id="__codelineno-112-27" name="__codelineno-112-27" href="#__codelineno-112-27"></a><span class="go">NAME                             READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-112-28"><a id="__codelineno-112-28" name="__codelineno-112-28" href="#__codelineno-112-28"></a><span class="go">deployment.apps/home-assistant   1/1     1            1           59s</span>
</span><span id="__span-112-29"><a id="__codelineno-112-29" name="__codelineno-112-29" href="#__codelineno-112-29"></a>
</span><span id="__span-112-30"><a id="__codelineno-112-30" name="__codelineno-112-30" href="#__codelineno-112-30"></a><span class="go">NAME                                        DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-112-31"><a id="__codelineno-112-31" name="__codelineno-112-31" href="#__codelineno-112-31"></a><span class="go">replicaset.apps/home-assistant-77bf44c47b   1         1         1       59s</span>
</span><span id="__span-112-32"><a id="__codelineno-112-32" name="__codelineno-112-32" href="#__codelineno-112-32"></a>
</span><span id="__span-112-33"><a id="__codelineno-112-33" name="__codelineno-112-33" href="#__codelineno-112-33"></a><span class="gp">$ </span>sudo<span class="w"> </span>ls<span class="w"> </span>-lah<span class="w"> </span>/home/k8s/home-assistant
</span><span id="__span-112-34"><a id="__codelineno-112-34" name="__codelineno-112-34" href="#__codelineno-112-34"></a><span class="go">total 916K</span>
</span><span id="__span-112-35"><a id="__codelineno-112-35" name="__codelineno-112-35" href="#__codelineno-112-35"></a><span class="go">drwxr-xr-x 1 root root  372 Apr 27 14:14 .</span>
</span><span id="__span-112-36"><a id="__codelineno-112-36" name="__codelineno-112-36" href="#__codelineno-112-36"></a><span class="go">drwxr-xr-x 1 root root   28 Apr 27 14:03 ..</span>
</span><span id="__span-112-37"><a id="__codelineno-112-37" name="__codelineno-112-37" href="#__codelineno-112-37"></a><span class="go">drwxr-xr-x 1 root root   32 Apr 27 14:14 blueprints</span>
</span><span id="__span-112-38"><a id="__codelineno-112-38" name="__codelineno-112-38" href="#__codelineno-112-38"></a><span class="go">drwxr-xr-x 1 root root    0 Apr 27 14:14 .cloud</span>
</span><span id="__span-112-39"><a id="__codelineno-112-39" name="__codelineno-112-39" href="#__codelineno-112-39"></a><span class="go">-rw-r--r-- 1 root root    0 Apr 27 14:14 configuration.yaml</span>
</span><span id="__span-112-40"><a id="__codelineno-112-40" name="__codelineno-112-40" href="#__codelineno-112-40"></a><span class="go">-rw-r--r-- 1 root root    8 Apr 27 14:14 .HA_VERSION</span>
</span><span id="__span-112-41"><a id="__codelineno-112-41" name="__codelineno-112-41" href="#__codelineno-112-41"></a><span class="go">-rw-r--r-- 1 root root    0 Apr 27 14:14 home-assistant.log</span>
</span><span id="__span-112-42"><a id="__codelineno-112-42" name="__codelineno-112-42" href="#__codelineno-112-42"></a><span class="go">-rw-r--r-- 1 root root    0 Apr 27 14:14 home-assistant.log.1</span>
</span><span id="__span-112-43"><a id="__codelineno-112-43" name="__codelineno-112-43" href="#__codelineno-112-43"></a><span class="go">-rw-r--r-- 1 root root    0 Apr 27 14:14 home-assistant.log.fault</span>
</span><span id="__span-112-44"><a id="__codelineno-112-44" name="__codelineno-112-44" href="#__codelineno-112-44"></a><span class="go">-rw-r--r-- 1 root root 4.0K Apr 27 14:14 home-assistant_v2.db</span>
</span><span id="__span-112-45"><a id="__codelineno-112-45" name="__codelineno-112-45" href="#__codelineno-112-45"></a><span class="go">-rw-r--r-- 1 root root  32K Apr 27 14:30 home-assistant_v2.db-shm</span>
</span><span id="__span-112-46"><a id="__codelineno-112-46" name="__codelineno-112-46" href="#__codelineno-112-46"></a><span class="go">-rw-r--r-- 1 root root 866K Apr 27 14:30 home-assistant_v2.db-wal</span>
</span><span id="__span-112-47"><a id="__codelineno-112-47" name="__codelineno-112-47" href="#__codelineno-112-47"></a><span class="go">drwxr-xr-x 1 root root  428 Apr 27 14:29 .storage</span>
</span><span id="__span-112-48"><a id="__codelineno-112-48" name="__codelineno-112-48" href="#__codelineno-112-48"></a><span class="go">drwxr-xr-x 1 root root    0 Apr 27 14:14 tts</span>
</span></code></pre></div>
<p>After less than a minute, the ACME solver is patched to listen on port <code>32080</code>,
and after just about another minute the solver is gone. At that point Home Assistant
is available at both <a href="https://home-assistant-octavo.royal-penny.ts.net/">https://home-assistant-octavo.royal-penny.ts.net/</a> and
<a href="https://home-assistant-octavo.very-very-dark-gray.top/">https://home-assistant-octavo.very-very-dark-gray.top/</a> ready to start the
onboarding process.</p>
<h4 id="bluetooth-setup">Bluetooth setup</h4>
<p><a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#bluetooth-failed-setup">Bluetooth failed setup</a>
in <code>lexicon</code> and the same is bound to repeat in <code>octavo</code> now; even though the base
deployment manifests already mount <code>/run/dbus</code> it is also required to
<em>switch from dbus-daemon to dbus-broker</em> and <em>install BlueZ</em>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="gp">$ </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>bluez<span class="w"> </span>dbus-broker<span class="w"> </span>-y
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>--global<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>dbus-broker.service
</span></code></pre></div>
<h4 id="restore-backup">Restore backup</h4>
<p>At this point a fresh backup from <code>lexicon</code> could be restored in <code>octavo</code> to
initialize Home Assistant, including the tweaked <code>configuration.yaml</code> file,
<a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#home-assistant-community-store">Home Assistant Community Store</a>
and all the cards and dashboards.</p>
<p>However, restoring a backup <strong>fails consistently</strong> with an OS-level error that
doesn't seem to make sense; the logs for the pod show that a process was unable
to open the main <code>configuration.yaml</code> file, even though there was definitely
nothing accessing it at the time:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a><span class="gp">$ </span>klogs<span class="w"> </span>home-assistant<span class="w"> </span>home-assistant
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a><span class="go">s6-rc: info: service s6rc-oneshot-runner: starting</span>
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a><span class="go">s6-rc: info: service s6rc-oneshot-runner successfully started</span>
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a><span class="go">s6-rc: info: service fix-attrs: starting</span>
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a><span class="go">s6-rc: info: service fix-attrs successfully started</span>
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a><span class="go">s6-rc: info: service legacy-cont-init: starting</span>
</span><span id="__span-114-7"><a id="__codelineno-114-7" name="__codelineno-114-7" href="#__codelineno-114-7"></a><span class="go">s6-rc: info: service legacy-cont-init successfully started</span>
</span><span id="__span-114-8"><a id="__codelineno-114-8" name="__codelineno-114-8" href="#__codelineno-114-8"></a><span class="go">s6-rc: info: service legacy-services: starting</span>
</span><span id="__span-114-9"><a id="__codelineno-114-9" name="__codelineno-114-9" href="#__codelineno-114-9"></a><span class="go">services-up: info: copying legacy longrun home-assistant (no readiness notification)</span>
</span><span id="__span-114-10"><a id="__codelineno-114-10" name="__codelineno-114-10" href="#__codelineno-114-10"></a><span class="go">s6-rc: info: service legacy-services successfully started</span>
</span><span id="__span-114-11"><a id="__codelineno-114-11" name="__codelineno-114-11" href="#__codelineno-114-11"></a>
</span><span id="__span-114-12"><a id="__codelineno-114-12" name="__codelineno-114-12" href="#__codelineno-114-12"></a>
</span><span id="__span-114-13"><a id="__codelineno-114-13" name="__codelineno-114-13" href="#__codelineno-114-13"></a><span class="go">[12:58:06] INFO: Home Assistant Core finish process exit code 100</span>
</span><span id="__span-114-14"><a id="__codelineno-114-14" name="__codelineno-114-14" href="#__codelineno-114-14"></a><span class="go">INFO:homeassistant.backup_restore:Restoring /config/backups/lexicon-last_2025-04-27_14.40_32799259.tar</span>
</span><span id="__span-114-15"><a id="__codelineno-114-15" name="__codelineno-114-15" href="#__codelineno-114-15"></a><span class="go">Traceback (most recent call last):</span>
</span><span id="__span-114-16"><a id="__codelineno-114-16" name="__codelineno-114-16" href="#__codelineno-114-16"></a><span class="go">  File "&lt;frozen runpy&gt;", line 198, in _run_module_as_main</span>
</span><span id="__span-114-17"><a id="__codelineno-114-17" name="__codelineno-114-17" href="#__codelineno-114-17"></a><span class="go">  File "&lt;frozen runpy&gt;", line 88, in _run_code</span>
</span><span id="__span-114-18"><a id="__codelineno-114-18" name="__codelineno-114-18" href="#__codelineno-114-18"></a><span class="go">  File "/usr/src/homeassistant/homeassistant/__main__.py", line 227, in &lt;module&gt;</span>
</span><span id="__span-114-19"><a id="__codelineno-114-19" name="__codelineno-114-19" href="#__codelineno-114-19"></a><span class="go">    sys.exit(main())</span>
</span><span id="__span-114-20"><a id="__codelineno-114-20" name="__codelineno-114-20" href="#__codelineno-114-20"></a><span class="go">             ~~~~^^</span>
</span><span id="__span-114-21"><a id="__codelineno-114-21" name="__codelineno-114-21" href="#__codelineno-114-21"></a><span class="go">  File "/usr/src/homeassistant/homeassistant/__main__.py", line 186, in main</span>
</span><span id="__span-114-22"><a id="__codelineno-114-22" name="__codelineno-114-22" href="#__codelineno-114-22"></a><span class="go">    if restore_backup(config_dir):</span>
</span><span id="__span-114-23"><a id="__codelineno-114-23" name="__codelineno-114-23" href="#__codelineno-114-23"></a><span class="go">       ~~~~~~~~~~~~~~^^^^^^^^^^^^</span>
</span><span id="__span-114-24"><a id="__codelineno-114-24" name="__codelineno-114-24" href="#__codelineno-114-24"></a><span class="go">  File "/usr/src/homeassistant/homeassistant/backup_restore.py", line 197, in restore_backup</span>
</span><span id="__span-114-25"><a id="__codelineno-114-25" name="__codelineno-114-25" href="#__codelineno-114-25"></a><span class="go">    _extract_backup(</span>
</span><span id="__span-114-26"><a id="__codelineno-114-26" name="__codelineno-114-26" href="#__codelineno-114-26"></a><span class="go">    ~~~~~~~~~~~~~~~^</span>
</span><span id="__span-114-27"><a id="__codelineno-114-27" name="__codelineno-114-27" href="#__codelineno-114-27"></a><span class="go">        config_dir=config_dir,</span>
</span><span id="__span-114-28"><a id="__codelineno-114-28" name="__codelineno-114-28" href="#__codelineno-114-28"></a><span class="go">        ^^^^^^^^^^^^^^^^^^^^^^</span>
</span><span id="__span-114-29"><a id="__codelineno-114-29" name="__codelineno-114-29" href="#__codelineno-114-29"></a><span class="go">        restore_content=restore_content,</span>
</span><span id="__span-114-30"><a id="__codelineno-114-30" name="__codelineno-114-30" href="#__codelineno-114-30"></a><span class="go">        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span>
</span><span id="__span-114-31"><a id="__codelineno-114-31" name="__codelineno-114-31" href="#__codelineno-114-31"></a><span class="go">    )</span>
</span><span id="__span-114-32"><a id="__codelineno-114-32" name="__codelineno-114-32" href="#__codelineno-114-32"></a><span class="go">    ^</span>
</span><span id="__span-114-33"><a id="__codelineno-114-33" name="__codelineno-114-33" href="#__codelineno-114-33"></a><span class="go">  File "/usr/src/homeassistant/homeassistant/backup_restore.py", line 143, in _extract_backup</span>
</span><span id="__span-114-34"><a id="__codelineno-114-34" name="__codelineno-114-34" href="#__codelineno-114-34"></a><span class="go">    _clear_configuration_directory(config_dir, keep)</span>
</span><span id="__span-114-35"><a id="__codelineno-114-35" name="__codelineno-114-35" href="#__codelineno-114-35"></a><span class="go">    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^</span>
</span><span id="__span-114-36"><a id="__codelineno-114-36" name="__codelineno-114-36" href="#__codelineno-114-36"></a><span class="go">  File "/usr/src/homeassistant/homeassistant/backup_restore.py", line 87, in _clear_configuration_directory</span>
</span><span id="__span-114-37"><a id="__codelineno-114-37" name="__codelineno-114-37" href="#__codelineno-114-37"></a><span class="go">    entrypath.unlink()</span>
</span><span id="__span-114-38"><a id="__codelineno-114-38" name="__codelineno-114-38" href="#__codelineno-114-38"></a><span class="go">    ~~~~~~~~~~~~~~~~^^</span>
</span><span id="__span-114-39"><a id="__codelineno-114-39" name="__codelineno-114-39" href="#__codelineno-114-39"></a><span class="go">  File "/usr/local/lib/python3.13/pathlib/_local.py", line 746, in unlink</span>
</span><span id="__span-114-40"><a id="__codelineno-114-40" name="__codelineno-114-40" href="#__codelineno-114-40"></a><span class="go">    os.unlink(self)</span>
</span><span id="__span-114-41"><a id="__codelineno-114-41" name="__codelineno-114-41" href="#__codelineno-114-41"></a><span class="go">    ~~~~~~~~~^^^^^^</span>
</span><span id="__span-114-42"><a id="__codelineno-114-42" name="__codelineno-114-42" href="#__codelineno-114-42"></a><span class="hll"><span class="go">OSError: [Errno 16] Resource busy: '/config/configuration.yaml'</span>
</span></span><span id="__span-114-43"><a id="__codelineno-114-43" name="__codelineno-114-43" href="#__codelineno-114-43"></a><span class="go">[12:58:08] INFO: Home Assistant Core finish process exit code 1</span>
</span><span id="__span-114-44"><a id="__codelineno-114-44" name="__codelineno-114-44" href="#__codelineno-114-44"></a><span class="go">[12:58:08] INFO: Home Assistant Core service shutdown</span>
</span><span id="__span-114-45"><a id="__codelineno-114-45" name="__codelineno-114-45" href="#__codelineno-114-45"></a><span class="go">s6-rc: info: service legacy-services: stopping</span>
</span><span id="__span-114-46"><a id="__codelineno-114-46" name="__codelineno-114-46" href="#__codelineno-114-46"></a><span class="go">s6-rc: info: service legacy-services successfully stopped</span>
</span><span id="__span-114-47"><a id="__codelineno-114-47" name="__codelineno-114-47" href="#__codelineno-114-47"></a><span class="go">s6-rc: info: service legacy-cont-init: stopping</span>
</span><span id="__span-114-48"><a id="__codelineno-114-48" name="__codelineno-114-48" href="#__codelineno-114-48"></a><span class="go">s6-rc: info: service legacy-cont-init successfully stopped</span>
</span><span id="__span-114-49"><a id="__codelineno-114-49" name="__codelineno-114-49" href="#__codelineno-114-49"></a><span class="go">s6-rc: info: service fix-attrs: stopping</span>
</span><span id="__span-114-50"><a id="__codelineno-114-50" name="__codelineno-114-50" href="#__codelineno-114-50"></a><span class="go">s6-rc: info: service fix-attrs successfully stopped</span>
</span><span id="__span-114-51"><a id="__codelineno-114-51" name="__codelineno-114-51" href="#__codelineno-114-51"></a><span class="go">s6-rc: info: service s6rc-oneshot-runner: stopping</span>
</span><span id="__span-114-52"><a id="__codelineno-114-52" name="__codelineno-114-52" href="#__codelineno-114-52"></a><span class="go">s6-rc: info: service s6rc-oneshot-runner successfully stopped</span>
</span></code></pre></div>
<p>The error persists after Home Assistant (pod) is restarted:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="gp">$ </span>klogs<span class="w"> </span>home-assistant<span class="w"> </span>home-assistant
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="go">s6-rc: info: service s6rc-oneshot-runner: starting</span>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a><span class="go">s6-rc: info: service s6rc-oneshot-runner successfully started</span>
</span><span id="__span-115-4"><a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="go">s6-rc: info: service fix-attrs: starting</span>
</span><span id="__span-115-5"><a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="go">s6-rc: info: service fix-attrs successfully started</span>
</span><span id="__span-115-6"><a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a><span class="go">s6-rc: info: service legacy-cont-init: starting</span>
</span><span id="__span-115-7"><a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="go">s6-rc: info: service legacy-cont-init successfully started</span>
</span><span id="__span-115-8"><a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a><span class="go">s6-rc: info: service legacy-services: starting</span>
</span><span id="__span-115-9"><a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="go">services-up: info: copying legacy longrun home-assistant (no readiness notification)</span>
</span><span id="__span-115-10"><a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a><span class="go">s6-rc: info: service legacy-services successfully started</span>
</span><span id="__span-115-11"><a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a><span class="go">2025-04-27 14:58:16.784 WARNING (MainThread) [homeassistant.components.backup]</span>
</span><span id="__span-115-12"><a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a><span class="hll"><span class="go">  Backup restore failed with OSError: [Errno 16] Resource busy: '/config/configuration.yaml'</span>
</span></span></code></pre></div>
<p>In the meantime, the Home Assistant onboarding page keeps <em>waiting</em> even though nothing
is happening in the backend. Opening the same page on a new browser tab and selecting
the option to restore the backup shows the same error:</p>
<div class="language-text highlight"><pre><span></span><code>The backup could not be restored. Please try again.

Error:  
[Errno 16] Resource busy: '/config/configuration.yaml'
</code></pre></div>
<p>Trying again <em>consistently</em> leads to the same error time and again, even after stopping
the pods, deleting the entire <code>/home/k8s/home-assistant</code> directory and starting anew
with a fresh empty one.</p>
<h4 id="hardcore-migration">Hardcore migration</h4>
<p>The solution turned out to be to simply copy over the <code>/home/k8s/home-assistant</code>
directory at the rigth time between stopping and starting the relevant services:</p>
<ol>
<li>
<p>Stop Home Assistant <strong>on both servers</strong> by <em>scaling</em> the deployment to 0 replicas:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>home-assistant<span class="w"> </span>deployment<span class="w"> </span>home-assistant<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a><span class="go">deployment.apps/home-assistant scaled</span>
</span></code></pre></div>
</li>
<li>
<p>Copy <code>/home/k8s/home-assistant</code> over from <code>lexicon</code> to <code>octavo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="gp">root@octavo ~ # </span>rm<span class="w"> </span>-rf<span class="w"> </span>/home/k8s/home-assistant
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/home-assistant<span class="w"> </span>/home/k8s/
</span><span id="__span-117-3"><a id="__codelineno-117-3" name="__codelineno-117-3" href="#__codelineno-117-3"></a><span class="gp">root@octavo ~ # </span>ls<span class="w"> </span>-hal<span class="w"> </span>/home/k8s/home-assistant
</span><span id="__span-117-4"><a id="__codelineno-117-4" name="__codelineno-117-4" href="#__codelineno-117-4"></a><span class="go">total 110M</span>
</span><span id="__span-117-5"><a id="__codelineno-117-5" name="__codelineno-117-5" href="#__codelineno-117-5"></a><span class="go">drwxr-xr-x 1 root root  570 Apr 27 23:28 .</span>
</span><span id="__span-117-6"><a id="__codelineno-117-6" name="__codelineno-117-6" href="#__codelineno-117-6"></a><span class="go">drwxr-xr-x 1 root root   76 Apr 28 21:14 ..</span>
</span><span id="__span-117-7"><a id="__codelineno-117-7" name="__codelineno-117-7" href="#__codelineno-117-7"></a><span class="go">-rw-r--r-- 1 root root    0 Apr 25 22:39 automations.yaml</span>
</span><span id="__span-117-8"><a id="__codelineno-117-8" name="__codelineno-117-8" href="#__codelineno-117-8"></a><span class="go">drwxr-xr-x 1 root root  484 Apr 28 05:37 backups</span>
</span><span id="__span-117-9"><a id="__codelineno-117-9" name="__codelineno-117-9" href="#__codelineno-117-9"></a><span class="go">drwxr-xr-x 1 root root   48 Apr 25 22:42 blueprints</span>
</span><span id="__span-117-10"><a id="__codelineno-117-10" name="__codelineno-117-10" href="#__codelineno-117-10"></a><span class="go">drwxr-xr-x 1 root root    0 Apr 21 11:13 .cloud</span>
</span><span id="__span-117-11"><a id="__codelineno-117-11" name="__codelineno-117-11" href="#__codelineno-117-11"></a><span class="go">-rw-r--r-- 1 root root  670 Apr 27 19:37 configuration.yaml</span>
</span><span id="__span-117-12"><a id="__codelineno-117-12" name="__codelineno-117-12" href="#__codelineno-117-12"></a><span class="go">drwxr-xr-x 1 root root   26 Apr 24 21:04 custom_components</span>
</span><span id="__span-117-13"><a id="__codelineno-117-13" name="__codelineno-117-13" href="#__codelineno-117-13"></a><span class="go">drwxr-xr-x 1 root root    0 Apr 21 17:58 deps</span>
</span><span id="__span-117-14"><a id="__codelineno-117-14" name="__codelineno-117-14" href="#__codelineno-117-14"></a><span class="go">-rw-r--r-- 1 root root    8 Apr 26 05:08 .HA_VERSION</span>
</span><span id="__span-117-15"><a id="__codelineno-117-15" name="__codelineno-117-15" href="#__codelineno-117-15"></a><span class="go">-rw-r--r-- 1 root root 2.2M Apr 28 22:20 home-assistant.log</span>
</span><span id="__span-117-16"><a id="__codelineno-117-16" name="__codelineno-117-16" href="#__codelineno-117-16"></a><span class="go">-rw-r--r-- 1 root root 5.8K Apr 27 23:28 home-assistant.log.1</span>
</span><span id="__span-117-17"><a id="__codelineno-117-17" name="__codelineno-117-17" href="#__codelineno-117-17"></a><span class="go">-rw-r--r-- 1 root root    0 Apr 27 23:28 home-assistant.log.fault</span>
</span><span id="__span-117-18"><a id="__codelineno-117-18" name="__codelineno-117-18" href="#__codelineno-117-18"></a><span class="go">-rw-r--r-- 1 root root 103M Apr 28 22:18 home-assistant_v2.db</span>
</span><span id="__span-117-19"><a id="__codelineno-117-19" name="__codelineno-117-19" href="#__codelineno-117-19"></a><span class="go">-rw-r--r-- 1 root root  32K Apr 28 22:20 home-assistant_v2.db-shm</span>
</span><span id="__span-117-20"><a id="__codelineno-117-20" name="__codelineno-117-20" href="#__codelineno-117-20"></a><span class="go">-rw-r--r-- 1 root root 4.4M Apr 28 22:20 home-assistant_v2.db-wal</span>
</span><span id="__span-117-21"><a id="__codelineno-117-21" name="__codelineno-117-21" href="#__codelineno-117-21"></a><span class="go">drwxr-xr-x 1 root root  448 Apr 23 21:07 image</span>
</span><span id="__span-117-22"><a id="__codelineno-117-22" name="__codelineno-117-22" href="#__codelineno-117-22"></a><span class="go">-rw-r--r-- 1 root root 4.9K Apr 22 22:59 install-hacs.sh</span>
</span><span id="__span-117-23"><a id="__codelineno-117-23" name="__codelineno-117-23" href="#__codelineno-117-23"></a><span class="go">-rw-r--r-- 1 root root    0 Apr 25 22:39 scenes.yaml</span>
</span><span id="__span-117-24"><a id="__codelineno-117-24" name="__codelineno-117-24" href="#__codelineno-117-24"></a><span class="go">-rw-r--r-- 1 root root    0 Apr 25 22:39 scripts.yaml</span>
</span><span id="__span-117-25"><a id="__codelineno-117-25" name="__codelineno-117-25" href="#__codelineno-117-25"></a><span class="go">drwxr-xr-x 1 root root 1.3K Apr 28 22:13 .storage</span>
</span><span id="__span-117-26"><a id="__codelineno-117-26" name="__codelineno-117-26" href="#__codelineno-117-26"></a><span class="go">drwxr-xr-x 1 root root   14 Apr 25 22:29 templates</span>
</span><span id="__span-117-27"><a id="__codelineno-117-27" name="__codelineno-117-27" href="#__codelineno-117-27"></a><span class="go">drwxr-xr-x 1 root root    0 Apr 21 11:13 tts</span>
</span><span id="__span-117-28"><a id="__codelineno-117-28" name="__codelineno-117-28" href="#__codelineno-117-28"></a><span class="go">drwxr-xr-x 1 root root   18 Apr 23 22:58 www</span>
</span></code></pre></div>
</li>
<li>
<p>Start Home Assistant <strong>on <code>octavo</code> only</strong> (<em>scaling</em> back to 1 replica):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>home-assistant<span class="w"> </span>deployment<span class="w"> </span>home-assistant<span class="w"> </span>--replicas<span class="o">=</span><span class="m">1</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a><span class="go">deployment.apps/home-assistant scaled</span>
</span></code></pre></div>
</li>
</ol>
<p>Now Home Assistant is available at <a href="https://home-assistant-octavo.royal-penny.ts.net/">https://home-assistant-octavo.royal-penny.ts.net/</a>
and <a href="https://home-assistant-octavo.very-very-dark-gray.top/">https://home-assistant-octavo.very-very-dark-gray.top/</a> and working flawlessly,
with the same user credentails, except for just one little quirk:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../../../media/2025-04-12-kubernetes-homelab-server-with-ubuntu-server-24-04-octavo/home-assistant-octavo-bluetooth-found.png" data-desc-position="bottom"><img alt="Bluetooth devices found in Home Assistant (Octavo)" src="../../../../media/2025-04-12-kubernetes-homelab-server-with-ubuntu-server-24-04-octavo/home-assistant-octavo-bluetooth-found.png" style="height:325px;width:675px"></a></p>
<p><code>DC:21:48:43:B7:C2</code> is the Bluetooth adapter in <code>lexicon</code>, so it can be removed, and
<code>D0:65:78:A5:8B:E1</code> is the Bluetooth adapter in <code>octavo</code> so that's the one to add.</p>
<h4 id="influxdb">InfluxDB</h4>
<p><a href="../../../02/22/home-assistant-on-kubernetes-on-raspberry-pi-5-alfred/#influxdb">The InfluxDB integration</a>
stopped reporting metrics to <code>octavo</code> even though the configuration remained valid;
the integration had gone missing and would no longer be found under
<strong>Settings &gt; Devices &amp; services</strong>. To restore reporting it was found necessary to</p>
<ol>
<li>Remove the <code>influxdb</code> section from Home Assistant's <code>configuration.yaml</code>.</li>
<li>Restart Home Assistant.</li>
<li>Add the <code>influxdb</code> section again to <code>configuration.yaml</code>.</li>
<li>Restart Home Assistant <em>again</em>.</li>
</ol>
<p>This persuaded Home Assistant to add the InfluxDB integration back, and after that
the integration simply resumed sending all metrics again.</p>
<h4 id="synology-dsm">Synology DSM</h4>
<p>Another little surprise from Home Assistant after moving to <code>octavo</code> is
<a href="https://www.home-assistant.io/integrations/synology_dsm/">Synology DSM</a> discovering the
<a href="../../18/synology-ds423-for-the-homelab-luggage/">Synology DS423+ (luggage)</a>.
Create a new NAS user in the admin group but without access to any files, but with
access to all services:</p>
<p><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../../../media/2025-04-12-kubernetes-homelab-server-with-ubuntu-server-24-04-octavo/luggage-new-user-octavo.png" data-desc-position="bottom"><img alt="NAS user for Home Assistant (Octavo)" src="../../../../media/2025-04-12-kubernetes-homelab-server-with-ubuntu-server-24-04-octavo/luggage-new-user-octavo.png" style="height:380px;width:535px"></a></p>
<p>Then add this user's credentials to the Synology DSM integration and specify port
<strong>5001</strong> to use HTTP<strong>S</strong>, <strong>check</strong> the option for <em>Uses an SSL certificate</em> but
<strong>uncheck</strong> the one for <em>Verify SSL certificate</em>. After sumitting, Home Assistant
creates devices for the NAS, each volume and each drive. This adds 5 devides and
43 entities, to be used later to create a
<a href="https://www.reddit.com/r/synology/comments/1gwpq15/home_assistant_synology_integration_dashboard/">cool dashboard</a>.</p>
<h3 id="influxdb-and-grafana">InfluxDB and Grafana</h3>
<p><a href="../../../../2024/04/20/monitoring-with-influxdb-and-grafana-on-kubernetes/">InfluxDB and Grafana</a>
running in <code>lexicon</code> collect data from all sources reporting through
<a href="../../../../../projects/conmon/">Continuous Monitoring</a> and serves the dashboards.
This setup is about a year old and runing Grafana 10.4.2 and InfluxDB 1.8.
Seems like time to update these:</p>
<ul>
<li><a href="https://docs.influxdata.com/influxdb/v1/about_the_project/release-notes/#v1117"><em>Upgrading InfluxDB from v1.8.10 to v1.11.7 is a large jump</em></a>
    and there is no reason to switch to v2 given
    <a href="../../../../../projects/conmon/#the-future-of-flux">the future of Flux</a>
    (deprecated and not planned for InfluxDB v3).</li>
<li><a href="https://grafana.com/docs/grafana/latest/breaking-changes/breaking-changes-v11-0/">Breaking changes in Grafana v11.0</a>
    looks like it <em>should be fine</em> to update from 10.4.2, at least worth a try.</li>
</ul>
<p>At this time the latest versions available in Docker images are
<a href="https://hub.docker.com/_/influxdb/tags">InfluxDB 1.11.8</a> and
<a href="https://hub.docker.com/r/grafana/grafana/tags">Grafana 11.6.1</a>.</p>
<details class="k8s">
<summary>Combined deployment for InfluxDB and Grafana</summary>
<div class="language-yaml highlight"><span class="filename">monitoring.yaml</span><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-5"><a id="__codelineno-119-5" name="__codelineno-119-5" href="#__codelineno-119-5"></a><span class="nn">---</span>
</span><span id="__span-119-6"><a id="__codelineno-119-6" name="__codelineno-119-6" href="#__codelineno-119-6"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-119-7"><a id="__codelineno-119-7" name="__codelineno-119-7" href="#__codelineno-119-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-119-8"><a id="__codelineno-119-8" name="__codelineno-119-8" href="#__codelineno-119-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-9"><a id="__codelineno-119-9" name="__codelineno-119-9" href="#__codelineno-119-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb-pv</span>
</span><span id="__span-119-10"><a id="__codelineno-119-10" name="__codelineno-119-10" href="#__codelineno-119-10"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-119-11"><a id="__codelineno-119-11" name="__codelineno-119-11" href="#__codelineno-119-11"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-119-12"><a id="__codelineno-119-12" name="__codelineno-119-12" href="#__codelineno-119-12"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-13"><a id="__codelineno-119-13" name="__codelineno-119-13" href="#__codelineno-119-13"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-14"><a id="__codelineno-119-14" name="__codelineno-119-14" href="#__codelineno-119-14"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-119-15"><a id="__codelineno-119-15" name="__codelineno-119-15" href="#__codelineno-119-15"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-119-16"><a id="__codelineno-119-16" name="__codelineno-119-16" href="#__codelineno-119-16"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30Gi</span>
</span><span id="__span-119-17"><a id="__codelineno-119-17" name="__codelineno-119-17" href="#__codelineno-119-17"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-119-18"><a id="__codelineno-119-18" name="__codelineno-119-18" href="#__codelineno-119-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-119-19"><a id="__codelineno-119-19" name="__codelineno-119-19" href="#__codelineno-119-19"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-119-20"><a id="__codelineno-119-20" name="__codelineno-119-20" href="#__codelineno-119-20"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/influxdb</span>
</span><span id="__span-119-21"><a id="__codelineno-119-21" name="__codelineno-119-21" href="#__codelineno-119-21"></a><span class="nn">---</span>
</span><span id="__span-119-22"><a id="__codelineno-119-22" name="__codelineno-119-22" href="#__codelineno-119-22"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-119-23"><a id="__codelineno-119-23" name="__codelineno-119-23" href="#__codelineno-119-23"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-119-24"><a id="__codelineno-119-24" name="__codelineno-119-24" href="#__codelineno-119-24"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-25"><a id="__codelineno-119-25" name="__codelineno-119-25" href="#__codelineno-119-25"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb-pv-claim</span>
</span><span id="__span-119-26"><a id="__codelineno-119-26" name="__codelineno-119-26" href="#__codelineno-119-26"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-27"><a id="__codelineno-119-27" name="__codelineno-119-27" href="#__codelineno-119-27"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-28"><a id="__codelineno-119-28" name="__codelineno-119-28" href="#__codelineno-119-28"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-119-29"><a id="__codelineno-119-29" name="__codelineno-119-29" href="#__codelineno-119-29"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb-pv</span>
</span><span id="__span-119-30"><a id="__codelineno-119-30" name="__codelineno-119-30" href="#__codelineno-119-30"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-119-31"><a id="__codelineno-119-31" name="__codelineno-119-31" href="#__codelineno-119-31"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-119-32"><a id="__codelineno-119-32" name="__codelineno-119-32" href="#__codelineno-119-32"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-119-33"><a id="__codelineno-119-33" name="__codelineno-119-33" href="#__codelineno-119-33"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-119-34"><a id="__codelineno-119-34" name="__codelineno-119-34" href="#__codelineno-119-34"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30Gi</span>
</span><span id="__span-119-35"><a id="__codelineno-119-35" name="__codelineno-119-35" href="#__codelineno-119-35"></a><span class="nn">---</span>
</span><span id="__span-119-36"><a id="__codelineno-119-36" name="__codelineno-119-36" href="#__codelineno-119-36"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-119-37"><a id="__codelineno-119-37" name="__codelineno-119-37" href="#__codelineno-119-37"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-119-38"><a id="__codelineno-119-38" name="__codelineno-119-38" href="#__codelineno-119-38"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-39"><a id="__codelineno-119-39" name="__codelineno-119-39" href="#__codelineno-119-39"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-40"><a id="__codelineno-119-40" name="__codelineno-119-40" href="#__codelineno-119-40"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-119-41"><a id="__codelineno-119-41" name="__codelineno-119-41" href="#__codelineno-119-41"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
</span><span id="__span-119-42"><a id="__codelineno-119-42" name="__codelineno-119-42" href="#__codelineno-119-42"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
</span><span id="__span-119-43"><a id="__codelineno-119-43" name="__codelineno-119-43" href="#__codelineno-119-43"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-44"><a id="__codelineno-119-44" name="__codelineno-119-44" href="#__codelineno-119-44"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-119-45"><a id="__codelineno-119-45" name="__codelineno-119-45" href="#__codelineno-119-45"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-119-46"><a id="__codelineno-119-46" name="__codelineno-119-46" href="#__codelineno-119-46"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-119-47"><a id="__codelineno-119-47" name="__codelineno-119-47" href="#__codelineno-119-47"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
</span><span id="__span-119-48"><a id="__codelineno-119-48" name="__codelineno-119-48" href="#__codelineno-119-48"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-119-49"><a id="__codelineno-119-49" name="__codelineno-119-49" href="#__codelineno-119-49"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-50"><a id="__codelineno-119-50" name="__codelineno-119-50" href="#__codelineno-119-50"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-119-51"><a id="__codelineno-119-51" name="__codelineno-119-51" href="#__codelineno-119-51"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
</span><span id="__span-119-52"><a id="__codelineno-119-52" name="__codelineno-119-52" href="#__codelineno-119-52"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-53"><a id="__codelineno-119-53" name="__codelineno-119-53" href="#__codelineno-119-53"></a><span class="w">      </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
</span><span id="__span-119-54"><a id="__codelineno-119-54" name="__codelineno-119-54" href="#__codelineno-119-54"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-119-55"><a id="__codelineno-119-55" name="__codelineno-119-55" href="#__codelineno-119-55"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.io/influxdb:1.11.8</span>
</span><span id="__span-119-56"><a id="__codelineno-119-56" name="__codelineno-119-56" href="#__codelineno-119-56"></a><span class="w">        </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-119-57"><a id="__codelineno-119-57" name="__codelineno-119-57" href="#__codelineno-119-57"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"INFLUXDB_HTTP_AUTH_ENABLED"</span>
</span><span id="__span-119-58"><a id="__codelineno-119-58" name="__codelineno-119-58" href="#__codelineno-119-58"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-119-59"><a id="__codelineno-119-59" name="__codelineno-119-59" href="#__codelineno-119-59"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
</span><span id="__span-119-60"><a id="__codelineno-119-60" name="__codelineno-119-60" href="#__codelineno-119-60"></a><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-119-61"><a id="__codelineno-119-61" name="__codelineno-119-61" href="#__codelineno-119-61"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/influxdb</span>
</span><span id="__span-119-62"><a id="__codelineno-119-62" name="__codelineno-119-62" href="#__codelineno-119-62"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb-data</span>
</span><span id="__span-119-63"><a id="__codelineno-119-63" name="__codelineno-119-63" href="#__codelineno-119-63"></a><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span>
</span><span id="__span-119-64"><a id="__codelineno-119-64" name="__codelineno-119-64" href="#__codelineno-119-64"></a><span class="w">        </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">114</span>
</span><span id="__span-119-65"><a id="__codelineno-119-65" name="__codelineno-119-65" href="#__codelineno-119-65"></a><span class="w">        </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">114</span>
</span><span id="__span-119-66"><a id="__codelineno-119-66" name="__codelineno-119-66" href="#__codelineno-119-66"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-119-67"><a id="__codelineno-119-67" name="__codelineno-119-67" href="#__codelineno-119-67"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb-data</span>
</span><span id="__span-119-68"><a id="__codelineno-119-68" name="__codelineno-119-68" href="#__codelineno-119-68"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-119-69"><a id="__codelineno-119-69" name="__codelineno-119-69" href="#__codelineno-119-69"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb-pv-claim</span>
</span><span id="__span-119-70"><a id="__codelineno-119-70" name="__codelineno-119-70" href="#__codelineno-119-70"></a><span class="nn">---</span>
</span><span id="__span-119-71"><a id="__codelineno-119-71" name="__codelineno-119-71" href="#__codelineno-119-71"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-119-72"><a id="__codelineno-119-72" name="__codelineno-119-72" href="#__codelineno-119-72"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-119-73"><a id="__codelineno-119-73" name="__codelineno-119-73" href="#__codelineno-119-73"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-74"><a id="__codelineno-119-74" name="__codelineno-119-74" href="#__codelineno-119-74"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-119-75"><a id="__codelineno-119-75" name="__codelineno-119-75" href="#__codelineno-119-75"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
</span><span id="__span-119-76"><a id="__codelineno-119-76" name="__codelineno-119-76" href="#__codelineno-119-76"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb-svc</span>
</span><span id="__span-119-77"><a id="__codelineno-119-77" name="__codelineno-119-77" href="#__codelineno-119-77"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-78"><a id="__codelineno-119-78" name="__codelineno-119-78" href="#__codelineno-119-78"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-79"><a id="__codelineno-119-79" name="__codelineno-119-79" href="#__codelineno-119-79"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-119-80"><a id="__codelineno-119-80" name="__codelineno-119-80" href="#__codelineno-119-80"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">18086</span>
</span><span id="__span-119-81"><a id="__codelineno-119-81" name="__codelineno-119-81" href="#__codelineno-119-81"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-119-82"><a id="__codelineno-119-82" name="__codelineno-119-82" href="#__codelineno-119-82"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8086</span>
</span><span id="__span-119-83"><a id="__codelineno-119-83" name="__codelineno-119-83" href="#__codelineno-119-83"></a><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30086</span>
</span><span id="__span-119-84"><a id="__codelineno-119-84" name="__codelineno-119-84" href="#__codelineno-119-84"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-119-85"><a id="__codelineno-119-85" name="__codelineno-119-85" href="#__codelineno-119-85"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb</span>
</span><span id="__span-119-86"><a id="__codelineno-119-86" name="__codelineno-119-86" href="#__codelineno-119-86"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</span><span id="__span-119-87"><a id="__codelineno-119-87" name="__codelineno-119-87" href="#__codelineno-119-87"></a><span class="nn">---</span>
</span><span id="__span-119-88"><a id="__codelineno-119-88" name="__codelineno-119-88" href="#__codelineno-119-88"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-119-89"><a id="__codelineno-119-89" name="__codelineno-119-89" href="#__codelineno-119-89"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-119-90"><a id="__codelineno-119-90" name="__codelineno-119-90" href="#__codelineno-119-90"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-91"><a id="__codelineno-119-91" name="__codelineno-119-91" href="#__codelineno-119-91"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-pv</span>
</span><span id="__span-119-92"><a id="__codelineno-119-92" name="__codelineno-119-92" href="#__codelineno-119-92"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-119-93"><a id="__codelineno-119-93" name="__codelineno-119-93" href="#__codelineno-119-93"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-119-94"><a id="__codelineno-119-94" name="__codelineno-119-94" href="#__codelineno-119-94"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-95"><a id="__codelineno-119-95" name="__codelineno-119-95" href="#__codelineno-119-95"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-96"><a id="__codelineno-119-96" name="__codelineno-119-96" href="#__codelineno-119-96"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-119-97"><a id="__codelineno-119-97" name="__codelineno-119-97" href="#__codelineno-119-97"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-119-98"><a id="__codelineno-119-98" name="__codelineno-119-98" href="#__codelineno-119-98"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3Gi</span>
</span><span id="__span-119-99"><a id="__codelineno-119-99" name="__codelineno-119-99" href="#__codelineno-119-99"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-119-100"><a id="__codelineno-119-100" name="__codelineno-119-100" href="#__codelineno-119-100"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-119-101"><a id="__codelineno-119-101" name="__codelineno-119-101" href="#__codelineno-119-101"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-119-102"><a id="__codelineno-119-102" name="__codelineno-119-102" href="#__codelineno-119-102"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/grafana</span>
</span><span id="__span-119-103"><a id="__codelineno-119-103" name="__codelineno-119-103" href="#__codelineno-119-103"></a><span class="nn">---</span>
</span><span id="__span-119-104"><a id="__codelineno-119-104" name="__codelineno-119-104" href="#__codelineno-119-104"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-119-105"><a id="__codelineno-119-105" name="__codelineno-119-105" href="#__codelineno-119-105"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-119-106"><a id="__codelineno-119-106" name="__codelineno-119-106" href="#__codelineno-119-106"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-107"><a id="__codelineno-119-107" name="__codelineno-119-107" href="#__codelineno-119-107"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-pv-claim</span>
</span><span id="__span-119-108"><a id="__codelineno-119-108" name="__codelineno-119-108" href="#__codelineno-119-108"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-109"><a id="__codelineno-119-109" name="__codelineno-119-109" href="#__codelineno-119-109"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-110"><a id="__codelineno-119-110" name="__codelineno-119-110" href="#__codelineno-119-110"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-119-111"><a id="__codelineno-119-111" name="__codelineno-119-111" href="#__codelineno-119-111"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-pv</span>
</span><span id="__span-119-112"><a id="__codelineno-119-112" name="__codelineno-119-112" href="#__codelineno-119-112"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-119-113"><a id="__codelineno-119-113" name="__codelineno-119-113" href="#__codelineno-119-113"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-119-114"><a id="__codelineno-119-114" name="__codelineno-119-114" href="#__codelineno-119-114"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-119-115"><a id="__codelineno-119-115" name="__codelineno-119-115" href="#__codelineno-119-115"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-119-116"><a id="__codelineno-119-116" name="__codelineno-119-116" href="#__codelineno-119-116"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3Gi</span>
</span><span id="__span-119-117"><a id="__codelineno-119-117" name="__codelineno-119-117" href="#__codelineno-119-117"></a><span class="nn">---</span>
</span><span id="__span-119-118"><a id="__codelineno-119-118" name="__codelineno-119-118" href="#__codelineno-119-118"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-119-119"><a id="__codelineno-119-119" name="__codelineno-119-119" href="#__codelineno-119-119"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-119-120"><a id="__codelineno-119-120" name="__codelineno-119-120" href="#__codelineno-119-120"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-121"><a id="__codelineno-119-121" name="__codelineno-119-121" href="#__codelineno-119-121"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-122"><a id="__codelineno-119-122" name="__codelineno-119-122" href="#__codelineno-119-122"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-119-123"><a id="__codelineno-119-123" name="__codelineno-119-123" href="#__codelineno-119-123"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-119-124"><a id="__codelineno-119-124" name="__codelineno-119-124" href="#__codelineno-119-124"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-119-125"><a id="__codelineno-119-125" name="__codelineno-119-125" href="#__codelineno-119-125"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-126"><a id="__codelineno-119-126" name="__codelineno-119-126" href="#__codelineno-119-126"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-119-127"><a id="__codelineno-119-127" name="__codelineno-119-127" href="#__codelineno-119-127"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-119-128"><a id="__codelineno-119-128" name="__codelineno-119-128" href="#__codelineno-119-128"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-119-129"><a id="__codelineno-119-129" name="__codelineno-119-129" href="#__codelineno-119-129"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-119-130"><a id="__codelineno-119-130" name="__codelineno-119-130" href="#__codelineno-119-130"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-119-131"><a id="__codelineno-119-131" name="__codelineno-119-131" href="#__codelineno-119-131"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-132"><a id="__codelineno-119-132" name="__codelineno-119-132" href="#__codelineno-119-132"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-119-133"><a id="__codelineno-119-133" name="__codelineno-119-133" href="#__codelineno-119-133"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-119-134"><a id="__codelineno-119-134" name="__codelineno-119-134" href="#__codelineno-119-134"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-135"><a id="__codelineno-119-135" name="__codelineno-119-135" href="#__codelineno-119-135"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-119-136"><a id="__codelineno-119-136" name="__codelineno-119-136" href="#__codelineno-119-136"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">docker.io/grafana/grafana:11.6.1</span>
</span><span id="__span-119-137"><a id="__codelineno-119-137" name="__codelineno-119-137" href="#__codelineno-119-137"></a><span class="w">        </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-119-138"><a id="__codelineno-119-138" name="__codelineno-119-138" href="#__codelineno-119-138"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HOSTNAME</span>
</span><span id="__span-119-139"><a id="__codelineno-119-139" name="__codelineno-119-139" href="#__codelineno-119-139"></a><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span>
</span><span id="__span-119-140"><a id="__codelineno-119-140" name="__codelineno-119-140" href="#__codelineno-119-140"></a><span class="w">            </span><span class="nt">fieldRef</span><span class="p">:</span>
</span><span id="__span-119-141"><a id="__codelineno-119-141" name="__codelineno-119-141" href="#__codelineno-119-141"></a><span class="w">              </span><span class="nt">fieldPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spec.nodeName</span>
</span><span id="__span-119-142"><a id="__codelineno-119-142" name="__codelineno-119-142" href="#__codelineno-119-142"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"GF_AUTH_ANONYMOUS_ENABLED"</span>
</span><span id="__span-119-143"><a id="__codelineno-119-143" name="__codelineno-119-143" href="#__codelineno-119-143"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-119-144"><a id="__codelineno-119-144" name="__codelineno-119-144" href="#__codelineno-119-144"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"GF_SECURITY_ADMIN_USER"</span>
</span><span id="__span-119-145"><a id="__codelineno-119-145" name="__codelineno-119-145" href="#__codelineno-119-145"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"admin"</span>
</span><span id="__span-119-146"><a id="__codelineno-119-146" name="__codelineno-119-146" href="#__codelineno-119-146"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">"GF_SECURITY_ADMIN_PASSWORD"</span>
</span><span id="__span-119-147"><a id="__codelineno-119-147" name="__codelineno-119-147" href="#__codelineno-119-147"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"__________________________"</span>
</span><span id="__span-119-148"><a id="__codelineno-119-148" name="__codelineno-119-148" href="#__codelineno-119-148"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-119-149"><a id="__codelineno-119-149" name="__codelineno-119-149" href="#__codelineno-119-149"></a><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-119-150"><a id="__codelineno-119-150" name="__codelineno-119-150" href="#__codelineno-119-150"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-data</span>
</span><span id="__span-119-151"><a id="__codelineno-119-151" name="__codelineno-119-151" href="#__codelineno-119-151"></a><span class="w">            </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/grafana</span>
</span><span id="__span-119-152"><a id="__codelineno-119-152" name="__codelineno-119-152" href="#__codelineno-119-152"></a><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span>
</span><span id="__span-119-153"><a id="__codelineno-119-153" name="__codelineno-119-153" href="#__codelineno-119-153"></a><span class="w">        </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">115</span>
</span><span id="__span-119-154"><a id="__codelineno-119-154" name="__codelineno-119-154" href="#__codelineno-119-154"></a><span class="w">        </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">115</span>
</span><span id="__span-119-155"><a id="__codelineno-119-155" name="__codelineno-119-155" href="#__codelineno-119-155"></a><span class="w">        </span><span class="nt">fsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">115</span>
</span><span id="__span-119-156"><a id="__codelineno-119-156" name="__codelineno-119-156" href="#__codelineno-119-156"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-119-157"><a id="__codelineno-119-157" name="__codelineno-119-157" href="#__codelineno-119-157"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-data</span>
</span><span id="__span-119-158"><a id="__codelineno-119-158" name="__codelineno-119-158" href="#__codelineno-119-158"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-119-159"><a id="__codelineno-119-159" name="__codelineno-119-159" href="#__codelineno-119-159"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-pv-claim</span>
</span><span id="__span-119-160"><a id="__codelineno-119-160" name="__codelineno-119-160" href="#__codelineno-119-160"></a><span class="nn">---</span>
</span><span id="__span-119-161"><a id="__codelineno-119-161" name="__codelineno-119-161" href="#__codelineno-119-161"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-119-162"><a id="__codelineno-119-162" name="__codelineno-119-162" href="#__codelineno-119-162"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-119-163"><a id="__codelineno-119-163" name="__codelineno-119-163" href="#__codelineno-119-163"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-164"><a id="__codelineno-119-164" name="__codelineno-119-164" href="#__codelineno-119-164"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-119-165"><a id="__codelineno-119-165" name="__codelineno-119-165" href="#__codelineno-119-165"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-119-166"><a id="__codelineno-119-166" name="__codelineno-119-166" href="#__codelineno-119-166"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-svc</span>
</span><span id="__span-119-167"><a id="__codelineno-119-167" name="__codelineno-119-167" href="#__codelineno-119-167"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-168"><a id="__codelineno-119-168" name="__codelineno-119-168" href="#__codelineno-119-168"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-169"><a id="__codelineno-119-169" name="__codelineno-119-169" href="#__codelineno-119-169"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-119-170"><a id="__codelineno-119-170" name="__codelineno-119-170" href="#__codelineno-119-170"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">13000</span>
</span><span id="__span-119-171"><a id="__codelineno-119-171" name="__codelineno-119-171" href="#__codelineno-119-171"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-119-172"><a id="__codelineno-119-172" name="__codelineno-119-172" href="#__codelineno-119-172"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
</span><span id="__span-119-173"><a id="__codelineno-119-173" name="__codelineno-119-173" href="#__codelineno-119-173"></a><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30300</span>
</span><span id="__span-119-174"><a id="__codelineno-119-174" name="__codelineno-119-174" href="#__codelineno-119-174"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-119-175"><a id="__codelineno-119-175" name="__codelineno-119-175" href="#__codelineno-119-175"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-119-176"><a id="__codelineno-119-176" name="__codelineno-119-176" href="#__codelineno-119-176"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</span><span id="__span-119-177"><a id="__codelineno-119-177" name="__codelineno-119-177" href="#__codelineno-119-177"></a><span class="nn">---</span>
</span><span id="__span-119-178"><a id="__codelineno-119-178" name="__codelineno-119-178" href="#__codelineno-119-178"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-119-179"><a id="__codelineno-119-179" name="__codelineno-119-179" href="#__codelineno-119-179"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-119-180"><a id="__codelineno-119-180" name="__codelineno-119-180" href="#__codelineno-119-180"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-181"><a id="__codelineno-119-181" name="__codelineno-119-181" href="#__codelineno-119-181"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-ingress</span>
</span><span id="__span-119-182"><a id="__codelineno-119-182" name="__codelineno-119-182" href="#__codelineno-119-182"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-183"><a id="__codelineno-119-183" name="__codelineno-119-183" href="#__codelineno-119-183"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-119-184"><a id="__codelineno-119-184" name="__codelineno-119-184" href="#__codelineno-119-184"></a><span class="w">    </span><span class="nt">acme.cert-manager.io/http01-edit-in-place</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-119-185"><a id="__codelineno-119-185" name="__codelineno-119-185" href="#__codelineno-119-185"></a><span class="w">    </span><span class="nt">cert-manager.io/issue-temporary-certificate</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-119-186"><a id="__codelineno-119-186" name="__codelineno-119-186" href="#__codelineno-119-186"></a><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-119-187"><a id="__codelineno-119-187" name="__codelineno-119-187" href="#__codelineno-119-187"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-188"><a id="__codelineno-119-188" name="__codelineno-119-188" href="#__codelineno-119-188"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-119-189"><a id="__codelineno-119-189" name="__codelineno-119-189" href="#__codelineno-119-189"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-119-190"><a id="__codelineno-119-190" name="__codelineno-119-190" href="#__codelineno-119-190"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana.very-very-dark-gray.top</span>
</span><span id="__span-119-191"><a id="__codelineno-119-191" name="__codelineno-119-191" href="#__codelineno-119-191"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-119-192"><a id="__codelineno-119-192" name="__codelineno-119-192" href="#__codelineno-119-192"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-119-193"><a id="__codelineno-119-193" name="__codelineno-119-193" href="#__codelineno-119-193"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-119-194"><a id="__codelineno-119-194" name="__codelineno-119-194" href="#__codelineno-119-194"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-119-195"><a id="__codelineno-119-195" name="__codelineno-119-195" href="#__codelineno-119-195"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-119-196"><a id="__codelineno-119-196" name="__codelineno-119-196" href="#__codelineno-119-196"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-119-197"><a id="__codelineno-119-197" name="__codelineno-119-197" href="#__codelineno-119-197"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-svc</span>
</span><span id="__span-119-198"><a id="__codelineno-119-198" name="__codelineno-119-198" href="#__codelineno-119-198"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-119-199"><a id="__codelineno-119-199" name="__codelineno-119-199" href="#__codelineno-119-199"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3000</span>
</span><span id="__span-119-200"><a id="__codelineno-119-200" name="__codelineno-119-200" href="#__codelineno-119-200"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-119-201"><a id="__codelineno-119-201" name="__codelineno-119-201" href="#__codelineno-119-201"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret-grafana</span>
</span><span id="__span-119-202"><a id="__codelineno-119-202" name="__codelineno-119-202" href="#__codelineno-119-202"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-119-203"><a id="__codelineno-119-203" name="__codelineno-119-203" href="#__codelineno-119-203"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana.very-very-dark-gray.top</span>
</span><span id="__span-119-204"><a id="__codelineno-119-204" name="__codelineno-119-204" href="#__codelineno-119-204"></a><span class="nn">---</span>
</span><span id="__span-119-205"><a id="__codelineno-119-205" name="__codelineno-119-205" href="#__codelineno-119-205"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-119-206"><a id="__codelineno-119-206" name="__codelineno-119-206" href="#__codelineno-119-206"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-119-207"><a id="__codelineno-119-207" name="__codelineno-119-207" href="#__codelineno-119-207"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-119-208"><a id="__codelineno-119-208" name="__codelineno-119-208" href="#__codelineno-119-208"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb-ingress</span>
</span><span id="__span-119-209"><a id="__codelineno-119-209" name="__codelineno-119-209" href="#__codelineno-119-209"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">monitoring</span>
</span><span id="__span-119-210"><a id="__codelineno-119-210" name="__codelineno-119-210" href="#__codelineno-119-210"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-119-211"><a id="__codelineno-119-211" name="__codelineno-119-211" href="#__codelineno-119-211"></a><span class="w">    </span><span class="nt">acme.cert-manager.io/http01-edit-in-place</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-119-212"><a id="__codelineno-119-212" name="__codelineno-119-212" href="#__codelineno-119-212"></a><span class="w">    </span><span class="nt">cert-manager.io/issue-temporary-certificate</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-119-213"><a id="__codelineno-119-213" name="__codelineno-119-213" href="#__codelineno-119-213"></a><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-119-214"><a id="__codelineno-119-214" name="__codelineno-119-214" href="#__codelineno-119-214"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-119-215"><a id="__codelineno-119-215" name="__codelineno-119-215" href="#__codelineno-119-215"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-119-216"><a id="__codelineno-119-216" name="__codelineno-119-216" href="#__codelineno-119-216"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-119-217"><a id="__codelineno-119-217" name="__codelineno-119-217" href="#__codelineno-119-217"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb.very-very-dark-gray.top</span>
</span><span id="__span-119-218"><a id="__codelineno-119-218" name="__codelineno-119-218" href="#__codelineno-119-218"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-119-219"><a id="__codelineno-119-219" name="__codelineno-119-219" href="#__codelineno-119-219"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-119-220"><a id="__codelineno-119-220" name="__codelineno-119-220" href="#__codelineno-119-220"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-119-221"><a id="__codelineno-119-221" name="__codelineno-119-221" href="#__codelineno-119-221"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-119-222"><a id="__codelineno-119-222" name="__codelineno-119-222" href="#__codelineno-119-222"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-119-223"><a id="__codelineno-119-223" name="__codelineno-119-223" href="#__codelineno-119-223"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-119-224"><a id="__codelineno-119-224" name="__codelineno-119-224" href="#__codelineno-119-224"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb-svc</span>
</span><span id="__span-119-225"><a id="__codelineno-119-225" name="__codelineno-119-225" href="#__codelineno-119-225"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-119-226"><a id="__codelineno-119-226" name="__codelineno-119-226" href="#__codelineno-119-226"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8086</span>
</span><span id="__span-119-227"><a id="__codelineno-119-227" name="__codelineno-119-227" href="#__codelineno-119-227"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-119-228"><a id="__codelineno-119-228" name="__codelineno-119-228" href="#__codelineno-119-228"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret-influxdb</span>
</span><span id="__span-119-229"><a id="__codelineno-119-229" name="__codelineno-119-229" href="#__codelineno-119-229"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-119-230"><a id="__codelineno-119-230" name="__codelineno-119-230" href="#__codelineno-119-230"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">influxdb.very-very-dark-gray.top</span>
</span></code></pre></div>
</details>
<p>Before deploying the above, dedicated users and home directories must be created for
<code>influxdb</code> and <code>grafana</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="gp">root@octavo ~ # </span>groupadd<span class="w"> </span>influxdb<span class="w"> </span>-g<span class="w"> </span><span class="m">114</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="gp">root@octavo ~ # </span>groupadd<span class="w"> </span>grafana<span class="w">  </span>-g<span class="w"> </span><span class="m">115</span>
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a><span class="gp">root@octavo ~ # </span>useradd<span class="w">  </span>influxdb<span class="w"> </span>-u<span class="w"> </span><span class="m">114</span><span class="w"> </span>-g<span class="w"> </span><span class="m">114</span><span class="w"> </span>-s<span class="w"> </span>/usr/sbin/nologin
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="gp">root@octavo ~ # </span>useradd<span class="w">  </span>grafana<span class="w">  </span>-u<span class="w"> </span><span class="m">115</span><span class="w"> </span>-g<span class="w"> </span><span class="m">115</span><span class="w"> </span>-s<span class="w"> </span>/usr/sbin/nologin
</span></code></pre></div>
<p>Then files need to be copied over at the right time between stopping the services
in <code>lexicon</code> and starting them again:</p>
<ol>
<li>
<p>Stop Grafana and InfluxDB (in this <strong>order) in <code>lexicon</code></strong>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>monitoring<span class="w"> </span>deployment<span class="w"> </span>grafana<span class="w">  </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="go">deployment.apps/grafana scaled</span>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>monitoring<span class="w"> </span>deployment<span class="w"> </span>influxdb<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="go">deployment.apps/influxdb scaled</span>
</span></code></pre></div>
</li>
<li>
<p>Copy data over from <code>lexicon</code> to <code>octavo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/influxdb<span class="w"> </span>/home/k8s/
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/grafana<span class="w">  </span>/home/k8s/
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="gp">root@octavo ~ # </span>chown<span class="w"> </span>-R<span class="w"> </span>influxdb:influxdb<span class="w"> </span>/home/k8s/influxdb
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a><span class="gp">root@octavo ~ # </span>chown<span class="w"> </span>-R<span class="w">  </span>grafana:grafana<span class="w">  </span>/home/k8s/grafana
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="gp">root@octavo ~ # </span>ls<span class="w"> </span>-hal<span class="w"> </span>/home/k8s/influxdb<span class="w"> </span>/home/k8s/grafana
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="go">/home/k8s/grafana:</span>
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="go">total 3.9M</span>
</span><span id="__span-122-8"><a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a><span class="go">drwxr-xr-x 1 grafana grafana   68 Apr 27 19:08 .</span>
</span><span id="__span-122-9"><a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="go">drwxr-xr-x 1 root    root      58 Apr 27 19:10 ..</span>
</span><span id="__span-122-10"><a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="go">drwxr-x--- 1 grafana grafana    2 Apr 20  2024 alerting</span>
</span><span id="__span-122-11"><a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="go">drwx------ 1 grafana grafana    0 Apr 20  2024 csv</span>
</span><span id="__span-122-12"><a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a><span class="go">-rw-r----- 1 grafana grafana 3.9M Apr 27 19:08 grafana.db</span>
</span><span id="__span-122-13"><a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="go">drwx------ 1 grafana grafana    0 Apr 20  2024 pdf</span>
</span><span id="__span-122-14"><a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="go">drwxr-xr-x 1 grafana grafana    0 Apr 20  2024 plugins</span>
</span><span id="__span-122-15"><a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="go">drwx------ 1 grafana grafana    0 Apr 20  2024 png</span>
</span><span id="__span-122-16"><a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a>
</span><span id="__span-122-17"><a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a><span class="go">/home/k8s/influxdb:</span>
</span><span id="__span-122-18"><a id="__codelineno-122-18" name="__codelineno-122-18" href="#__codelineno-122-18"></a><span class="go">total 0</span>
</span><span id="__span-122-19"><a id="__codelineno-122-19" name="__codelineno-122-19" href="#__codelineno-122-19"></a><span class="go">drwxr-xr-x 1 influxdb influxdb 22 Apr 20  2024 .</span>
</span><span id="__span-122-20"><a id="__codelineno-122-20" name="__codelineno-122-20" href="#__codelineno-122-20"></a><span class="go">drwxr-xr-x 1 root     root     58 Apr 27 19:10 ..</span>
</span><span id="__span-122-21"><a id="__codelineno-122-21" name="__codelineno-122-21" href="#__codelineno-122-21"></a><span class="go">drwxr-xr-x 1 influxdb influxdb 90 Apr 26 08:20 data</span>
</span><span id="__span-122-22"><a id="__codelineno-122-22" name="__codelineno-122-22" href="#__codelineno-122-22"></a><span class="go">drwxr-xr-x 1 influxdb influxdb 14 Apr 27 02:08 meta</span>
</span><span id="__span-122-23"><a id="__codelineno-122-23" name="__codelineno-122-23" href="#__codelineno-122-23"></a><span class="go">drwx------ 1 influxdb influxdb 90 Apr 26 08:20 wal</span>
</span></code></pre></div>
</li>
<li>
<p>Start InfluxDB and Grafana <strong>(in this order)</strong> in <code>lexicon</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>monitoring<span class="w"> </span>deployment<span class="w"> </span>influxdb<span class="w"> </span>--replicas<span class="o">=</span><span class="m">1</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="go">deployment.apps/influxdb scaled</span>
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>monitoring<span class="w"> </span>deployment<span class="w"> </span>grafana<span class="w">  </span>--replicas<span class="o">=</span><span class="m">1</span>
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="go">deployment.apps/grafana scaled</span>
</span></code></pre></div>
</li>
</ol>
<p>Finally, start the deployment in <code>octavo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>monitoring.yaml
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="go">namespace/monitoring created</span>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a><span class="go">persistentvolume/influxdb-pv created</span>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="go">persistentvolumeclaim/influxdb-pv-claim created</span>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="go">deployment.apps/influxdb created</span>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="go">service/influxdb-svc created</span>
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a><span class="go">persistentvolume/grafana-pv created</span>
</span><span id="__span-124-8"><a id="__codelineno-124-8" name="__codelineno-124-8" href="#__codelineno-124-8"></a><span class="go">persistentvolumeclaim/grafana-pv-claim created</span>
</span><span id="__span-124-9"><a id="__codelineno-124-9" name="__codelineno-124-9" href="#__codelineno-124-9"></a><span class="go">deployment.apps/grafana created</span>
</span><span id="__span-124-10"><a id="__codelineno-124-10" name="__codelineno-124-10" href="#__codelineno-124-10"></a><span class="go">service/grafana-svc created</span>
</span><span id="__span-124-11"><a id="__codelineno-124-11" name="__codelineno-124-11" href="#__codelineno-124-11"></a><span class="go">ingress.networking.k8s.io/grafana-ingress created</span>
</span><span id="__span-124-12"><a id="__codelineno-124-12" name="__codelineno-124-12" href="#__codelineno-124-12"></a><span class="go">ingress.networking.k8s.io/influxdb-ingress created</span>
</span><span id="__span-124-13"><a id="__codelineno-124-13" name="__codelineno-124-13" href="#__codelineno-124-13"></a>
</span><span id="__span-124-14"><a id="__codelineno-124-14" name="__codelineno-124-14" href="#__codelineno-124-14"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>monitoring
</span><span id="__span-124-15"><a id="__codelineno-124-15" name="__codelineno-124-15" href="#__codelineno-124-15"></a><span class="go">NAME                            READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-124-16"><a id="__codelineno-124-16" name="__codelineno-124-16" href="#__codelineno-124-16"></a><span class="go">pod/cm-acme-http-solver-dkgn5   1/1     Running   0          59s</span>
</span><span id="__span-124-17"><a id="__codelineno-124-17" name="__codelineno-124-17" href="#__codelineno-124-17"></a><span class="go">pod/grafana-6fff9dbb6c-v22hg    1/1     Running   0          62s</span>
</span><span id="__span-124-18"><a id="__codelineno-124-18" name="__codelineno-124-18" href="#__codelineno-124-18"></a><span class="go">pod/influxdb-5974bf664f-8r5mf   1/1     Running   0          62s</span>
</span><span id="__span-124-19"><a id="__codelineno-124-19" name="__codelineno-124-19" href="#__codelineno-124-19"></a>
</span><span id="__span-124-20"><a id="__codelineno-124-20" name="__codelineno-124-20" href="#__codelineno-124-20"></a><span class="go">NAME                                TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)           AGE</span>
</span><span id="__span-124-21"><a id="__codelineno-124-21" name="__codelineno-124-21" href="#__codelineno-124-21"></a><span class="go">service/cm-acme-http-solver-n8l8h   NodePort   10.98.3.183     &lt;none&gt;        8089:30378/TCP    59s</span>
</span><span id="__span-124-22"><a id="__codelineno-124-22" name="__codelineno-124-22" href="#__codelineno-124-22"></a><span class="go">service/grafana-svc                 NodePort   10.110.29.239   &lt;none&gt;        13000:30300/TCP   62s</span>
</span><span id="__span-124-23"><a id="__codelineno-124-23" name="__codelineno-124-23" href="#__codelineno-124-23"></a><span class="go">service/influxdb-svc                NodePort   10.110.65.108   &lt;none&gt;        18086:30086/TCP   62s</span>
</span><span id="__span-124-24"><a id="__codelineno-124-24" name="__codelineno-124-24" href="#__codelineno-124-24"></a>
</span><span id="__span-124-25"><a id="__codelineno-124-25" name="__codelineno-124-25" href="#__codelineno-124-25"></a><span class="go">NAME                       READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-124-26"><a id="__codelineno-124-26" name="__codelineno-124-26" href="#__codelineno-124-26"></a><span class="go">deployment.apps/grafana    1/1     1            1           62s</span>
</span><span id="__span-124-27"><a id="__codelineno-124-27" name="__codelineno-124-27" href="#__codelineno-124-27"></a><span class="go">deployment.apps/influxdb   1/1     1            1           62s</span>
</span><span id="__span-124-28"><a id="__codelineno-124-28" name="__codelineno-124-28" href="#__codelineno-124-28"></a>
</span><span id="__span-124-29"><a id="__codelineno-124-29" name="__codelineno-124-29" href="#__codelineno-124-29"></a><span class="go">NAME                                  DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-124-30"><a id="__codelineno-124-30" name="__codelineno-124-30" href="#__codelineno-124-30"></a><span class="go">replicaset.apps/grafana-6fff9dbb6c    1         1         1       62s</span>
</span><span id="__span-124-31"><a id="__codelineno-124-31" name="__codelineno-124-31" href="#__codelineno-124-31"></a><span class="go">replicaset.apps/influxdb-5974bf664f   1         1         1       62s</span>
</span><span id="__span-124-32"><a id="__codelineno-124-32" name="__codelineno-124-32" href="#__codelineno-124-32"></a>
</span><span id="__span-124-33"><a id="__codelineno-124-33" name="__codelineno-124-33" href="#__codelineno-124-33"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>monitoring
</span><span id="__span-124-34"><a id="__codelineno-124-34" name="__codelineno-124-34" href="#__codelineno-124-34"></a><span class="go">NAME                        TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)           AGE</span>
</span><span id="__span-124-35"><a id="__codelineno-124-35" name="__codelineno-124-35" href="#__codelineno-124-35"></a><span class="go">cm-acme-http-solver-n8l8h   NodePort   10.98.3.183     &lt;none&gt;        8089:30378/TCP    63s</span>
</span><span id="__span-124-36"><a id="__codelineno-124-36" name="__codelineno-124-36" href="#__codelineno-124-36"></a><span class="go">grafana-svc                 NodePort   10.110.29.239   &lt;none&gt;        13000:30300/TCP   66s</span>
</span><span id="__span-124-37"><a id="__codelineno-124-37" name="__codelineno-124-37" href="#__codelineno-124-37"></a><span class="go">influxdb-svc                NodePort   10.110.65.108   &lt;none&gt;        18086:30086/TCP   66s</span>
</span><span id="__span-124-38"><a id="__codelineno-124-38" name="__codelineno-124-38" href="#__codelineno-124-38"></a>
</span><span id="__span-124-39"><a id="__codelineno-124-39" name="__codelineno-124-39" href="#__codelineno-124-39"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ingress<span class="w"> </span>-n<span class="w"> </span>monitoring
</span><span id="__span-124-40"><a id="__codelineno-124-40" name="__codelineno-124-40" href="#__codelineno-124-40"></a><span class="go">NAME               CLASS   HOSTS                              ADDRESS         PORTS     AGE</span>
</span><span id="__span-124-41"><a id="__codelineno-124-41" name="__codelineno-124-41" href="#__codelineno-124-41"></a><span class="go">grafana-ingress    nginx   grafana.very-very-dark-gray.top    192.168.0.171   80, 443   69s</span>
</span><span id="__span-124-42"><a id="__codelineno-124-42" name="__codelineno-124-42" href="#__codelineno-124-42"></a><span class="go">influxdb-ingress   nginx   influxdb.very-very-dark-gray.top   192.168.0.171   80, 443   69s</span>
</span></code></pre></div>
<p>This worked <em>surprisingly</em> well, both services became quickly available at their
assigned URLs, with authentication working as intended and all dashboards working
as before. The only other change needed was getting data flowing into the new InfluxDB
server, by updating the <code>conmon</code> scripts in all the reporting systems.</p>
<h4 id="clean-up-lexicon">Clean up <code>lexicon</code></h4>
<p>Once InfluxDB is running in <code>octavo</code> there are a few additional monitoring scripts to
relocate to <code>octavo</code> (because they've been running in <code>lexicon</code>), some of which require
additional dependencies to be installed system-wide:</p>
<ol>
<li><a href="../../../../../projects/conmon/#conmon-speedtest"><code>conmon-speedtest</code></a> depens on
    <code>speedtest-cli</code></li>
<li><a href="../../../../../projects/conmon/#conmon-tapopy"><code>conmon-tapo.py</code></a> has more complex
    <a href="../../../../../projects/conmon/#python-dependencies">Python dependencies</a>.</li>
</ol>
<p>Once the scripts work, they need to run from <code>root</code>'s <code>crontab</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="gp"># </span>crontab<span class="w"> </span>-e
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="go">*/3 * * * * /home/k8s/code-server/conmon/conmon-speedtest</span>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="go">*/5 * * * * /home/k8s/code-server/conmon/conmon-tapo.py</span>
</span></code></pre></div>
<h3 id="komga">Komga</h3>
<p><a href="../../../../2024/05/26/self-hosted-ebook-library-with-komga/">Komga (eBook library)</a>
was very easy to migrate from <code>lexicon</code>, with only the minor quirk that its <code>/config</code>
directory had been inadvertently placed <em>inside itself</em>; fixing this, and the location
of eBooks, are the only changes in this deployment:</p>
<details class="k8s">
<summary>Kubernetes deployment: <code>komga.yaml</code></summary>
<div class="language-yaml highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">komga.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-126-1">  1</a></span>
<span class="normal"><a href="#__codelineno-126-2">  2</a></span>
<span class="normal"><a href="#__codelineno-126-3">  3</a></span>
<span class="normal"><a href="#__codelineno-126-4">  4</a></span>
<span class="normal"><a href="#__codelineno-126-5">  5</a></span>
<span class="normal"><a href="#__codelineno-126-6">  6</a></span>
<span class="normal"><a href="#__codelineno-126-7">  7</a></span>
<span class="normal"><a href="#__codelineno-126-8">  8</a></span>
<span class="normal"><a href="#__codelineno-126-9">  9</a></span>
<span class="normal"><a href="#__codelineno-126-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-126-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-126-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-126-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-126-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-126-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-126-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-126-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-126-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-126-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-126-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-126-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-126-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-126-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-126-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-126-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-126-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-126-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-126-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-126-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-126-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-126-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-126-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-126-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-126-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-126-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-126-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-126-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-126-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-126-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-126-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-126-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-126-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-126-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-126-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-126-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-126-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-126-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-126-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-126-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-126-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-126-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-126-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-126-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-126-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-126-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-126-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-126-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-126-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-126-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-126-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-126-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-126-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-126-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-126-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-126-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-126-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-126-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-126-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-126-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-126-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-126-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-126-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-126-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-126-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-126-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-126-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-126-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-126-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-126-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-126-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-126-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-126-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-126-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-126-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-126-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-126-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-126-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-126-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-126-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-126-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-126-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-126-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-126-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-126-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-126-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-126-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-126-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-126-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-126-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-126-100">100</a></span>
<span class="normal"><a href="#__codelineno-126-101">101</a></span>
<span class="normal"><a href="#__codelineno-126-102">102</a></span>
<span class="normal"><a href="#__codelineno-126-103">103</a></span>
<span class="normal"><a href="#__codelineno-126-104">104</a></span>
<span class="normal"><a href="#__codelineno-126-105">105</a></span>
<span class="normal"><a href="#__codelineno-126-106">106</a></span>
<span class="normal"><a href="#__codelineno-126-107">107</a></span>
<span class="normal"><a href="#__codelineno-126-108">108</a></span>
<span class="normal"><a href="#__codelineno-126-109">109</a></span>
<span class="normal"><a href="#__codelineno-126-110">110</a></span>
<span class="normal"><a href="#__codelineno-126-111">111</a></span>
<span class="normal"><a href="#__codelineno-126-112">112</a></span>
<span class="normal"><a href="#__codelineno-126-113">113</a></span>
<span class="normal"><a href="#__codelineno-126-114">114</a></span>
<span class="normal"><a href="#__codelineno-126-115">115</a></span>
<span class="normal"><a href="#__codelineno-126-116">116</a></span>
<span class="normal"><a href="#__codelineno-126-117">117</a></span>
<span class="normal"><a href="#__codelineno-126-118">118</a></span>
<span class="normal"><a href="#__codelineno-126-119">119</a></span>
<span class="normal"><a href="#__codelineno-126-120">120</a></span>
<span class="normal"><a href="#__codelineno-126-121">121</a></span>
<span class="normal"><a href="#__codelineno-126-122">122</a></span>
<span class="normal"><a href="#__codelineno-126-123">123</a></span>
<span class="normal"><a href="#__codelineno-126-124">124</a></span>
<span class="normal"><a href="#__codelineno-126-125">125</a></span>
<span class="normal"><a href="#__codelineno-126-126">126</a></span>
<span class="normal"><a href="#__codelineno-126-127">127</a></span>
<span class="normal"><a href="#__codelineno-126-128">128</a></span>
<span class="normal"><a href="#__codelineno-126-129">129</a></span>
<span class="normal"><a href="#__codelineno-126-130">130</a></span>
<span class="normal"><a href="#__codelineno-126-131">131</a></span>
<span class="normal"><a href="#__codelineno-126-132">132</a></span>
<span class="normal"><a href="#__codelineno-126-133">133</a></span>
<span class="normal"><a href="#__codelineno-126-134">134</a></span>
<span class="normal"><a href="#__codelineno-126-135">135</a></span>
<span class="normal"><a href="#__codelineno-126-136">136</a></span>
<span class="normal"><a href="#__codelineno-126-137">137</a></span>
<span class="normal"><a href="#__codelineno-126-138">138</a></span>
<span class="normal"><a href="#__codelineno-126-139">139</a></span>
<span class="normal"><a href="#__codelineno-126-140">140</a></span>
<span class="normal"><a href="#__codelineno-126-141">141</a></span>
<span class="normal"><a href="#__codelineno-126-142">142</a></span>
<span class="normal"><a href="#__codelineno-126-143">143</a></span>
<span class="normal"><a href="#__codelineno-126-144">144</a></span>
<span class="normal"><a href="#__codelineno-126-145">145</a></span>
<span class="normal"><a href="#__codelineno-126-146">146</a></span>
<span class="normal"><a href="#__codelineno-126-147">147</a></span>
<span class="normal"><a href="#__codelineno-126-148">148</a></span>
<span class="normal"><a href="#__codelineno-126-149">149</a></span>
<span class="normal"><a href="#__codelineno-126-150">150</a></span>
<span class="normal"><a href="#__codelineno-126-151">151</a></span>
<span class="normal"><a href="#__codelineno-126-152">152</a></span>
<span class="normal"><a href="#__codelineno-126-153">153</a></span>
<span class="normal"><a href="#__codelineno-126-154">154</a></span>
<span class="normal"><a href="#__codelineno-126-155">155</a></span>
<span class="normal"><a href="#__codelineno-126-156">156</a></span>
<span class="normal"><a href="#__codelineno-126-157">157</a></span>
<span class="normal"><a href="#__codelineno-126-158">158</a></span>
<span class="normal"><a href="#__codelineno-126-159">159</a></span>
<span class="normal"><a href="#__codelineno-126-160">160</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-5"><a id="__codelineno-126-5" name="__codelineno-126-5"></a><span class="nn">---</span>
</span><span id="__span-126-6"><a id="__codelineno-126-6" name="__codelineno-126-6"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-126-7"><a id="__codelineno-126-7" name="__codelineno-126-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-126-8"><a id="__codelineno-126-8" name="__codelineno-126-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-126-9"><a id="__codelineno-126-9" name="__codelineno-126-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-pv-config</span>
</span><span id="__span-126-10"><a id="__codelineno-126-10" name="__codelineno-126-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-11"><a id="__codelineno-126-11" name="__codelineno-126-11"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-126-12"><a id="__codelineno-126-12" name="__codelineno-126-12"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-126-13"><a id="__codelineno-126-13" name="__codelineno-126-13"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-126-14"><a id="__codelineno-126-14" name="__codelineno-126-14"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-126-15"><a id="__codelineno-126-15" name="__codelineno-126-15"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-126-16"><a id="__codelineno-126-16" name="__codelineno-126-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-126-17"><a id="__codelineno-126-17" name="__codelineno-126-17"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-126-18"><a id="__codelineno-126-18" name="__codelineno-126-18"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-126-19"><a id="__codelineno-126-19" name="__codelineno-126-19"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/komga</span>
</span><span id="__span-126-20"><a id="__codelineno-126-20" name="__codelineno-126-20"></a><span class="nn">---</span>
</span><span id="__span-126-21"><a id="__codelineno-126-21" name="__codelineno-126-21"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-126-22"><a id="__codelineno-126-22" name="__codelineno-126-22"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-126-23"><a id="__codelineno-126-23" name="__codelineno-126-23"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-126-24"><a id="__codelineno-126-24" name="__codelineno-126-24"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-pv-books</span>
</span><span id="__span-126-25"><a id="__codelineno-126-25" name="__codelineno-126-25"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-26"><a id="__codelineno-126-26" name="__codelineno-126-26"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-126-27"><a id="__codelineno-126-27" name="__codelineno-126-27"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-126-28"><a id="__codelineno-126-28" name="__codelineno-126-28"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-126-29"><a id="__codelineno-126-29" name="__codelineno-126-29"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-126-30"><a id="__codelineno-126-30" name="__codelineno-126-30"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-126-31"><a id="__codelineno-126-31" name="__codelineno-126-31"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-126-32"><a id="__codelineno-126-32" name="__codelineno-126-32"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-126-33"><a id="__codelineno-126-33" name="__codelineno-126-33"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-126-34"><a id="__codelineno-126-34" name="__codelineno-126-34"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/nas/public/ebooks</span>
</span><span id="__span-126-35"><a id="__codelineno-126-35" name="__codelineno-126-35"></a><span class="nn">---</span>
</span><span id="__span-126-36"><a id="__codelineno-126-36" name="__codelineno-126-36"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-126-37"><a id="__codelineno-126-37" name="__codelineno-126-37"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-126-38"><a id="__codelineno-126-38" name="__codelineno-126-38"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-126-39"><a id="__codelineno-126-39" name="__codelineno-126-39"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-pvc-config</span>
</span><span id="__span-126-40"><a id="__codelineno-126-40" name="__codelineno-126-40"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-41"><a id="__codelineno-126-41" name="__codelineno-126-41"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-126-42"><a id="__codelineno-126-42" name="__codelineno-126-42"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-126-43"><a id="__codelineno-126-43" name="__codelineno-126-43"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-pv-config</span>
</span><span id="__span-126-44"><a id="__codelineno-126-44" name="__codelineno-126-44"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-126-45"><a id="__codelineno-126-45" name="__codelineno-126-45"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-126-46"><a id="__codelineno-126-46" name="__codelineno-126-46"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-126-47"><a id="__codelineno-126-47" name="__codelineno-126-47"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-126-48"><a id="__codelineno-126-48" name="__codelineno-126-48"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-126-49"><a id="__codelineno-126-49" name="__codelineno-126-49"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-126-50"><a id="__codelineno-126-50" name="__codelineno-126-50"></a><span class="nn">---</span>
</span><span id="__span-126-51"><a id="__codelineno-126-51" name="__codelineno-126-51"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-126-52"><a id="__codelineno-126-52" name="__codelineno-126-52"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-126-53"><a id="__codelineno-126-53" name="__codelineno-126-53"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-126-54"><a id="__codelineno-126-54" name="__codelineno-126-54"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-pvc-books</span>
</span><span id="__span-126-55"><a id="__codelineno-126-55" name="__codelineno-126-55"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-56"><a id="__codelineno-126-56" name="__codelineno-126-56"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-126-57"><a id="__codelineno-126-57" name="__codelineno-126-57"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-126-58"><a id="__codelineno-126-58" name="__codelineno-126-58"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-pv-books</span>
</span><span id="__span-126-59"><a id="__codelineno-126-59" name="__codelineno-126-59"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-126-60"><a id="__codelineno-126-60" name="__codelineno-126-60"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-126-61"><a id="__codelineno-126-61" name="__codelineno-126-61"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-126-62"><a id="__codelineno-126-62" name="__codelineno-126-62"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-126-63"><a id="__codelineno-126-63" name="__codelineno-126-63"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-126-64"><a id="__codelineno-126-64" name="__codelineno-126-64"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-126-65"><a id="__codelineno-126-65" name="__codelineno-126-65"></a><span class="nn">---</span>
</span><span id="__span-126-66"><a id="__codelineno-126-66" name="__codelineno-126-66"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-126-67"><a id="__codelineno-126-67" name="__codelineno-126-67"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-126-68"><a id="__codelineno-126-68" name="__codelineno-126-68"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-126-69"><a id="__codelineno-126-69" name="__codelineno-126-69"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-126-70"><a id="__codelineno-126-70" name="__codelineno-126-70"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-71"><a id="__codelineno-126-71" name="__codelineno-126-71"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-72"><a id="__codelineno-126-72" name="__codelineno-126-72"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-73"><a id="__codelineno-126-73" name="__codelineno-126-73"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-126-74"><a id="__codelineno-126-74" name="__codelineno-126-74"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-126-75"><a id="__codelineno-126-75" name="__codelineno-126-75"></a><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-126-76"><a id="__codelineno-126-76" name="__codelineno-126-76"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-126-77"><a id="__codelineno-126-77" name="__codelineno-126-77"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-126-78"><a id="__codelineno-126-78" name="__codelineno-126-78"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-79"><a id="__codelineno-126-79" name="__codelineno-126-79"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-126-80"><a id="__codelineno-126-80" name="__codelineno-126-80"></a><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span>
</span><span id="__span-126-81"><a id="__codelineno-126-81" name="__codelineno-126-81"></a><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-126-82"><a id="__codelineno-126-82" name="__codelineno-126-82"></a><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-126-83"><a id="__codelineno-126-83" name="__codelineno-126-83"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
</span><span id="__span-126-84"><a id="__codelineno-126-84" name="__codelineno-126-84"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-126-85"><a id="__codelineno-126-85" name="__codelineno-126-85"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-126-86"><a id="__codelineno-126-86" name="__codelineno-126-86"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-126-87"><a id="__codelineno-126-87" name="__codelineno-126-87"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-88"><a id="__codelineno-126-88" name="__codelineno-126-88"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-126-89"><a id="__codelineno-126-89" name="__codelineno-126-89"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-126-90"><a id="__codelineno-126-90" name="__codelineno-126-90"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gotson/komga</span>
</span><span id="__span-126-91"><a id="__codelineno-126-91" name="__codelineno-126-91"></a><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-126-92"><a id="__codelineno-126-92" name="__codelineno-126-92"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-93"><a id="__codelineno-126-93" name="__codelineno-126-93"></a><span class="w">          </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"user"</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">"118:118"</span><span class="p p-Indicator">]</span>
</span><span id="__span-126-94"><a id="__codelineno-126-94" name="__codelineno-126-94"></a><span class="w">          </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-126-95"><a id="__codelineno-126-95" name="__codelineno-126-95"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ</span>
</span><span id="__span-126-96"><a id="__codelineno-126-96" name="__codelineno-126-96"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"Europe/Amsterdam"</span>
</span><span id="__span-126-97"><a id="__codelineno-126-97" name="__codelineno-126-97"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-126-98"><a id="__codelineno-126-98" name="__codelineno-126-98"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25600</span>
</span><span id="__span-126-99"><a id="__codelineno-126-99" name="__codelineno-126-99"></a><span class="w">          </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-126-100"><a id="__codelineno-126-100" name="__codelineno-126-100"></a><span class="w">          </span><span class="nt">stdin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-126-101"><a id="__codelineno-126-101" name="__codelineno-126-101"></a><span class="w">          </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-126-102"><a id="__codelineno-126-102" name="__codelineno-126-102"></a><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-126-103"><a id="__codelineno-126-103" name="__codelineno-126-103"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/config</span>
</span><span id="__span-126-104"><a id="__codelineno-126-104" name="__codelineno-126-104"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-config</span>
</span><span id="__span-126-105"><a id="__codelineno-126-105" name="__codelineno-126-105"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data</span>
</span><span id="__span-126-106"><a id="__codelineno-126-106" name="__codelineno-126-106"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-books</span>
</span><span id="__span-126-107"><a id="__codelineno-126-107" name="__codelineno-126-107"></a><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span>
</span><span id="__span-126-108"><a id="__codelineno-126-108" name="__codelineno-126-108"></a><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-126-109"><a id="__codelineno-126-109" name="__codelineno-126-109"></a><span class="w">            </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">118</span>
</span><span id="__span-126-110"><a id="__codelineno-126-110" name="__codelineno-126-110"></a><span class="w">            </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">118</span>
</span><span id="__span-126-111"><a id="__codelineno-126-111" name="__codelineno-126-111"></a><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-126-112"><a id="__codelineno-126-112" name="__codelineno-126-112"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-126-113"><a id="__codelineno-126-113" name="__codelineno-126-113"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-config</span>
</span><span id="__span-126-114"><a id="__codelineno-126-114" name="__codelineno-126-114"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-126-115"><a id="__codelineno-126-115" name="__codelineno-126-115"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-pvc-config</span>
</span><span id="__span-126-116"><a id="__codelineno-126-116" name="__codelineno-126-116"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-books</span>
</span><span id="__span-126-117"><a id="__codelineno-126-117" name="__codelineno-126-117"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-126-118"><a id="__codelineno-126-118" name="__codelineno-126-118"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-pvc-books</span>
</span><span id="__span-126-119"><a id="__codelineno-126-119" name="__codelineno-126-119"></a><span class="nn">---</span>
</span><span id="__span-126-120"><a id="__codelineno-126-120" name="__codelineno-126-120"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-126-121"><a id="__codelineno-126-121" name="__codelineno-126-121"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-126-122"><a id="__codelineno-126-122" name="__codelineno-126-122"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-126-123"><a id="__codelineno-126-123" name="__codelineno-126-123"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-svc</span>
</span><span id="__span-126-124"><a id="__codelineno-126-124" name="__codelineno-126-124"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-125"><a id="__codelineno-126-125" name="__codelineno-126-125"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-126-126"><a id="__codelineno-126-126" name="__codelineno-126-126"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</span><span id="__span-126-127"><a id="__codelineno-126-127" name="__codelineno-126-127"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-126-128"><a id="__codelineno-126-128" name="__codelineno-126-128"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25600</span>
</span><span id="__span-126-129"><a id="__codelineno-126-129" name="__codelineno-126-129"></a><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30600</span>
</span><span id="__span-126-130"><a id="__codelineno-126-130" name="__codelineno-126-130"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25600</span>
</span><span id="__span-126-131"><a id="__codelineno-126-131" name="__codelineno-126-131"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-126-132"><a id="__codelineno-126-132" name="__codelineno-126-132"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-133"><a id="__codelineno-126-133" name="__codelineno-126-133"></a><span class="nn">---</span>
</span><span id="__span-126-134"><a id="__codelineno-126-134" name="__codelineno-126-134"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-126-135"><a id="__codelineno-126-135" name="__codelineno-126-135"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-126-136"><a id="__codelineno-126-136" name="__codelineno-126-136"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-126-137"><a id="__codelineno-126-137" name="__codelineno-126-137"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-ingress</span>
</span><span id="__span-126-138"><a id="__codelineno-126-138" name="__codelineno-126-138"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga</span>
</span><span id="__span-126-139"><a id="__codelineno-126-139" name="__codelineno-126-139"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-126-140"><a id="__codelineno-126-140" name="__codelineno-126-140"></a><span class="w">    </span><span class="nt">acme.cert-manager.io/http01-edit-in-place</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-126-141"><a id="__codelineno-126-141" name="__codelineno-126-141"></a><span class="w">    </span><span class="nt">cert-manager.io/issue-temporary-certificate</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-126-142"><a id="__codelineno-126-142" name="__codelineno-126-142"></a><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-126-143"><a id="__codelineno-126-143" name="__codelineno-126-143"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/websocket-services</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-svc</span>
</span><span id="__span-126-144"><a id="__codelineno-126-144" name="__codelineno-126-144"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-126-145"><a id="__codelineno-126-145" name="__codelineno-126-145"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-126-146"><a id="__codelineno-126-146" name="__codelineno-126-146"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-126-147"><a id="__codelineno-126-147" name="__codelineno-126-147"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga.very-very-dark-gray.top</span>
</span><span id="__span-126-148"><a id="__codelineno-126-148" name="__codelineno-126-148"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-126-149"><a id="__codelineno-126-149" name="__codelineno-126-149"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-126-150"><a id="__codelineno-126-150" name="__codelineno-126-150"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-126-151"><a id="__codelineno-126-151" name="__codelineno-126-151"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-126-152"><a id="__codelineno-126-152" name="__codelineno-126-152"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-126-153"><a id="__codelineno-126-153" name="__codelineno-126-153"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-126-154"><a id="__codelineno-126-154" name="__codelineno-126-154"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga-svc</span>
</span><span id="__span-126-155"><a id="__codelineno-126-155" name="__codelineno-126-155"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-126-156"><a id="__codelineno-126-156" name="__codelineno-126-156"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">25600</span>
</span><span id="__span-126-157"><a id="__codelineno-126-157" name="__codelineno-126-157"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-126-158"><a id="__codelineno-126-158" name="__codelineno-126-158"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret</span>
</span><span id="__span-126-159"><a id="__codelineno-126-159" name="__codelineno-126-159"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-126-160"><a id="__codelineno-126-160" name="__codelineno-126-160"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">komga.very-very-dark-gray.top</span>
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<p>Then again, the trick is to copy the <code>/config</code> directory between stopping the service
in <code>lexicon</code> and starting it in <code>octavo</code>.</p>
<p>First, stop komga in <code>lexicon</code> (it won't be used moving forward):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>komga<span class="w"> </span>deployment<span class="w"> </span>komga<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="go">deployment.apps/komga scaled</span>
</span></code></pre></div>
<p>Copy data over from <code>lexicon</code> to <code>octavo</code>, moving the <code>/config</code> directory one level up:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="gp">root@octavo ~ # </span>groupadd<span class="w"> </span>komga<span class="w"> </span>-g<span class="w"> </span><span class="m">118</span>
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="gp">root@octavo ~ # </span>useradd<span class="w">  </span>komga<span class="w"> </span>-u<span class="w"> </span><span class="m">118</span><span class="w"> </span>-g<span class="w"> </span><span class="m">118</span><span class="w"> </span>-s<span class="w"> </span>/usr/sbin/nologin
</span><span id="__span-128-3"><a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="hll"><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/komga/config/<span class="w"> </span>/home/k8s/komga
</span></span><span id="__span-128-4"><a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a><span class="gp">root@octavo ~ # </span>chown<span class="w"> </span>-R<span class="w"> </span>komga:komga<span class="w"> </span>/home/k8s/komga
</span><span id="__span-128-5"><a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a><span class="gp">root@octavo ~ # </span>ls<span class="w"> </span>-hal<span class="w"> </span>/home/k8s/komga
</span><span id="__span-128-6"><a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a><span class="go">total 14M</span>
</span><span id="__span-128-7"><a id="__codelineno-128-7" name="__codelineno-128-7" href="#__codelineno-128-7"></a><span class="go">drwxr-xr-x 1 komga komga   74 Apr 28 23:09 .</span>
</span><span id="__span-128-8"><a id="__codelineno-128-8" name="__codelineno-128-8" href="#__codelineno-128-8"></a><span class="go">drwxr-xr-x 1 root  root   114 Apr 28 23:26 ..</span>
</span><span id="__span-128-9"><a id="__codelineno-128-9" name="__codelineno-128-9" href="#__codelineno-128-9"></a><span class="go">-rw-r--r-- 1 komga komga  14M Apr 28 23:09 database.sqlite</span>
</span><span id="__span-128-10"><a id="__codelineno-128-10" name="__codelineno-128-10" href="#__codelineno-128-10"></a><span class="go">drwxr-xr-x 1 komga komga  368 Apr 28 05:05 logs</span>
</span><span id="__span-128-11"><a id="__codelineno-128-11" name="__codelineno-128-11" href="#__codelineno-128-11"></a><span class="go">drwxr-xr-x 1 komga komga  668 Mar 16 06:08 lucene</span>
</span><span id="__span-128-12"><a id="__codelineno-128-12" name="__codelineno-128-12" href="#__codelineno-128-12"></a><span class="go">-rw-r--r-- 1 komga komga 156K Apr 28 23:09 tasks.sqlite</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The trailing <code>/</code> in <code>lexicon:/home/k8s/komga/config/</code> is <strong>critical</strong> to make
the destination directory <code>/home/k8s/komga</code> in <code>octavo</code> <strong>be</strong> that <code>data</code>
directory, instead of <em>containing</em> it.</p>
</div>
<p>Finally, start the deployment in <code>octavo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>komga.yaml
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="go">namespace/komga created</span>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="go">persistentvolume/komga-pv-config created</span>
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="go">persistentvolume/komga-pv-books created</span>
</span><span id="__span-129-5"><a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a><span class="go">persistentvolumeclaim/komga-pvc-config created</span>
</span><span id="__span-129-6"><a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a><span class="go">persistentvolumeclaim/komga-pvc-books created</span>
</span><span id="__span-129-7"><a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a><span class="go">deployment.apps/komga created</span>
</span><span id="__span-129-8"><a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a><span class="go">service/komga-svc created</span>
</span><span id="__span-129-9"><a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a><span class="go">ingress.networking.k8s.io/komga-ingress created</span>
</span><span id="__span-129-10"><a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a>
</span><span id="__span-129-11"><a id="__codelineno-129-11" name="__codelineno-129-11" href="#__codelineno-129-11"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>komga
</span><span id="__span-129-12"><a id="__codelineno-129-12" name="__codelineno-129-12" href="#__codelineno-129-12"></a><span class="go">NAME                            READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-129-13"><a id="__codelineno-129-13" name="__codelineno-129-13" href="#__codelineno-129-13"></a><span class="go">pod/cm-acme-http-solver-v8rp6   1/1     Running   0          21s</span>
</span><span id="__span-129-14"><a id="__codelineno-129-14" name="__codelineno-129-14" href="#__codelineno-129-14"></a><span class="go">pod/komga-5cc699fdcd-xwqlh      1/1     Running   0          24s</span>
</span><span id="__span-129-15"><a id="__codelineno-129-15" name="__codelineno-129-15" href="#__codelineno-129-15"></a>
</span><span id="__span-129-16"><a id="__codelineno-129-16" name="__codelineno-129-16" href="#__codelineno-129-16"></a><span class="go">NAME                                TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)           AGE</span>
</span><span id="__span-129-17"><a id="__codelineno-129-17" name="__codelineno-129-17" href="#__codelineno-129-17"></a><span class="go">service/cm-acme-http-solver-m625s   NodePort   10.108.18.62     &lt;none&gt;        8089:31587/TCP    21s</span>
</span><span id="__span-129-18"><a id="__codelineno-129-18" name="__codelineno-129-18" href="#__codelineno-129-18"></a><span class="go">service/komga-svc                   NodePort   10.105.251.174   &lt;none&gt;        25600:30600/TCP   24s</span>
</span><span id="__span-129-19"><a id="__codelineno-129-19" name="__codelineno-129-19" href="#__codelineno-129-19"></a>
</span><span id="__span-129-20"><a id="__codelineno-129-20" name="__codelineno-129-20" href="#__codelineno-129-20"></a><span class="go">NAME                    READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-129-21"><a id="__codelineno-129-21" name="__codelineno-129-21" href="#__codelineno-129-21"></a><span class="go">deployment.apps/komga   1/1     1            1           24s</span>
</span><span id="__span-129-22"><a id="__codelineno-129-22" name="__codelineno-129-22" href="#__codelineno-129-22"></a>
</span><span id="__span-129-23"><a id="__codelineno-129-23" name="__codelineno-129-23" href="#__codelineno-129-23"></a><span class="go">NAME                               DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-129-24"><a id="__codelineno-129-24" name="__codelineno-129-24" href="#__codelineno-129-24"></a><span class="go">replicaset.apps/komga-5cc699fdcd   1         1         1       24s</span>
</span><span id="__span-129-25"><a id="__codelineno-129-25" name="__codelineno-129-25" href="#__codelineno-129-25"></a>
</span><span id="__span-129-26"><a id="__codelineno-129-26" name="__codelineno-129-26" href="#__codelineno-129-26"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>komga
</span><span id="__span-129-27"><a id="__codelineno-129-27" name="__codelineno-129-27" href="#__codelineno-129-27"></a><span class="go">NAME        TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)           AGE</span>
</span><span id="__span-129-28"><a id="__codelineno-129-28" name="__codelineno-129-28" href="#__codelineno-129-28"></a><span class="go">komga-svc   NodePort   10.105.251.174   &lt;none&gt;        25600:30600/TCP   67s</span>
</span><span id="__span-129-29"><a id="__codelineno-129-29" name="__codelineno-129-29" href="#__codelineno-129-29"></a>
</span><span id="__span-129-30"><a id="__codelineno-129-30" name="__codelineno-129-30" href="#__codelineno-129-30"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ingress<span class="w"> </span>-n<span class="w"> </span>komga
</span><span id="__span-129-31"><a id="__codelineno-129-31" name="__codelineno-129-31" href="#__codelineno-129-31"></a><span class="go">NAME            CLASS   HOSTS                           ADDRESS         PORTS     AGE</span>
</span><span id="__span-129-32"><a id="__codelineno-129-32" name="__codelineno-129-32" href="#__codelineno-129-32"></a><span class="go">komga-ingress   nginx   komga.very-very-dark-gray.top   192.168.0.171   80, 443   72s</span>
</span></code></pre></div>
<p>After a couple for minutes Komga is available at
<a href="https://komga.very-very-dark-gray.top/">https://komga.very-very-dark-gray.top/</a> and everything works fine.</p>
<h3 id="navidrome">Navidrome</h3>
<p><a href="../../../../2024/10/26/self-hosted-music-streaming-with-navidrome/">Navidrome (music streaming)</a>
was very easy to migrate from <code>lexicon</code>, with only the minor quirk that its <code>/data</code>
directory had been inadvertently placed <em>inside itself</em>; fixing this, and the location
of music files, are the only changes in this deployment:</p>
<details class="k8s">
<summary>Kubernetes deployment: <code>navidrome.yaml</code></summary>
<div class="language-yaml highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">navidrome.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-130-1">  1</a></span>
<span class="normal"><a href="#__codelineno-130-2">  2</a></span>
<span class="normal"><a href="#__codelineno-130-3">  3</a></span>
<span class="normal"><a href="#__codelineno-130-4">  4</a></span>
<span class="normal"><a href="#__codelineno-130-5">  5</a></span>
<span class="normal"><a href="#__codelineno-130-6">  6</a></span>
<span class="normal"><a href="#__codelineno-130-7">  7</a></span>
<span class="normal"><a href="#__codelineno-130-8">  8</a></span>
<span class="normal"><a href="#__codelineno-130-9">  9</a></span>
<span class="normal"><a href="#__codelineno-130-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-130-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-130-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-130-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-130-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-130-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-130-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-130-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-130-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-130-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-130-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-130-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-130-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-130-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-130-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-130-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-130-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-130-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-130-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-130-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-130-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-130-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-130-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-130-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-130-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-130-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-130-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-130-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-130-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-130-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-130-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-130-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-130-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-130-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-130-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-130-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-130-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-130-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-130-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-130-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-130-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-130-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-130-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-130-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-130-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-130-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-130-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-130-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-130-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-130-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-130-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-130-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-130-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-130-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-130-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-130-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-130-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-130-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-130-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-130-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-130-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-130-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-130-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-130-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-130-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-130-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-130-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-130-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-130-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-130-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-130-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-130-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-130-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-130-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-130-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-130-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-130-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-130-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-130-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-130-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-130-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-130-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-130-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-130-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-130-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-130-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-130-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-130-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-130-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-130-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-130-100">100</a></span>
<span class="normal"><a href="#__codelineno-130-101">101</a></span>
<span class="normal"><a href="#__codelineno-130-102">102</a></span>
<span class="normal"><a href="#__codelineno-130-103">103</a></span>
<span class="normal"><a href="#__codelineno-130-104">104</a></span>
<span class="normal"><a href="#__codelineno-130-105">105</a></span>
<span class="normal"><a href="#__codelineno-130-106">106</a></span>
<span class="normal"><a href="#__codelineno-130-107">107</a></span>
<span class="normal"><a href="#__codelineno-130-108">108</a></span>
<span class="normal"><a href="#__codelineno-130-109">109</a></span>
<span class="normal"><a href="#__codelineno-130-110">110</a></span>
<span class="normal"><a href="#__codelineno-130-111">111</a></span>
<span class="normal"><a href="#__codelineno-130-112">112</a></span>
<span class="normal"><a href="#__codelineno-130-113">113</a></span>
<span class="normal"><a href="#__codelineno-130-114">114</a></span>
<span class="normal"><a href="#__codelineno-130-115">115</a></span>
<span class="normal"><a href="#__codelineno-130-116">116</a></span>
<span class="normal"><a href="#__codelineno-130-117">117</a></span>
<span class="normal"><a href="#__codelineno-130-118">118</a></span>
<span class="normal"><a href="#__codelineno-130-119">119</a></span>
<span class="normal"><a href="#__codelineno-130-120">120</a></span>
<span class="normal"><a href="#__codelineno-130-121">121</a></span>
<span class="normal"><a href="#__codelineno-130-122">122</a></span>
<span class="normal"><a href="#__codelineno-130-123">123</a></span>
<span class="normal"><a href="#__codelineno-130-124">124</a></span>
<span class="normal"><a href="#__codelineno-130-125">125</a></span>
<span class="normal"><a href="#__codelineno-130-126">126</a></span>
<span class="normal"><a href="#__codelineno-130-127">127</a></span>
<span class="normal"><a href="#__codelineno-130-128">128</a></span>
<span class="normal"><a href="#__codelineno-130-129">129</a></span>
<span class="normal"><a href="#__codelineno-130-130">130</a></span>
<span class="normal"><a href="#__codelineno-130-131">131</a></span>
<span class="normal"><a href="#__codelineno-130-132">132</a></span>
<span class="normal"><a href="#__codelineno-130-133">133</a></span>
<span class="normal"><a href="#__codelineno-130-134">134</a></span>
<span class="normal"><a href="#__codelineno-130-135">135</a></span>
<span class="normal"><a href="#__codelineno-130-136">136</a></span>
<span class="normal"><a href="#__codelineno-130-137">137</a></span>
<span class="normal"><a href="#__codelineno-130-138">138</a></span>
<span class="normal"><a href="#__codelineno-130-139">139</a></span>
<span class="normal"><a href="#__codelineno-130-140">140</a></span>
<span class="normal"><a href="#__codelineno-130-141">141</a></span>
<span class="normal"><a href="#__codelineno-130-142">142</a></span>
<span class="normal"><a href="#__codelineno-130-143">143</a></span>
<span class="normal"><a href="#__codelineno-130-144">144</a></span>
<span class="normal"><a href="#__codelineno-130-145">145</a></span>
<span class="normal"><a href="#__codelineno-130-146">146</a></span>
<span class="normal"><a href="#__codelineno-130-147">147</a></span>
<span class="normal"><a href="#__codelineno-130-148">148</a></span>
<span class="normal"><a href="#__codelineno-130-149">149</a></span>
<span class="normal"><a href="#__codelineno-130-150">150</a></span>
<span class="normal"><a href="#__codelineno-130-151">151</a></span>
<span class="normal"><a href="#__codelineno-130-152">152</a></span>
<span class="normal"><a href="#__codelineno-130-153">153</a></span>
<span class="normal"><a href="#__codelineno-130-154">154</a></span>
<span class="normal"><a href="#__codelineno-130-155">155</a></span>
<span class="normal"><a href="#__codelineno-130-156">156</a></span>
<span class="normal"><a href="#__codelineno-130-157">157</a></span>
<span class="normal"><a href="#__codelineno-130-158">158</a></span>
<span class="normal"><a href="#__codelineno-130-159">159</a></span>
<span class="normal"><a href="#__codelineno-130-160">160</a></span>
<span class="normal"><a href="#__codelineno-130-161">161</a></span>
<span class="normal"><a href="#__codelineno-130-162">162</a></span>
<span class="normal"><a href="#__codelineno-130-163">163</a></span>
<span class="normal"><a href="#__codelineno-130-164">164</a></span>
<span class="normal"><a href="#__codelineno-130-165">165</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-5"><a id="__codelineno-130-5" name="__codelineno-130-5"></a><span class="nn">---</span>
</span><span id="__span-130-6"><a id="__codelineno-130-6" name="__codelineno-130-6"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-130-7"><a id="__codelineno-130-7" name="__codelineno-130-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-130-8"><a id="__codelineno-130-8" name="__codelineno-130-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-130-9"><a id="__codelineno-130-9" name="__codelineno-130-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-pv-data</span>
</span><span id="__span-130-10"><a id="__codelineno-130-10" name="__codelineno-130-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-11"><a id="__codelineno-130-11" name="__codelineno-130-11"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-130-12"><a id="__codelineno-130-12" name="__codelineno-130-12"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-130-13"><a id="__codelineno-130-13" name="__codelineno-130-13"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-130-14"><a id="__codelineno-130-14" name="__codelineno-130-14"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-130-15"><a id="__codelineno-130-15" name="__codelineno-130-15"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-130-16"><a id="__codelineno-130-16" name="__codelineno-130-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-130-17"><a id="__codelineno-130-17" name="__codelineno-130-17"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-130-18"><a id="__codelineno-130-18" name="__codelineno-130-18"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-130-19"><a id="__codelineno-130-19" name="__codelineno-130-19"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/navidrome</span>
</span><span id="__span-130-20"><a id="__codelineno-130-20" name="__codelineno-130-20"></a><span class="nn">---</span>
</span><span id="__span-130-21"><a id="__codelineno-130-21" name="__codelineno-130-21"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-130-22"><a id="__codelineno-130-22" name="__codelineno-130-22"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-130-23"><a id="__codelineno-130-23" name="__codelineno-130-23"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-130-24"><a id="__codelineno-130-24" name="__codelineno-130-24"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-pv-music</span>
</span><span id="__span-130-25"><a id="__codelineno-130-25" name="__codelineno-130-25"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-26"><a id="__codelineno-130-26" name="__codelineno-130-26"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-130-27"><a id="__codelineno-130-27" name="__codelineno-130-27"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-130-28"><a id="__codelineno-130-28" name="__codelineno-130-28"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-130-29"><a id="__codelineno-130-29" name="__codelineno-130-29"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100Gi</span>
</span><span id="__span-130-30"><a id="__codelineno-130-30" name="__codelineno-130-30"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-130-31"><a id="__codelineno-130-31" name="__codelineno-130-31"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-130-32"><a id="__codelineno-130-32" name="__codelineno-130-32"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-130-33"><a id="__codelineno-130-33" name="__codelineno-130-33"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-130-34"><a id="__codelineno-130-34" name="__codelineno-130-34"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/nas/public/audio/Music</span>
</span><span id="__span-130-35"><a id="__codelineno-130-35" name="__codelineno-130-35"></a><span class="nn">---</span>
</span><span id="__span-130-36"><a id="__codelineno-130-36" name="__codelineno-130-36"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-130-37"><a id="__codelineno-130-37" name="__codelineno-130-37"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-130-38"><a id="__codelineno-130-38" name="__codelineno-130-38"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-130-39"><a id="__codelineno-130-39" name="__codelineno-130-39"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-pvc-data</span>
</span><span id="__span-130-40"><a id="__codelineno-130-40" name="__codelineno-130-40"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-41"><a id="__codelineno-130-41" name="__codelineno-130-41"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-130-42"><a id="__codelineno-130-42" name="__codelineno-130-42"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-130-43"><a id="__codelineno-130-43" name="__codelineno-130-43"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-pv-data</span>
</span><span id="__span-130-44"><a id="__codelineno-130-44" name="__codelineno-130-44"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-130-45"><a id="__codelineno-130-45" name="__codelineno-130-45"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-130-46"><a id="__codelineno-130-46" name="__codelineno-130-46"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-130-47"><a id="__codelineno-130-47" name="__codelineno-130-47"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-130-48"><a id="__codelineno-130-48" name="__codelineno-130-48"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-130-49"><a id="__codelineno-130-49" name="__codelineno-130-49"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-130-50"><a id="__codelineno-130-50" name="__codelineno-130-50"></a><span class="nn">---</span>
</span><span id="__span-130-51"><a id="__codelineno-130-51" name="__codelineno-130-51"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-130-52"><a id="__codelineno-130-52" name="__codelineno-130-52"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-130-53"><a id="__codelineno-130-53" name="__codelineno-130-53"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-130-54"><a id="__codelineno-130-54" name="__codelineno-130-54"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-pvc-music</span>
</span><span id="__span-130-55"><a id="__codelineno-130-55" name="__codelineno-130-55"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-56"><a id="__codelineno-130-56" name="__codelineno-130-56"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-130-57"><a id="__codelineno-130-57" name="__codelineno-130-57"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-130-58"><a id="__codelineno-130-58" name="__codelineno-130-58"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-pv-music</span>
</span><span id="__span-130-59"><a id="__codelineno-130-59" name="__codelineno-130-59"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-130-60"><a id="__codelineno-130-60" name="__codelineno-130-60"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-130-61"><a id="__codelineno-130-61" name="__codelineno-130-61"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-130-62"><a id="__codelineno-130-62" name="__codelineno-130-62"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-130-63"><a id="__codelineno-130-63" name="__codelineno-130-63"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-130-64"><a id="__codelineno-130-64" name="__codelineno-130-64"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-130-65"><a id="__codelineno-130-65" name="__codelineno-130-65"></a><span class="nn">---</span>
</span><span id="__span-130-66"><a id="__codelineno-130-66" name="__codelineno-130-66"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-130-67"><a id="__codelineno-130-67" name="__codelineno-130-67"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-130-68"><a id="__codelineno-130-68" name="__codelineno-130-68"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-130-69"><a id="__codelineno-130-69" name="__codelineno-130-69"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-130-70"><a id="__codelineno-130-70" name="__codelineno-130-70"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-71"><a id="__codelineno-130-71" name="__codelineno-130-71"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-72"><a id="__codelineno-130-72" name="__codelineno-130-72"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-73"><a id="__codelineno-130-73" name="__codelineno-130-73"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-130-74"><a id="__codelineno-130-74" name="__codelineno-130-74"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-130-75"><a id="__codelineno-130-75" name="__codelineno-130-75"></a><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-130-76"><a id="__codelineno-130-76" name="__codelineno-130-76"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-130-77"><a id="__codelineno-130-77" name="__codelineno-130-77"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-130-78"><a id="__codelineno-130-78" name="__codelineno-130-78"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-79"><a id="__codelineno-130-79" name="__codelineno-130-79"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-130-80"><a id="__codelineno-130-80" name="__codelineno-130-80"></a><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span>
</span><span id="__span-130-81"><a id="__codelineno-130-81" name="__codelineno-130-81"></a><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-130-82"><a id="__codelineno-130-82" name="__codelineno-130-82"></a><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-130-83"><a id="__codelineno-130-83" name="__codelineno-130-83"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
</span><span id="__span-130-84"><a id="__codelineno-130-84" name="__codelineno-130-84"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-130-85"><a id="__codelineno-130-85" name="__codelineno-130-85"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-130-86"><a id="__codelineno-130-86" name="__codelineno-130-86"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-130-87"><a id="__codelineno-130-87" name="__codelineno-130-87"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-88"><a id="__codelineno-130-88" name="__codelineno-130-88"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-130-89"><a id="__codelineno-130-89" name="__codelineno-130-89"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-130-90"><a id="__codelineno-130-90" name="__codelineno-130-90"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deluan/navidrome:latest</span>
</span><span id="__span-130-91"><a id="__codelineno-130-91" name="__codelineno-130-91"></a><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-130-92"><a id="__codelineno-130-92" name="__codelineno-130-92"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-93"><a id="__codelineno-130-93" name="__codelineno-130-93"></a><span class="w">          </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-130-94"><a id="__codelineno-130-94" name="__codelineno-130-94"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ND_BASEURL</span>
</span><span id="__span-130-95"><a id="__codelineno-130-95" name="__codelineno-130-95"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"https://navidrome.very-very-dark-gray.top/"</span>
</span><span id="__span-130-96"><a id="__codelineno-130-96" name="__codelineno-130-96"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ND_LOGLEVEL</span>
</span><span id="__span-130-97"><a id="__codelineno-130-97" name="__codelineno-130-97"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"info"</span>
</span><span id="__span-130-98"><a id="__codelineno-130-98" name="__codelineno-130-98"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ND_SCANSCHEDULE</span>
</span><span id="__span-130-99"><a id="__codelineno-130-99" name="__codelineno-130-99"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"1h"</span>
</span><span id="__span-130-100"><a id="__codelineno-130-100" name="__codelineno-130-100"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ND_SESSIONTIMEOUT</span>
</span><span id="__span-130-101"><a id="__codelineno-130-101" name="__codelineno-130-101"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"24h"</span>
</span><span id="__span-130-102"><a id="__codelineno-130-102" name="__codelineno-130-102"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-130-103"><a id="__codelineno-130-103" name="__codelineno-130-103"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4533</span>
</span><span id="__span-130-104"><a id="__codelineno-130-104" name="__codelineno-130-104"></a><span class="w">          </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-130-105"><a id="__codelineno-130-105" name="__codelineno-130-105"></a><span class="w">          </span><span class="nt">stdin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-130-106"><a id="__codelineno-130-106" name="__codelineno-130-106"></a><span class="w">          </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-130-107"><a id="__codelineno-130-107" name="__codelineno-130-107"></a><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-130-108"><a id="__codelineno-130-108" name="__codelineno-130-108"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data</span>
</span><span id="__span-130-109"><a id="__codelineno-130-109" name="__codelineno-130-109"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-data</span>
</span><span id="__span-130-110"><a id="__codelineno-130-110" name="__codelineno-130-110"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/music</span>
</span><span id="__span-130-111"><a id="__codelineno-130-111" name="__codelineno-130-111"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-music</span>
</span><span id="__span-130-112"><a id="__codelineno-130-112" name="__codelineno-130-112"></a><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span>
</span><span id="__span-130-113"><a id="__codelineno-130-113" name="__codelineno-130-113"></a><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-130-114"><a id="__codelineno-130-114" name="__codelineno-130-114"></a><span class="w">            </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">116</span>
</span><span id="__span-130-115"><a id="__codelineno-130-115" name="__codelineno-130-115"></a><span class="w">            </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">116</span>
</span><span id="__span-130-116"><a id="__codelineno-130-116" name="__codelineno-130-116"></a><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-130-117"><a id="__codelineno-130-117" name="__codelineno-130-117"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-130-118"><a id="__codelineno-130-118" name="__codelineno-130-118"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-data</span>
</span><span id="__span-130-119"><a id="__codelineno-130-119" name="__codelineno-130-119"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-130-120"><a id="__codelineno-130-120" name="__codelineno-130-120"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-pvc-data</span>
</span><span id="__span-130-121"><a id="__codelineno-130-121" name="__codelineno-130-121"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-music</span>
</span><span id="__span-130-122"><a id="__codelineno-130-122" name="__codelineno-130-122"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-130-123"><a id="__codelineno-130-123" name="__codelineno-130-123"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-pvc-music</span>
</span><span id="__span-130-124"><a id="__codelineno-130-124" name="__codelineno-130-124"></a><span class="nn">---</span>
</span><span id="__span-130-125"><a id="__codelineno-130-125" name="__codelineno-130-125"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-130-126"><a id="__codelineno-130-126" name="__codelineno-130-126"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-130-127"><a id="__codelineno-130-127" name="__codelineno-130-127"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-130-128"><a id="__codelineno-130-128" name="__codelineno-130-128"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-svc</span>
</span><span id="__span-130-129"><a id="__codelineno-130-129" name="__codelineno-130-129"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-130"><a id="__codelineno-130-130" name="__codelineno-130-130"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-130-131"><a id="__codelineno-130-131" name="__codelineno-130-131"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</span><span id="__span-130-132"><a id="__codelineno-130-132" name="__codelineno-130-132"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-130-133"><a id="__codelineno-130-133" name="__codelineno-130-133"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4533</span>
</span><span id="__span-130-134"><a id="__codelineno-130-134" name="__codelineno-130-134"></a><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30533</span>
</span><span id="__span-130-135"><a id="__codelineno-130-135" name="__codelineno-130-135"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4533</span>
</span><span id="__span-130-136"><a id="__codelineno-130-136" name="__codelineno-130-136"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-130-137"><a id="__codelineno-130-137" name="__codelineno-130-137"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-138"><a id="__codelineno-130-138" name="__codelineno-130-138"></a><span class="nn">---</span>
</span><span id="__span-130-139"><a id="__codelineno-130-139" name="__codelineno-130-139"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-130-140"><a id="__codelineno-130-140" name="__codelineno-130-140"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-130-141"><a id="__codelineno-130-141" name="__codelineno-130-141"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-130-142"><a id="__codelineno-130-142" name="__codelineno-130-142"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-ingress</span>
</span><span id="__span-130-143"><a id="__codelineno-130-143" name="__codelineno-130-143"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome</span>
</span><span id="__span-130-144"><a id="__codelineno-130-144" name="__codelineno-130-144"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-130-145"><a id="__codelineno-130-145" name="__codelineno-130-145"></a><span class="w">    </span><span class="nt">acme.cert-manager.io/http01-edit-in-place</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-130-146"><a id="__codelineno-130-146" name="__codelineno-130-146"></a><span class="w">    </span><span class="nt">cert-manager.io/issue-temporary-certificate</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-130-147"><a id="__codelineno-130-147" name="__codelineno-130-147"></a><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-130-148"><a id="__codelineno-130-148" name="__codelineno-130-148"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/websocket-services</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-svc</span>
</span><span id="__span-130-149"><a id="__codelineno-130-149" name="__codelineno-130-149"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-130-150"><a id="__codelineno-130-150" name="__codelineno-130-150"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-130-151"><a id="__codelineno-130-151" name="__codelineno-130-151"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-130-152"><a id="__codelineno-130-152" name="__codelineno-130-152"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome.very-very-dark-gray.top</span>
</span><span id="__span-130-153"><a id="__codelineno-130-153" name="__codelineno-130-153"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-130-154"><a id="__codelineno-130-154" name="__codelineno-130-154"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-130-155"><a id="__codelineno-130-155" name="__codelineno-130-155"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-130-156"><a id="__codelineno-130-156" name="__codelineno-130-156"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-130-157"><a id="__codelineno-130-157" name="__codelineno-130-157"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-130-158"><a id="__codelineno-130-158" name="__codelineno-130-158"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-130-159"><a id="__codelineno-130-159" name="__codelineno-130-159"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome-svc</span>
</span><span id="__span-130-160"><a id="__codelineno-130-160" name="__codelineno-130-160"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-130-161"><a id="__codelineno-130-161" name="__codelineno-130-161"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4533</span>
</span><span id="__span-130-162"><a id="__codelineno-130-162" name="__codelineno-130-162"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-130-163"><a id="__codelineno-130-163" name="__codelineno-130-163"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret</span>
</span><span id="__span-130-164"><a id="__codelineno-130-164" name="__codelineno-130-164"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-130-165"><a id="__codelineno-130-165" name="__codelineno-130-165"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">navidrome.very-very-dark-gray.top</span>
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<p>Then again, the trick is to copy the <code>/data</code> directory between stopping the service
in <code>lexicon</code> and starting it in <code>octavo</code>.</p>
<p>First, stop Navidrome in <code>lexicon</code> (it won't be used moving forward):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>navidrome<span class="w"> </span>deployment<span class="w"> </span>navidrome<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="go">deployment.apps/navidrome scaled</span>
</span></code></pre></div>
<p>Copy data over from <code>lexicon</code> to <code>octavo</code>, moving the <code>/data</code> directory one level up:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="gp">root@octavo ~ # </span>groupadd<span class="w"> </span>navidrome<span class="w"> </span>-g<span class="w"> </span><span class="m">116</span>
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a><span class="gp">root@octavo ~ # </span>useradd<span class="w">  </span>navidrome<span class="w"> </span>-u<span class="w"> </span><span class="m">116</span><span class="w"> </span>-g<span class="w"> </span><span class="m">116</span><span class="w"> </span>-s<span class="w"> </span>/usr/sbin/nologin
</span><span id="__span-132-3"><a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a><span class="hll"><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/navidrome/data/<span class="w"> </span>/home/k8s/navidrome
</span></span><span id="__span-132-4"><a id="__codelineno-132-4" name="__codelineno-132-4" href="#__codelineno-132-4"></a><span class="gp">root@octavo ~ # </span>chown<span class="w"> </span>-R<span class="w"> </span>navidrome:navidrome<span class="w"> </span>/home/k8s/navidrome
</span><span id="__span-132-5"><a id="__codelineno-132-5" name="__codelineno-132-5" href="#__codelineno-132-5"></a><span class="gp">root@octavo ~ # </span>ls<span class="w"> </span>-hal<span class="w"> </span>/home/k8s/navidrome
</span><span id="__span-132-6"><a id="__codelineno-132-6" name="__codelineno-132-6" href="#__codelineno-132-6"></a><span class="go">total 33M</span>
</span><span id="__span-132-7"><a id="__codelineno-132-7" name="__codelineno-132-7" href="#__codelineno-132-7"></a><span class="go">drwxr-xr-x 1 navidrome navidrome   98 Apr 28 21:22 .</span>
</span><span id="__span-132-8"><a id="__codelineno-132-8" name="__codelineno-132-8" href="#__codelineno-132-8"></a><span class="go">drwxr-xr-x 1 root      root        76 Apr 28 21:14 ..</span>
</span><span id="__span-132-9"><a id="__codelineno-132-9" name="__codelineno-132-9" href="#__codelineno-132-9"></a><span class="go">drwxr-xr-x 1 navidrome navidrome   56 Dec 23 06:09 cache</span>
</span><span id="__span-132-10"><a id="__codelineno-132-10" name="__codelineno-132-10" href="#__codelineno-132-10"></a><span class="go">-rw-r--r-- 1 navidrome navidrome  32M Apr 28 21:08 navidrome.db</span>
</span><span id="__span-132-11"><a id="__codelineno-132-11" name="__codelineno-132-11" href="#__codelineno-132-11"></a><span class="go">-rw-r--r-- 1 navidrome navidrome  32K Apr 28 22:18 navidrome.db-shm</span>
</span><span id="__span-132-12"><a id="__codelineno-132-12" name="__codelineno-132-12" href="#__codelineno-132-12"></a><span class="go">-rw-r--r-- 1 navidrome navidrome 620K Apr 28 22:18 navidrome.db-wal</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The trailing <code>/</code> in <code>lexicon:/home/k8s/navidrome/data/</code> is <strong>critical</strong> to make
the destination directory <code>/home/k8s/navidrome</code> in <code>octavo</code> <strong>be</strong> that <code>data</code>
directory, instead of <em>containing</em> it.</p>
</div>
<p>Finally, start the deployment in <code>octavo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>navidrome.yaml
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a><span class="go">NAME                             READY   STATUS              RESTARTS   AGE</span>
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a><span class="go">pod/cm-acme-http-solver-tq8wv    1/1     Running             0          6s</span>
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a><span class="go">pod/navidrome-588d4d77c7-pcxqm   0/1     ContainerCreating   0          9s</span>
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a>
</span><span id="__span-133-6"><a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a><span class="go">NAME                                TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span>
</span><span id="__span-133-7"><a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a><span class="go">service/cm-acme-http-solver-l9wp2   NodePort   10.97.50.141    &lt;none&gt;        8089:31185/TCP   6s</span>
</span><span id="__span-133-8"><a id="__codelineno-133-8" name="__codelineno-133-8" href="#__codelineno-133-8"></a><span class="go">service/navidrome-svc               NodePort   10.110.51.110   &lt;none&gt;        4533:30533/TCP   9s</span>
</span><span id="__span-133-9"><a id="__codelineno-133-9" name="__codelineno-133-9" href="#__codelineno-133-9"></a>
</span><span id="__span-133-10"><a id="__codelineno-133-10" name="__codelineno-133-10" href="#__codelineno-133-10"></a><span class="go">NAME                        READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-133-11"><a id="__codelineno-133-11" name="__codelineno-133-11" href="#__codelineno-133-11"></a><span class="go">deployment.apps/navidrome   0/1     1            0           9s</span>
</span><span id="__span-133-12"><a id="__codelineno-133-12" name="__codelineno-133-12" href="#__codelineno-133-12"></a>
</span><span id="__span-133-13"><a id="__codelineno-133-13" name="__codelineno-133-13" href="#__codelineno-133-13"></a><span class="go">NAME                                   DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-133-14"><a id="__codelineno-133-14" name="__codelineno-133-14" href="#__codelineno-133-14"></a><span class="go">replicaset.apps/navidrome-588d4d77c7   1         1         0       9s</span>
</span><span id="__span-133-15"><a id="__codelineno-133-15" name="__codelineno-133-15" href="#__codelineno-133-15"></a>
</span><span id="__span-133-16"><a id="__codelineno-133-16" name="__codelineno-133-16" href="#__codelineno-133-16"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>navidrome<span class="w"> </span>
</span><span id="__span-133-17"><a id="__codelineno-133-17" name="__codelineno-133-17" href="#__codelineno-133-17"></a><span class="go">NAME                        TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span>
</span><span id="__span-133-18"><a id="__codelineno-133-18" name="__codelineno-133-18" href="#__codelineno-133-18"></a><span class="go">cm-acme-http-solver-l9wp2   NodePort   10.97.50.141    &lt;none&gt;        8089:31185/TCP   10s</span>
</span><span id="__span-133-19"><a id="__codelineno-133-19" name="__codelineno-133-19" href="#__codelineno-133-19"></a><span class="go">navidrome-svc               NodePort   10.110.51.110   &lt;none&gt;        4533:30533/TCP   13s</span>
</span><span id="__span-133-20"><a id="__codelineno-133-20" name="__codelineno-133-20" href="#__codelineno-133-20"></a>
</span><span id="__span-133-21"><a id="__codelineno-133-21" name="__codelineno-133-21" href="#__codelineno-133-21"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ingress<span class="w"> </span>-n<span class="w"> </span>navidrome<span class="w"> </span>
</span><span id="__span-133-22"><a id="__codelineno-133-22" name="__codelineno-133-22" href="#__codelineno-133-22"></a><span class="go">NAME                CLASS   HOSTS                               ADDRESS         PORTS     AGE</span>
</span><span id="__span-133-23"><a id="__codelineno-133-23" name="__codelineno-133-23" href="#__codelineno-133-23"></a><span class="go">navidrome-ingress   nginx   navidrome.very-very-dark-gray.top   192.168.0.171   80, 443   17</span>
</span></code></pre></div>
<p>After a couple for minutes Navidrome is available at
<a href="https://navidrome.very-very-dark-gray.top/">https://navidrome.very-very-dark-gray.top/</a> and everything works fine.</p>
<h3 id="visual-studio-code-server">Visual Studio Code Server</h3>
<p><a href="../../../../2023/05/29/running-visual-studio-code-server-on-kubernetes/">Visual Studio Code Server</a>
has been running in <code>lexicon</code> for nearly 2 years and it is still sometimes
preferable to using Visual Studio Code on the desktop, so this service is
also migrated over to <code>octavo</code> in very much the same fashion.</p>
<details class="k8s">
<summary>Kubernetes deployment: <code>code-server.yaml</code></summary>
<div class="language-yaml highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">code-server.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-134-1">  1</a></span>
<span class="normal"><a href="#__codelineno-134-2">  2</a></span>
<span class="normal"><a href="#__codelineno-134-3">  3</a></span>
<span class="normal"><a href="#__codelineno-134-4">  4</a></span>
<span class="normal"><a href="#__codelineno-134-5">  5</a></span>
<span class="normal"><a href="#__codelineno-134-6">  6</a></span>
<span class="normal"><a href="#__codelineno-134-7">  7</a></span>
<span class="normal"><a href="#__codelineno-134-8">  8</a></span>
<span class="normal"><a href="#__codelineno-134-9">  9</a></span>
<span class="normal"><a href="#__codelineno-134-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-134-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-134-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-134-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-134-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-134-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-134-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-134-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-134-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-134-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-134-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-134-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-134-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-134-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-134-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-134-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-134-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-134-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-134-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-134-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-134-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-134-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-134-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-134-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-134-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-134-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-134-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-134-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-134-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-134-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-134-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-134-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-134-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-134-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-134-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-134-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-134-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-134-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-134-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-134-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-134-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-134-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-134-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-134-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-134-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-134-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-134-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-134-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-134-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-134-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-134-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-134-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-134-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-134-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-134-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-134-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-134-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-134-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-134-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-134-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-134-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-134-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-134-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-134-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-134-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-134-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-134-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-134-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-134-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-134-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-134-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-134-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-134-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-134-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-134-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-134-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-134-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-134-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-134-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-134-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-134-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-134-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-134-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-134-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-134-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-134-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-134-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-134-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-134-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-134-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-134-100">100</a></span>
<span class="normal"><a href="#__codelineno-134-101">101</a></span>
<span class="normal"><a href="#__codelineno-134-102">102</a></span>
<span class="normal"><a href="#__codelineno-134-103">103</a></span>
<span class="normal"><a href="#__codelineno-134-104">104</a></span>
<span class="normal"><a href="#__codelineno-134-105">105</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-134-4"><a id="__codelineno-134-4" name="__codelineno-134-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-5"><a id="__codelineno-134-5" name="__codelineno-134-5"></a><span class="nn">---</span>
</span><span id="__span-134-6"><a id="__codelineno-134-6" name="__codelineno-134-6"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-134-7"><a id="__codelineno-134-7" name="__codelineno-134-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-134-8"><a id="__codelineno-134-8" name="__codelineno-134-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-134-9"><a id="__codelineno-134-9" name="__codelineno-134-9"></a><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-10"><a id="__codelineno-134-10" name="__codelineno-134-10"></a><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-11"><a id="__codelineno-134-11" name="__codelineno-134-11"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-134-12"><a id="__codelineno-134-12" name="__codelineno-134-12"></a><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-134-13"><a id="__codelineno-134-13" name="__codelineno-134-13"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id="__span-134-14"><a id="__codelineno-134-14" name="__codelineno-134-14"></a><span class="w">  </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-134-15"><a id="__codelineno-134-15" name="__codelineno-134-15"></a><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-134-16"><a id="__codelineno-134-16" name="__codelineno-134-16"></a><span class="w">  </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-17"><a id="__codelineno-134-17" name="__codelineno-134-17"></a><span class="nn">---</span>
</span><span id="__span-134-18"><a id="__codelineno-134-18" name="__codelineno-134-18"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-134-19"><a id="__codelineno-134-19" name="__codelineno-134-19"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-134-20"><a id="__codelineno-134-20" name="__codelineno-134-20"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-134-21"><a id="__codelineno-134-21" name="__codelineno-134-21"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server-pv</span>
</span><span id="__span-134-22"><a id="__codelineno-134-22" name="__codelineno-134-22"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-134-23"><a id="__codelineno-134-23" name="__codelineno-134-23"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">local</span>
</span><span id="__span-134-24"><a id="__codelineno-134-24" name="__codelineno-134-24"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-25"><a id="__codelineno-134-25" name="__codelineno-134-25"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-134-26"><a id="__codelineno-134-26" name="__codelineno-134-26"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-134-27"><a id="__codelineno-134-27" name="__codelineno-134-27"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-134-28"><a id="__codelineno-134-28" name="__codelineno-134-28"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
</span><span id="__span-134-29"><a id="__codelineno-134-29" name="__codelineno-134-29"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-134-30"><a id="__codelineno-134-30" name="__codelineno-134-30"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-134-31"><a id="__codelineno-134-31" name="__codelineno-134-31"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-134-32"><a id="__codelineno-134-32" name="__codelineno-134-32"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">"/home/k8s/code-server"</span>
</span><span id="__span-134-33"><a id="__codelineno-134-33" name="__codelineno-134-33"></a><span class="nn">---</span>
</span><span id="__span-134-34"><a id="__codelineno-134-34" name="__codelineno-134-34"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-134-35"><a id="__codelineno-134-35" name="__codelineno-134-35"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-134-36"><a id="__codelineno-134-36" name="__codelineno-134-36"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-134-37"><a id="__codelineno-134-37" name="__codelineno-134-37"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server-pv-claim</span>
</span><span id="__span-134-38"><a id="__codelineno-134-38" name="__codelineno-134-38"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-39"><a id="__codelineno-134-39" name="__codelineno-134-39"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-134-40"><a id="__codelineno-134-40" name="__codelineno-134-40"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-134-41"><a id="__codelineno-134-41" name="__codelineno-134-41"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-134-42"><a id="__codelineno-134-42" name="__codelineno-134-42"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-134-43"><a id="__codelineno-134-43" name="__codelineno-134-43"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-134-44"><a id="__codelineno-134-44" name="__codelineno-134-44"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-134-45"><a id="__codelineno-134-45" name="__codelineno-134-45"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3Gi</span>
</span><span id="__span-134-46"><a id="__codelineno-134-46" name="__codelineno-134-46"></a><span class="nn">---</span>
</span><span id="__span-134-47"><a id="__codelineno-134-47" name="__codelineno-134-47"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-134-48"><a id="__codelineno-134-48" name="__codelineno-134-48"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-134-49"><a id="__codelineno-134-49" name="__codelineno-134-49"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-134-50"><a id="__codelineno-134-50" name="__codelineno-134-50"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-134-51"><a id="__codelineno-134-51" name="__codelineno-134-51"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-52"><a id="__codelineno-134-52" name="__codelineno-134-52"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-53"><a id="__codelineno-134-53" name="__codelineno-134-53"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-54"><a id="__codelineno-134-54" name="__codelineno-134-54"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-134-55"><a id="__codelineno-134-55" name="__codelineno-134-55"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-134-56"><a id="__codelineno-134-56" name="__codelineno-134-56"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-134-57"><a id="__codelineno-134-57" name="__codelineno-134-57"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-58"><a id="__codelineno-134-58" name="__codelineno-134-58"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-134-59"><a id="__codelineno-134-59" name="__codelineno-134-59"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-134-60"><a id="__codelineno-134-60" name="__codelineno-134-60"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-134-61"><a id="__codelineno-134-61" name="__codelineno-134-61"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-62"><a id="__codelineno-134-62" name="__codelineno-134-62"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-134-63"><a id="__codelineno-134-63" name="__codelineno-134-63"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-134-64"><a id="__codelineno-134-64" name="__codelineno-134-64"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server-storage</span>
</span><span id="__span-134-65"><a id="__codelineno-134-65" name="__codelineno-134-65"></a><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-134-66"><a id="__codelineno-134-66" name="__codelineno-134-66"></a><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server-pv-claim</span>
</span><span id="__span-134-67"><a id="__codelineno-134-67" name="__codelineno-134-67"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-134-68"><a id="__codelineno-134-68" name="__codelineno-134-68"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codercom/code-server</span>
</span><span id="__span-134-69"><a id="__codelineno-134-69" name="__codelineno-134-69"></a><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
</span><span id="__span-134-70"><a id="__codelineno-134-70" name="__codelineno-134-70"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-71"><a id="__codelineno-134-71" name="__codelineno-134-71"></a><span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-134-72"><a id="__codelineno-134-72" name="__codelineno-134-72"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-134-73"><a id="__codelineno-134-73" name="__codelineno-134-73"></a><span class="w">        </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-134-74"><a id="__codelineno-134-74" name="__codelineno-134-74"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PASSWORD</span>
</span><span id="__span-134-75"><a id="__codelineno-134-75" name="__codelineno-134-75"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"*************************"</span>
</span><span id="__span-134-76"><a id="__codelineno-134-76" name="__codelineno-134-76"></a><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-134-77"><a id="__codelineno-134-77" name="__codelineno-134-77"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">"/home/coder"</span>
</span><span id="__span-134-78"><a id="__codelineno-134-78" name="__codelineno-134-78"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server-storage</span>
</span><span id="__span-134-79"><a id="__codelineno-134-79" name="__codelineno-134-79"></a><span class="nn">---</span>
</span><span id="__span-134-80"><a id="__codelineno-134-80" name="__codelineno-134-80"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-134-81"><a id="__codelineno-134-81" name="__codelineno-134-81"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-134-82"><a id="__codelineno-134-82" name="__codelineno-134-82"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-134-83"><a id="__codelineno-134-83" name="__codelineno-134-83"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server-ingress</span>
</span><span id="__span-134-84"><a id="__codelineno-134-84" name="__codelineno-134-84"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-85"><a id="__codelineno-134-85" name="__codelineno-134-85"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-134-86"><a id="__codelineno-134-86" name="__codelineno-134-86"></a><span class="w">    </span><span class="nt">acme.cert-manager.io/http01-edit-in-place</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-134-87"><a id="__codelineno-134-87" name="__codelineno-134-87"></a><span class="w">    </span><span class="nt">cert-manager.io/issue-temporary-certificate</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-134-88"><a id="__codelineno-134-88" name="__codelineno-134-88"></a><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-134-89"><a id="__codelineno-134-89" name="__codelineno-134-89"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-134-90"><a id="__codelineno-134-90" name="__codelineno-134-90"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-134-91"><a id="__codelineno-134-91" name="__codelineno-134-91"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-134-92"><a id="__codelineno-134-92" name="__codelineno-134-92"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="s">"code-server.very-very-dark-gray.top"</span>
</span><span id="__span-134-93"><a id="__codelineno-134-93" name="__codelineno-134-93"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-134-94"><a id="__codelineno-134-94" name="__codelineno-134-94"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-134-95"><a id="__codelineno-134-95" name="__codelineno-134-95"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-134-96"><a id="__codelineno-134-96" name="__codelineno-134-96"></a><span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-134-97"><a id="__codelineno-134-97" name="__codelineno-134-97"></a><span class="w">            </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-134-98"><a id="__codelineno-134-98" name="__codelineno-134-98"></a><span class="w">              </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-134-99"><a id="__codelineno-134-99" name="__codelineno-134-99"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">code-server</span>
</span><span id="__span-134-100"><a id="__codelineno-134-100" name="__codelineno-134-100"></a><span class="w">                </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-134-101"><a id="__codelineno-134-101" name="__codelineno-134-101"></a><span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id="__span-134-102"><a id="__codelineno-134-102" name="__codelineno-134-102"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-134-103"><a id="__codelineno-134-103" name="__codelineno-134-103"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret</span>
</span><span id="__span-134-104"><a id="__codelineno-134-104" name="__codelineno-134-104"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-134-105"><a id="__codelineno-134-105" name="__codelineno-134-105"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"code-server.very-very-dark-gray.top"</span>
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<p>First, stop the service in <code>lexicon</code> (it won't be used moving forward):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>code-server<span class="w"> </span>deployment<span class="w"> </span>code-server<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="go">deployment.apps/code-server scaled</span>
</span></code></pre></div>
<p>Copy data over from <code>lexicon</code> to <code>octavo</code> (keeping ownership to <code>ponder</code>):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/code-server<span class="w"> </span>/home/k8s/
</span></code></pre></div>
<p>Start the deployment in <code>octavo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>code-server.yaml
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a><span class="go">namespace/code-server created</span>
</span><span id="__span-137-3"><a id="__codelineno-137-3" name="__codelineno-137-3" href="#__codelineno-137-3"></a><span class="go">service/code-server created</span>
</span><span id="__span-137-4"><a id="__codelineno-137-4" name="__codelineno-137-4" href="#__codelineno-137-4"></a><span class="go">persistentvolume/code-server-pv created</span>
</span><span id="__span-137-5"><a id="__codelineno-137-5" name="__codelineno-137-5" href="#__codelineno-137-5"></a><span class="go">persistentvolumeclaim/code-server-pv-claim created</span>
</span><span id="__span-137-6"><a id="__codelineno-137-6" name="__codelineno-137-6" href="#__codelineno-137-6"></a><span class="go">deployment.apps/code-server created</span>
</span><span id="__span-137-7"><a id="__codelineno-137-7" name="__codelineno-137-7" href="#__codelineno-137-7"></a><span class="go">ingress.networking.k8s.io/code-server-ingress created</span>
</span><span id="__span-137-8"><a id="__codelineno-137-8" name="__codelineno-137-8" href="#__codelineno-137-8"></a>
</span><span id="__span-137-9"><a id="__codelineno-137-9" name="__codelineno-137-9" href="#__codelineno-137-9"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>code-server
</span><span id="__span-137-10"><a id="__codelineno-137-10" name="__codelineno-137-10" href="#__codelineno-137-10"></a><span class="go">NAME                               READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-137-11"><a id="__codelineno-137-11" name="__codelineno-137-11" href="#__codelineno-137-11"></a><span class="go">pod/cm-acme-http-solver-44r69      1/1     Running   0          16s</span>
</span><span id="__span-137-12"><a id="__codelineno-137-12" name="__codelineno-137-12" href="#__codelineno-137-12"></a><span class="go">pod/code-server-69d64cd9cd-llgqq   1/1     Running   0          18s</span>
</span><span id="__span-137-13"><a id="__codelineno-137-13" name="__codelineno-137-13" href="#__codelineno-137-13"></a>
</span><span id="__span-137-14"><a id="__codelineno-137-14" name="__codelineno-137-14" href="#__codelineno-137-14"></a><span class="go">NAME                                TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span>
</span><span id="__span-137-15"><a id="__codelineno-137-15" name="__codelineno-137-15" href="#__codelineno-137-15"></a><span class="go">service/cm-acme-http-solver-x75d2   NodePort    10.106.2.52     &lt;none&gt;        8089:32080/TCP   16s</span>
</span><span id="__span-137-16"><a id="__codelineno-137-16" name="__codelineno-137-16" href="#__codelineno-137-16"></a><span class="go">service/code-server                 ClusterIP   10.103.60.210   &lt;none&gt;        80/TCP           18s</span>
</span><span id="__span-137-17"><a id="__codelineno-137-17" name="__codelineno-137-17" href="#__codelineno-137-17"></a>
</span><span id="__span-137-18"><a id="__codelineno-137-18" name="__codelineno-137-18" href="#__codelineno-137-18"></a><span class="go">NAME                          READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-137-19"><a id="__codelineno-137-19" name="__codelineno-137-19" href="#__codelineno-137-19"></a><span class="go">deployment.apps/code-server   1/1     1            1           18s</span>
</span><span id="__span-137-20"><a id="__codelineno-137-20" name="__codelineno-137-20" href="#__codelineno-137-20"></a>
</span><span id="__span-137-21"><a id="__codelineno-137-21" name="__codelineno-137-21" href="#__codelineno-137-21"></a><span class="go">NAME                                     DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-137-22"><a id="__codelineno-137-22" name="__codelineno-137-22" href="#__codelineno-137-22"></a><span class="go">replicaset.apps/code-server-69d64cd9cd   1         1         1       18s</span>
</span><span id="__span-137-23"><a id="__codelineno-137-23" name="__codelineno-137-23" href="#__codelineno-137-23"></a>
</span><span id="__span-137-24"><a id="__codelineno-137-24" name="__codelineno-137-24" href="#__codelineno-137-24"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>code-server
</span><span id="__span-137-25"><a id="__codelineno-137-25" name="__codelineno-137-25" href="#__codelineno-137-25"></a><span class="go">NAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span>
</span><span id="__span-137-26"><a id="__codelineno-137-26" name="__codelineno-137-26" href="#__codelineno-137-26"></a><span class="go">cm-acme-http-solver-x75d2   NodePort    10.106.2.52     &lt;none&gt;        8089:32080/TCP   5s</span>
</span><span id="__span-137-27"><a id="__codelineno-137-27" name="__codelineno-137-27" href="#__codelineno-137-27"></a><span class="go">code-server                 ClusterIP   10.103.60.210   &lt;none&gt;        80/TCP           7s</span>
</span><span id="__span-137-28"><a id="__codelineno-137-28" name="__codelineno-137-28" href="#__codelineno-137-28"></a>
</span><span id="__span-137-29"><a id="__codelineno-137-29" name="__codelineno-137-29" href="#__codelineno-137-29"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ingress<span class="w"> </span>-n<span class="w"> </span>code-server
</span><span id="__span-137-30"><a id="__codelineno-137-30" name="__codelineno-137-30" href="#__codelineno-137-30"></a><span class="go">NAME                  CLASS   HOSTS                                   ADDRESS   PORTS     AGE</span>
</span><span id="__span-137-31"><a id="__codelineno-137-31" name="__codelineno-137-31" href="#__codelineno-137-31"></a><span class="go">code-server-ingress   nginx   code-server.very-very-dark-gray.top               80, 443   11s</span>
</span></code></pre></div>
<p>After a couple for minutes Visual Studio Code is available at
<a href="https://code-server.very-very-dark-gray.top/">https://code-server.very-very-dark-gray.top/</a> and everything works fine, although
due to the new URL it needs to be re-authorized on the linked GitHub account.</p>
<h3 id="plex-media-server">Plex Media Server</h3>
<p><a href="../../../../2023/09/16/migrating-a-plex-media-server-to-kubernetes/">Migrating my Plex Media Server to Kubernetes</a>
on <code>lexicon</code> was relatively involved and this Plex server has already been replaced by
<a href="#new-services-post-migration">Jellyfin</a>, so it's not clear that this Plex server needs
to be <em>migrated</em> in the same way as before.</p>
<p>To make sure the service won't be missed, the deployment is now stopped:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>plexserver<span class="w"> </span>deployment<span class="w"> </span>plexserver<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="go">deployment.apps/plexserver scaled</span>
</span></code></pre></div>
<p>For now, its database will be copied over to <code>octavo</code> so the "same" Plex
server can be restored later in necessary, although it may make more time
to instead set it up as a new Plex server with only a subset of the library.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/plexmediaserver<span class="w"> </span>/home/k8s/
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="gp">root@octavo ~ # </span>ls<span class="w"> </span>-lan<span class="w"> </span>/home/k8s/plexmediaserver/
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="go">total 0</span>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a><span class="go">drwxr-xr-x 1 998 998  42 Sep 16  2023 .</span>
</span><span id="__span-139-5"><a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="go">drwxr-xr-x 1   0   0 306 May  1 19:16 ..</span>
</span><span id="__span-139-6"><a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a><span class="go">drwxr-xr-x 1 998 998  38 Jul  6  2022 Library</span>
</span><span id="__span-139-7"><a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a><span class="go">drwxr-xr-x 1 998 998  38 Sep 15  2023 Library.backup</span>
</span></code></pre></div>
<p>UID/GID 998 is already taken by <code>systemd-network</code> so the files would need to have their
ownership changed <em>if and when</em> a dedicated <code>plex</code> user is created for a new Plex Media
Server deployment.</p>
<h3 id="minecraft-server">Minecraft Server</h3>
<p><a href="../../../../2023/08/10/running-minecraft-java-server-for-bedrock-clients-on-kubernetes/">Running Minecraft Java Server for Bedrock clients on Kubernetes</a>
was fun while the kids wanted to play Minecraft, but they don't seem to be so inclined
since some time ago and have admitted they won't be using it any time soon. Since the
server was taking up a sizeable <strong>10GB</strong> of RAM (to do essentially nothing with it),
it has been scaled down to zero replicas and won't be setup in <code>octavo</code> until there is
demand for it again. Maybe by then it can be added to a working
<a href="../../../../../projects/self-hosting/#pterodactyl">Pterodactyl</a>.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>minecraft-server<span class="w"> </span>deployment<span class="w"> </span>minecraft-server<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a><span class="go">deployment.apps/minecraft-server scaled</span>
</span></code></pre></div>
<p>In the meantime, backups are kept in their configured paths for potential future use:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-141-1"><a id="__codelineno-141-1" name="__codelineno-141-1" href="#__codelineno-141-1"></a><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/minecraft-server<span class="w"> </span>/home/k8s/
</span><span id="__span-141-2"><a id="__codelineno-141-2" name="__codelineno-141-2" href="#__codelineno-141-2"></a><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/minecraft-server-backups<span class="w"> </span>/home/k8s/
</span><span id="__span-141-3"><a id="__codelineno-141-3" name="__codelineno-141-3" href="#__codelineno-141-3"></a><span class="gp">root@octavo ~ # </span>du<span class="w"> </span>-sh<span class="w"> </span>/home/k8s/minecraft-server*
</span><span id="__span-141-4"><a id="__codelineno-141-4" name="__codelineno-141-4" href="#__codelineno-141-4"></a><span class="go">1.8G    /home/k8s/minecraft-server</span>
</span><span id="__span-141-5"><a id="__codelineno-141-5" name="__codelineno-141-5" href="#__codelineno-141-5"></a><span class="go">40G     /home/k8s/minecraft-server-backups</span>
</span></code></pre></div>
<h3 id="firefly-iii">Firefly III</h3>
<p><a href="../../../../2024/05/19/self-hosted-accountancy-with-firefly-iii/">Self-hosted accountancy with Firefly III</a>
has not been used much; in all honesty keeping track of expenses and transactions is a
lot less fun and a lot more grind than everything else going on. Even so, just in case
this <em>will</em> be used in the future, it is worth migrating just to not throw it away.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not bother trying to change what user these processes run as, these are
hard-coded in the images and (at least) the <code>mariadb</code> pod will fail to start
if it runs as a different user.</p>
</div>
<details class="k8s">
<summary>Kubernetes deployment: <code>firefly-iii.yaml</code></summary>
<div class="language-yaml highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">firefly-iii.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-142-1">  1</a></span>
<span class="normal"><a href="#__codelineno-142-2">  2</a></span>
<span class="normal"><a href="#__codelineno-142-3">  3</a></span>
<span class="normal"><a href="#__codelineno-142-4">  4</a></span>
<span class="normal"><a href="#__codelineno-142-5">  5</a></span>
<span class="normal"><a href="#__codelineno-142-6">  6</a></span>
<span class="normal"><a href="#__codelineno-142-7">  7</a></span>
<span class="normal"><a href="#__codelineno-142-8">  8</a></span>
<span class="normal"><a href="#__codelineno-142-9">  9</a></span>
<span class="normal"><a href="#__codelineno-142-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-142-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-142-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-142-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-142-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-142-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-142-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-142-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-142-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-142-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-142-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-142-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-142-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-142-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-142-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-142-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-142-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-142-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-142-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-142-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-142-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-142-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-142-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-142-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-142-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-142-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-142-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-142-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-142-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-142-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-142-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-142-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-142-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-142-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-142-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-142-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-142-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-142-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-142-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-142-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-142-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-142-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-142-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-142-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-142-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-142-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-142-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-142-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-142-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-142-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-142-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-142-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-142-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-142-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-142-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-142-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-142-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-142-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-142-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-142-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-142-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-142-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-142-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-142-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-142-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-142-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-142-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-142-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-142-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-142-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-142-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-142-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-142-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-142-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-142-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-142-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-142-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-142-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-142-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-142-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-142-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-142-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-142-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-142-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-142-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-142-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-142-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-142-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-142-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-142-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-142-100">100</a></span>
<span class="normal"><a href="#__codelineno-142-101">101</a></span>
<span class="normal"><a href="#__codelineno-142-102">102</a></span>
<span class="normal"><a href="#__codelineno-142-103">103</a></span>
<span class="normal"><a href="#__codelineno-142-104">104</a></span>
<span class="normal"><a href="#__codelineno-142-105">105</a></span>
<span class="normal"><a href="#__codelineno-142-106">106</a></span>
<span class="normal"><a href="#__codelineno-142-107">107</a></span>
<span class="normal"><a href="#__codelineno-142-108">108</a></span>
<span class="normal"><a href="#__codelineno-142-109">109</a></span>
<span class="normal"><a href="#__codelineno-142-110">110</a></span>
<span class="normal"><a href="#__codelineno-142-111">111</a></span>
<span class="normal"><a href="#__codelineno-142-112">112</a></span>
<span class="normal"><a href="#__codelineno-142-113">113</a></span>
<span class="normal"><a href="#__codelineno-142-114">114</a></span>
<span class="normal"><a href="#__codelineno-142-115">115</a></span>
<span class="normal"><a href="#__codelineno-142-116">116</a></span>
<span class="normal"><a href="#__codelineno-142-117">117</a></span>
<span class="normal"><a href="#__codelineno-142-118">118</a></span>
<span class="normal"><a href="#__codelineno-142-119">119</a></span>
<span class="normal"><a href="#__codelineno-142-120">120</a></span>
<span class="normal"><a href="#__codelineno-142-121">121</a></span>
<span class="normal"><a href="#__codelineno-142-122">122</a></span>
<span class="normal"><a href="#__codelineno-142-123">123</a></span>
<span class="normal"><a href="#__codelineno-142-124">124</a></span>
<span class="normal"><a href="#__codelineno-142-125">125</a></span>
<span class="normal"><a href="#__codelineno-142-126">126</a></span>
<span class="normal"><a href="#__codelineno-142-127">127</a></span>
<span class="normal"><a href="#__codelineno-142-128">128</a></span>
<span class="normal"><a href="#__codelineno-142-129">129</a></span>
<span class="normal"><a href="#__codelineno-142-130">130</a></span>
<span class="normal"><a href="#__codelineno-142-131">131</a></span>
<span class="normal"><a href="#__codelineno-142-132">132</a></span>
<span class="normal"><a href="#__codelineno-142-133">133</a></span>
<span class="normal"><a href="#__codelineno-142-134">134</a></span>
<span class="normal"><a href="#__codelineno-142-135">135</a></span>
<span class="normal"><a href="#__codelineno-142-136">136</a></span>
<span class="normal"><a href="#__codelineno-142-137">137</a></span>
<span class="normal"><a href="#__codelineno-142-138">138</a></span>
<span class="normal"><a href="#__codelineno-142-139">139</a></span>
<span class="normal"><a href="#__codelineno-142-140">140</a></span>
<span class="normal"><a href="#__codelineno-142-141">141</a></span>
<span class="normal"><a href="#__codelineno-142-142">142</a></span>
<span class="normal"><a href="#__codelineno-142-143">143</a></span>
<span class="normal"><a href="#__codelineno-142-144">144</a></span>
<span class="normal"><a href="#__codelineno-142-145">145</a></span>
<span class="normal"><a href="#__codelineno-142-146">146</a></span>
<span class="normal"><a href="#__codelineno-142-147">147</a></span>
<span class="normal"><a href="#__codelineno-142-148">148</a></span>
<span class="normal"><a href="#__codelineno-142-149">149</a></span>
<span class="normal"><a href="#__codelineno-142-150">150</a></span>
<span class="normal"><a href="#__codelineno-142-151">151</a></span>
<span class="normal"><a href="#__codelineno-142-152">152</a></span>
<span class="normal"><a href="#__codelineno-142-153">153</a></span>
<span class="normal"><a href="#__codelineno-142-154">154</a></span>
<span class="normal"><a href="#__codelineno-142-155">155</a></span>
<span class="normal"><a href="#__codelineno-142-156">156</a></span>
<span class="normal"><a href="#__codelineno-142-157">157</a></span>
<span class="normal"><a href="#__codelineno-142-158">158</a></span>
<span class="normal"><a href="#__codelineno-142-159">159</a></span>
<span class="normal"><a href="#__codelineno-142-160">160</a></span>
<span class="normal"><a href="#__codelineno-142-161">161</a></span>
<span class="normal"><a href="#__codelineno-142-162">162</a></span>
<span class="normal"><a href="#__codelineno-142-163">163</a></span>
<span class="normal"><a href="#__codelineno-142-164">164</a></span>
<span class="normal"><a href="#__codelineno-142-165">165</a></span>
<span class="normal"><a href="#__codelineno-142-166">166</a></span>
<span class="normal"><a href="#__codelineno-142-167">167</a></span>
<span class="normal"><a href="#__codelineno-142-168">168</a></span>
<span class="normal"><a href="#__codelineno-142-169">169</a></span>
<span class="normal"><a href="#__codelineno-142-170">170</a></span>
<span class="normal"><a href="#__codelineno-142-171">171</a></span>
<span class="normal"><a href="#__codelineno-142-172">172</a></span>
<span class="normal"><a href="#__codelineno-142-173">173</a></span>
<span class="normal"><a href="#__codelineno-142-174">174</a></span>
<span class="normal"><a href="#__codelineno-142-175">175</a></span>
<span class="normal"><a href="#__codelineno-142-176">176</a></span>
<span class="normal"><a href="#__codelineno-142-177">177</a></span>
<span class="normal"><a href="#__codelineno-142-178">178</a></span>
<span class="normal"><a href="#__codelineno-142-179">179</a></span>
<span class="normal"><a href="#__codelineno-142-180">180</a></span>
<span class="normal"><a href="#__codelineno-142-181">181</a></span>
<span class="normal"><a href="#__codelineno-142-182">182</a></span>
<span class="normal"><a href="#__codelineno-142-183">183</a></span>
<span class="normal"><a href="#__codelineno-142-184">184</a></span>
<span class="normal"><a href="#__codelineno-142-185">185</a></span>
<span class="normal"><a href="#__codelineno-142-186">186</a></span>
<span class="normal"><a href="#__codelineno-142-187">187</a></span>
<span class="normal"><a href="#__codelineno-142-188">188</a></span>
<span class="normal"><a href="#__codelineno-142-189">189</a></span>
<span class="normal"><a href="#__codelineno-142-190">190</a></span>
<span class="normal"><a href="#__codelineno-142-191">191</a></span>
<span class="normal"><a href="#__codelineno-142-192">192</a></span>
<span class="normal"><a href="#__codelineno-142-193">193</a></span>
<span class="normal"><a href="#__codelineno-142-194">194</a></span>
<span class="normal"><a href="#__codelineno-142-195">195</a></span>
<span class="normal"><a href="#__codelineno-142-196">196</a></span>
<span class="normal"><a href="#__codelineno-142-197">197</a></span>
<span class="normal"><a href="#__codelineno-142-198">198</a></span>
<span class="normal"><a href="#__codelineno-142-199">199</a></span>
<span class="normal"><a href="#__codelineno-142-200">200</a></span>
<span class="normal"><a href="#__codelineno-142-201">201</a></span>
<span class="normal"><a href="#__codelineno-142-202">202</a></span>
<span class="normal"><a href="#__codelineno-142-203">203</a></span>
<span class="normal"><a href="#__codelineno-142-204">204</a></span>
<span class="normal"><a href="#__codelineno-142-205">205</a></span>
<span class="normal"><a href="#__codelineno-142-206">206</a></span>
<span class="normal"><a href="#__codelineno-142-207">207</a></span>
<span class="normal"><a href="#__codelineno-142-208">208</a></span>
<span class="normal"><a href="#__codelineno-142-209">209</a></span>
<span class="normal"><a href="#__codelineno-142-210">210</a></span>
<span class="normal"><a href="#__codelineno-142-211">211</a></span>
<span class="normal"><a href="#__codelineno-142-212">212</a></span>
<span class="normal"><a href="#__codelineno-142-213">213</a></span>
<span class="normal"><a href="#__codelineno-142-214">214</a></span>
<span class="normal"><a href="#__codelineno-142-215">215</a></span>
<span class="normal"><a href="#__codelineno-142-216">216</a></span>
<span class="normal"><a href="#__codelineno-142-217">217</a></span>
<span class="normal"><a href="#__codelineno-142-218">218</a></span>
<span class="normal"><a href="#__codelineno-142-219">219</a></span>
<span class="normal"><a href="#__codelineno-142-220">220</a></span>
<span class="normal"><a href="#__codelineno-142-221">221</a></span>
<span class="normal"><a href="#__codelineno-142-222">222</a></span>
<span class="normal"><a href="#__codelineno-142-223">223</a></span>
<span class="normal"><a href="#__codelineno-142-224">224</a></span>
<span class="normal"><a href="#__codelineno-142-225">225</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-142-1"><a id="__codelineno-142-1" name="__codelineno-142-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-142-2"><a id="__codelineno-142-2" name="__codelineno-142-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id="__span-142-3"><a id="__codelineno-142-3" name="__codelineno-142-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-4"><a id="__codelineno-142-4" name="__codelineno-142-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-5"><a id="__codelineno-142-5" name="__codelineno-142-5"></a><span class="nn">---</span>
</span><span id="__span-142-6"><a id="__codelineno-142-6" name="__codelineno-142-6"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-142-7"><a id="__codelineno-142-7" name="__codelineno-142-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-142-8"><a id="__codelineno-142-8" name="__codelineno-142-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-9"><a id="__codelineno-142-9" name="__codelineno-142-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-pv-mysql</span>
</span><span id="__span-142-10"><a id="__codelineno-142-10" name="__codelineno-142-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-11"><a id="__codelineno-142-11" name="__codelineno-142-11"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-142-12"><a id="__codelineno-142-12" name="__codelineno-142-12"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-13"><a id="__codelineno-142-13" name="__codelineno-142-13"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-14"><a id="__codelineno-142-14" name="__codelineno-142-14"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-142-15"><a id="__codelineno-142-15" name="__codelineno-142-15"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-142-16"><a id="__codelineno-142-16" name="__codelineno-142-16"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
</span><span id="__span-142-17"><a id="__codelineno-142-17" name="__codelineno-142-17"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-142-18"><a id="__codelineno-142-18" name="__codelineno-142-18"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-142-19"><a id="__codelineno-142-19" name="__codelineno-142-19"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-142-20"><a id="__codelineno-142-20" name="__codelineno-142-20"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-142-21"><a id="__codelineno-142-21" name="__codelineno-142-21"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/firefly-iii/mysql</span>
</span><span id="__span-142-22"><a id="__codelineno-142-22" name="__codelineno-142-22"></a><span class="nn">---</span>
</span><span id="__span-142-23"><a id="__codelineno-142-23" name="__codelineno-142-23"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-142-24"><a id="__codelineno-142-24" name="__codelineno-142-24"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-142-25"><a id="__codelineno-142-25" name="__codelineno-142-25"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-26"><a id="__codelineno-142-26" name="__codelineno-142-26"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-pvc-mysql</span>
</span><span id="__span-142-27"><a id="__codelineno-142-27" name="__codelineno-142-27"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-28"><a id="__codelineno-142-28" name="__codelineno-142-28"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-142-29"><a id="__codelineno-142-29" name="__codelineno-142-29"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-30"><a id="__codelineno-142-30" name="__codelineno-142-30"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-31"><a id="__codelineno-142-31" name="__codelineno-142-31"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-142-32"><a id="__codelineno-142-32" name="__codelineno-142-32"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-pv-mysql</span>
</span><span id="__span-142-33"><a id="__codelineno-142-33" name="__codelineno-142-33"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-142-34"><a id="__codelineno-142-34" name="__codelineno-142-34"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-142-35"><a id="__codelineno-142-35" name="__codelineno-142-35"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-142-36"><a id="__codelineno-142-36" name="__codelineno-142-36"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-142-37"><a id="__codelineno-142-37" name="__codelineno-142-37"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-142-38"><a id="__codelineno-142-38" name="__codelineno-142-38"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
</span><span id="__span-142-39"><a id="__codelineno-142-39" name="__codelineno-142-39"></a><span class="nn">---</span>
</span><span id="__span-142-40"><a id="__codelineno-142-40" name="__codelineno-142-40"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-142-41"><a id="__codelineno-142-41" name="__codelineno-142-41"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-142-42"><a id="__codelineno-142-42" name="__codelineno-142-42"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-43"><a id="__codelineno-142-43" name="__codelineno-142-43"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-mysql</span>
</span><span id="__span-142-44"><a id="__codelineno-142-44" name="__codelineno-142-44"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-45"><a id="__codelineno-142-45" name="__codelineno-142-45"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-142-46"><a id="__codelineno-142-46" name="__codelineno-142-46"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-47"><a id="__codelineno-142-47" name="__codelineno-142-47"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-48"><a id="__codelineno-142-48" name="__codelineno-142-48"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-142-49"><a id="__codelineno-142-49" name="__codelineno-142-49"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-142-50"><a id="__codelineno-142-50" name="__codelineno-142-50"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-51"><a id="__codelineno-142-51" name="__codelineno-142-51"></a><span class="w">      </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
</span><span id="__span-142-52"><a id="__codelineno-142-52" name="__codelineno-142-52"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-142-53"><a id="__codelineno-142-53" name="__codelineno-142-53"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
</span><span id="__span-142-54"><a id="__codelineno-142-54" name="__codelineno-142-54"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-142-55"><a id="__codelineno-142-55" name="__codelineno-142-55"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-56"><a id="__codelineno-142-56" name="__codelineno-142-56"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-142-57"><a id="__codelineno-142-57" name="__codelineno-142-57"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-58"><a id="__codelineno-142-58" name="__codelineno-142-58"></a><span class="w">        </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
</span><span id="__span-142-59"><a id="__codelineno-142-59" name="__codelineno-142-59"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-60"><a id="__codelineno-142-60" name="__codelineno-142-60"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-142-61"><a id="__codelineno-142-61" name="__codelineno-142-61"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yobasystems/alpine-mariadb:latest</span>
</span><span id="__span-142-62"><a id="__codelineno-142-62" name="__codelineno-142-62"></a><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-142-63"><a id="__codelineno-142-63" name="__codelineno-142-63"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
</span><span id="__span-142-64"><a id="__codelineno-142-64" name="__codelineno-142-64"></a><span class="w">        </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-142-65"><a id="__codelineno-142-65" name="__codelineno-142-65"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MYSQL_ROOT_PASSWORD</span>
</span><span id="__span-142-66"><a id="__codelineno-142-66" name="__codelineno-142-66"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"**************************"</span>
</span><span id="__span-142-67"><a id="__codelineno-142-67" name="__codelineno-142-67"></a><span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-142-68"><a id="__codelineno-142-68" name="__codelineno-142-68"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
</span><span id="__span-142-69"><a id="__codelineno-142-69" name="__codelineno-142-69"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
</span><span id="__span-142-70"><a id="__codelineno-142-70" name="__codelineno-142-70"></a><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-142-71"><a id="__codelineno-142-71" name="__codelineno-142-71"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-persistent-storage</span>
</span><span id="__span-142-72"><a id="__codelineno-142-72" name="__codelineno-142-72"></a><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/mysql</span>
</span><span id="__span-142-73"><a id="__codelineno-142-73" name="__codelineno-142-73"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-142-74"><a id="__codelineno-142-74" name="__codelineno-142-74"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-persistent-storage</span>
</span><span id="__span-142-75"><a id="__codelineno-142-75" name="__codelineno-142-75"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-142-76"><a id="__codelineno-142-76" name="__codelineno-142-76"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-pvc-mysql</span>
</span><span id="__span-142-77"><a id="__codelineno-142-77" name="__codelineno-142-77"></a><span class="nn">---</span>
</span><span id="__span-142-78"><a id="__codelineno-142-78" name="__codelineno-142-78"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-142-79"><a id="__codelineno-142-79" name="__codelineno-142-79"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-142-80"><a id="__codelineno-142-80" name="__codelineno-142-80"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-81"><a id="__codelineno-142-81" name="__codelineno-142-81"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-mysql-svc</span>
</span><span id="__span-142-82"><a id="__codelineno-142-82" name="__codelineno-142-82"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-83"><a id="__codelineno-142-83" name="__codelineno-142-83"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-142-84"><a id="__codelineno-142-84" name="__codelineno-142-84"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-85"><a id="__codelineno-142-85" name="__codelineno-142-85"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-86"><a id="__codelineno-142-86" name="__codelineno-142-86"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</span><span id="__span-142-87"><a id="__codelineno-142-87" name="__codelineno-142-87"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-142-88"><a id="__codelineno-142-88" name="__codelineno-142-88"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
</span><span id="__span-142-89"><a id="__codelineno-142-89" name="__codelineno-142-89"></a><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30306</span>
</span><span id="__span-142-90"><a id="__codelineno-142-90" name="__codelineno-142-90"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3306</span>
</span><span id="__span-142-91"><a id="__codelineno-142-91" name="__codelineno-142-91"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-142-92"><a id="__codelineno-142-92" name="__codelineno-142-92"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-93"><a id="__codelineno-142-93" name="__codelineno-142-93"></a><span class="w">    </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
</span><span id="__span-142-94"><a id="__codelineno-142-94" name="__codelineno-142-94"></a><span class="nn">---</span>
</span><span id="__span-142-95"><a id="__codelineno-142-95" name="__codelineno-142-95"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-142-96"><a id="__codelineno-142-96" name="__codelineno-142-96"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-142-97"><a id="__codelineno-142-97" name="__codelineno-142-97"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-98"><a id="__codelineno-142-98" name="__codelineno-142-98"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-pv-upload</span>
</span><span id="__span-142-99"><a id="__codelineno-142-99" name="__codelineno-142-99"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-100"><a id="__codelineno-142-100" name="__codelineno-142-100"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-142-101"><a id="__codelineno-142-101" name="__codelineno-142-101"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-102"><a id="__codelineno-142-102" name="__codelineno-142-102"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-103"><a id="__codelineno-142-103" name="__codelineno-142-103"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-142-104"><a id="__codelineno-142-104" name="__codelineno-142-104"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-142-105"><a id="__codelineno-142-105" name="__codelineno-142-105"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
</span><span id="__span-142-106"><a id="__codelineno-142-106" name="__codelineno-142-106"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-142-107"><a id="__codelineno-142-107" name="__codelineno-142-107"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-142-108"><a id="__codelineno-142-108" name="__codelineno-142-108"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-142-109"><a id="__codelineno-142-109" name="__codelineno-142-109"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-142-110"><a id="__codelineno-142-110" name="__codelineno-142-110"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/firefly-iii/upload</span>
</span><span id="__span-142-111"><a id="__codelineno-142-111" name="__codelineno-142-111"></a><span class="nn">---</span>
</span><span id="__span-142-112"><a id="__codelineno-142-112" name="__codelineno-142-112"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-142-113"><a id="__codelineno-142-113" name="__codelineno-142-113"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-142-114"><a id="__codelineno-142-114" name="__codelineno-142-114"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-115"><a id="__codelineno-142-115" name="__codelineno-142-115"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-pvc-upload</span>
</span><span id="__span-142-116"><a id="__codelineno-142-116" name="__codelineno-142-116"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-117"><a id="__codelineno-142-117" name="__codelineno-142-117"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-142-118"><a id="__codelineno-142-118" name="__codelineno-142-118"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-119"><a id="__codelineno-142-119" name="__codelineno-142-119"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-120"><a id="__codelineno-142-120" name="__codelineno-142-120"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-142-121"><a id="__codelineno-142-121" name="__codelineno-142-121"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-pv-upload</span>
</span><span id="__span-142-122"><a id="__codelineno-142-122" name="__codelineno-142-122"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-142-123"><a id="__codelineno-142-123" name="__codelineno-142-123"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-142-124"><a id="__codelineno-142-124" name="__codelineno-142-124"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-142-125"><a id="__codelineno-142-125" name="__codelineno-142-125"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-142-126"><a id="__codelineno-142-126" name="__codelineno-142-126"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-142-127"><a id="__codelineno-142-127" name="__codelineno-142-127"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
</span><span id="__span-142-128"><a id="__codelineno-142-128" name="__codelineno-142-128"></a><span class="nn">---</span>
</span><span id="__span-142-129"><a id="__codelineno-142-129" name="__codelineno-142-129"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-142-130"><a id="__codelineno-142-130" name="__codelineno-142-130"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-142-131"><a id="__codelineno-142-131" name="__codelineno-142-131"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-132"><a id="__codelineno-142-132" name="__codelineno-142-132"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-svc</span>
</span><span id="__span-142-133"><a id="__codelineno-142-133" name="__codelineno-142-133"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-134"><a id="__codelineno-142-134" name="__codelineno-142-134"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-142-135"><a id="__codelineno-142-135" name="__codelineno-142-135"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-136"><a id="__codelineno-142-136" name="__codelineno-142-136"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-137"><a id="__codelineno-142-137" name="__codelineno-142-137"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</span><span id="__span-142-138"><a id="__codelineno-142-138" name="__codelineno-142-138"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-142-139"><a id="__codelineno-142-139" name="__codelineno-142-139"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-142-140"><a id="__codelineno-142-140" name="__codelineno-142-140"></a><span class="w">    </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30080</span>
</span><span id="__span-142-141"><a id="__codelineno-142-141" name="__codelineno-142-141"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-142-142"><a id="__codelineno-142-142" name="__codelineno-142-142"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-142-143"><a id="__codelineno-142-143" name="__codelineno-142-143"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-144"><a id="__codelineno-142-144" name="__codelineno-142-144"></a><span class="w">    </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-142-145"><a id="__codelineno-142-145" name="__codelineno-142-145"></a><span class="nn">---</span>
</span><span id="__span-142-146"><a id="__codelineno-142-146" name="__codelineno-142-146"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-142-147"><a id="__codelineno-142-147" name="__codelineno-142-147"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-142-148"><a id="__codelineno-142-148" name="__codelineno-142-148"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-149"><a id="__codelineno-142-149" name="__codelineno-142-149"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-150"><a id="__codelineno-142-150" name="__codelineno-142-150"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-151"><a id="__codelineno-142-151" name="__codelineno-142-151"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-142-152"><a id="__codelineno-142-152" name="__codelineno-142-152"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-153"><a id="__codelineno-142-153" name="__codelineno-142-153"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-154"><a id="__codelineno-142-154" name="__codelineno-142-154"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-142-155"><a id="__codelineno-142-155" name="__codelineno-142-155"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-142-156"><a id="__codelineno-142-156" name="__codelineno-142-156"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-157"><a id="__codelineno-142-157" name="__codelineno-142-157"></a><span class="w">      </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-142-158"><a id="__codelineno-142-158" name="__codelineno-142-158"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-142-159"><a id="__codelineno-142-159" name="__codelineno-142-159"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Recreate</span>
</span><span id="__span-142-160"><a id="__codelineno-142-160" name="__codelineno-142-160"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-142-161"><a id="__codelineno-142-161" name="__codelineno-142-161"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-162"><a id="__codelineno-142-162" name="__codelineno-142-162"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-142-163"><a id="__codelineno-142-163" name="__codelineno-142-163"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-164"><a id="__codelineno-142-164" name="__codelineno-142-164"></a><span class="w">        </span><span class="nt">tier</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-142-165"><a id="__codelineno-142-165" name="__codelineno-142-165"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-166"><a id="__codelineno-142-166" name="__codelineno-142-166"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-142-167"><a id="__codelineno-142-167" name="__codelineno-142-167"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">fireflyiii/core</span>
</span><span id="__span-142-168"><a id="__codelineno-142-168" name="__codelineno-142-168"></a><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-142-169"><a id="__codelineno-142-169" name="__codelineno-142-169"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-170"><a id="__codelineno-142-170" name="__codelineno-142-170"></a><span class="w">        </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-142-171"><a id="__codelineno-142-171" name="__codelineno-142-171"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_ENV</span>
</span><span id="__span-142-172"><a id="__codelineno-142-172" name="__codelineno-142-172"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"local"</span>
</span><span id="__span-142-173"><a id="__codelineno-142-173" name="__codelineno-142-173"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">APP_KEY</span>
</span><span id="__span-142-174"><a id="__codelineno-142-174" name="__codelineno-142-174"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"********************************"</span>
</span><span id="__span-142-175"><a id="__codelineno-142-175" name="__codelineno-142-175"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_HOST</span>
</span><span id="__span-142-176"><a id="__codelineno-142-176" name="__codelineno-142-176"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-mysql-svc</span>
</span><span id="__span-142-177"><a id="__codelineno-142-177" name="__codelineno-142-177"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_CONNECTION</span>
</span><span id="__span-142-178"><a id="__codelineno-142-178" name="__codelineno-142-178"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql</span>
</span><span id="__span-142-179"><a id="__codelineno-142-179" name="__codelineno-142-179"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_DATABASE</span>
</span><span id="__span-142-180"><a id="__codelineno-142-180" name="__codelineno-142-180"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"fireflyiii"</span>
</span><span id="__span-142-181"><a id="__codelineno-142-181" name="__codelineno-142-181"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_USERNAME</span>
</span><span id="__span-142-182"><a id="__codelineno-142-182" name="__codelineno-142-182"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"root"</span>
</span><span id="__span-142-183"><a id="__codelineno-142-183" name="__codelineno-142-183"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DB_PASSWORD</span>
</span><span id="__span-142-184"><a id="__codelineno-142-184" name="__codelineno-142-184"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"**************************"</span>
</span><span id="__span-142-185"><a id="__codelineno-142-185" name="__codelineno-142-185"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TRUSTED_PROXIES</span>
</span><span id="__span-142-186"><a id="__codelineno-142-186" name="__codelineno-142-186"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"**"</span>
</span><span id="__span-142-187"><a id="__codelineno-142-187" name="__codelineno-142-187"></a><span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-142-188"><a id="__codelineno-142-188" name="__codelineno-142-188"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-142-189"><a id="__codelineno-142-189" name="__codelineno-142-189"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-190"><a id="__codelineno-142-190" name="__codelineno-142-190"></a><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-142-191"><a id="__codelineno-142-191" name="__codelineno-142-191"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="s">"/var/www/html/storage/upload"</span>
</span><span id="__span-142-192"><a id="__codelineno-142-192" name="__codelineno-142-192"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-upload</span><span class="w"> </span>
</span><span id="__span-142-193"><a id="__codelineno-142-193" name="__codelineno-142-193"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-142-194"><a id="__codelineno-142-194" name="__codelineno-142-194"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-upload</span>
</span><span id="__span-142-195"><a id="__codelineno-142-195" name="__codelineno-142-195"></a><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-142-196"><a id="__codelineno-142-196" name="__codelineno-142-196"></a><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-pvc-upload</span>
</span><span id="__span-142-197"><a id="__codelineno-142-197" name="__codelineno-142-197"></a><span class="nn">---</span>
</span><span id="__span-142-198"><a id="__codelineno-142-198" name="__codelineno-142-198"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
</span><span id="__span-142-199"><a id="__codelineno-142-199" name="__codelineno-142-199"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-142-200"><a id="__codelineno-142-200" name="__codelineno-142-200"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-142-201"><a id="__codelineno-142-201" name="__codelineno-142-201"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-ingress</span>
</span><span id="__span-142-202"><a id="__codelineno-142-202" name="__codelineno-142-202"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii</span>
</span><span id="__span-142-203"><a id="__codelineno-142-203" name="__codelineno-142-203"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-142-204"><a id="__codelineno-142-204" name="__codelineno-142-204"></a><span class="w">    </span><span class="nt">acme.cert-manager.io/http01-edit-in-place</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-142-205"><a id="__codelineno-142-205" name="__codelineno-142-205"></a><span class="w">    </span><span class="nt">cert-manager.io/issue-temporary-certificate</span><span class="p">:</span><span class="w"> </span><span class="s">"true"</span>
</span><span id="__span-142-206"><a id="__codelineno-142-206" name="__codelineno-142-206"></a><span class="w">    </span><span class="nt">cert-manager.io/cluster-issuer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">letsencrypt-prod</span>
</span><span id="__span-142-207"><a id="__codelineno-142-207" name="__codelineno-142-207"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/websocket-services</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-svc</span>
</span><span id="__span-142-208"><a id="__codelineno-142-208" name="__codelineno-142-208"></a><span class="w">    </span><span class="nt">nginx.ingress.kubernetes.io/proxy-buffer-size</span><span class="p">:</span><span class="w"> </span><span class="s">"16k"</span>
</span><span id="__span-142-209"><a id="__codelineno-142-209" name="__codelineno-142-209"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-142-210"><a id="__codelineno-142-210" name="__codelineno-142-210"></a><span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-142-211"><a id="__codelineno-142-211" name="__codelineno-142-211"></a><span class="w">  </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-142-212"><a id="__codelineno-142-212" name="__codelineno-142-212"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii.very-very-dark-gray.top</span>
</span><span id="__span-142-213"><a id="__codelineno-142-213" name="__codelineno-142-213"></a><span class="w">    </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-142-214"><a id="__codelineno-142-214" name="__codelineno-142-214"></a><span class="w">      </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-142-215"><a id="__codelineno-142-215" name="__codelineno-142-215"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-142-216"><a id="__codelineno-142-216" name="__codelineno-142-216"></a><span class="w">        </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
</span><span id="__span-142-217"><a id="__codelineno-142-217" name="__codelineno-142-217"></a><span class="w">        </span><span class="nt">backend</span><span class="p">:</span>
</span><span id="__span-142-218"><a id="__codelineno-142-218" name="__codelineno-142-218"></a><span class="w">          </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-142-219"><a id="__codelineno-142-219" name="__codelineno-142-219"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii-svc</span>
</span><span id="__span-142-220"><a id="__codelineno-142-220" name="__codelineno-142-220"></a><span class="w">            </span><span class="nt">port</span><span class="p">:</span>
</span><span id="__span-142-221"><a id="__codelineno-142-221" name="__codelineno-142-221"></a><span class="w">              </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-142-222"><a id="__codelineno-142-222" name="__codelineno-142-222"></a><span class="w">  </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-142-223"><a id="__codelineno-142-223" name="__codelineno-142-223"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-secret</span>
</span><span id="__span-142-224"><a id="__codelineno-142-224" name="__codelineno-142-224"></a><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-142-225"><a id="__codelineno-142-225" name="__codelineno-142-225"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">firefly-iii.very-very-dark-gray.top</span>
</span></code></pre></div></td></tr></tbody></table></div>
</details>
<p>First, stop the service in <code>lexicon</code> (it won't be used moving forward):</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-143-1"><a id="__codelineno-143-1" name="__codelineno-143-1" href="#__codelineno-143-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>firefly-iii<span class="w"> </span>deployment<span class="w"> </span>firefly-iii<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-143-2"><a id="__codelineno-143-2" name="__codelineno-143-2" href="#__codelineno-143-2"></a><span class="go">deployment.apps/firefly-iii scaled</span>
</span><span id="__span-143-3"><a id="__codelineno-143-3" name="__codelineno-143-3" href="#__codelineno-143-3"></a>
</span><span id="__span-143-4"><a id="__codelineno-143-4" name="__codelineno-143-4" href="#__codelineno-143-4"></a><span class="gp">$ </span>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>firefly-iii<span class="w"> </span>deployment<span class="w"> </span>firefly-iii-mysql<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span><span id="__span-143-5"><a id="__codelineno-143-5" name="__codelineno-143-5" href="#__codelineno-143-5"></a><span class="go">deployment.apps/firefly-iii-mysql scaled</span>
</span></code></pre></div>
<p>Copy data over from <code>lexicon</code> to <code>octavo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-144-1"><a id="__codelineno-144-1" name="__codelineno-144-1" href="#__codelineno-144-1"></a><span class="gp">root@octavo ~ # </span>rsync<span class="w"> </span>-ua<span class="w"> </span>lexicon:/home/k8s/firefly-iii<span class="w"> </span>/home/k8s/
</span><span id="__span-144-2"><a id="__codelineno-144-2" name="__codelineno-144-2" href="#__codelineno-144-2"></a><span class="gp">root@octavo ~ # </span>ls<span class="w"> </span>-hal<span class="w"> </span>/home/k8s/firefly-iii
</span><span id="__span-144-3"><a id="__codelineno-144-3" name="__codelineno-144-3" href="#__codelineno-144-3"></a><span class="go">drwxr-xr-x 1 root     root      22 May 19  2024 .</span>
</span><span id="__span-144-4"><a id="__codelineno-144-4" name="__codelineno-144-4" href="#__codelineno-144-4"></a><span class="go">drwxr-xr-x 1 root     root     254 May  1 15:20 ..</span>
</span><span id="__span-144-5"><a id="__codelineno-144-5" name="__codelineno-144-5" href="#__codelineno-144-5"></a><span class="go">drwxr-xr-x 1 dhcpcd   lxd      566 May  1 15:32 mysql</span>
</span><span id="__span-144-6"><a id="__codelineno-144-6" name="__codelineno-144-6" href="#__codelineno-144-6"></a><span class="go">drwxrwxr-x 1 www-data www-data   0 May 19  2024 upload</span>
</span></code></pre></div>
<p>Start the deployment in <code>octavo</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-145-1"><a id="__codelineno-145-1" name="__codelineno-145-1" href="#__codelineno-145-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>firefly-iii.yaml<span class="w"> </span>
</span><span id="__span-145-2"><a id="__codelineno-145-2" name="__codelineno-145-2" href="#__codelineno-145-2"></a><span class="go">namespace/firefly-iii created</span>
</span><span id="__span-145-3"><a id="__codelineno-145-3" name="__codelineno-145-3" href="#__codelineno-145-3"></a><span class="go">persistentvolume/firefly-iii-pv-mysql created</span>
</span><span id="__span-145-4"><a id="__codelineno-145-4" name="__codelineno-145-4" href="#__codelineno-145-4"></a><span class="go">persistentvolumeclaim/firefly-iii-pvc-mysql created</span>
</span><span id="__span-145-5"><a id="__codelineno-145-5" name="__codelineno-145-5" href="#__codelineno-145-5"></a><span class="go">service/firefly-iii-mysql-svc created</span>
</span><span id="__span-145-6"><a id="__codelineno-145-6" name="__codelineno-145-6" href="#__codelineno-145-6"></a><span class="go">persistentvolume/firefly-iii-pv-upload created</span>
</span><span id="__span-145-7"><a id="__codelineno-145-7" name="__codelineno-145-7" href="#__codelineno-145-7"></a><span class="go">persistentvolumeclaim/firefly-iii-pvc-upload created</span>
</span><span id="__span-145-8"><a id="__codelineno-145-8" name="__codelineno-145-8" href="#__codelineno-145-8"></a><span class="go">service/firefly-iii-svc created</span>
</span><span id="__span-145-9"><a id="__codelineno-145-9" name="__codelineno-145-9" href="#__codelineno-145-9"></a><span class="go">ingress.networking.k8s.io/firefly-iii-ingress created</span>
</span><span id="__span-145-10"><a id="__codelineno-145-10" name="__codelineno-145-10" href="#__codelineno-145-10"></a><span class="go">deployment.apps/firefly-iii created</span>
</span><span id="__span-145-11"><a id="__codelineno-145-11" name="__codelineno-145-11" href="#__codelineno-145-11"></a><span class="go">ingress.networking.k8s.io/firefly-iii-ingress configured</span>
</span><span id="__span-145-12"><a id="__codelineno-145-12" name="__codelineno-145-12" href="#__codelineno-145-12"></a>
</span><span id="__span-145-13"><a id="__codelineno-145-13" name="__codelineno-145-13" href="#__codelineno-145-13"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>firefly-iii
</span><span id="__span-145-14"><a id="__codelineno-145-14" name="__codelineno-145-14" href="#__codelineno-145-14"></a><span class="go">NAME                                     READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-145-15"><a id="__codelineno-145-15" name="__codelineno-145-15" href="#__codelineno-145-15"></a><span class="go">pod/cm-acme-http-solver-rhfrm            1/1     Running   0          15s</span>
</span><span id="__span-145-16"><a id="__codelineno-145-16" name="__codelineno-145-16" href="#__codelineno-145-16"></a><span class="go">pod/firefly-iii-7c6f8597c9-j7nlf         1/1     Running   0          3m27s</span>
</span><span id="__span-145-17"><a id="__codelineno-145-17" name="__codelineno-145-17" href="#__codelineno-145-17"></a><span class="go">pod/firefly-iii-mysql-859cd77d57-85pjp   1/1     Running   0          4m1s</span>
</span><span id="__span-145-18"><a id="__codelineno-145-18" name="__codelineno-145-18" href="#__codelineno-145-18"></a>
</span><span id="__span-145-19"><a id="__codelineno-145-19" name="__codelineno-145-19" href="#__codelineno-145-19"></a><span class="go">NAME                                TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span>
</span><span id="__span-145-20"><a id="__codelineno-145-20" name="__codelineno-145-20" href="#__codelineno-145-20"></a><span class="go">service/cm-acme-http-solver-4dln6   NodePort   10.99.155.239    &lt;none&gt;        8089:32080/TCP   15s</span>
</span><span id="__span-145-21"><a id="__codelineno-145-21" name="__codelineno-145-21" href="#__codelineno-145-21"></a><span class="go">service/firefly-iii-mysql-svc       NodePort   10.105.106.204   &lt;none&gt;        3306:30306/TCP   10m</span>
</span><span id="__span-145-22"><a id="__codelineno-145-22" name="__codelineno-145-22" href="#__codelineno-145-22"></a><span class="go">service/firefly-iii-svc             NodePort   10.98.129.183    &lt;none&gt;        8080:30080/TCP   10m</span>
</span><span id="__span-145-23"><a id="__codelineno-145-23" name="__codelineno-145-23" href="#__codelineno-145-23"></a>
</span><span id="__span-145-24"><a id="__codelineno-145-24" name="__codelineno-145-24" href="#__codelineno-145-24"></a><span class="go">NAME                                READY   UP-TO-DATE   AVAILABLE   AGE</span>
</span><span id="__span-145-25"><a id="__codelineno-145-25" name="__codelineno-145-25" href="#__codelineno-145-25"></a><span class="go">deployment.apps/firefly-iii         1/1     1            1           9m57s</span>
</span><span id="__span-145-26"><a id="__codelineno-145-26" name="__codelineno-145-26" href="#__codelineno-145-26"></a><span class="go">deployment.apps/firefly-iii-mysql   1/1     1            1           9m57s</span>
</span><span id="__span-145-27"><a id="__codelineno-145-27" name="__codelineno-145-27" href="#__codelineno-145-27"></a>
</span><span id="__span-145-28"><a id="__codelineno-145-28" name="__codelineno-145-28" href="#__codelineno-145-28"></a><span class="go">NAME                                           DESIRED   CURRENT   READY   AGE</span>
</span><span id="__span-145-29"><a id="__codelineno-145-29" name="__codelineno-145-29" href="#__codelineno-145-29"></a><span class="go">replicaset.apps/firefly-iii-7c6f8597c9         1         1         1       4m22s</span>
</span><span id="__span-145-30"><a id="__codelineno-145-30" name="__codelineno-145-30" href="#__codelineno-145-30"></a><span class="go">replicaset.apps/firefly-iii-mysql-859cd77d57   1         1         1       4m23s</span>
</span><span id="__span-145-31"><a id="__codelineno-145-31" name="__codelineno-145-31" href="#__codelineno-145-31"></a>
</span><span id="__span-145-32"><a id="__codelineno-145-32" name="__codelineno-145-32" href="#__codelineno-145-32"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>firefly-iii
</span><span id="__span-145-33"><a id="__codelineno-145-33" name="__codelineno-145-33" href="#__codelineno-145-33"></a><span class="go">NAME                        TYPE       CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE</span>
</span><span id="__span-145-34"><a id="__codelineno-145-34" name="__codelineno-145-34" href="#__codelineno-145-34"></a><span class="go">cm-acme-http-solver-hgc27   NodePort   10.110.227.244   &lt;none&gt;        8089:32080/TCP   72s</span>
</span><span id="__span-145-35"><a id="__codelineno-145-35" name="__codelineno-145-35" href="#__codelineno-145-35"></a><span class="go">firefly-iii-mysql-svc       NodePort   10.105.106.204   &lt;none&gt;        3306:30306/TCP   76s</span>
</span><span id="__span-145-36"><a id="__codelineno-145-36" name="__codelineno-145-36" href="#__codelineno-145-36"></a><span class="go">firefly-iii-svc             NodePort   10.98.129.183    &lt;none&gt;        8080:30080/TCP   76s</span>
</span><span id="__span-145-37"><a id="__codelineno-145-37" name="__codelineno-145-37" href="#__codelineno-145-37"></a>
</span><span id="__span-145-38"><a id="__codelineno-145-38" name="__codelineno-145-38" href="#__codelineno-145-38"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ingress<span class="w"> </span>-n<span class="w"> </span>firefly-iii
</span><span id="__span-145-39"><a id="__codelineno-145-39" name="__codelineno-145-39" href="#__codelineno-145-39"></a><span class="go">NAME                  CLASS   HOSTS                                 ADDRESS         PORTS     AGE</span>
</span><span id="__span-145-40"><a id="__codelineno-145-40" name="__codelineno-145-40" href="#__codelineno-145-40"></a>
</span><span id="__span-145-41"><a id="__codelineno-145-41" name="__codelineno-145-41" href="#__codelineno-145-41"></a><span class="go">firefly-iii-ingress   nginx   firefly-iii.very-very-dark-gray.top   192.168.0.171   80, 443   79s</span>
</span></code></pre></div>
<p>After a couple of minutes Firefly III is available at
<a href="https://firefly-iii.very-very-dark-gray.top/">https://firefly-iii.very-very-dark-gray.top/</a> and ready to use with the migrated
database and everything else.</p>
<h2 id="new-services-post-migration">New services (post migration)</h2>
<p>After all the above migrations, new services have been added to <code>octavo</code> that were not
previously available in <code>lexicon</code>:</p>
<ul>
<li><a href="../../29/jellyfin-on-kubernetes-with-intel-gpu/">Jellyfin</a> to watch videos
    from anywhere, including hardware acceleration for transcoding AV1 videos using 
    the onboard Intel GPU Irix Xe Graphics.</li>
<li><a href="../../../../2024/12/31/migrating-unifi-controller-to-kubernetes/">Unifi Network Application</a>
    was never actually used in <code>lexicon</code>, so instead of migrating an
    empty deployment this was deployed anew in <code>octavo</code> using a slightly updated
    manifest to set newer versions of both images and updated UID/GID (119).</li>
</ul>
<h2 id="migration-to-new-isp">Migration to new ISP</h2>
<p>Replacing the router with a UniFi Gateway Fiber (UXG-FIBER) required
first adopting the router, by connecting it to the LAN on both sides:</p>
<ul>
<li>Ethernet uplink port to get an IP on the current LAN to communicate
  both with the Internet (old router) and LAN (to the UniFi Network app).
  The IP range on the LAN is 192.168.<strong>0</strong>.0/24 as set by the old router,
  this being its default settings.</li>
<li>Ethernet downlink port sets its own static IP range, seemingly choosing
  the 192.168.<strong>1</strong>.0/24 range automatically, it being the next available
  <code>/24</code> network available.</li>
</ul>
<h3 id="take-1-unifi-network-application-on-new-lan">Take 1: Unifi Network Application on new LAN</h3>
<p>The <a href="../../../../2024/12/31/migrating-unifi-controller-to-kubernetes/">Unifi Network Application</a>
being only available on the <strong>0</strong>.0/24 network, it would not be reachable by
the router once the old router is disconnected from the LAN. To make the
Unifi Network Application reachable on the new router's LAN side, it needs
an IP address on the <strong>1</strong>.0/24 network, </p>
<p>Kubernetes services can be exposed on a new LAN by adding a suitable range
to the pool of IP addresses for <a href="#metallb-load-balancer">MetalLB Load Balancer</a>
and adding a new <code>Service</code> using one of those IP addresses:</p>
<div class="language-yaml highlight"><span class="filename">metallb/ipaddress-pool-octavo.yaml</span><pre><span></span><code><span id="__span-146-1"><a id="__codelineno-146-1" name="__codelineno-146-1" href="#__codelineno-146-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb.io/v1beta1</span>
</span><span id="__span-146-2"><a id="__codelineno-146-2" name="__codelineno-146-2" href="#__codelineno-146-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IPAddressPool</span>
</span><span id="__span-146-3"><a id="__codelineno-146-3" name="__codelineno-146-3" href="#__codelineno-146-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-146-4"><a id="__codelineno-146-4" name="__codelineno-146-4" href="#__codelineno-146-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-146-5"><a id="__codelineno-146-5" name="__codelineno-146-5" href="#__codelineno-146-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb-system</span>
</span><span id="__span-146-6"><a id="__codelineno-146-6" name="__codelineno-146-6" href="#__codelineno-146-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-146-7"><a id="__codelineno-146-7" name="__codelineno-146-7" href="#__codelineno-146-7"></a><span class="w">  </span><span class="nt">addresses</span><span class="p">:</span>
</span><span id="__span-146-8"><a id="__codelineno-146-8" name="__codelineno-146-8" href="#__codelineno-146-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.171-192.168.0.180</span>
</span><span id="__span-146-9"><a id="__codelineno-146-9" name="__codelineno-146-9" href="#__codelineno-146-9"></a><span class="hll"><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.171-192.168.1.220</span>
</span></span><span id="__span-146-10"><a id="__codelineno-146-10" name="__codelineno-146-10" href="#__codelineno-146-10"></a><span class="nn">---</span>
</span><span id="__span-146-11"><a id="__codelineno-146-11" name="__codelineno-146-11" href="#__codelineno-146-11"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb.io/v1beta1</span>
</span><span id="__span-146-12"><a id="__codelineno-146-12" name="__codelineno-146-12" href="#__codelineno-146-12"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">L2Advertisement</span>
</span><span id="__span-146-13"><a id="__codelineno-146-13" name="__codelineno-146-13" href="#__codelineno-146-13"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-146-14"><a id="__codelineno-146-14" name="__codelineno-146-14" href="#__codelineno-146-14"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">l2-advert</span>
</span><span id="__span-146-15"><a id="__codelineno-146-15" name="__codelineno-146-15" href="#__codelineno-146-15"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb-system</span>
</span></code></pre></div>
<div class="language-console highlight"><pre><span></span><code><span id="__span-147-1"><a id="__codelineno-147-1" name="__codelineno-147-1" href="#__codelineno-147-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>metallb/ipaddress-pool-octavo.yaml
</span><span id="__span-147-2"><a id="__codelineno-147-2" name="__codelineno-147-2" href="#__codelineno-147-2"></a><span class="go">ipaddresspool.metallb.io/production configured</span>
</span><span id="__span-147-3"><a id="__codelineno-147-3" name="__codelineno-147-3" href="#__codelineno-147-3"></a><span class="go">l2advertisement.metallb.io/l2-advert unchanged</span>
</span><span id="__span-147-4"><a id="__codelineno-147-4" name="__codelineno-147-4" href="#__codelineno-147-4"></a>
</span><span id="__span-147-5"><a id="__codelineno-147-5" name="__codelineno-147-5" href="#__codelineno-147-5"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ipaddresspool.metallb.io<span class="w"> </span>-n<span class="w"> </span>metallb-system
</span><span id="__span-147-6"><a id="__codelineno-147-6" name="__codelineno-147-6" href="#__codelineno-147-6"></a><span class="go">NAME         AUTO ASSIGN   AVOID BUGGY IPS   ADDRESSES</span>
</span><span id="__span-147-7"><a id="__codelineno-147-7" name="__codelineno-147-7" href="#__codelineno-147-7"></a><span class="go">production   true          false             ["192.168.0.171-192.168.0.180","192.168.1.201-192.168.1.220"]</span>
</span></code></pre></div>
<div class="language-yaml highlight"><table class="highlighttable"><tbody><tr><th colspan="2" class="filename"><span class="filename">unifi-network-app.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-148-237">237</a></span>
<span class="normal"><a href="#__codelineno-148-238">238</a></span>
<span class="normal"><a href="#__codelineno-148-239">239</a></span>
<span class="normal"><a href="#__codelineno-148-240">240</a></span>
<span class="normal"><a href="#__codelineno-148-241">241</a></span>
<span class="normal"><a href="#__codelineno-148-242">242</a></span>
<span class="normal"><a href="#__codelineno-148-243">243</a></span>
<span class="normal"><a href="#__codelineno-148-244">244</a></span>
<span class="normal"><a href="#__codelineno-148-245">245</a></span>
<span class="normal"><a href="#__codelineno-148-246">246</a></span>
<span class="normal"><a href="#__codelineno-148-247">247</a></span>
<span class="normal"><a href="#__codelineno-148-248">248</a></span>
<span class="normal"><a href="#__codelineno-148-249">249</a></span>
<span class="normal"><a href="#__codelineno-148-250">250</a></span>
<span class="normal"><a href="#__codelineno-148-251">251</a></span>
<span class="normal"><a href="#__codelineno-148-252">252</a></span>
<span class="normal"><a href="#__codelineno-148-253">253</a></span>
<span class="normal"><a href="#__codelineno-148-254">254</a></span>
<span class="normal"><a href="#__codelineno-148-255">255</a></span>
<span class="normal"><a href="#__codelineno-148-256">256</a></span>
<span class="normal"><a href="#__codelineno-148-257">257</a></span>
<span class="normal"><a href="#__codelineno-148-258">258</a></span>
<span class="normal"><a href="#__codelineno-148-259">259</a></span>
<span class="normal"><a href="#__codelineno-148-260">260</a></span>
<span class="normal"><a href="#__codelineno-148-261">261</a></span>
<span class="normal"><a href="#__codelineno-148-262">262</a></span>
<span class="normal"><a href="#__codelineno-148-263">263</a></span>
<span class="normal"><a href="#__codelineno-148-264">264</a></span>
<span class="normal"><a href="#__codelineno-148-265">265</a></span>
<span class="normal"><a href="#__codelineno-148-266">266</a></span>
<span class="normal"><a href="#__codelineno-148-267">267</a></span>
<span class="normal"><a href="#__codelineno-148-268">268</a></span>
<span class="normal"><a href="#__codelineno-148-269">269</a></span>
<span class="normal"><a href="#__codelineno-148-270">270</a></span>
<span class="normal"><a href="#__codelineno-148-271">271</a></span>
<span class="normal"><a href="#__codelineno-148-272">272</a></span>
<span class="normal"><a href="#__codelineno-148-273">273</a></span>
<span class="normal"><a href="#__codelineno-148-274">274</a></span>
<span class="normal"><a href="#__codelineno-148-275">275</a></span>
<span class="normal"><a href="#__codelineno-148-276">276</a></span>
<span class="normal"><a href="#__codelineno-148-277">277</a></span>
<span class="normal"><a href="#__codelineno-148-278">278</a></span>
<span class="normal"><a href="#__codelineno-148-279">279</a></span>
<span class="normal"><a href="#__codelineno-148-280">280</a></span>
<span class="normal"><a href="#__codelineno-148-281">281</a></span>
<span class="normal"><a href="#__codelineno-148-282">282</a></span>
<span class="normal"><a href="#__codelineno-148-283">283</a></span>
<span class="normal"><a href="#__codelineno-148-284">284</a></span>
<span class="normal"><a href="#__codelineno-148-285">285</a></span>
<span class="normal"><a href="#__codelineno-148-286">286</a></span>
<span class="normal"><a href="#__codelineno-148-287">287</a></span>
<span class="normal"><a href="#__codelineno-148-288">288</a></span>
<span class="normal"><a href="#__codelineno-148-289">289</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-148-237"><a id="__codelineno-148-237" name="__codelineno-148-237"></a><span class="nn">---</span>
</span><span id="__span-148-238"><a id="__codelineno-148-238" name="__codelineno-148-238"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-148-239"><a id="__codelineno-148-239" name="__codelineno-148-239"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-148-240"><a id="__codelineno-148-240" name="__codelineno-148-240"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-148-241"><a id="__codelineno-148-241" name="__codelineno-148-241"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unifi-tcp</span>
</span><span id="__span-148-242"><a id="__codelineno-148-242" name="__codelineno-148-242"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unifi</span>
</span><span id="__span-148-243"><a id="__codelineno-148-243" name="__codelineno-148-243"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-148-244"><a id="__codelineno-148-244" name="__codelineno-148-244"></a><span class="w">    </span><span class="nt">metallb.universe.tf/allow-shared-ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unifi</span>
</span><span id="__span-148-245"><a id="__codelineno-148-245" name="__codelineno-148-245"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-148-246"><a id="__codelineno-148-246" name="__codelineno-148-246"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span><span id="__span-148-247"><a id="__codelineno-148-247" name="__codelineno-148-247"></a><span class="w">  </span><span class="nt">loadBalancerIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.173</span>
</span><span id="__span-148-248"><a id="__codelineno-148-248" name="__codelineno-148-248"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-148-249"><a id="__codelineno-148-249" name="__codelineno-148-249"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mob-speedtest</span>
</span><span id="__span-148-250"><a id="__codelineno-148-250" name="__codelineno-148-250"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-148-251"><a id="__codelineno-148-251" name="__codelineno-148-251"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6789</span>
</span><span id="__span-148-252"><a id="__codelineno-148-252" name="__codelineno-148-252"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6789</span>
</span><span id="__span-148-253"><a id="__codelineno-148-253" name="__codelineno-148-253"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">device-inform</span>
</span><span id="__span-148-254"><a id="__codelineno-148-254" name="__codelineno-148-254"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-148-255"><a id="__codelineno-148-255" name="__codelineno-148-255"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-148-256"><a id="__codelineno-148-256" name="__codelineno-148-256"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-148-257"><a id="__codelineno-148-257" name="__codelineno-148-257"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-ui</span>
</span><span id="__span-148-258"><a id="__codelineno-148-258" name="__codelineno-148-258"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-148-259"><a id="__codelineno-148-259" name="__codelineno-148-259"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
</span><span id="__span-148-260"><a id="__codelineno-148-260" name="__codelineno-148-260"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
</span><span id="__span-148-261"><a id="__codelineno-148-261" name="__codelineno-148-261"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-148-262"><a id="__codelineno-148-262" name="__codelineno-148-262"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unifi</span>
</span><span id="__span-148-263"><a id="__codelineno-148-263" name="__codelineno-148-263"></a><span class="nn">---</span>
</span><span id="__span-148-264"><a id="__codelineno-148-264" name="__codelineno-148-264"></a><span class="hll"><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span></span><span id="__span-148-265"><a id="__codelineno-148-265" name="__codelineno-148-265"></a><span class="hll"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span></span><span id="__span-148-266"><a id="__codelineno-148-266" name="__codelineno-148-266"></a><span class="hll"><span class="nt">metadata</span><span class="p">:</span>
</span></span><span id="__span-148-267"><a id="__codelineno-148-267" name="__codelineno-148-267"></a><span class="hll"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unifi-tcp-1</span>
</span></span><span id="__span-148-268"><a id="__codelineno-148-268" name="__codelineno-148-268"></a><span class="hll"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unifi</span>
</span></span><span id="__span-148-269"><a id="__codelineno-148-269" name="__codelineno-148-269"></a><span class="hll"><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span></span><span id="__span-148-270"><a id="__codelineno-148-270" name="__codelineno-148-270"></a><span class="hll"><span class="w">    </span><span class="nt">metallb.universe.tf/allow-shared-ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unifi</span>
</span></span><span id="__span-148-271"><a id="__codelineno-148-271" name="__codelineno-148-271"></a><span class="hll"><span class="nt">spec</span><span class="p">:</span>
</span></span><span id="__span-148-272"><a id="__codelineno-148-272" name="__codelineno-148-272"></a><span class="hll"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span></span><span id="__span-148-273"><a id="__codelineno-148-273" name="__codelineno-148-273"></a><span class="hll"><span class="w">  </span><span class="nt">loadBalancerIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.1.220</span>
</span></span><span id="__span-148-274"><a id="__codelineno-148-274" name="__codelineno-148-274"></a><span class="hll"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span></span><span id="__span-148-275"><a id="__codelineno-148-275" name="__codelineno-148-275"></a><span class="hll"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mob-speedtest</span>
</span></span><span id="__span-148-276"><a id="__codelineno-148-276" name="__codelineno-148-276"></a><span class="hll"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span></span><span id="__span-148-277"><a id="__codelineno-148-277" name="__codelineno-148-277"></a><span class="hll"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6789</span>
</span></span><span id="__span-148-278"><a id="__codelineno-148-278" name="__codelineno-148-278"></a><span class="hll"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6789</span>
</span></span><span id="__span-148-279"><a id="__codelineno-148-279" name="__codelineno-148-279"></a><span class="hll"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">device-inform</span>
</span></span><span id="__span-148-280"><a id="__codelineno-148-280" name="__codelineno-148-280"></a><span class="hll"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span></span><span id="__span-148-281"><a id="__codelineno-148-281" name="__codelineno-148-281"></a><span class="hll"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span></span><span id="__span-148-282"><a id="__codelineno-148-282" name="__codelineno-148-282"></a><span class="hll"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span></span><span id="__span-148-283"><a id="__codelineno-148-283" name="__codelineno-148-283"></a><span class="hll"><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">web-ui</span>
</span></span><span id="__span-148-284"><a id="__codelineno-148-284" name="__codelineno-148-284"></a><span class="hll"><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span></span><span id="__span-148-285"><a id="__codelineno-148-285" name="__codelineno-148-285"></a><span class="hll"><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
</span></span><span id="__span-148-286"><a id="__codelineno-148-286" name="__codelineno-148-286"></a><span class="hll"><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
</span></span><span id="__span-148-287"><a id="__codelineno-148-287" name="__codelineno-148-287"></a><span class="hll"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span></span><span id="__span-148-288"><a id="__codelineno-148-288" name="__codelineno-148-288"></a><span class="hll"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unifi</span>
</span></span><span id="__span-148-289"><a id="__codelineno-148-289" name="__codelineno-148-289"></a><span class="nn">---</span>
</span></code></pre></div></td></tr></tbody></table></div>
<div class="language-console highlight"><pre><span></span><code><span id="__span-149-1"><a id="__codelineno-149-1" name="__codelineno-149-1" href="#__codelineno-149-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>unifi-network-app.yaml
</span><span id="__span-149-2"><a id="__codelineno-149-2" name="__codelineno-149-2" href="#__codelineno-149-2"></a><span class="go">namespace/unifi unchanged</span>
</span><span id="__span-149-3"><a id="__codelineno-149-3" name="__codelineno-149-3" href="#__codelineno-149-3"></a><span class="go">persistentvolume/mongo-pv-data unchanged</span>
</span><span id="__span-149-4"><a id="__codelineno-149-4" name="__codelineno-149-4" href="#__codelineno-149-4"></a><span class="go">persistentvolume/mongo-pv-init unchanged</span>
</span><span id="__span-149-5"><a id="__codelineno-149-5" name="__codelineno-149-5" href="#__codelineno-149-5"></a><span class="go">persistentvolumeclaim/mongo-pvc-data unchanged</span>
</span><span id="__span-149-6"><a id="__codelineno-149-6" name="__codelineno-149-6" href="#__codelineno-149-6"></a><span class="go">persistentvolumeclaim/mongo-pvc-init unchanged</span>
</span><span id="__span-149-7"><a id="__codelineno-149-7" name="__codelineno-149-7" href="#__codelineno-149-7"></a><span class="go">deployment.apps/mongo unchanged</span>
</span><span id="__span-149-8"><a id="__codelineno-149-8" name="__codelineno-149-8" href="#__codelineno-149-8"></a><span class="go">service/mongo-svc unchanged</span>
</span><span id="__span-149-9"><a id="__codelineno-149-9" name="__codelineno-149-9" href="#__codelineno-149-9"></a><span class="go">persistentvolume/unifi-pv-config unchanged</span>
</span><span id="__span-149-10"><a id="__codelineno-149-10" name="__codelineno-149-10" href="#__codelineno-149-10"></a><span class="go">persistentvolumeclaim/unifi-pvc-config unchanged</span>
</span><span id="__span-149-11"><a id="__codelineno-149-11" name="__codelineno-149-11" href="#__codelineno-149-11"></a><span class="go">deployment.apps/unifi unchanged</span>
</span><span id="__span-149-12"><a id="__codelineno-149-12" name="__codelineno-149-12" href="#__codelineno-149-12"></a><span class="go">service/unifi-tcp unchanged</span>
</span><span id="__span-149-13"><a id="__codelineno-149-13" name="__codelineno-149-13" href="#__codelineno-149-13"></a><span class="hll"><span class="go">service/unifi-tcp-1 created</span>
</span></span><span id="__span-149-14"><a id="__codelineno-149-14" name="__codelineno-149-14" href="#__codelineno-149-14"></a><span class="go">service/unifi-udp unchanged</span>
</span><span id="__span-149-15"><a id="__codelineno-149-15" name="__codelineno-149-15" href="#__codelineno-149-15"></a><span class="go">ingress.networking.k8s.io/unifi-ingress unchanged</span>
</span><span id="__span-149-16"><a id="__codelineno-149-16" name="__codelineno-149-16" href="#__codelineno-149-16"></a>
</span><span id="__span-149-17"><a id="__codelineno-149-17" name="__codelineno-149-17" href="#__codelineno-149-17"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>-A<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s1">'192.168.'</span>
</span><span id="__span-149-18"><a id="__codelineno-149-18" name="__codelineno-149-18" href="#__codelineno-149-18"></a><span class="go">ingress-nginx              ingress-nginx-controller                                LoadBalancer   10.99.252.250    192.168.0.171   80:30278/TCP,443:30974/TCP                      150d</span>
</span><span id="__span-149-19"><a id="__codelineno-149-19" name="__codelineno-149-19" href="#__codelineno-149-19"></a><span class="go">unifi                      unifi-tcp                                               LoadBalancer   10.105.232.48    192.168.0.173   6789:31231/TCP,8080:32034/TCP,8443:30909/TCP    145d</span>
</span><span id="__span-149-20"><a id="__codelineno-149-20" name="__codelineno-149-20" href="#__codelineno-149-20"></a><span class="hll"><span class="go">unifi                      unifi-tcp-1                                             LoadBalancer   10.109.194.34    192.168.1.220   6789:30860/TCP,8080:31627/TCP,8443:30889/TCP    6d1h</span>
</span></span><span id="__span-149-21"><a id="__codelineno-149-21" name="__codelineno-149-21" href="#__codelineno-149-21"></a><span class="go">unifi                      unifi-udp                                               LoadBalancer   10.108.54.45     192.168.0.173   3478:31805/UDP,10001:32694/UDP,1900:30234/UDP   145d</span>
</span></code></pre></div>
<h3 id="take-2-old-router-on-new-lan">Take 2: Old router on new LAN</h3>
<p>Turns out the UniFi router, once adopted, would never reporr to the
Unifi Network Application on 192.168.<strong>1.220</strong>, even though the application
is available on https://192.168.1.220:8443 just as well as on
https://192.168.0.173:8443 because, unlike access points, the router has no
usable SSH connection to <code>set-inform https://192.168.0.220:8080</code>.</p>
<p>Eventually the solution was to set the old router to be leasing addresses
(as DHCP server) on the <strong>1</strong>.0/24 network, which let the UniFi router to
re-configure its LAN ports to adopt the <strong>0</strong>.0/24 network. After <em>this</em>
change, the router was able again to reach the Unifi Network Application
on 192.168.<strong>0.173</strong> and <em>everything was well once again</em>.</p>
<h2 id="bridging-wireless">Bridging wireless</h2>
<p>This new server has a Wi-Fi 6E interface that is not needed, but can be used to improve
the Wi-Fi coverage in the room it occupies. In this environment the Wireless network in
is provided by a number of UniFi access points, none of which offer good coverage in
the room where the NUC is.</p>
<p>To provide bridged access point using the server's Wi-Fi interface, create a software
bridge (<code>br0</code>) that unite the Ethernet and Wi-Fi interfaces into a single Layer 2
network, allowing the NUC to extend the existing UniFi network.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>Most Intel wireless chips (using the <code>iwlWi-Fi</code> driver) support AP mode. To check against
this limitation, run <code>iw list</code> and confirm <code>Supported interface modes</code> includes <code>AP</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-150-1"><a id="__codelineno-150-1" name="__codelineno-150-1" href="#__codelineno-150-1"></a><span class="gp"># </span>iw<span class="w"> </span>list
</span><span id="__span-150-2"><a id="__codelineno-150-2" name="__codelineno-150-2" href="#__codelineno-150-2"></a><span class="go">Wiphy phy0</span>
</span><span id="__span-150-3"><a id="__codelineno-150-3" name="__codelineno-150-3" href="#__codelineno-150-3"></a><span class="go">        ...</span>
</span><span id="__span-150-4"><a id="__codelineno-150-4" name="__codelineno-150-4" href="#__codelineno-150-4"></a><span class="go">        Supported interface modes:</span>
</span><span id="__span-150-5"><a id="__codelineno-150-5" name="__codelineno-150-5" href="#__codelineno-150-5"></a><span class="go">                 * IBSS</span>
</span><span id="__span-150-6"><a id="__codelineno-150-6" name="__codelineno-150-6" href="#__codelineno-150-6"></a><span class="go">                 * managed</span>
</span><span id="__span-150-7"><a id="__codelineno-150-7" name="__codelineno-150-7" href="#__codelineno-150-7"></a><span class="go">                 * AP</span>
</span><span id="__span-150-8"><a id="__codelineno-150-8" name="__codelineno-150-8" href="#__codelineno-150-8"></a><span class="go">                 * AP/VLAN</span>
</span><span id="__span-150-9"><a id="__codelineno-150-9" name="__codelineno-150-9" href="#__codelineno-150-9"></a><span class="go">                 * monitor</span>
</span><span id="__span-150-10"><a id="__codelineno-150-10" name="__codelineno-150-10" href="#__codelineno-150-10"></a><span class="go">                 * P2P-client</span>
</span><span id="__span-150-11"><a id="__codelineno-150-11" name="__codelineno-150-11" href="#__codelineno-150-11"></a><span class="go">                 * P2P-GO</span>
</span><span id="__span-150-12"><a id="__codelineno-150-12" name="__codelineno-150-12" href="#__codelineno-150-12"></a><span class="go">                 * P2P-device</span>
</span></code></pre></div>
<p>Install <code>hostapd</code> for the access point and <code>bridge-utils</code> for bridging support:</p>
<details class="terminal">
<summary><code># apt install hostapd bridge-utils</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-151-1"><a id="__codelineno-151-1" name="__codelineno-151-1" href="#__codelineno-151-1"></a><span class="gp"># </span>apt<span class="w"> </span>install<span class="w"> </span>hostapd<span class="w"> </span>bridge-utils
</span><span id="__span-151-2"><a id="__codelineno-151-2" name="__codelineno-151-2" href="#__codelineno-151-2"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-151-3"><a id="__codelineno-151-3" name="__codelineno-151-3" href="#__codelineno-151-3"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-151-4"><a id="__codelineno-151-4" name="__codelineno-151-4" href="#__codelineno-151-4"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-151-5"><a id="__codelineno-151-5" name="__codelineno-151-5" href="#__codelineno-151-5"></a><span class="go">Suggested packages:</span>
</span><span id="__span-151-6"><a id="__codelineno-151-6" name="__codelineno-151-6" href="#__codelineno-151-6"></a><span class="go">  ifupdown</span>
</span><span id="__span-151-7"><a id="__codelineno-151-7" name="__codelineno-151-7" href="#__codelineno-151-7"></a><span class="go">The following NEW packages will be installed:</span>
</span><span id="__span-151-8"><a id="__codelineno-151-8" name="__codelineno-151-8" href="#__codelineno-151-8"></a><span class="go">  bridge-utils hostapd</span>
</span><span id="__span-151-9"><a id="__codelineno-151-9" name="__codelineno-151-9" href="#__codelineno-151-9"></a><span class="go">0 upgraded, 2 newly installed, 0 to remove and 0 not upgraded.</span>
</span><span id="__span-151-10"><a id="__codelineno-151-10" name="__codelineno-151-10" href="#__codelineno-151-10"></a><span class="go">Need to get 933 kB of archives.</span>
</span><span id="__span-151-11"><a id="__codelineno-151-11" name="__codelineno-151-11" href="#__codelineno-151-11"></a><span class="go">After this operation, 2,437 kB of additional disk space will be used.</span>
</span><span id="__span-151-12"><a id="__codelineno-151-12" name="__codelineno-151-12" href="#__codelineno-151-12"></a><span class="go">Get:1 http://ch.archive.ubuntu.com/ubuntu noble-updates/universe amd64 hostapd amd64 2:2.10-21ubuntu0.3 [899 kB]</span>
</span><span id="__span-151-13"><a id="__codelineno-151-13" name="__codelineno-151-13" href="#__codelineno-151-13"></a><span class="go">Get:2 http://ch.archive.ubuntu.com/ubuntu noble/main amd64 bridge-utils amd64 1.7.1-1ubuntu2 [33.9 kB]</span>
</span><span id="__span-151-14"><a id="__codelineno-151-14" name="__codelineno-151-14" href="#__codelineno-151-14"></a><span class="go">Fetched 933 kB in 0s (32.6 MB/s)        </span>
</span><span id="__span-151-15"><a id="__codelineno-151-15" name="__codelineno-151-15" href="#__codelineno-151-15"></a><span class="go">Selecting previously unselected package hostapd.</span>
</span><span id="__span-151-16"><a id="__codelineno-151-16" name="__codelineno-151-16" href="#__codelineno-151-16"></a><span class="gp gp-VirtualEnv">(Reading database ... 169804 files and directories currently installed.)</span>
</span><span id="__span-151-17"><a id="__codelineno-151-17" name="__codelineno-151-17" href="#__codelineno-151-17"></a><span class="go">Preparing to unpack .../hostapd_2%3a2.10-21ubuntu0.3_amd64.deb ...</span>
</span><span id="__span-151-18"><a id="__codelineno-151-18" name="__codelineno-151-18" href="#__codelineno-151-18"></a><span class="go">Unpacking hostapd (2:2.10-21ubuntu0.3) ...</span>
</span><span id="__span-151-19"><a id="__codelineno-151-19" name="__codelineno-151-19" href="#__codelineno-151-19"></a><span class="go">Selecting previously unselected package bridge-utils.</span>
</span><span id="__span-151-20"><a id="__codelineno-151-20" name="__codelineno-151-20" href="#__codelineno-151-20"></a><span class="go">Preparing to unpack .../bridge-utils_1.7.1-1ubuntu2_amd64.deb ...</span>
</span><span id="__span-151-21"><a id="__codelineno-151-21" name="__codelineno-151-21" href="#__codelineno-151-21"></a><span class="go">Unpacking bridge-utils (1.7.1-1ubuntu2) ...</span>
</span><span id="__span-151-22"><a id="__codelineno-151-22" name="__codelineno-151-22" href="#__codelineno-151-22"></a><span class="go">Setting up hostapd (2:2.10-21ubuntu0.3) ...</span>
</span><span id="__span-151-23"><a id="__codelineno-151-23" name="__codelineno-151-23" href="#__codelineno-151-23"></a><span class="go">Created symlink /etc/systemd/system/multi-user.target.wants/hostapd.service  /usr/lib/systemd/system/hostapd.service.</span>
</span><span id="__span-151-24"><a id="__codelineno-151-24" name="__codelineno-151-24" href="#__codelineno-151-24"></a><span class="go">Created symlink /etc/systemd/system/hostapd.service  /dev/null.</span>
</span><span id="__span-151-25"><a id="__codelineno-151-25" name="__codelineno-151-25" href="#__codelineno-151-25"></a><span class="go">Setting up bridge-utils (1.7.1-1ubuntu2) ...</span>
</span><span id="__span-151-26"><a id="__codelineno-151-26" name="__codelineno-151-26" href="#__codelineno-151-26"></a><span class="go">Processing triggers for man-db (2.12.0-4build2) ...</span>
</span><span id="__span-151-27"><a id="__codelineno-151-27" name="__codelineno-151-27" href="#__codelineno-151-27"></a><span class="go">Scanning processes...                                                                                            </span>
</span><span id="__span-151-28"><a id="__codelineno-151-28" name="__codelineno-151-28" href="#__codelineno-151-28"></a><span class="go">Scanning candidates...                                                                                           </span>
</span><span id="__span-151-29"><a id="__codelineno-151-29" name="__codelineno-151-29" href="#__codelineno-151-29"></a><span class="go">Scanning processor microcode...                                                                                  </span>
</span><span id="__span-151-30"><a id="__codelineno-151-30" name="__codelineno-151-30" href="#__codelineno-151-30"></a><span class="go">Scanning linux images...                                                                                         </span>
</span><span id="__span-151-31"><a id="__codelineno-151-31" name="__codelineno-151-31" href="#__codelineno-151-31"></a>
</span><span id="__span-151-32"><a id="__codelineno-151-32" name="__codelineno-151-32" href="#__codelineno-151-32"></a><span class="go">Running kernel seems to be up-to-date.</span>
</span><span id="__span-151-33"><a id="__codelineno-151-33" name="__codelineno-151-33" href="#__codelineno-151-33"></a>
</span><span id="__span-151-34"><a id="__codelineno-151-34" name="__codelineno-151-34" href="#__codelineno-151-34"></a><span class="go">The processor microcode seems to be up-to-date.</span>
</span><span id="__span-151-35"><a id="__codelineno-151-35" name="__codelineno-151-35" href="#__codelineno-151-35"></a>
</span><span id="__span-151-36"><a id="__codelineno-151-36" name="__codelineno-151-36" href="#__codelineno-151-36"></a><span class="go">Restarting services...</span>
</span><span id="__span-151-37"><a id="__codelineno-151-37" name="__codelineno-151-37" href="#__codelineno-151-37"></a>
</span><span id="__span-151-38"><a id="__codelineno-151-38" name="__codelineno-151-38" href="#__codelineno-151-38"></a><span class="go">Service restarts being deferred:</span>
</span><span id="__span-151-39"><a id="__codelineno-151-39" name="__codelineno-151-39" href="#__codelineno-151-39"></a><span class="go">systemctl restart bluetooth.service</span>
</span><span id="__span-151-40"><a id="__codelineno-151-40" name="__codelineno-151-40" href="#__codelineno-151-40"></a><span class="go">systemctl restart unattended-upgrades.service</span>
</span><span id="__span-151-41"><a id="__codelineno-151-41" name="__codelineno-151-41" href="#__codelineno-151-41"></a>
</span><span id="__span-151-42"><a id="__codelineno-151-42" name="__codelineno-151-42" href="#__codelineno-151-42"></a><span class="go">No containers need to be restarted.</span>
</span><span id="__span-151-43"><a id="__codelineno-151-43" name="__codelineno-151-43" href="#__codelineno-151-43"></a>
</span><span id="__span-151-44"><a id="__codelineno-151-44" name="__codelineno-151-44" href="#__codelineno-151-44"></a><span class="go">No user sessions are running outdated binaries.</span>
</span><span id="__span-151-45"><a id="__codelineno-151-45" name="__codelineno-151-45" href="#__codelineno-151-45"></a>
</span><span id="__span-151-46"><a id="__codelineno-151-46" name="__codelineno-151-46" href="#__codelineno-151-46"></a><span class="go">No VM guests are running outdated hypervisor (qemu) binaries on this host.</span>
</span></code></pre></div>
</details>
<h3 id="bridge">Bridge</h3>
<p>Define a bridge in Netplan that includes the Ethernet interface (<code>enp86s0</code>) and
assigns the static IP. The Wi-Fi interface (<code>wlo1</code>) will be added to the bridge by
<code>hostapd</code> automatically once it is started later:</p>
<div class="admonition code">
<p class="admonition-title"><code>/etc/netplan/50-cloud-init.yaml</code></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-152-1"><a id="__codelineno-152-1" name="__codelineno-152-1" href="#__codelineno-152-1"></a><span class="c1"># Dual static IP on LAN, nothing else.</span>
</span><span id="__span-152-2"><a id="__codelineno-152-2" name="__codelineno-152-2" href="#__codelineno-152-2"></a><span class="nt">network</span><span class="p">:</span>
</span><span id="__span-152-3"><a id="__codelineno-152-3" name="__codelineno-152-3" href="#__codelineno-152-3"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-152-4"><a id="__codelineno-152-4" name="__codelineno-152-4" href="#__codelineno-152-4"></a><span class="w">  </span><span class="nt">renderer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networkd</span>
</span><span id="__span-152-5"><a id="__codelineno-152-5" name="__codelineno-152-5" href="#__codelineno-152-5"></a><span class="w">  </span><span class="nt">ethernets</span><span class="p">:</span>
</span><span id="__span-152-6"><a id="__codelineno-152-6" name="__codelineno-152-6" href="#__codelineno-152-6"></a><span class="w">    </span><span class="nt">enp86s0</span><span class="p">:</span>
</span><span id="__span-152-7"><a id="__codelineno-152-7" name="__codelineno-152-7" href="#__codelineno-152-7"></a><span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-152-8"><a id="__codelineno-152-8" name="__codelineno-152-8" href="#__codelineno-152-8"></a><span class="w">      </span><span class="nt">dhcp6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-152-9"><a id="__codelineno-152-9" name="__codelineno-152-9" href="#__codelineno-152-9"></a><span class="w">    </span><span class="nt">wlo1</span><span class="p">:</span>
</span><span id="__span-152-10"><a id="__codelineno-152-10" name="__codelineno-152-10" href="#__codelineno-152-10"></a><span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-152-11"><a id="__codelineno-152-11" name="__codelineno-152-11" href="#__codelineno-152-11"></a><span class="w">      </span><span class="nt">dhcp6</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no</span>
</span><span id="__span-152-12"><a id="__codelineno-152-12" name="__codelineno-152-12" href="#__codelineno-152-12"></a><span class="hll"><span class="w">  </span><span class="nt">bridges</span><span class="p">:</span>
</span></span><span id="__span-152-13"><a id="__codelineno-152-13" name="__codelineno-152-13" href="#__codelineno-152-13"></a><span class="hll"><span class="w">    </span><span class="nt">br0</span><span class="p">:</span>
</span></span><span id="__span-152-14"><a id="__codelineno-152-14" name="__codelineno-152-14" href="#__codelineno-152-14"></a><span class="hll"><span class="w">      </span><span class="nt">interfaces</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">enp86s0</span><span class="p p-Indicator">]</span>
</span></span><span id="__span-152-15"><a id="__codelineno-152-15" name="__codelineno-152-15" href="#__codelineno-152-15"></a><span class="hll"><span class="w">      </span><span class="nt">parameters</span><span class="p">:</span>
</span></span><span id="__span-152-16"><a id="__codelineno-152-16" name="__codelineno-152-16" href="#__codelineno-152-16"></a><span class="hll"><span class="w">        </span><span class="nt">stp</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">  </span><span class="c1"># Disable Spanning Tree Protocol for home setups</span>
</span></span><span id="__span-152-17"><a id="__codelineno-152-17" name="__codelineno-152-17" href="#__codelineno-152-17"></a><span class="w">      </span><span class="c1"># Ser IP address &amp; subnet mask</span>
</span><span id="__span-152-18"><a id="__codelineno-152-18" name="__codelineno-152-18" href="#__codelineno-152-18"></a><span class="w">      </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">10.0.0.8/24</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">192.168.0.8/24</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span><span id="__span-152-19"><a id="__codelineno-152-19" name="__codelineno-152-19" href="#__codelineno-152-19"></a><span class="w">      </span><span class="c1"># Set default gateway</span>
</span><span id="__span-152-20"><a id="__codelineno-152-20" name="__codelineno-152-20" href="#__codelineno-152-20"></a><span class="w">      </span><span class="nt">routes</span><span class="p">:</span>
</span><span id="__span-152-21"><a id="__codelineno-152-21" name="__codelineno-152-21" href="#__codelineno-152-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-152-22"><a id="__codelineno-152-22" name="__codelineno-152-22" href="#__codelineno-152-22"></a><span class="w">        </span><span class="nt">via</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.1</span><span class="w">  </span><span class="c1"># UniFi router gateway</span>
</span><span id="__span-152-23"><a id="__codelineno-152-23" name="__codelineno-152-23" href="#__codelineno-152-23"></a><span class="w">      </span><span class="c1"># Set DNS name servers</span>
</span><span id="__span-152-24"><a id="__codelineno-152-24" name="__codelineno-152-24" href="#__codelineno-152-24"></a><span class="w">      </span><span class="nt">nameservers</span><span class="p">:</span>
</span><span id="__span-152-25"><a id="__codelineno-152-25" name="__codelineno-152-25" href="#__codelineno-152-25"></a><span class="w">        </span><span class="nt">addresses</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">77.109.128.2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">213.144.129.20</span><span class="w"> </span><span class="p p-Indicator">]</span>
</span></code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The Wi-Fi <code>wlo1</code> is under the <code>ethernets</code> section, and not under <code>Wi-Fis</code>, so that
Netplan brings the physical interface up but perform no Layer 3 configuration (no
IP/DHCP), allowing <code>hostapd</code> to take control of it and attach it to the bridge.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If using an SSH session, it may disconnect. Be prepared to connect with a physical
keyboard/monitor immediately if things go wrong. Normally changes can tested with
<code>netplan try</code> but not in this case because a bridge is involved:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-153-1"><a id="__codelineno-153-1" name="__codelineno-153-1" href="#__codelineno-153-1"></a><span class="gp"># </span>netplan<span class="w"> </span>try
</span><span id="__span-153-2"><a id="__codelineno-153-2" name="__codelineno-153-2" href="#__codelineno-153-2"></a><span class="go">br0: reverting custom parameters for bridges and bonds is not supported</span>
</span><span id="__span-153-3"><a id="__codelineno-153-3" name="__codelineno-153-3" href="#__codelineno-153-3"></a>
</span><span id="__span-153-4"><a id="__codelineno-153-4" name="__codelineno-153-4" href="#__codelineno-153-4"></a><span class="go">Please carefully review the configuration and use 'netplan apply' directly.</span>
</span></code></pre></div>
</div>
<p>Applying Netplan config should create the bridge, without the Wi-Fi for now, and assign
the IP addresses to the bridge:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-154-1"><a id="__codelineno-154-1" name="__codelineno-154-1" href="#__codelineno-154-1"></a><span class="gp"># </span>netplan<span class="w"> </span>apply
</span><span id="__span-154-2"><a id="__codelineno-154-2" name="__codelineno-154-2" href="#__codelineno-154-2"></a>
</span><span id="__span-154-3"><a id="__codelineno-154-3" name="__codelineno-154-3" href="#__codelineno-154-3"></a><span class="gp"># </span>brctl<span class="w"> </span>show<span class="w"> </span>br0
</span><span id="__span-154-4"><a id="__codelineno-154-4" name="__codelineno-154-4" href="#__codelineno-154-4"></a><span class="go">bridge name     bridge id               STP enabled     interfaces</span>
</span><span id="__span-154-5"><a id="__codelineno-154-5" name="__codelineno-154-5" href="#__codelineno-154-5"></a><span class="go">br0             8000.ae6c4282ecc1       no              enp86s0</span>
</span><span id="__span-154-6"><a id="__codelineno-154-6" name="__codelineno-154-6" href="#__codelineno-154-6"></a>
</span><span id="__span-154-7"><a id="__codelineno-154-7" name="__codelineno-154-7" href="#__codelineno-154-7"></a><span class="gp"># </span>ip<span class="w"> </span>addr<span class="w"> </span>show<span class="w"> </span>br0
</span><span id="__span-154-8"><a id="__codelineno-154-8" name="__codelineno-154-8" href="#__codelineno-154-8"></a><span class="go">491: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span>
</span><span id="__span-154-9"><a id="__codelineno-154-9" name="__codelineno-154-9" href="#__codelineno-154-9"></a><span class="go">    link/ether ae:6c:42:82:ec:c1 brd ff:ff:ff:ff:ff:ff</span>
</span><span id="__span-154-10"><a id="__codelineno-154-10" name="__codelineno-154-10" href="#__codelineno-154-10"></a><span class="go">    inet 10.0.0.8/24 brd 10.0.0.255 scope global br0</span>
</span><span id="__span-154-11"><a id="__codelineno-154-11" name="__codelineno-154-11" href="#__codelineno-154-11"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-154-12"><a id="__codelineno-154-12" name="__codelineno-154-12" href="#__codelineno-154-12"></a><span class="go">    inet 192.168.0.8/24 brd 192.168.0.255 scope global br0</span>
</span><span id="__span-154-13"><a id="__codelineno-154-13" name="__codelineno-154-13" href="#__codelineno-154-13"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span><span id="__span-154-14"><a id="__codelineno-154-14" name="__codelineno-154-14" href="#__codelineno-154-14"></a><span class="go">    inet6 fe80::ac6c:42ff:fe82:ecc1/64 scope link </span>
</span><span id="__span-154-15"><a id="__codelineno-154-15" name="__codelineno-154-15" href="#__codelineno-154-15"></a><span class="go">       valid_lft forever preferred_lft forever</span>
</span></code></pre></div>
<h3 id="2ghz-ap-works">2GHz AP (works)</h3>
<p>Create the hostapd configuration file to define the SSID and bridge connection:</p>
<div class="admonition code">
<p class="admonition-title"><code>/etc/hostapd/hostapd.conf</code></p>
<div class="language-ini highlight"><pre><span></span><code><span id="__span-155-1"><a id="__codelineno-155-1" name="__codelineno-155-1" href="#__codelineno-155-1"></a><span class="na">bridge</span><span class="o">=</span><span class="s">br0</span>
</span><span id="__span-155-2"><a id="__codelineno-155-2" name="__codelineno-155-2" href="#__codelineno-155-2"></a><span class="na">country_code</span><span class="o">=</span><span class="s">CH</span>
</span><span id="__span-155-3"><a id="__codelineno-155-3" name="__codelineno-155-3" href="#__codelineno-155-3"></a><span class="na">driver</span><span class="o">=</span><span class="s">nl80211</span>
</span><span id="__span-155-4"><a id="__codelineno-155-4" name="__codelineno-155-4" href="#__codelineno-155-4"></a><span class="na">interface</span><span class="o">=</span><span class="s">wlo1</span>
</span><span id="__span-155-5"><a id="__codelineno-155-5" name="__codelineno-155-5" href="#__codelineno-155-5"></a>
</span><span id="__span-155-6"><a id="__codelineno-155-6" name="__codelineno-155-6" href="#__codelineno-155-6"></a><span class="c1"># 'g' for 2.4GHz or 'a' for 5GHz.</span>
</span><span id="__span-155-7"><a id="__codelineno-155-7" name="__codelineno-155-7" href="#__codelineno-155-7"></a><span class="na">hw_mode</span><span class="o">=</span><span class="s">g</span>
</span><span id="__span-155-8"><a id="__codelineno-155-8" name="__codelineno-155-8" href="#__codelineno-155-8"></a><span class="c1"># Non-overlapping channel allowed by region CH</span>
</span><span id="__span-155-9"><a id="__codelineno-155-9" name="__codelineno-155-9" href="#__codelineno-155-9"></a><span class="na">channel</span><span class="o">=</span><span class="s">1</span>
</span><span id="__span-155-10"><a id="__codelineno-155-10" name="__codelineno-155-10" href="#__codelineno-155-10"></a><span class="c1"># High Throughput (HT) mode (Wi-Fi 4)</span>
</span><span id="__span-155-11"><a id="__codelineno-155-11" name="__codelineno-155-11" href="#__codelineno-155-11"></a><span class="na">ieee80211n</span><span class="o">=</span><span class="s">1</span>
</span><span id="__span-155-12"><a id="__codelineno-155-12" name="__codelineno-155-12" href="#__codelineno-155-12"></a>
</span><span id="__span-155-13"><a id="__codelineno-155-13" name="__codelineno-155-13" href="#__codelineno-155-13"></a><span class="c1"># SSID and Security settings</span>
</span><span id="__span-155-14"><a id="__codelineno-155-14" name="__codelineno-155-14" href="#__codelineno-155-14"></a><span class="na">ssid</span><span class="o">=</span><span class="s">Discworld_IoT</span>
</span><span id="__span-155-15"><a id="__codelineno-155-15" name="__codelineno-155-15" href="#__codelineno-155-15"></a><span class="na">wpa</span><span class="o">=</span><span class="s">2</span>
</span><span id="__span-155-16"><a id="__codelineno-155-16" name="__codelineno-155-16" href="#__codelineno-155-16"></a><span class="na">wpa_passphrase</span><span class="o">=</span><span class="s">************</span>
</span><span id="__span-155-17"><a id="__codelineno-155-17" name="__codelineno-155-17" href="#__codelineno-155-17"></a><span class="na">wpa_key_mgmt</span><span class="o">=</span><span class="s">WPA-PSK</span>
</span><span id="__span-155-18"><a id="__codelineno-155-18" name="__codelineno-155-18" href="#__codelineno-155-18"></a><span class="na">wpa_pairwise</span><span class="o">=</span><span class="s">CCMP</span>
</span><span id="__span-155-19"><a id="__codelineno-155-19" name="__codelineno-155-19" href="#__codelineno-155-19"></a><span class="na">rsn_pairwise</span><span class="o">=</span><span class="s">CCMP</span>
</span></code></pre></div>
</div>
<p>With <code>hw_mode=g</code> (2.4GHz) it is possible to use <code>ieee80211n=1</code> (enable Wi-Fi 4), but
all the other <code>ieee80211...</code> flags will be ignored as they don't support 2.4GHz. </p>
<p>The UniFi access points are on channels 6 and 11, as reported by the
<a href="../../../../2024/12/31/migrating-unifi-controller-to-kubernetes/">UniFi Network</a>
application. This leaves only <strong>Channel 1</strong> as completely non-overlapping with them.
When marking channel 1 as Excluded at 40MHz in UniFi (under <strong>Settings &gt; WiFi</strong>) it
disables all channels up to 7, leaving only channel 11 in use by UniFi, and since UniFi
is not using any channels at 40MHz, it is not recommended to enable the faster 40MHz
channel width (with <code>ht_capab=[HT40+]</code>).</p>
<p><strong>Mark channel 1 in UniFi to mark it as Excluded at 20 MHz.</strong></p>
<p>In any case, modern smartphones and laptops are programmed to automatically drop down
to 20MHz in the 2.4GHz band whenever they detect any other nearby Wi-Fi networks to
prevent interference; even faster 40MHz channel width was forced, clients would likely
refuse to use it. Sticking to the 20MHz channel width makes also roaming smoother, when
a client moves from a UniFi AP to the NUC, the transition is smoother if the channel
widths are consistent.</p>
<p>Unmask and enable the <code>hostapd</code> service so it starts on boot:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-156-1"><a id="__codelineno-156-1" name="__codelineno-156-1" href="#__codelineno-156-1"></a><span class="gp"># </span>systemctl<span class="w"> </span>unmask<span class="w"> </span>hostapd
</span><span id="__span-156-2"><a id="__codelineno-156-2" name="__codelineno-156-2" href="#__codelineno-156-2"></a><span class="go">Removed "/etc/systemd/system/hostapd.service".</span>
</span><span id="__span-156-3"><a id="__codelineno-156-3" name="__codelineno-156-3" href="#__codelineno-156-3"></a>
</span><span id="__span-156-4"><a id="__codelineno-156-4" name="__codelineno-156-4" href="#__codelineno-156-4"></a><span class="gp"># </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>hostapd
</span><span id="__span-156-5"><a id="__codelineno-156-5" name="__codelineno-156-5" href="#__codelineno-156-5"></a><span class="go">Synchronizing state of hostapd.service with SysV service script with /usr/lib/systemd/systemd-sysv-install.</span>
</span><span id="__span-156-6"><a id="__codelineno-156-6" name="__codelineno-156-6" href="#__codelineno-156-6"></a><span class="go">Executing: /usr/lib/systemd/systemd-sysv-install enable hostapd</span>
</span><span id="__span-156-7"><a id="__codelineno-156-7" name="__codelineno-156-7" href="#__codelineno-156-7"></a>
</span><span id="__span-156-8"><a id="__codelineno-156-8" name="__codelineno-156-8" href="#__codelineno-156-8"></a><span class="gp"># </span>systemctl<span class="w"> </span>start<span class="w"> </span>hostapd
</span><span id="__span-156-9"><a id="__codelineno-156-9" name="__codelineno-156-9" href="#__codelineno-156-9"></a><span class="go">Job for hostapd.service failed because the control process exited with error code.</span>
</span><span id="__span-156-10"><a id="__codelineno-156-10" name="__codelineno-156-10" href="#__codelineno-156-10"></a><span class="go">See "systemctl status hostapd.service" and "journalctl -xeu hostapd.service" for details.</span>
</span><span id="__span-156-11"><a id="__codelineno-156-11" name="__codelineno-156-11" href="#__codelineno-156-11"></a>
</span><span id="__span-156-12"><a id="__codelineno-156-12" name="__codelineno-156-12" href="#__codelineno-156-12"></a><span class="gp"># </span>systemctl<span class="w"> </span>status<span class="w"> </span>hostapd
</span><span id="__span-156-13"><a id="__codelineno-156-13" name="__codelineno-156-13" href="#__codelineno-156-13"></a><span class="go"> hostapd.service - Access point and authentication server for Wi-Fi and Ethernet</span>
</span><span id="__span-156-14"><a id="__codelineno-156-14" name="__codelineno-156-14" href="#__codelineno-156-14"></a><span class="go">     Loaded: loaded (/usr/lib/systemd/system/hostapd.service; enabled; preset: enabled)</span>
</span><span id="__span-156-15"><a id="__codelineno-156-15" name="__codelineno-156-15" href="#__codelineno-156-15"></a><span class="go">     Active: active (running) since Thu 2026-01-22 07:26:28 CET; 2min 10s ago</span>
</span><span id="__span-156-16"><a id="__codelineno-156-16" name="__codelineno-156-16" href="#__codelineno-156-16"></a><span class="go">       Docs: man:hostapd(8)</span>
</span><span id="__span-156-17"><a id="__codelineno-156-17" name="__codelineno-156-17" href="#__codelineno-156-17"></a><span class="go">    Process: 1874042 ExecStart=/usr/sbin/hostapd -B -P /run/hostapd.pid $DAEMON_OPTS ${DAEMON_CONF} (code=exited, status=0/SUCCESS)</span>
</span><span id="__span-156-18"><a id="__codelineno-156-18" name="__codelineno-156-18" href="#__codelineno-156-18"></a><span class="go">   Main PID: 1874338 (hostapd)</span>
</span><span id="__span-156-19"><a id="__codelineno-156-19" name="__codelineno-156-19" href="#__codelineno-156-19"></a><span class="go">      Tasks: 1 (limit: 37734)</span>
</span><span id="__span-156-20"><a id="__codelineno-156-20" name="__codelineno-156-20" href="#__codelineno-156-20"></a><span class="go">     Memory: 1.0M (peak: 1.5M)</span>
</span><span id="__span-156-21"><a id="__codelineno-156-21" name="__codelineno-156-21" href="#__codelineno-156-21"></a><span class="go">        CPU: 64ms</span>
</span><span id="__span-156-22"><a id="__codelineno-156-22" name="__codelineno-156-22" href="#__codelineno-156-22"></a><span class="go">     CGroup: /system.slice/hostapd.service</span>
</span><span id="__span-156-23"><a id="__codelineno-156-23" name="__codelineno-156-23" href="#__codelineno-156-23"></a><span class="go">             1874338 /usr/sbin/hostapd -B -P /run/hostapd.pid /etc/hostapd/hostapd.conf</span>
</span><span id="__span-156-24"><a id="__codelineno-156-24" name="__codelineno-156-24" href="#__codelineno-156-24"></a>
</span><span id="__span-156-25"><a id="__codelineno-156-25" name="__codelineno-156-25" href="#__codelineno-156-25"></a><span class="go">Jan 22 07:26:28 octavo systemd[1]: Starting hostapd.service - Access point and authentication server for Wi-Fi and Ethernet...</span>
</span><span id="__span-156-26"><a id="__codelineno-156-26" name="__codelineno-156-26" href="#__codelineno-156-26"></a><span class="go">Jan 22 07:26:28 octavo (hostapd)[1874042]: hostapd.service: Referenced but unset environment variable evaluates to an empty string: DAEMON_OPTS</span>
</span><span id="__span-156-27"><a id="__codelineno-156-27" name="__codelineno-156-27" href="#__codelineno-156-27"></a><span class="go">Jan 22 07:26:28 octavo hostapd[1874042]: wlo1: interface state UNINITIALIZED-&gt;COUNTRY_UPDATE</span>
</span><span id="__span-156-28"><a id="__codelineno-156-28" name="__codelineno-156-28" href="#__codelineno-156-28"></a><span class="go">Jan 22 07:26:28 octavo hostapd[1874042]: wlo1: interface state COUNTRY_UPDATE-&gt;ENABLED</span>
</span><span id="__span-156-29"><a id="__codelineno-156-29" name="__codelineno-156-29" href="#__codelineno-156-29"></a><span class="go">Jan 22 07:26:28 octavo hostapd[1874042]: wlo1: AP-ENABLED</span>
</span><span id="__span-156-30"><a id="__codelineno-156-30" name="__codelineno-156-30" href="#__codelineno-156-30"></a><span class="go">Jan 22 07:26:28 octavo systemd[1]: Started hostapd.service - Access point and authentication server for Wi-Fi and Ethernet.</span>
</span></code></pre></div>
<p>Once the hostapd service is running, the interface should be correctly bridged:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-157-1"><a id="__codelineno-157-1" name="__codelineno-157-1" href="#__codelineno-157-1"></a><span class="gp"># </span>brctl<span class="w"> </span>show<span class="w"> </span>br0
</span><span id="__span-157-2"><a id="__codelineno-157-2" name="__codelineno-157-2" href="#__codelineno-157-2"></a><span class="go">bridge name     bridge id               STP enabled     interfaces</span>
</span><span id="__span-157-3"><a id="__codelineno-157-3" name="__codelineno-157-3" href="#__codelineno-157-3"></a><span class="go">br0             8000.ae6c4282ecc1       no              enp86s0</span>
</span><span id="__span-157-4"><a id="__codelineno-157-4" name="__codelineno-157-4" href="#__codelineno-157-4"></a><span class="go">                                                        wlo1</span>
</span></code></pre></div>
<p>Now both the Ethernet interface (<code>enp86s0</code>) and the Wi-Fi interface (<code>wlo1</code>)
listed under the <code>interfaces</code> column for <code>br0</code>. This confirms that any client
connecting to the NUC Wi-Fi will be Layer-2 bridged directly to the UniFi network.</p>
<h3 id="5ghz-ap-does-not-work">5GHz AP (does not work)</h3>
<p>Unfortunately the above setup would not work on the 5HGz band.</p>
<p>Many Intel cards have <strong>Location Aware Regulatory (LAR)</strong> firmware that often prevents
5GHz AP mode in Linux because the card cannot "see" its regulatory domain without being
a client first.</p>
<p>The first step is to make sure the regulatory domain is set, by running <code>iw reg get</code>
with the appropriate country code:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-158-1"><a id="__codelineno-158-1" name="__codelineno-158-1" href="#__codelineno-158-1"></a><span class="gp"># </span>iw<span class="w"> </span>reg<span class="w"> </span><span class="nb">set</span><span class="w"> </span>FR
</span><span id="__span-158-2"><a id="__codelineno-158-2" name="__codelineno-158-2" href="#__codelineno-158-2"></a>
</span><span id="__span-158-3"><a id="__codelineno-158-3" name="__codelineno-158-3" href="#__codelineno-158-3"></a><span class="gp"># </span>iw<span class="w"> </span>reg<span class="w"> </span>get
</span><span id="__span-158-4"><a id="__codelineno-158-4" name="__codelineno-158-4" href="#__codelineno-158-4"></a><span class="go">global</span>
</span><span id="__span-158-5"><a id="__codelineno-158-5" name="__codelineno-158-5" href="#__codelineno-158-5"></a><span class="go">country 00: DFS-UNSET</span>
</span><span id="__span-158-6"><a id="__codelineno-158-6" name="__codelineno-158-6" href="#__codelineno-158-6"></a><span class="go">        (755 - 928 @ 2), (N/A, 20), (N/A), PASSIVE-SCAN</span>
</span><span id="__span-158-7"><a id="__codelineno-158-7" name="__codelineno-158-7" href="#__codelineno-158-7"></a><span class="go">        (2402 - 2472 @ 40), (N/A, 20), (N/A)</span>
</span><span id="__span-158-8"><a id="__codelineno-158-8" name="__codelineno-158-8" href="#__codelineno-158-8"></a><span class="go">        (2457 - 2482 @ 20), (N/A, 20), (N/A), AUTO-BW, PASSIVE-SCAN</span>
</span><span id="__span-158-9"><a id="__codelineno-158-9" name="__codelineno-158-9" href="#__codelineno-158-9"></a><span class="go">        (2474 - 2494 @ 20), (N/A, 20), (N/A), NO-OFDM, PASSIVE-SCAN</span>
</span><span id="__span-158-10"><a id="__codelineno-158-10" name="__codelineno-158-10" href="#__codelineno-158-10"></a><span class="go">        (5170 - 5250 @ 80), (N/A, 20), (N/A), AUTO-BW, PASSIVE-SCAN</span>
</span><span id="__span-158-11"><a id="__codelineno-158-11" name="__codelineno-158-11" href="#__codelineno-158-11"></a><span class="go">        (5250 - 5330 @ 80), (N/A, 20), (0 ms), DFS, AUTO-BW, PASSIVE-SCAN</span>
</span><span id="__span-158-12"><a id="__codelineno-158-12" name="__codelineno-158-12" href="#__codelineno-158-12"></a><span class="go">        (5490 - 5730 @ 160), (N/A, 20), (0 ms), DFS, PASSIVE-SCAN</span>
</span><span id="__span-158-13"><a id="__codelineno-158-13" name="__codelineno-158-13" href="#__codelineno-158-13"></a><span class="go">        (5735 - 5835 @ 80), (N/A, 20), (N/A), PASSIVE-SCAN</span>
</span><span id="__span-158-14"><a id="__codelineno-158-14" name="__codelineno-158-14" href="#__codelineno-158-14"></a><span class="go">        (57240 - 63720 @ 2160), (N/A, 0), (N/A)</span>
</span><span id="__span-158-15"><a id="__codelineno-158-15" name="__codelineno-158-15" href="#__codelineno-158-15"></a>
</span><span id="__span-158-16"><a id="__codelineno-158-16" name="__codelineno-158-16" href="#__codelineno-158-16"></a><span class="go">phy#0 (self-managed)</span>
</span><span id="__span-158-17"><a id="__codelineno-158-17" name="__codelineno-158-17" href="#__codelineno-158-17"></a><span class="go">country 00: DFS-UNSET</span>
</span><span id="__span-158-18"><a id="__codelineno-158-18" name="__codelineno-158-18" href="#__codelineno-158-18"></a><span class="go">        (2402 - 2437 @ 40), (6, 22), (N/A), AUTO-BW, NO-HT40MINUS, NO-80MHZ, NO-160MHZ</span>
</span><span id="__span-158-19"><a id="__codelineno-158-19" name="__codelineno-158-19" href="#__codelineno-158-19"></a><span class="go">        (2422 - 2462 @ 40), (6, 22), (N/A), AUTO-BW, NO-80MHZ, NO-160MHZ</span>
</span><span id="__span-158-20"><a id="__codelineno-158-20" name="__codelineno-158-20" href="#__codelineno-158-20"></a><span class="go">        (2447 - 2482 @ 40), (6, 22), (N/A), AUTO-BW, NO-HT40PLUS, NO-80MHZ, NO-160MHZ</span>
</span><span id="__span-158-21"><a id="__codelineno-158-21" name="__codelineno-158-21" href="#__codelineno-158-21"></a><span class="go">        (5170 - 5190 @ 160), (6, 22), (N/A), NO-OUTDOOR, AUTO-BW, IR-CONCURRENT, NO-HT40MINUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-22"><a id="__codelineno-158-22" name="__codelineno-158-22" href="#__codelineno-158-22"></a><span class="go">        (5190 - 5210 @ 160), (6, 22), (N/A), NO-OUTDOOR, AUTO-BW, IR-CONCURRENT, NO-HT40PLUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-23"><a id="__codelineno-158-23" name="__codelineno-158-23" href="#__codelineno-158-23"></a><span class="go">        (5210 - 5230 @ 160), (6, 22), (N/A), NO-OUTDOOR, AUTO-BW, IR-CONCURRENT, NO-HT40MINUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-24"><a id="__codelineno-158-24" name="__codelineno-158-24" href="#__codelineno-158-24"></a><span class="go">        (5230 - 5250 @ 160), (6, 22), (N/A), NO-OUTDOOR, AUTO-BW, IR-CONCURRENT, NO-HT40PLUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-25"><a id="__codelineno-158-25" name="__codelineno-158-25" href="#__codelineno-158-25"></a><span class="go">        (5250 - 5270 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-26"><a id="__codelineno-158-26" name="__codelineno-158-26" href="#__codelineno-158-26"></a><span class="go">        (5270 - 5290 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-27"><a id="__codelineno-158-27" name="__codelineno-158-27" href="#__codelineno-158-27"></a><span class="go">        (5290 - 5310 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-28"><a id="__codelineno-158-28" name="__codelineno-158-28" href="#__codelineno-158-28"></a><span class="go">        (5310 - 5330 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-29"><a id="__codelineno-158-29" name="__codelineno-158-29" href="#__codelineno-158-29"></a><span class="go">        (5490 - 5510 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-30"><a id="__codelineno-158-30" name="__codelineno-158-30" href="#__codelineno-158-30"></a><span class="go">        (5510 - 5530 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-31"><a id="__codelineno-158-31" name="__codelineno-158-31" href="#__codelineno-158-31"></a><span class="go">        (5530 - 5550 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-32"><a id="__codelineno-158-32" name="__codelineno-158-32" href="#__codelineno-158-32"></a><span class="go">        (5550 - 5570 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-33"><a id="__codelineno-158-33" name="__codelineno-158-33" href="#__codelineno-158-33"></a><span class="go">        (5570 - 5590 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-34"><a id="__codelineno-158-34" name="__codelineno-158-34" href="#__codelineno-158-34"></a><span class="go">        (5590 - 5610 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-35"><a id="__codelineno-158-35" name="__codelineno-158-35" href="#__codelineno-158-35"></a><span class="go">        (5610 - 5630 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-36"><a id="__codelineno-158-36" name="__codelineno-158-36" href="#__codelineno-158-36"></a><span class="go">        (5630 - 5650 @ 160), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-37"><a id="__codelineno-158-37" name="__codelineno-158-37" href="#__codelineno-158-37"></a><span class="go">        (5650 - 5670 @ 80), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, NO-160MHZ, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-38"><a id="__codelineno-158-38" name="__codelineno-158-38" href="#__codelineno-158-38"></a><span class="go">        (5670 - 5690 @ 80), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, NO-160MHZ, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-39"><a id="__codelineno-158-39" name="__codelineno-158-39" href="#__codelineno-158-39"></a><span class="go">        (5690 - 5710 @ 80), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40MINUS, NO-160MHZ, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-40"><a id="__codelineno-158-40" name="__codelineno-158-40" href="#__codelineno-158-40"></a><span class="go">        (5710 - 5730 @ 80), (6, 22), (0 ms), DFS, AUTO-BW, NO-HT40PLUS, NO-160MHZ, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-41"><a id="__codelineno-158-41" name="__codelineno-158-41" href="#__codelineno-158-41"></a><span class="go">        (5735 - 5755 @ 80), (6, 22), (N/A), AUTO-BW, IR-CONCURRENT, NO-HT40MINUS, NO-160MHZ, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-42"><a id="__codelineno-158-42" name="__codelineno-158-42" href="#__codelineno-158-42"></a><span class="go">        (5755 - 5775 @ 80), (6, 22), (N/A), AUTO-BW, IR-CONCURRENT, NO-HT40PLUS, NO-160MHZ, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-43"><a id="__codelineno-158-43" name="__codelineno-158-43" href="#__codelineno-158-43"></a><span class="go">        (5775 - 5795 @ 80), (6, 22), (N/A), AUTO-BW, IR-CONCURRENT, NO-HT40MINUS, NO-160MHZ, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-44"><a id="__codelineno-158-44" name="__codelineno-158-44" href="#__codelineno-158-44"></a><span class="go">        (5795 - 5815 @ 80), (6, 22), (N/A), AUTO-BW, IR-CONCURRENT, NO-HT40PLUS, NO-160MHZ, NO-320MHZ, PASSIVE-SCAN</span>
</span><span id="__span-158-45"><a id="__codelineno-158-45" name="__codelineno-158-45" href="#__codelineno-158-45"></a><span class="go">        (5815 - 5835 @ 40), (6, 22), (N/A), AUTO-BW, IR-CONCURRENT, NO-HT40MINUS, NO-80MHZ, NO-160MHZ, NO-320MHZ, PASSIVE-SCAN</span>
</span></code></pre></div>
<p>Since <code>iw reg get</code> still says <code>country 00</code> the setting has not been effective. This
shows a common Intel hardware limitation: the Wi-Fi card is "self-managed" and is
ignoring the system's FR (France) regulatory setting, defaulting instead to a
restrictive <code>00 (World)</code> domain. Also, almost every 5GHz frequency is marked with
<code>PASSIVE-SCAN</code> or <code>IR-CONCURRENT</code>. In the Linux wireless stack, this is effectively
the same as <code>no-IR</code>.</p>
<p>Using the <code>iw</code> tool to check for list all the Wi-Fi channels with shows that everything
except <code>Band 1</code> (2.4GHz) has either <code>No IR</code> (No Initial Radiation) or <code>(disabled)</code>,
including all frequencies in the 52605700 MHz range (channels 52140):</p>
<details class="terminal">
<summary><code>iw phy phy0 channels</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-159-1"><a id="__codelineno-159-1" name="__codelineno-159-1" href="#__codelineno-159-1"></a><span class="gp"># </span>iw<span class="w"> </span>phy<span class="w"> </span>phy0<span class="w"> </span>channels
</span><span id="__span-159-2"><a id="__codelineno-159-2" name="__codelineno-159-2" href="#__codelineno-159-2"></a><span class="go">Band 1:</span>
</span><span id="__span-159-3"><a id="__codelineno-159-3" name="__codelineno-159-3" href="#__codelineno-159-3"></a><span class="go">        * 2412 MHz [1] </span>
</span><span id="__span-159-4"><a id="__codelineno-159-4" name="__codelineno-159-4" href="#__codelineno-159-4"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-5"><a id="__codelineno-159-5" name="__codelineno-159-5" href="#__codelineno-159-5"></a><span class="go">          Channel widths: 20MHz HT40+</span>
</span><span id="__span-159-6"><a id="__codelineno-159-6" name="__codelineno-159-6" href="#__codelineno-159-6"></a><span class="go">        * 2417 MHz [2] </span>
</span><span id="__span-159-7"><a id="__codelineno-159-7" name="__codelineno-159-7" href="#__codelineno-159-7"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-8"><a id="__codelineno-159-8" name="__codelineno-159-8" href="#__codelineno-159-8"></a><span class="go">          Channel widths: 20MHz HT40+</span>
</span><span id="__span-159-9"><a id="__codelineno-159-9" name="__codelineno-159-9" href="#__codelineno-159-9"></a><span class="go">        * 2422 MHz [3] </span>
</span><span id="__span-159-10"><a id="__codelineno-159-10" name="__codelineno-159-10" href="#__codelineno-159-10"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-11"><a id="__codelineno-159-11" name="__codelineno-159-11" href="#__codelineno-159-11"></a><span class="go">          Channel widths: 20MHz HT40+</span>
</span><span id="__span-159-12"><a id="__codelineno-159-12" name="__codelineno-159-12" href="#__codelineno-159-12"></a><span class="go">        * 2427 MHz [4] </span>
</span><span id="__span-159-13"><a id="__codelineno-159-13" name="__codelineno-159-13" href="#__codelineno-159-13"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-14"><a id="__codelineno-159-14" name="__codelineno-159-14" href="#__codelineno-159-14"></a><span class="go">          Channel widths: 20MHz HT40+</span>
</span><span id="__span-159-15"><a id="__codelineno-159-15" name="__codelineno-159-15" href="#__codelineno-159-15"></a><span class="go">        * 2432 MHz [5] </span>
</span><span id="__span-159-16"><a id="__codelineno-159-16" name="__codelineno-159-16" href="#__codelineno-159-16"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-17"><a id="__codelineno-159-17" name="__codelineno-159-17" href="#__codelineno-159-17"></a><span class="go">          Channel widths: 20MHz HT40- HT40+</span>
</span><span id="__span-159-18"><a id="__codelineno-159-18" name="__codelineno-159-18" href="#__codelineno-159-18"></a><span class="go">        * 2437 MHz [6] </span>
</span><span id="__span-159-19"><a id="__codelineno-159-19" name="__codelineno-159-19" href="#__codelineno-159-19"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-20"><a id="__codelineno-159-20" name="__codelineno-159-20" href="#__codelineno-159-20"></a><span class="go">          Channel widths: 20MHz HT40- HT40+</span>
</span><span id="__span-159-21"><a id="__codelineno-159-21" name="__codelineno-159-21" href="#__codelineno-159-21"></a><span class="go">        * 2442 MHz [7] </span>
</span><span id="__span-159-22"><a id="__codelineno-159-22" name="__codelineno-159-22" href="#__codelineno-159-22"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-23"><a id="__codelineno-159-23" name="__codelineno-159-23" href="#__codelineno-159-23"></a><span class="go">          Channel widths: 20MHz HT40- HT40+</span>
</span><span id="__span-159-24"><a id="__codelineno-159-24" name="__codelineno-159-24" href="#__codelineno-159-24"></a><span class="go">        * 2447 MHz [8] </span>
</span><span id="__span-159-25"><a id="__codelineno-159-25" name="__codelineno-159-25" href="#__codelineno-159-25"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-26"><a id="__codelineno-159-26" name="__codelineno-159-26" href="#__codelineno-159-26"></a><span class="go">          Channel widths: 20MHz HT40- HT40+</span>
</span><span id="__span-159-27"><a id="__codelineno-159-27" name="__codelineno-159-27" href="#__codelineno-159-27"></a><span class="go">        * 2452 MHz [9] </span>
</span><span id="__span-159-28"><a id="__codelineno-159-28" name="__codelineno-159-28" href="#__codelineno-159-28"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-29"><a id="__codelineno-159-29" name="__codelineno-159-29" href="#__codelineno-159-29"></a><span class="go">          Channel widths: 20MHz HT40- HT40+</span>
</span><span id="__span-159-30"><a id="__codelineno-159-30" name="__codelineno-159-30" href="#__codelineno-159-30"></a><span class="go">        * 2457 MHz [10] </span>
</span><span id="__span-159-31"><a id="__codelineno-159-31" name="__codelineno-159-31" href="#__codelineno-159-31"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-32"><a id="__codelineno-159-32" name="__codelineno-159-32" href="#__codelineno-159-32"></a><span class="go">          Channel widths: 20MHz HT40-</span>
</span><span id="__span-159-33"><a id="__codelineno-159-33" name="__codelineno-159-33" href="#__codelineno-159-33"></a><span class="go">        * 2462 MHz [11] </span>
</span><span id="__span-159-34"><a id="__codelineno-159-34" name="__codelineno-159-34" href="#__codelineno-159-34"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-35"><a id="__codelineno-159-35" name="__codelineno-159-35" href="#__codelineno-159-35"></a><span class="go">          Channel widths: 20MHz HT40-</span>
</span><span id="__span-159-36"><a id="__codelineno-159-36" name="__codelineno-159-36" href="#__codelineno-159-36"></a><span class="go">        * 2467 MHz [12] </span>
</span><span id="__span-159-37"><a id="__codelineno-159-37" name="__codelineno-159-37" href="#__codelineno-159-37"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-38"><a id="__codelineno-159-38" name="__codelineno-159-38" href="#__codelineno-159-38"></a><span class="go">          Channel widths: 20MHz HT40-</span>
</span><span id="__span-159-39"><a id="__codelineno-159-39" name="__codelineno-159-39" href="#__codelineno-159-39"></a><span class="go">        * 2472 MHz [13] </span>
</span><span id="__span-159-40"><a id="__codelineno-159-40" name="__codelineno-159-40" href="#__codelineno-159-40"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-41"><a id="__codelineno-159-41" name="__codelineno-159-41" href="#__codelineno-159-41"></a><span class="go">          Channel widths: 20MHz HT40-</span>
</span><span id="__span-159-42"><a id="__codelineno-159-42" name="__codelineno-159-42" href="#__codelineno-159-42"></a><span class="go">        * 2484 MHz [14] (disabled)</span>
</span><span id="__span-159-43"><a id="__codelineno-159-43" name="__codelineno-159-43" href="#__codelineno-159-43"></a><span class="go">Band 2:</span>
</span><span id="__span-159-44"><a id="__codelineno-159-44" name="__codelineno-159-44" href="#__codelineno-159-44"></a><span class="go">        * 5180 MHz [36] </span>
</span><span id="__span-159-45"><a id="__codelineno-159-45" name="__codelineno-159-45" href="#__codelineno-159-45"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-46"><a id="__codelineno-159-46" name="__codelineno-159-46" href="#__codelineno-159-46"></a><span class="go">          No IR</span>
</span><span id="__span-159-47"><a id="__codelineno-159-47" name="__codelineno-159-47" href="#__codelineno-159-47"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80 VHT160</span>
</span><span id="__span-159-48"><a id="__codelineno-159-48" name="__codelineno-159-48" href="#__codelineno-159-48"></a><span class="go">        * 5200 MHz [40] </span>
</span><span id="__span-159-49"><a id="__codelineno-159-49" name="__codelineno-159-49" href="#__codelineno-159-49"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-50"><a id="__codelineno-159-50" name="__codelineno-159-50" href="#__codelineno-159-50"></a><span class="go">          No IR</span>
</span><span id="__span-159-51"><a id="__codelineno-159-51" name="__codelineno-159-51" href="#__codelineno-159-51"></a><span class="go">          Channel widths: 20MHz HT40- VHT80 VHT160</span>
</span><span id="__span-159-52"><a id="__codelineno-159-52" name="__codelineno-159-52" href="#__codelineno-159-52"></a><span class="go">        * 5220 MHz [44] </span>
</span><span id="__span-159-53"><a id="__codelineno-159-53" name="__codelineno-159-53" href="#__codelineno-159-53"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-54"><a id="__codelineno-159-54" name="__codelineno-159-54" href="#__codelineno-159-54"></a><span class="go">          No IR</span>
</span><span id="__span-159-55"><a id="__codelineno-159-55" name="__codelineno-159-55" href="#__codelineno-159-55"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80 VHT160</span>
</span><span id="__span-159-56"><a id="__codelineno-159-56" name="__codelineno-159-56" href="#__codelineno-159-56"></a><span class="go">        * 5240 MHz [48] </span>
</span><span id="__span-159-57"><a id="__codelineno-159-57" name="__codelineno-159-57" href="#__codelineno-159-57"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-58"><a id="__codelineno-159-58" name="__codelineno-159-58" href="#__codelineno-159-58"></a><span class="go">          No IR</span>
</span><span id="__span-159-59"><a id="__codelineno-159-59" name="__codelineno-159-59" href="#__codelineno-159-59"></a><span class="go">          Channel widths: 20MHz HT40- VHT80 VHT160</span>
</span><span id="__span-159-60"><a id="__codelineno-159-60" name="__codelineno-159-60" href="#__codelineno-159-60"></a><span class="go">        * 5260 MHz [52] </span>
</span><span id="__span-159-61"><a id="__codelineno-159-61" name="__codelineno-159-61" href="#__codelineno-159-61"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-62"><a id="__codelineno-159-62" name="__codelineno-159-62" href="#__codelineno-159-62"></a><span class="go">          No IR</span>
</span><span id="__span-159-63"><a id="__codelineno-159-63" name="__codelineno-159-63" href="#__codelineno-159-63"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-64"><a id="__codelineno-159-64" name="__codelineno-159-64" href="#__codelineno-159-64"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80 VHT160</span>
</span><span id="__span-159-65"><a id="__codelineno-159-65" name="__codelineno-159-65" href="#__codelineno-159-65"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-66"><a id="__codelineno-159-66" name="__codelineno-159-66" href="#__codelineno-159-66"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-67"><a id="__codelineno-159-67" name="__codelineno-159-67" href="#__codelineno-159-67"></a><span class="go">        * 5280 MHz [56] </span>
</span><span id="__span-159-68"><a id="__codelineno-159-68" name="__codelineno-159-68" href="#__codelineno-159-68"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-69"><a id="__codelineno-159-69" name="__codelineno-159-69" href="#__codelineno-159-69"></a><span class="go">          No IR</span>
</span><span id="__span-159-70"><a id="__codelineno-159-70" name="__codelineno-159-70" href="#__codelineno-159-70"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-71"><a id="__codelineno-159-71" name="__codelineno-159-71" href="#__codelineno-159-71"></a><span class="go">          Channel widths: 20MHz HT40- VHT80 VHT160</span>
</span><span id="__span-159-72"><a id="__codelineno-159-72" name="__codelineno-159-72" href="#__codelineno-159-72"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-73"><a id="__codelineno-159-73" name="__codelineno-159-73" href="#__codelineno-159-73"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-74"><a id="__codelineno-159-74" name="__codelineno-159-74" href="#__codelineno-159-74"></a><span class="go">        * 5300 MHz [60] </span>
</span><span id="__span-159-75"><a id="__codelineno-159-75" name="__codelineno-159-75" href="#__codelineno-159-75"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-76"><a id="__codelineno-159-76" name="__codelineno-159-76" href="#__codelineno-159-76"></a><span class="go">          No IR</span>
</span><span id="__span-159-77"><a id="__codelineno-159-77" name="__codelineno-159-77" href="#__codelineno-159-77"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-78"><a id="__codelineno-159-78" name="__codelineno-159-78" href="#__codelineno-159-78"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80 VHT160</span>
</span><span id="__span-159-79"><a id="__codelineno-159-79" name="__codelineno-159-79" href="#__codelineno-159-79"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-80"><a id="__codelineno-159-80" name="__codelineno-159-80" href="#__codelineno-159-80"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-81"><a id="__codelineno-159-81" name="__codelineno-159-81" href="#__codelineno-159-81"></a><span class="go">        * 5320 MHz [64] </span>
</span><span id="__span-159-82"><a id="__codelineno-159-82" name="__codelineno-159-82" href="#__codelineno-159-82"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-83"><a id="__codelineno-159-83" name="__codelineno-159-83" href="#__codelineno-159-83"></a><span class="go">          No IR</span>
</span><span id="__span-159-84"><a id="__codelineno-159-84" name="__codelineno-159-84" href="#__codelineno-159-84"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-85"><a id="__codelineno-159-85" name="__codelineno-159-85" href="#__codelineno-159-85"></a><span class="go">          Channel widths: 20MHz HT40- VHT80 VHT160</span>
</span><span id="__span-159-86"><a id="__codelineno-159-86" name="__codelineno-159-86" href="#__codelineno-159-86"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-87"><a id="__codelineno-159-87" name="__codelineno-159-87" href="#__codelineno-159-87"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-88"><a id="__codelineno-159-88" name="__codelineno-159-88" href="#__codelineno-159-88"></a><span class="go">        * 5340 MHz [68] (disabled)</span>
</span><span id="__span-159-89"><a id="__codelineno-159-89" name="__codelineno-159-89" href="#__codelineno-159-89"></a><span class="go">        * 5360 MHz [72] (disabled)</span>
</span><span id="__span-159-90"><a id="__codelineno-159-90" name="__codelineno-159-90" href="#__codelineno-159-90"></a><span class="go">        * 5380 MHz [76] (disabled)</span>
</span><span id="__span-159-91"><a id="__codelineno-159-91" name="__codelineno-159-91" href="#__codelineno-159-91"></a><span class="go">        * 5400 MHz [80] (disabled)</span>
</span><span id="__span-159-92"><a id="__codelineno-159-92" name="__codelineno-159-92" href="#__codelineno-159-92"></a><span class="go">        * 5420 MHz [84] (disabled)</span>
</span><span id="__span-159-93"><a id="__codelineno-159-93" name="__codelineno-159-93" href="#__codelineno-159-93"></a><span class="go">        * 5440 MHz [88] (disabled)</span>
</span><span id="__span-159-94"><a id="__codelineno-159-94" name="__codelineno-159-94" href="#__codelineno-159-94"></a><span class="go">        * 5460 MHz [92] (disabled)</span>
</span><span id="__span-159-95"><a id="__codelineno-159-95" name="__codelineno-159-95" href="#__codelineno-159-95"></a><span class="go">        * 5480 MHz [96] (disabled)</span>
</span><span id="__span-159-96"><a id="__codelineno-159-96" name="__codelineno-159-96" href="#__codelineno-159-96"></a><span class="go">        * 5500 MHz [100] </span>
</span><span id="__span-159-97"><a id="__codelineno-159-97" name="__codelineno-159-97" href="#__codelineno-159-97"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-98"><a id="__codelineno-159-98" name="__codelineno-159-98" href="#__codelineno-159-98"></a><span class="go">          No IR</span>
</span><span id="__span-159-99"><a id="__codelineno-159-99" name="__codelineno-159-99" href="#__codelineno-159-99"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-100"><a id="__codelineno-159-100" name="__codelineno-159-100" href="#__codelineno-159-100"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80 VHT160</span>
</span><span id="__span-159-101"><a id="__codelineno-159-101" name="__codelineno-159-101" href="#__codelineno-159-101"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-102"><a id="__codelineno-159-102" name="__codelineno-159-102" href="#__codelineno-159-102"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-103"><a id="__codelineno-159-103" name="__codelineno-159-103" href="#__codelineno-159-103"></a><span class="go">        * 5520 MHz [104] </span>
</span><span id="__span-159-104"><a id="__codelineno-159-104" name="__codelineno-159-104" href="#__codelineno-159-104"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-105"><a id="__codelineno-159-105" name="__codelineno-159-105" href="#__codelineno-159-105"></a><span class="go">          No IR</span>
</span><span id="__span-159-106"><a id="__codelineno-159-106" name="__codelineno-159-106" href="#__codelineno-159-106"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-107"><a id="__codelineno-159-107" name="__codelineno-159-107" href="#__codelineno-159-107"></a><span class="go">          Channel widths: 20MHz HT40- VHT80 VHT160</span>
</span><span id="__span-159-108"><a id="__codelineno-159-108" name="__codelineno-159-108" href="#__codelineno-159-108"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-109"><a id="__codelineno-159-109" name="__codelineno-159-109" href="#__codelineno-159-109"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-110"><a id="__codelineno-159-110" name="__codelineno-159-110" href="#__codelineno-159-110"></a><span class="go">        * 5540 MHz [108] </span>
</span><span id="__span-159-111"><a id="__codelineno-159-111" name="__codelineno-159-111" href="#__codelineno-159-111"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-112"><a id="__codelineno-159-112" name="__codelineno-159-112" href="#__codelineno-159-112"></a><span class="go">          No IR</span>
</span><span id="__span-159-113"><a id="__codelineno-159-113" name="__codelineno-159-113" href="#__codelineno-159-113"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-114"><a id="__codelineno-159-114" name="__codelineno-159-114" href="#__codelineno-159-114"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80 VHT160</span>
</span><span id="__span-159-115"><a id="__codelineno-159-115" name="__codelineno-159-115" href="#__codelineno-159-115"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-116"><a id="__codelineno-159-116" name="__codelineno-159-116" href="#__codelineno-159-116"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-117"><a id="__codelineno-159-117" name="__codelineno-159-117" href="#__codelineno-159-117"></a><span class="go">        * 5560 MHz [112] </span>
</span><span id="__span-159-118"><a id="__codelineno-159-118" name="__codelineno-159-118" href="#__codelineno-159-118"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-119"><a id="__codelineno-159-119" name="__codelineno-159-119" href="#__codelineno-159-119"></a><span class="go">          No IR</span>
</span><span id="__span-159-120"><a id="__codelineno-159-120" name="__codelineno-159-120" href="#__codelineno-159-120"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-121"><a id="__codelineno-159-121" name="__codelineno-159-121" href="#__codelineno-159-121"></a><span class="go">          Channel widths: 20MHz HT40- VHT80 VHT160</span>
</span><span id="__span-159-122"><a id="__codelineno-159-122" name="__codelineno-159-122" href="#__codelineno-159-122"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-123"><a id="__codelineno-159-123" name="__codelineno-159-123" href="#__codelineno-159-123"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-124"><a id="__codelineno-159-124" name="__codelineno-159-124" href="#__codelineno-159-124"></a><span class="go">        * 5580 MHz [116] </span>
</span><span id="__span-159-125"><a id="__codelineno-159-125" name="__codelineno-159-125" href="#__codelineno-159-125"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-126"><a id="__codelineno-159-126" name="__codelineno-159-126" href="#__codelineno-159-126"></a><span class="go">          No IR</span>
</span><span id="__span-159-127"><a id="__codelineno-159-127" name="__codelineno-159-127" href="#__codelineno-159-127"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-128"><a id="__codelineno-159-128" name="__codelineno-159-128" href="#__codelineno-159-128"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80 VHT160</span>
</span><span id="__span-159-129"><a id="__codelineno-159-129" name="__codelineno-159-129" href="#__codelineno-159-129"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-130"><a id="__codelineno-159-130" name="__codelineno-159-130" href="#__codelineno-159-130"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-131"><a id="__codelineno-159-131" name="__codelineno-159-131" href="#__codelineno-159-131"></a><span class="go">        * 5600 MHz [120] </span>
</span><span id="__span-159-132"><a id="__codelineno-159-132" name="__codelineno-159-132" href="#__codelineno-159-132"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-133"><a id="__codelineno-159-133" name="__codelineno-159-133" href="#__codelineno-159-133"></a><span class="go">          No IR</span>
</span><span id="__span-159-134"><a id="__codelineno-159-134" name="__codelineno-159-134" href="#__codelineno-159-134"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-135"><a id="__codelineno-159-135" name="__codelineno-159-135" href="#__codelineno-159-135"></a><span class="go">          Channel widths: 20MHz HT40- VHT80 VHT160</span>
</span><span id="__span-159-136"><a id="__codelineno-159-136" name="__codelineno-159-136" href="#__codelineno-159-136"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-137"><a id="__codelineno-159-137" name="__codelineno-159-137" href="#__codelineno-159-137"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-138"><a id="__codelineno-159-138" name="__codelineno-159-138" href="#__codelineno-159-138"></a><span class="go">        * 5620 MHz [124] </span>
</span><span id="__span-159-139"><a id="__codelineno-159-139" name="__codelineno-159-139" href="#__codelineno-159-139"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-140"><a id="__codelineno-159-140" name="__codelineno-159-140" href="#__codelineno-159-140"></a><span class="go">          No IR</span>
</span><span id="__span-159-141"><a id="__codelineno-159-141" name="__codelineno-159-141" href="#__codelineno-159-141"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-142"><a id="__codelineno-159-142" name="__codelineno-159-142" href="#__codelineno-159-142"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80 VHT160</span>
</span><span id="__span-159-143"><a id="__codelineno-159-143" name="__codelineno-159-143" href="#__codelineno-159-143"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-144"><a id="__codelineno-159-144" name="__codelineno-159-144" href="#__codelineno-159-144"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-145"><a id="__codelineno-159-145" name="__codelineno-159-145" href="#__codelineno-159-145"></a><span class="go">        * 5640 MHz [128] </span>
</span><span id="__span-159-146"><a id="__codelineno-159-146" name="__codelineno-159-146" href="#__codelineno-159-146"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-147"><a id="__codelineno-159-147" name="__codelineno-159-147" href="#__codelineno-159-147"></a><span class="go">          No IR</span>
</span><span id="__span-159-148"><a id="__codelineno-159-148" name="__codelineno-159-148" href="#__codelineno-159-148"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-149"><a id="__codelineno-159-149" name="__codelineno-159-149" href="#__codelineno-159-149"></a><span class="go">          Channel widths: 20MHz HT40- VHT80 VHT160</span>
</span><span id="__span-159-150"><a id="__codelineno-159-150" name="__codelineno-159-150" href="#__codelineno-159-150"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-151"><a id="__codelineno-159-151" name="__codelineno-159-151" href="#__codelineno-159-151"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-152"><a id="__codelineno-159-152" name="__codelineno-159-152" href="#__codelineno-159-152"></a><span class="go">        * 5660 MHz [132] </span>
</span><span id="__span-159-153"><a id="__codelineno-159-153" name="__codelineno-159-153" href="#__codelineno-159-153"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-154"><a id="__codelineno-159-154" name="__codelineno-159-154" href="#__codelineno-159-154"></a><span class="go">          No IR</span>
</span><span id="__span-159-155"><a id="__codelineno-159-155" name="__codelineno-159-155" href="#__codelineno-159-155"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-156"><a id="__codelineno-159-156" name="__codelineno-159-156" href="#__codelineno-159-156"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80</span>
</span><span id="__span-159-157"><a id="__codelineno-159-157" name="__codelineno-159-157" href="#__codelineno-159-157"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-158"><a id="__codelineno-159-158" name="__codelineno-159-158" href="#__codelineno-159-158"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-159"><a id="__codelineno-159-159" name="__codelineno-159-159" href="#__codelineno-159-159"></a><span class="go">        * 5680 MHz [136] </span>
</span><span id="__span-159-160"><a id="__codelineno-159-160" name="__codelineno-159-160" href="#__codelineno-159-160"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-161"><a id="__codelineno-159-161" name="__codelineno-159-161" href="#__codelineno-159-161"></a><span class="go">          No IR</span>
</span><span id="__span-159-162"><a id="__codelineno-159-162" name="__codelineno-159-162" href="#__codelineno-159-162"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-163"><a id="__codelineno-159-163" name="__codelineno-159-163" href="#__codelineno-159-163"></a><span class="go">          Channel widths: 20MHz HT40- VHT80</span>
</span><span id="__span-159-164"><a id="__codelineno-159-164" name="__codelineno-159-164" href="#__codelineno-159-164"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-165"><a id="__codelineno-159-165" name="__codelineno-159-165" href="#__codelineno-159-165"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-166"><a id="__codelineno-159-166" name="__codelineno-159-166" href="#__codelineno-159-166"></a><span class="go">        * 5700 MHz [140] </span>
</span><span id="__span-159-167"><a id="__codelineno-159-167" name="__codelineno-159-167" href="#__codelineno-159-167"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-168"><a id="__codelineno-159-168" name="__codelineno-159-168" href="#__codelineno-159-168"></a><span class="go">          No IR</span>
</span><span id="__span-159-169"><a id="__codelineno-159-169" name="__codelineno-159-169" href="#__codelineno-159-169"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-170"><a id="__codelineno-159-170" name="__codelineno-159-170" href="#__codelineno-159-170"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80</span>
</span><span id="__span-159-171"><a id="__codelineno-159-171" name="__codelineno-159-171" href="#__codelineno-159-171"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-172"><a id="__codelineno-159-172" name="__codelineno-159-172" href="#__codelineno-159-172"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-173"><a id="__codelineno-159-173" name="__codelineno-159-173" href="#__codelineno-159-173"></a><span class="go">        * 5720 MHz [144] </span>
</span><span id="__span-159-174"><a id="__codelineno-159-174" name="__codelineno-159-174" href="#__codelineno-159-174"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-175"><a id="__codelineno-159-175" name="__codelineno-159-175" href="#__codelineno-159-175"></a><span class="go">          No IR</span>
</span><span id="__span-159-176"><a id="__codelineno-159-176" name="__codelineno-159-176" href="#__codelineno-159-176"></a><span class="go">          Radar detection</span>
</span><span id="__span-159-177"><a id="__codelineno-159-177" name="__codelineno-159-177" href="#__codelineno-159-177"></a><span class="go">          Channel widths: 20MHz HT40- VHT80</span>
</span><span id="__span-159-178"><a id="__codelineno-159-178" name="__codelineno-159-178" href="#__codelineno-159-178"></a><span class="go">          DFS state: usable (for 42089 sec)</span>
</span><span id="__span-159-179"><a id="__codelineno-159-179" name="__codelineno-159-179" href="#__codelineno-159-179"></a><span class="go">          DFS CAC time: 60000 ms</span>
</span><span id="__span-159-180"><a id="__codelineno-159-180" name="__codelineno-159-180" href="#__codelineno-159-180"></a><span class="go">        * 5745 MHz [149] </span>
</span><span id="__span-159-181"><a id="__codelineno-159-181" name="__codelineno-159-181" href="#__codelineno-159-181"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-182"><a id="__codelineno-159-182" name="__codelineno-159-182" href="#__codelineno-159-182"></a><span class="go">          No IR</span>
</span><span id="__span-159-183"><a id="__codelineno-159-183" name="__codelineno-159-183" href="#__codelineno-159-183"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80</span>
</span><span id="__span-159-184"><a id="__codelineno-159-184" name="__codelineno-159-184" href="#__codelineno-159-184"></a><span class="go">        * 5765 MHz [153] </span>
</span><span id="__span-159-185"><a id="__codelineno-159-185" name="__codelineno-159-185" href="#__codelineno-159-185"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-186"><a id="__codelineno-159-186" name="__codelineno-159-186" href="#__codelineno-159-186"></a><span class="go">          No IR</span>
</span><span id="__span-159-187"><a id="__codelineno-159-187" name="__codelineno-159-187" href="#__codelineno-159-187"></a><span class="go">          Channel widths: 20MHz HT40- VHT80</span>
</span><span id="__span-159-188"><a id="__codelineno-159-188" name="__codelineno-159-188" href="#__codelineno-159-188"></a><span class="go">        * 5785 MHz [157] </span>
</span><span id="__span-159-189"><a id="__codelineno-159-189" name="__codelineno-159-189" href="#__codelineno-159-189"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-190"><a id="__codelineno-159-190" name="__codelineno-159-190" href="#__codelineno-159-190"></a><span class="go">          No IR</span>
</span><span id="__span-159-191"><a id="__codelineno-159-191" name="__codelineno-159-191" href="#__codelineno-159-191"></a><span class="go">          Channel widths: 20MHz HT40+ VHT80</span>
</span><span id="__span-159-192"><a id="__codelineno-159-192" name="__codelineno-159-192" href="#__codelineno-159-192"></a><span class="go">        * 5805 MHz [161] </span>
</span><span id="__span-159-193"><a id="__codelineno-159-193" name="__codelineno-159-193" href="#__codelineno-159-193"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-194"><a id="__codelineno-159-194" name="__codelineno-159-194" href="#__codelineno-159-194"></a><span class="go">          No IR</span>
</span><span id="__span-159-195"><a id="__codelineno-159-195" name="__codelineno-159-195" href="#__codelineno-159-195"></a><span class="go">          Channel widths: 20MHz HT40- VHT80</span>
</span><span id="__span-159-196"><a id="__codelineno-159-196" name="__codelineno-159-196" href="#__codelineno-159-196"></a><span class="go">        * 5825 MHz [165] </span>
</span><span id="__span-159-197"><a id="__codelineno-159-197" name="__codelineno-159-197" href="#__codelineno-159-197"></a><span class="go">          Maximum TX power: 22.0 dBm</span>
</span><span id="__span-159-198"><a id="__codelineno-159-198" name="__codelineno-159-198" href="#__codelineno-159-198"></a><span class="go">          No IR</span>
</span><span id="__span-159-199"><a id="__codelineno-159-199" name="__codelineno-159-199" href="#__codelineno-159-199"></a><span class="go">          Channel widths: 20MHz</span>
</span><span id="__span-159-200"><a id="__codelineno-159-200" name="__codelineno-159-200" href="#__codelineno-159-200"></a><span class="go">        * 5845 MHz [169] (disabled)</span>
</span><span id="__span-159-201"><a id="__codelineno-159-201" name="__codelineno-159-201" href="#__codelineno-159-201"></a><span class="go">        * 5865 MHz [173] (disabled)</span>
</span><span id="__span-159-202"><a id="__codelineno-159-202" name="__codelineno-159-202" href="#__codelineno-159-202"></a><span class="go">        * 5885 MHz [177] (disabled)</span>
</span><span id="__span-159-203"><a id="__codelineno-159-203" name="__codelineno-159-203" href="#__codelineno-159-203"></a><span class="go">        * 5905 MHz [181] (disabled)</span>
</span><span id="__span-159-204"><a id="__codelineno-159-204" name="__codelineno-159-204" href="#__codelineno-159-204"></a><span class="go">Band 4:</span>
</span><span id="__span-159-205"><a id="__codelineno-159-205" name="__codelineno-159-205" href="#__codelineno-159-205"></a><span class="go">        * 5955 MHz [1] (disabled)</span>
</span><span id="__span-159-206"><a id="__codelineno-159-206" name="__codelineno-159-206" href="#__codelineno-159-206"></a><span class="go">        * 5975 MHz [5] (disabled)</span>
</span><span id="__span-159-207"><a id="__codelineno-159-207" name="__codelineno-159-207" href="#__codelineno-159-207"></a><span class="go">        * 5995 MHz [9] (disabled)</span>
</span><span id="__span-159-208"><a id="__codelineno-159-208" name="__codelineno-159-208" href="#__codelineno-159-208"></a><span class="go">        * 6015 MHz [13] (disabled)</span>
</span><span id="__span-159-209"><a id="__codelineno-159-209" name="__codelineno-159-209" href="#__codelineno-159-209"></a><span class="go">        * 6035 MHz [17] (disabled)</span>
</span><span id="__span-159-210"><a id="__codelineno-159-210" name="__codelineno-159-210" href="#__codelineno-159-210"></a><span class="go">        * 6055 MHz [21] (disabled)</span>
</span><span id="__span-159-211"><a id="__codelineno-159-211" name="__codelineno-159-211" href="#__codelineno-159-211"></a><span class="go">        * 6075 MHz [25] (disabled)</span>
</span><span id="__span-159-212"><a id="__codelineno-159-212" name="__codelineno-159-212" href="#__codelineno-159-212"></a><span class="go">        * 6095 MHz [29] (disabled)</span>
</span><span id="__span-159-213"><a id="__codelineno-159-213" name="__codelineno-159-213" href="#__codelineno-159-213"></a><span class="go">        * 6115 MHz [33] (disabled)</span>
</span><span id="__span-159-214"><a id="__codelineno-159-214" name="__codelineno-159-214" href="#__codelineno-159-214"></a><span class="go">        * 6135 MHz [37] (disabled)</span>
</span><span id="__span-159-215"><a id="__codelineno-159-215" name="__codelineno-159-215" href="#__codelineno-159-215"></a><span class="go">        * 6155 MHz [41] (disabled)</span>
</span><span id="__span-159-216"><a id="__codelineno-159-216" name="__codelineno-159-216" href="#__codelineno-159-216"></a><span class="go">        * 6175 MHz [45] (disabled)</span>
</span><span id="__span-159-217"><a id="__codelineno-159-217" name="__codelineno-159-217" href="#__codelineno-159-217"></a><span class="go">        * 6195 MHz [49] (disabled)</span>
</span><span id="__span-159-218"><a id="__codelineno-159-218" name="__codelineno-159-218" href="#__codelineno-159-218"></a><span class="go">        * 6215 MHz [53] (disabled)</span>
</span><span id="__span-159-219"><a id="__codelineno-159-219" name="__codelineno-159-219" href="#__codelineno-159-219"></a><span class="go">        * 6235 MHz [57] (disabled)</span>
</span><span id="__span-159-220"><a id="__codelineno-159-220" name="__codelineno-159-220" href="#__codelineno-159-220"></a><span class="go">        * 6255 MHz [61] (disabled)</span>
</span><span id="__span-159-221"><a id="__codelineno-159-221" name="__codelineno-159-221" href="#__codelineno-159-221"></a><span class="go">        * 6275 MHz [65] (disabled)</span>
</span><span id="__span-159-222"><a id="__codelineno-159-222" name="__codelineno-159-222" href="#__codelineno-159-222"></a><span class="go">        * 6295 MHz [69] (disabled)</span>
</span><span id="__span-159-223"><a id="__codelineno-159-223" name="__codelineno-159-223" href="#__codelineno-159-223"></a><span class="go">        * 6315 MHz [73] (disabled)</span>
</span><span id="__span-159-224"><a id="__codelineno-159-224" name="__codelineno-159-224" href="#__codelineno-159-224"></a><span class="go">        * 6335 MHz [77] (disabled)</span>
</span><span id="__span-159-225"><a id="__codelineno-159-225" name="__codelineno-159-225" href="#__codelineno-159-225"></a><span class="go">        * 6355 MHz [81] (disabled)</span>
</span><span id="__span-159-226"><a id="__codelineno-159-226" name="__codelineno-159-226" href="#__codelineno-159-226"></a><span class="go">        * 6375 MHz [85] (disabled)</span>
</span><span id="__span-159-227"><a id="__codelineno-159-227" name="__codelineno-159-227" href="#__codelineno-159-227"></a><span class="go">        * 6395 MHz [89] (disabled)</span>
</span><span id="__span-159-228"><a id="__codelineno-159-228" name="__codelineno-159-228" href="#__codelineno-159-228"></a><span class="go">        * 6415 MHz [93] (disabled)</span>
</span><span id="__span-159-229"><a id="__codelineno-159-229" name="__codelineno-159-229" href="#__codelineno-159-229"></a><span class="go">        * 6435 MHz [97] (disabled)</span>
</span><span id="__span-159-230"><a id="__codelineno-159-230" name="__codelineno-159-230" href="#__codelineno-159-230"></a><span class="go">        * 6455 MHz [101] (disabled)</span>
</span><span id="__span-159-231"><a id="__codelineno-159-231" name="__codelineno-159-231" href="#__codelineno-159-231"></a><span class="go">        * 6475 MHz [105] (disabled)</span>
</span><span id="__span-159-232"><a id="__codelineno-159-232" name="__codelineno-159-232" href="#__codelineno-159-232"></a><span class="go">        * 6495 MHz [109] (disabled)</span>
</span><span id="__span-159-233"><a id="__codelineno-159-233" name="__codelineno-159-233" href="#__codelineno-159-233"></a><span class="go">        * 6515 MHz [113] (disabled)</span>
</span><span id="__span-159-234"><a id="__codelineno-159-234" name="__codelineno-159-234" href="#__codelineno-159-234"></a><span class="go">        * 6535 MHz [117] (disabled)</span>
</span><span id="__span-159-235"><a id="__codelineno-159-235" name="__codelineno-159-235" href="#__codelineno-159-235"></a><span class="go">        * 6555 MHz [121] (disabled)</span>
</span><span id="__span-159-236"><a id="__codelineno-159-236" name="__codelineno-159-236" href="#__codelineno-159-236"></a><span class="go">        * 6575 MHz [125] (disabled)</span>
</span><span id="__span-159-237"><a id="__codelineno-159-237" name="__codelineno-159-237" href="#__codelineno-159-237"></a><span class="go">        * 6595 MHz [129] (disabled)</span>
</span><span id="__span-159-238"><a id="__codelineno-159-238" name="__codelineno-159-238" href="#__codelineno-159-238"></a><span class="go">        * 6615 MHz [133] (disabled)</span>
</span><span id="__span-159-239"><a id="__codelineno-159-239" name="__codelineno-159-239" href="#__codelineno-159-239"></a><span class="go">        * 6635 MHz [137] (disabled)</span>
</span><span id="__span-159-240"><a id="__codelineno-159-240" name="__codelineno-159-240" href="#__codelineno-159-240"></a><span class="go">        * 6655 MHz [141] (disabled)</span>
</span><span id="__span-159-241"><a id="__codelineno-159-241" name="__codelineno-159-241" href="#__codelineno-159-241"></a><span class="go">        * 6675 MHz [145] (disabled)</span>
</span><span id="__span-159-242"><a id="__codelineno-159-242" name="__codelineno-159-242" href="#__codelineno-159-242"></a><span class="go">        * 6695 MHz [149] (disabled)</span>
</span><span id="__span-159-243"><a id="__codelineno-159-243" name="__codelineno-159-243" href="#__codelineno-159-243"></a><span class="go">        * 6715 MHz [153] (disabled)</span>
</span><span id="__span-159-244"><a id="__codelineno-159-244" name="__codelineno-159-244" href="#__codelineno-159-244"></a><span class="go">        * 6735 MHz [157] (disabled)</span>
</span><span id="__span-159-245"><a id="__codelineno-159-245" name="__codelineno-159-245" href="#__codelineno-159-245"></a><span class="go">        * 6755 MHz [161] (disabled)</span>
</span><span id="__span-159-246"><a id="__codelineno-159-246" name="__codelineno-159-246" href="#__codelineno-159-246"></a><span class="go">        * 6775 MHz [165] (disabled)</span>
</span><span id="__span-159-247"><a id="__codelineno-159-247" name="__codelineno-159-247" href="#__codelineno-159-247"></a><span class="go">        * 6795 MHz [169] (disabled)</span>
</span><span id="__span-159-248"><a id="__codelineno-159-248" name="__codelineno-159-248" href="#__codelineno-159-248"></a><span class="go">        * 6815 MHz [173] (disabled)</span>
</span><span id="__span-159-249"><a id="__codelineno-159-249" name="__codelineno-159-249" href="#__codelineno-159-249"></a><span class="go">        * 6835 MHz [177] (disabled)</span>
</span><span id="__span-159-250"><a id="__codelineno-159-250" name="__codelineno-159-250" href="#__codelineno-159-250"></a><span class="go">        * 6855 MHz [181] (disabled)</span>
</span><span id="__span-159-251"><a id="__codelineno-159-251" name="__codelineno-159-251" href="#__codelineno-159-251"></a><span class="go">        * 6875 MHz [185] (disabled)</span>
</span><span id="__span-159-252"><a id="__codelineno-159-252" name="__codelineno-159-252" href="#__codelineno-159-252"></a><span class="go">        * 6895 MHz [189] (disabled)</span>
</span><span id="__span-159-253"><a id="__codelineno-159-253" name="__codelineno-159-253" href="#__codelineno-159-253"></a><span class="go">        * 6915 MHz [193] (disabled)</span>
</span><span id="__span-159-254"><a id="__codelineno-159-254" name="__codelineno-159-254" href="#__codelineno-159-254"></a><span class="go">        * 6935 MHz [197] (disabled)</span>
</span><span id="__span-159-255"><a id="__codelineno-159-255" name="__codelineno-159-255" href="#__codelineno-159-255"></a><span class="go">        * 6955 MHz [201] (disabled)</span>
</span><span id="__span-159-256"><a id="__codelineno-159-256" name="__codelineno-159-256" href="#__codelineno-159-256"></a><span class="go">        * 6975 MHz [205] (disabled)</span>
</span><span id="__span-159-257"><a id="__codelineno-159-257" name="__codelineno-159-257" href="#__codelineno-159-257"></a><span class="go">        * 6995 MHz [209] (disabled)</span>
</span><span id="__span-159-258"><a id="__codelineno-159-258" name="__codelineno-159-258" href="#__codelineno-159-258"></a><span class="go">        * 7015 MHz [213] (disabled)</span>
</span><span id="__span-159-259"><a id="__codelineno-159-259" name="__codelineno-159-259" href="#__codelineno-159-259"></a><span class="go">        * 7035 MHz [217] (disabled)</span>
</span><span id="__span-159-260"><a id="__codelineno-159-260" name="__codelineno-159-260" href="#__codelineno-159-260"></a><span class="go">        * 7055 MHz [221] (disabled)</span>
</span><span id="__span-159-261"><a id="__codelineno-159-261" name="__codelineno-159-261" href="#__codelineno-159-261"></a><span class="go">        * 7075 MHz [225] (disabled)</span>
</span><span id="__span-159-262"><a id="__codelineno-159-262" name="__codelineno-159-262" href="#__codelineno-159-262"></a><span class="go">        * 7095 MHz [229] (disabled)</span>
</span><span id="__span-159-263"><a id="__codelineno-159-263" name="__codelineno-159-263" href="#__codelineno-159-263"></a><span class="go">        * 7115 MHz [233] (disabled)</span>
</span></code></pre></div>
</details>
<p>This means the card is prohibited from being the "master" (Access Point) on these
channels because it doesn't have regulatory permission to broadcast until it first
hears an existing authorized AP on that frequency. In contrast, the output for 2.4GHz
(2402-2437 MHz) does not have the <code>No IR</code> or <code>PASSIVE-SCAN</code> restriction, meaning it is
guaranteed to work in AP mode.</p>
<h4 id="confimed-failed-attempt">Confimed failed attempt</h4>
<p>Because of the <code>PASSIVE-SCAN</code> flags, it was foreseeable that <code>hostapd</code> might refuse to
start. An attempt was made to force it by adding the <code>ieee80211d=1</code> (Country Code
broadcasting) and <code>ieee80211h=1</code> (DFS support) flags.</p>
<p>UniFi is using channels 38 and 44 at 40MHz and channels 140, 149 and 157 are marked as
"Not available in your region". At 80MHz only channel 42 is in use, while channels 132
and 149 are marked as "Not available in your region". This leaves only a small window
available: the "DFS" Option, channels 52 through 140 are available but require <strong>DFS</strong>
(Dynamic Frequency Selection). The card shows these as DFS and <code>PASSIVE-SCAN</code>. Channel
52 is the only one outside the range of UniFi APs and is generally supported by most
devices.</p>
<p>The attempt failed due to the foreseen hardware limitations; after trying to start
the <code>hostapd</code> service it failed with <code>DFS start_dfs_cac() failed</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-160-1"><a id="__codelineno-160-1" name="__codelineno-160-1" href="#__codelineno-160-1"></a><span class="gp"># </span>systemctl<span class="w"> </span>status<span class="w"> </span>hostapd.service
</span><span id="__span-160-2"><a id="__codelineno-160-2" name="__codelineno-160-2" href="#__codelineno-160-2"></a><span class="go"> hostapd.service - Access point and authentication server for Wi-Fi and Ethernet</span>
</span><span id="__span-160-3"><a id="__codelineno-160-3" name="__codelineno-160-3" href="#__codelineno-160-3"></a><span class="go">     Loaded: loaded (/usr/lib/systemd/system/hostapd.service; enabled; preset: enabled)</span>
</span><span id="__span-160-4"><a id="__codelineno-160-4" name="__codelineno-160-4" href="#__codelineno-160-4"></a><span class="go">     Active: activating (auto-restart) (Result: exit-code) since Thu 2026-01-22 07:01:57 CET; 1s ago</span>
</span><span id="__span-160-5"><a id="__codelineno-160-5" name="__codelineno-160-5" href="#__codelineno-160-5"></a><span class="go">       Docs: man:hostapd(8)</span>
</span><span id="__span-160-6"><a id="__codelineno-160-6" name="__codelineno-160-6" href="#__codelineno-160-6"></a><span class="go">    Process: 1166743 ExecStart=/usr/sbin/hostapd -B -P /run/hostapd.pid $DAEMON_OPTS ${DAEMON_CONF} (code=exited, status=1/FAILURE)</span>
</span><span id="__span-160-7"><a id="__codelineno-160-7" name="__codelineno-160-7" href="#__codelineno-160-7"></a><span class="go">        CPU: 4ms</span>
</span><span id="__span-160-8"><a id="__codelineno-160-8" name="__codelineno-160-8" href="#__codelineno-160-8"></a>
</span><span id="__span-160-9"><a id="__codelineno-160-9" name="__codelineno-160-9" href="#__codelineno-160-9"></a><span class="go">Jan 22 07:02:00 octavo systemd[1]: Starting hostapd.service - Access point and authentication server for Wi-Fi and Ethernet...</span>
</span><span id="__span-160-10"><a id="__codelineno-160-10" name="__codelineno-160-10" href="#__codelineno-160-10"></a><span class="go">Jan 22 07:02:00 octavo (hostapd)[1167941]: hostapd.service: Referenced but unset environment variable evaluates to an empty string: DAEMON_OPTS</span>
</span><span id="__span-160-11"><a id="__codelineno-160-11" name="__codelineno-160-11" href="#__codelineno-160-11"></a><span class="go">Jan 22 07:02:00 octavo hostapd[1167941]: Failed to set up interface with /etc/hostapd/hostapd.conf</span>
</span><span id="__span-160-12"><a id="__codelineno-160-12" name="__codelineno-160-12" href="#__codelineno-160-12"></a><span class="go">Jan 22 07:02:00 octavo hostapd[1167941]: Failed to initialize interface</span>
</span><span id="__span-160-13"><a id="__codelineno-160-13" name="__codelineno-160-13" href="#__codelineno-160-13"></a><span class="go">Jan 22 07:02:00 octavo systemd[1]: hostapd.service: Control process exited, code=exited, status=1/FAILURE</span>
</span><span id="__span-160-14"><a id="__codelineno-160-14" name="__codelineno-160-14" href="#__codelineno-160-14"></a><span class="go">Jan 22 07:02:00 octavo systemd[1]: hostapd.service: Failed with result 'exit-code'.</span>
</span><span id="__span-160-15"><a id="__codelineno-160-15" name="__codelineno-160-15" href="#__codelineno-160-15"></a><span class="go">Jan 22 07:02:00 octavo systemd[1]: Failed to start hostapd.service - Access point and authentication server for Wi-Fi and Ethernet.</span>
</span><span id="__span-160-16"><a id="__codelineno-160-16" name="__codelineno-160-16" href="#__codelineno-160-16"></a>
</span><span id="__span-160-17"><a id="__codelineno-160-17" name="__codelineno-160-17" href="#__codelineno-160-17"></a><span class="gp"># </span>journalctl<span class="w"> </span>-xeu<span class="w"> </span>hostapd.service
</span><span id="__span-160-18"><a id="__codelineno-160-18" name="__codelineno-160-18" href="#__codelineno-160-18"></a><span class="go">Jan 22 07:04:32 octavo (hostapd)[1241470]: hostapd.service: Referenced but unset environment variable evaluates to an empty string: DAEMON_OPTS</span>
</span><span id="__span-160-19"><a id="__codelineno-160-19" name="__codelineno-160-19" href="#__codelineno-160-19"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: wlo1: interface state UNINITIALIZED-&gt;COUNTRY_UPDATE</span>
</span><span id="__span-160-20"><a id="__codelineno-160-20" name="__codelineno-160-20" href="#__codelineno-160-20"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: wlo1: interface state COUNTRY_UPDATE-&gt;DFS</span>
</span><span id="__span-160-21"><a id="__codelineno-160-21" name="__codelineno-160-21" href="#__codelineno-160-21"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: wlo1: DFS-CAC-START freq=5260 chan=52 sec_chan=0, width=0, seg0=0, seg1=0, cac_time=60s</span>
</span><span id="__span-160-22"><a id="__codelineno-160-22" name="__codelineno-160-22" href="#__codelineno-160-22"></a><span class="hll"><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: DFS start_dfs_cac() failed, -1</span>
</span></span><span id="__span-160-23"><a id="__codelineno-160-23" name="__codelineno-160-23" href="#__codelineno-160-23"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: Interface initialization failed</span>
</span><span id="__span-160-24"><a id="__codelineno-160-24" name="__codelineno-160-24" href="#__codelineno-160-24"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: wlo1: interface state DFS-&gt;DISABLED</span>
</span><span id="__span-160-25"><a id="__codelineno-160-25" name="__codelineno-160-25" href="#__codelineno-160-25"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: wlo1: AP-DISABLED</span>
</span><span id="__span-160-26"><a id="__codelineno-160-26" name="__codelineno-160-26" href="#__codelineno-160-26"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: wlo1: Unable to setup interface.</span>
</span><span id="__span-160-27"><a id="__codelineno-160-27" name="__codelineno-160-27" href="#__codelineno-160-27"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: wlo1: interface state DISABLED-&gt;DISABLED</span>
</span><span id="__span-160-28"><a id="__codelineno-160-28" name="__codelineno-160-28" href="#__codelineno-160-28"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: wlo1: AP-DISABLED</span>
</span><span id="__span-160-29"><a id="__codelineno-160-29" name="__codelineno-160-29" href="#__codelineno-160-29"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: wlo1: CTRL-EVENT-TERMINATING</span>
</span><span id="__span-160-30"><a id="__codelineno-160-30" name="__codelineno-160-30" href="#__codelineno-160-30"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: hostapd_free_hapd_data: Interface wlo1 wasn't started</span>
</span><span id="__span-160-31"><a id="__codelineno-160-31" name="__codelineno-160-31" href="#__codelineno-160-31"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: nl80211: deinit ifname=wlo1 disabled_11b_rates=0</span>
</span><span id="__span-160-32"><a id="__codelineno-160-32" name="__codelineno-160-32" href="#__codelineno-160-32"></a><span class="go">Jan 22 07:04:33 octavo hostapd[1241470]: nl80211: Failed to remove interface wlo1 from bridge br0: Invalid argument</span>
</span><span id="__span-160-33"><a id="__codelineno-160-33" name="__codelineno-160-33" href="#__codelineno-160-33"></a><span class="go">Jan 22 07:04:33 octavo systemd[1]: hostapd.service: Control process exited, code=exited, status=1/FAILURE</span>
</span></code></pre></div>







  
  



  


  



<script src="https://giscus.app/client.js" data-repo="stibbons1990/hex" data-repo-id="R_kgDOKXTsSg" data-category="Announcements" data-category-id="DIC_kwDOKXTsSs4CqHDX" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="1" data-input-position="top" data-theme="preferred_color_scheme" data-lang="en" crossorigin="anonymous" async>
</script>

      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../../../03/28/remote-access-options-for-self-hosted-services/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Remote access options for self-hosted services">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Remote access options for self-hosted services
              </div>
            </div>
          </a>
        
        
          
          <a href="../../18/synology-ds423-for-the-homelab-luggage/" class="md-footer__link md-footer__link--next" aria-label="Next: Synology DS423+ for the homelab (luggage)">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Synology DS423+ for the homelab (luggage)
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright  2019-2025 Ponder Stibbons
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../../..", "features": ["content.code.copy", "navigation.expand", "navigation.footer", "navigation.top", "search.highlight", "search.suggest"], "search": "../../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>