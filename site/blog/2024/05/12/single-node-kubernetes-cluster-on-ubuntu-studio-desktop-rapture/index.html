
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://stibbons1990.github.io/hex/blog/2024/05/12/single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/">
      
      
        <link rel="prev" href="../../04/getting-started-with-fallout-3-and-4-goty/">
      
      
        <link rel="next" href="../../19/self-hosted-accountancy-with-firefly-iii/">
      
      
      <link rel="icon" href="../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.0">
    
    
      
        <title>Single-node Kubernetes cluster on Ubuntu Studio desktop (rapture) - Inadvisably Applied Magic</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.9f615399.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.649f08f9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-Y167L3ZVGY"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-Y167L3ZVGY",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-Y167L3ZVGY",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="green">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#motivation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Inadvisably Applied Magic" class="md-header__button md-logo" aria-label="Inadvisably Applied Magic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="m64 416 104.6-235.3c15.3-34.4 40.3-63.5 72-83.7L387.5 3c3-1.9 6.5-2.9 10-2.9C407.7 0 416 8.3 416 18.6v1.6c0 2.6-.5 5.1-1.4 7.5l-59.8 149.2c-1.9 4.7-2.8 9.7-2.8 14.7 0 5.5 1.2 11 3.4 16.1L448 416H240.9l11.8-35.4 40.4-13.5c6.5-2.2 10.9-8.3 10.9-15.2s-4.4-13-10.9-15.2l-40.4-13.5-13.5-40.4c-2.2-6.4-8.3-10.8-15.2-10.8s-13 4.4-15.2 10.9l-13.5 40.4-40.4 13.5c-6.5 2.2-10.9 8.3-10.9 15.2s4.4 13 10.9 15.2l40.4 13.5 11.8 35.3H64zm215.6-274.5c-1.1-3.3-4.1-5.5-7.6-5.5s-6.5 2.2-7.6 5.5l-6.7 20.2-20.2 6.7c-3.3 1.1-5.5 4.1-5.5 7.6s2.2 6.5 5.5 7.6l20.2 6.7 6.7 20.2c1.1 3.3 4.1 5.5 7.6 5.5s6.5-2.2 7.6-5.5l6.7-20.2 20.2-6.7c3.3-1.1 5.5-4.1 5.5-7.6s-2.2-6.5-5.5-7.6l-20.2-6.7-6.7-20.2zM32 448h448c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Inadvisably Applied Magic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Single-node Kubernetes cluster on Ubuntu Studio desktop (rapture)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="green"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="green"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Inadvisably Applied Magic" class="md-nav__button md-logo" aria-label="Inadvisably Applied Magic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="m64 416 104.6-235.3c15.3-34.4 40.3-63.5 72-83.7L387.5 3c3-1.9 6.5-2.9 10-2.9C407.7 0 416 8.3 416 18.6v1.6c0 2.6-.5 5.1-1.4 7.5l-59.8 149.2c-1.9 4.7-2.8 9.7-2.8 14.7 0 5.5 1.2 11 3.4 16.1L448 416H240.9l11.8-35.4 40.4-13.5c6.5-2.2 10.9-8.3 10.9-15.2s-4.4-13-10.9-15.2l-40.4-13.5-13.5-40.4c-2.2-6.4-8.3-10.8-15.2-10.8s-13 4.4-15.2 10.9l-13.5 40.4-40.4 13.5c-6.5 2.2-10.9 8.3-10.9 15.2s4.4 13 10.9 15.2l40.4 13.5 11.8 35.3H64zm215.6-274.5c-1.1-3.3-4.1-5.5-7.6-5.5s-6.5 2.2-7.6 5.5l-6.7 20.2-20.2 6.7c-3.3 1.1-5.5 4.1-5.5 7.6s2.2 6.5 5.5 7.6l20.2 6.7 6.7 20.2c1.1 3.3 4.1 5.5 7.6 5.5s6.5-2.2 7.6-5.5l6.7-20.2 20.2-6.7c3.3-1.1 5.5-4.1 5.5-7.6s-2.2-6.5-5.5-7.6l-20.2-6.7-6.7-20.2zM32 448h448c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32z"/></svg>

    </a>
    Inadvisably Applied Magic
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About This Place
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../conmon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Continuous Monitoring
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unexpected Linux Adventures
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Archive
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2024
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2022/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2020/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2020
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2019/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2019
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Categories
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/monitoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    monitoring
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/tapo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tapo
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/linux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    linux
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/ubuntu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ubuntu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/github/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    github
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/markdown/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    markdown
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/blog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    blog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/migration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    migration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/mkdocs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mkdocs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/material/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    material
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/intel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    intel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/nuc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nuc
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/kubernetes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/server/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    server
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/self-hosted/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    self-hosted
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/music/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    music
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/streaming/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    streaming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/media/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    media
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/navidrome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    navidrome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/dns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/photo-albums/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    photo-albums
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/photoprism/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    photoprism
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/homebox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    homebox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/inventory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    inventory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/activitywatch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ActivityWatch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/time-tracking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    time-tracking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/ebook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/komga/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    komga
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/firefly-iii/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    firefly-iii
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/studio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    studio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/desktop/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    desktop
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/steam/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    steam
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/proton/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    proton
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/videogames/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    videogames
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/bethesda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bethesda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/fallout/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fallout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/raspberrypi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    raspberrypi
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/influxdb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    influxdb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/grafana/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    grafana
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/minecraft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    minecraft
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/java/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    java
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/bedrock/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bedrock
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/audiobookshelf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    audiobookshelf
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/audiobooks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    audiobooks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/encryption/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    encryption
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/veracrypt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    veracrypt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/luks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    luks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/cryptsetup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cryptsetup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/displaycal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    displaycal
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/skyrim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    skyrim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/mods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mods
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/audio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    audio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/recording/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    recording
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/alsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    alsa
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/headphones/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    headphones
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/ea/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ea
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/bioware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    bioware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/jekyll/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    jekyll
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/plex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    plex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/xhci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    xhci
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/usb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    usb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/hardware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hardware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/failure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    failure
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/workaround/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    workaround
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/asus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    asus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/mediatek/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mediatek
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/glitch/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    glitch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/timeout/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    timeout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/keyboard/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    keyboard
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/macropad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    macropad
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/qmk/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    qmk
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/firmware/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    firmware
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/vscode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vscode
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/nvidia/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nvidia
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/troubleshooting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    troubleshooting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/gpuburn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gpuburn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/cuda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cuda
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/crucial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    crucial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/ssd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ssd
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/locales/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    locales
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/chrome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    chrome
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/firefox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    firefox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/raid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RAID
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/btrfs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Btrfs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/intel-nuc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intel NUC
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/audible/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Audible
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/bash/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bash
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../category/mp3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    MP3
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    Motivation
  </a>
  
    <nav class="md-nav" aria-label="Motivation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#more-motivation" class="md-nav__link">
    More Motivation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github-repository" class="md-nav__link">
    GitHub Repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-kubernetes" class="md-nav__link">
    Install Kubernetes
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-container-runtime" class="md-nav__link">
    Install container runtime
  </a>
  
    <nav class="md-nav" aria-label="Install container runtime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-containerd" class="md-nav__link">
    Install containerd
  </a>
  
    <nav class="md-nav" aria-label="Install containerd">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuration-tweaks-for-containerd-and-docker" class="md-nav__link">
    Configuration tweaks for containerd and Docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bootstrap-the-cluster-with-kubeadm" class="md-nav__link">
    Bootstrap the cluster with kubeadm
  </a>
  
    <nav class="md-nav" aria-label="Bootstrap the cluster with kubeadm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#initialize-control-plane" class="md-nav__link">
    Initialize control-plane
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#network-plugin" class="md-nav__link">
    Network plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enable-single-node-cluster-as-worker-node" class="md-nav__link">
    Enable single-node cluster as Worker node
  </a>
  
    <nav class="md-nav" aria-label="Enable single-node cluster as Worker node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#test-pod-scheduling" class="md-nav__link">
    Test Pod Scheduling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#do-not-kubeadm-join" class="md-nav__link">
    DO NOT kubeadm join
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#metallb-load-balancer" class="md-nav__link">
    MetalLB Load Balancer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kubernets-dashboard" class="md-nav__link">
    Kubernets Dashboard
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ingress-controller" class="md-nav__link">
    Ingress Controller
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#https-with-lets-encrypt" class="md-nav__link">
    HTTPS with Letâ€™s Encrypt
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#localpath-pv-provisioner" class="md-nav__link">
    LocalPath PV provisioner
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#audiobookshelf" class="md-nav__link">
    Audiobookshelf
  </a>
  
    <nav class="md-nav" aria-label="Audiobookshelf">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#migration-from-lexicon" class="md-nav__link">
    Migration from Lexicon
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plex-media-server" class="md-nav__link">
    Plex Media Server
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__title">
                <div class="md-nav__link">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
              </li>
              <li class="md-nav__item">
                <div class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5v-5Z"/></svg>
                  <time datetime="2024-05-12 00:00:00" class="md-ellipsis">May 12, 2024</time>
                </div>
              </li>
              
              
                <li class="md-nav__item">
                  <div class="md-nav__link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3H9m3 2 4 13 3-1-4-13-3 1M5 5v13h3V5H5M3 19v2h18v-2H3Z"/></svg>
                    <span class="md-ellipsis">
                      in
                      
                        <a href="../../../../category/ubuntu/">ubuntu</a>, 
                        <a href="../../../../category/studio/">studio</a>, 
                        <a href="../../../../category/desktop/">desktop</a>, 
                        <a href="../../../../category/linux/">linux</a>, 
                        <a href="../../../../category/kubernetes/">kubernetes</a>, 
                        <a href="../../../../category/docker/">docker</a></span>
                  </div>
                </li>
              
              
                
                <li class="md-nav__item">
                  <div class="md-nav__link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5Z"/></svg>
                    <span class="md-ellipsis">
                      
                        47 min read
                      
                    </span>
                  </div>
                </li>
              
            </ul>
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        


  <h1>Single-node Kubernetes cluster on Ubuntu Studio desktop (rapture)</h1>

<div><p>For a bit more than a year, I've been running self-hosted
services on a
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/">single-node Kubernetes cluster on Ubuntu server</a>
and, while it has presented some troubles to shoot, I have
grown used to the advantages of deploying services far more
easily, without having to worry too much about their
dependencies, getting automatic updates, and even making many
of them available over HTTPS with good SSL certificates.
Now I want to <em>enjoy</em> some of those advantages in my desktop
PC: <strong>Rapture</strong>.</p>
<!-- more -->

<h2 id="motivation">Motivation</h2>
<p>In the last couple of months, a couple of <em>incidents</em> have left
me thinking it may be time to upgrade the cluster.</p>
<p>First, following the removal of
<a href="https://kubernetes.io/blog/2023/08/31/legacy-package-repository-deprecation/">Legacy Package Repositories</a>,
I had to
<a href="../../../03/05/updating-kubernetes-to-the-community-owned-package-repositories/">update Kubernetes to the Community-Owned Package Repositories</a>,
which didn't <em>directly</em> break anything but there <em>was</em>
<a href="../../../03/05/updating-kubernetes-to-the-community-owned-package-repositories/#an-unexpected-breakage">an unexpected breakage</a>
due to a
<a href="https://kubernetes.io/releases/version-skew-policy/#supported-versions">minor version mismatch</a>,
after which the cluster was left at version <strong>1.26</strong> as this
was the one originall installed for the
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/">single-node Kubernetes cluster on</a>.</p>
<p>Then, just a few weeks later, the
<a href="../../../03/22/kubernetes-certificate-expired/">Kubernetes Certificate Expired</a>
and eventually the solution was to perform a cumbersome
<a href="../../../03/22/kubernetes-certificate-expired/#manual-certificate-renewal">manual certificate renewal</a>.
While I'm still not entirely convince that it <em>will</em> work,
apparently certificates <em>should</em> be automatically renewed when
the Kubernetes cluster is upgraded to a higher <em>minor version</em>.</p>
<p>These left me with the nagging feeling that Kubernetes clusters
need to be periodically upgraded, but the stark impression that
<em>one does not simply upgrade</em>, even though at least 
<a href="https://philpep.org/blog/kubernetes-the-self-hosted-way/">Philpep's Kubernetes the self-hosted single node way</a>
claims <em>it wasn't so bad</em>:</p>
<blockquote>
<p>Handling upgrade with kubeadm is quite simple as long as you
read the upgrade notes carefully. For the latest releases
I just ran:
</p><div class="language-console highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">$ </span><span class="nb">export</span><span class="w"> </span><span class="nv">v</span><span class="o">=</span><span class="m">1</span>.14.1
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">$ </span>apt-get<span class="w"> </span>update
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">$ </span>apt-get<span class="w"> </span>install<span class="w"> </span><span class="nv">kubeadm</span><span class="o">=</span><span class="nv">$v</span>-00<span class="w"> </span><span class="nv">kubelet</span><span class="o">=</span><span class="nv">$v</span>-00
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">$ </span>kubeadm<span class="w"> </span>upgrade<span class="w"> </span>plan
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="go">[...]</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">$ </span>kubeadm<span class="w"> </span>upgrade<span class="w"> </span>apply<span class="w"> </span>v<span class="nv">$v</span>
</span></code></pre></div>
</blockquote>
<p>At any rate, it would be better to have a second single-node
cluster that is not running <em>critical</em> services, which is only
to say <em>services I would be rather inconvenienced without</em>, if
only to try things out with the peace of mind of not riksing
<em>breaking production the cluster</em>.</p>
<h3 id="more-motivation">More Motivation</h3>
<p>On the other hand, other incidents went rather well, e.g. when
<a href="../../../03/15/getbukkit-expired/">Getbukkit Expired</a>
the solutions where relativly easy to apply and I suspect
it was easier to update a single YAML file and <code>kubectl apply</code>
than applying the same changes on a bespoke environment would
have been.</p>
<p>I have also been wanting to
<a href="../../../../2023/09/16/migrating-a-plex-media-server-to-kubernetes/">migrate Plex Media Server to Kubernetes</a>
on my desktop PC, even though I barely use it.
Precisely because I barely use this one, it would be nice to
deploy it in Kubernetes and forget about it, letting Kubernetes
handle updates which I'm not bothering with (not using it).</p>
<p>I might also want to make more risky experiments with a
<a href="../../../../2023/08/10/running-minecraft-java-server-for-bedrock-clients-on-kubernetes/">Minecraft Java Server for Bedrock clients</a>,
something I'd feel better doing on my PC with a <code>world</code> nobody
care about.</p>
<p>But what I think would be more interesting is trying some other
applications I have not been able to run in Kubernetes so far, mostly because they are much more CPU-hungry than what a low-end
Intel NUC can handle:</p>
<ul>
<li><a href="../../../02/28/audiobookshelf-on-kubernetes/">Audiobookshelf</a> is <em>surprisingly</em> CPU
   intensive, not sure why but it is the one service that makes
   the CPU run hotter on a regular basis, although always in
   short spikes and never much above 100% (a single CPU core).</li>
<li><a href="https://docs.gitlab.com/charts/">GitLab Helm chart</a>
   requires enough CPU to be allocated that, together with
   just the basic single-node cluster allocations, it exceeded
   the limit of the available 4 CPU cores. Besides, running
   <a href="https://docs.gitlab.com/ee/ci/pipelines/">CI/CD pipelines</a>
   would likely take too long on a system with few CPU cores.</li>
<li><a href="https://docs.photoprism.app/getting-started/advanced/kubernetes/">PhotoPrism</a>
   is quite CPU hungry too, as is only to be expected given the
   features it offers, so it would only run well on a high-end
   CPU and that's one I only have on my desktop PC. Besides,
   that PC is the one where the files (photos and videos) live.</li>
</ul>
<h2 id="github-repository">GitHub Repository</h2>
<p>From this point on, adding deployments to the cluster will
be mostly based on YAML files and these are best stored in
a revision controlled environment. A GitHub repository
(e.g. <code>kubernetes-deployments</code>) will do just fine, and with
the idea of later upgrading the cluster to newer versions of
Kubernetes, it may be a good idea to keep deployments in
separate directories for each Kubernetes version:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="gp">$ </span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:xxxx/kubernetes-deployments.git
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span>kubernetes-deployments/
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="gp">$ </span>mkdir<span class="w"> </span><span class="m">1</span>.26
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="gp">$ </span><span class="nb">cd</span><span class="w"> </span><span class="m">1</span>.26
</span></code></pre></div>
<h2 id="install-kubernetes">Install Kubernetes</h2>
<p><a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/#kubernetes">Kubernetes installation in Lexicon</a>
was based on 
<a href="https://computingforgeeks.com/install-kubernetes-cluster-ubuntu-jammy/">Install Kubernetes Cluster on Ubuntu 22.04 using kubeadm</a>,
<a href="https://linuxconfig.org/how-to-install-kubernetes-on-ubuntu-22-04-jammy-jellyfish-linux">How to install Kubernetes on Ubuntu 22.04 Jammy Jellyfish Linux</a>
and
<a href="https://www.linuxtechi.com/install-kubernetes-on-ubuntu-22-04/">How to Install Kubernetes Cluster on Ubuntu 22.04</a>.
These article were all very helpful and I would highly recommend
following them, or their updated versions whenever available,
to anyone getting started with Kubernetes for the first time.</p>
<p>Being now somewhat more familiar with Kubernetes, this time
I will be following the Kubernetes Documentation at
<a href="https://kubernetes.io/docs">kubernetes.io/docs</a> to learn more
details <em>first-hand</em> from the official documentation.</p>
<p>To install the older <strong>1.26</strong> version, which is the one running
in <strong>Lexicon</strong>, so that the future upgrade/s to newer versions
can be tested in <strong>Rapture</strong>, the first step is to jump from the
<a href="https://kubernetes.io/docs/home/supported-doc-versions/">Available Documentation Versions</a>
page to the <a href="https://v1-27.docs.kubernetes.io/docs/home/supported-doc-versions/">1.26 documentation</a>
and from there to the starting point:
<a href="https://v1-27.docs.kubernetes.io/docs/setup/">Getting started</a>.</p>
<p>Right from the start, things get <em>confusing</em>:
<a href="https://v1-27.docs.kubernetes.io/releases/download/">Download Kubernetes</a> lists a number of <em>Container Images</em> and points to
<a href="https://www.downloadkubernetes.com/">downloadkubernetes.com</a>
to find the binaries, but there is no clear indication as to
<em>which</em> binaries are <em>actually required</em>, or recommended.</p>
<p>There is not even a mention of the possiblity to install these
binaries through more convenient means such as the
<em>native package management</em> which is explained only later,
in the documentation to
<a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux">Install and Set Up kubectl on Linux</a>,
in particular
<a href="https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-using-native-package-management">using native package management</a>
for <em>Debian-based distributions</em>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="gp"># </span>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://pkgs.k8s.io/core:/stable:/v1.26/deb/Release.key<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/etc/apt/keyrings/kubernetes-apt-keyring.gpg
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="gp"># </span><span class="nb">echo</span><span class="w"> </span><span class="s1">'deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.26/deb/ /'</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/kubernetes.list
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="go">deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.26/deb/ /</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="gp"># </span>apt-get<span class="w"> </span>update
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="go">...</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="go">Get:4 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.26/deb  InRelease [1,192 B]</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="go">Get:11 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.26/deb  Packages [22.1 kB]</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="gp"># </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>kubectl
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="go">The following NEW packages will be installed:</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="go">  kubectl</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="go">0 upgraded, 1 newly installed, 0 to remove and 13 not upgraded.</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="go">Need to get 10.2 MB of archives.</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="go">After this operation, 48.2 MB of additional disk space will be used.</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="go">Get:1 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.26/deb  kubectl 1.26.15-1.1 [10.2 MB]</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="go">Fetched 10.2 MB in 1s (16.1 MB/s)</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="go">Selecting previously unselected package kubectl.</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="gp gp-VirtualEnv">(Reading database ... 636365 files and directories currently installed.)</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="go">Preparing to unpack .../kubectl_1.26.15-1.1_amd64.deb ...</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="go">Unpacking kubectl (1.26.15-1.1) ...</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="go">Setting up kubectl (1.26.15-1.1) ...</span>
</span></code></pre></div>
<p>Additional commands may be necessary in a brand-new Ubuntu
desktop install, but in my case <code>/etc/apt/keyrings</code> akready
existed and <code>apt-transport-https ca-certificates curl</code> were
all already installed.</p>
<p>With only <code>kubectl</code> installed, pretty much anything that one
can try will (inevitably) fail because there is no cluster to
interact with:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="gp"># </span>kubectl<span class="w"> </span>version<span class="w"> </span>--output<span class="o">=</span>yaml
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="go">clientVersion:</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="go">  buildDate: "2024-03-14T01:05:39Z"</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="go">  compiler: gc</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="go">  gitCommit: 1649f592f1909b97aa3c2a0a8f968a3fd05a7b8b</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="go">  gitTreeState: clean</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="go">  gitVersion: v1.26.15</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="go">  goVersion: go1.21.8</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="go">  major: "1"</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="go">  minor: "26"</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="go">  platform: linux/amd64</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="go">kustomizeVersion: v4.5.7</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="go">The connection to the server localhost:8080 was refused - did you specify the right host or port?</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="gp"># </span>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="go">E0510 20:41:21.723009 2656643 memcache.go:265] couldn't get current server API group list: Get "http://localhost:8080/api?timeout=32s": dial tcp [::1]:8080: connect: connection refused</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="go">E0510 20:41:21.723354 2656643 memcache.go:265] couldn't get current server API group list: Get "http://localhost:8080/api?timeout=32s": dial tcp [::1]:8080: connect: connection refused</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="go">E0510 20:41:21.724591 2656643 memcache.go:265] couldn't get current server API group list: Get "http://localhost:8080/api?timeout=32s": dial tcp [::1]:8080: connect: connection refused</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="go">E0510 20:41:21.724761 2656643 memcache.go:265] couldn't get current server API group list: Get "http://localhost:8080/api?timeout=32s": dial tcp [::1]:8080: connect: connection refused</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="go">E0510 20:41:21.726089 2656643 memcache.go:265] couldn't get current server API group list: Get "http://localhost:8080/api?timeout=32s": dial tcp [::1]:8080: connect: connection refused</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="go">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="go">The connection to the server localhost:8080 was refused - did you specify the right host or port?</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="gp"># </span>kubectl<span class="w"> </span>cluster-info<span class="w"> </span>dump
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="go">The connection to the server localhost:8080 was refused - did you specify the right host or port?</span>
</span></code></pre></div>
<p>In addition to <code>kubectl</code> at least the following 2 packages are
required to start and run a Kubernetes cluster:</p>
<ul>
<li><code>kubeadm</code>: Command-line utility for administering a Kubernetes cluster.</li>
<li><code>kubectl</code>: Command-line utility for interacting with a Kubernetes cluster.</li>
<li><code>kubelet</code>: Node agent for Kubernetes clusters.</li>
</ul>
<p>Although far from being clearly explained, or even mentioned,
<a href="https://www.google.com/search?q=site%3Adocs.kubernetes.io+kubelet+kubeadm">anywhere under docs.kubernetes.io</a>, these
components can be installed as simply <code>kubectl</code>:</p>
<details class="terminal">
<summary><code># apt install -y kubelet kubeadm kubectl</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="gp"># </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>kubelet<span class="w"> </span>kubeadm<span class="w"> </span>kubectl
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="go">kubectl is already the newest version (1.26.15-1.1).</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="go">The following additional packages will be installed:</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="go">  conntrack cri-tools ebtables ethtool kubernetes-cni</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="go">The following NEW packages will be installed:</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="go">  conntrack cri-tools ebtables ethtool kubeadm kubelet kubernetes-cni</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="go">0 upgraded, 7 newly installed, 0 to remove and 13 not upgraded.</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="go">Need to get 77.8 MB of archives.</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="go">After this operation, 296 MB of additional disk space will be used.</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="go">Get:1 http://archive.ubuntu.com/ubuntu jammy/main amd64 conntrack amd64 1:1.4.6-2build2 [33.5 kB]</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="go">Get:2 http://archive.ubuntu.com/ubuntu jammy/main amd64 ebtables amd64 2.0.11-4build2 [84.9 kB]</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="go">Get:4 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 ethtool amd64 1:5.16-1ubuntu0.1 [207 kB]</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="go">Get:3 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.26/deb  cri-tools 1.26.0-1.1 [19.0 MB]</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="go">Get:5 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.26/deb  kubernetes-cni 1.2.0-2.1 [27.6 MB]</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="go">Get:6 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.26/deb  kubelet 1.26.15-1.1 [21.1 MB]</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="go">Get:7 https://prod-cdn.packages.k8s.io/repositories/isv:/kubernetes:/core:/stable:/v1.26/deb  kubeadm 1.26.15-1.1 [9,842 kB]</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="go">Fetched 77.8 MB in 1s (54.5 MB/s)  </span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="go">Selecting previously unselected package conntrack.</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="gp gp-VirtualEnv">(Reading database ... 636369 files and directories currently installed.)</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="go">Preparing to unpack .../0-conntrack_1%3a1.4.6-2build2_amd64.deb ...</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="go">Unpacking conntrack (1:1.4.6-2build2) ...</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="go">Selecting previously unselected package cri-tools.</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="go">Preparing to unpack .../1-cri-tools_1.26.0-1.1_amd64.deb ...</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="go">Unpacking cri-tools (1.26.0-1.1) ...</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="go">Selecting previously unselected package ebtables.</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="go">Preparing to unpack .../2-ebtables_2.0.11-4build2_amd64.deb ...</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="go">Unpacking ebtables (2.0.11-4build2) ...</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="go">Selecting previously unselected package ethtool.</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="go">Preparing to unpack .../3-ethtool_1%3a5.16-1ubuntu0.1_amd64.deb ...</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="go">Unpacking ethtool (1:5.16-1ubuntu0.1) ...</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="go">Selecting previously unselected package kubernetes-cni.</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="go">Preparing to unpack .../4-kubernetes-cni_1.2.0-2.1_amd64.deb ...</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="go">Unpacking kubernetes-cni (1.2.0-2.1) ...</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="go">Selecting previously unselected package kubelet.</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="go">Preparing to unpack .../5-kubelet_1.26.15-1.1_amd64.deb ...</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="go">Unpacking kubelet (1.26.15-1.1) ...</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="go">Selecting previously unselected package kubeadm.</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="go">Preparing to unpack .../6-kubeadm_1.26.15-1.1_amd64.deb ...</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="go">Unpacking kubeadm (1.26.15-1.1) ...</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="go">Setting up conntrack (1:1.4.6-2build2) ...</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="go">Setting up ebtables (2.0.11-4build2) ...</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="go">Setting up cri-tools (1.26.0-1.1) ...</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="go">Setting up kubernetes-cni (1.2.0-2.1) ...</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="go">Setting up ethtool (1:5.16-1ubuntu0.1) ...</span>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="go">Setting up kubelet (1.26.15-1.1) ...</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="go">Setting up kubeadm (1.26.15-1.1) ...</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="go">Processing triggers for man-db (2.10.2-1) ...</span>
</span></code></pre></div>
</details>
<p>Among other tools, this installs other critical components to
run a Kubernetes cluster</p>
<ul>
<li><code>cri-tools</code>: Command-line utility for interacting with a
   container runtime.</li>
<li><code>kubernetes-cni</code>: Binaries required to provision kubernetes
   container networking.</li>
</ul>
<h2 id="install-container-runtime">Install container runtime</h2>
<p>And now we come to the next major steps in the installation of
a new Kubernetes cluster:
<em>select a <a href="https://v1-27.docs.kubernetes.io/docs/setup/production-environment/container-runtimes/">container runtime</a></em>.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p><a href="https://v1-27.docs.kubernetes.io/docs/setup/production-environment/container-runtimes/#forwarding-ipv4-and-letting-iptables-see-bridged-traffic">Forwarding IPv4 and letting iptables see bridged traffic</a>
are already enabled in Ubuntu:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="gp"># </span>lsmod<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s1">'overlay|bridge'</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="go">bridge                311296  1 br_netfilter</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="go">stp                    16384  1 bridge</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="go">llc                    16384  2 bridge,stp</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="go">overlay               151552  1</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="gp"># </span>sysctl<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>egrep<span class="w"> </span><span class="s1">'net.ipv4.ip_forward|net.bridge.bridge-nf-call-ip'</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="go">net.bridge.bridge-nf-call-ip6tables = 1</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="go">net.bridge.bridge-nf-call-iptables = 1</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="go">net.ipv4.ip_forward = 1</span>
</span></code></pre></div>
<p><em>Even so</em>, <strong>these must be enabled explicitly</strong> to avoid issues
later, <a href="../../../09/22/upgrading-single-node-kubernetes-cluster-on-ubuntu-studio-2404/"><em>ask me how I know</em></a>.</p>
<h3 id="install-containerd">Install containerd</h3>
<p>To install containerd, follow the instructions on 
<a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md">getting started with containerd</a>,
in particular
<a href="https://github.com/containerd/containerd/blob/main/docs/getting-started.md#option-2-from-apt-get-or-dnf">Option 2: From <code>apt-get</code></a>
which leads to the instructions to
<a href="https://docs.docker.com/engine/install/ubuntu/">Install Docker Engine on Ubuntu</a>.</p>
<p>Normally this starts by uninstalling conflicting packages, that
is those provided by Ubuntu, before installing the official
version of Docker Engine.
In the case of Rapture, there are a few packages installed
from learning excercises over a year ago:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="gp"># </span><span class="k">for</span><span class="w"> </span>pkg<span class="w"> </span><span class="k">in</span><span class="w"> </span>docker.io<span class="w"> </span>docker-doc<span class="w"> </span>docker-compose<span class="w"> </span>docker-compose-v2<span class="w"> </span>podman-docker<span class="w"> </span>containerd<span class="w"> </span>runc<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="go">  dpkg -l $pkg 2&gt;/dev/null | grep ^ii</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="go">done</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="go">ii  docker.io      24.0.5-0ubuntu1~22.04.1 amd64        Linux container runtime</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="go">ii  docker-compose 1.29.2-1                all          define and run multi-container Docker applications with YAML</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="go">ii  containerd     1.7.2-0ubuntu1~22.04.1  amd64        daemon to control runC</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="go">ii  runc           1.1.7-0ubuntu1~22.04.2  amd64        Open Container Project - runtime</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="gp"># </span>docker<span class="w"> </span>ps
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="go">CONTAINER ID   IMAGE           COMMAND                  CREATED        STATUS        PORTS      NAMES</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="go">e6a7446a39d5   mariadb:10.11   "docker-entrypoint.sâ€¦"   8 months ago   Up 26 hours   3306/tcp   photoprism_mariadb_1</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="gp"># </span>docker<span class="w"> </span>images
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="go">REPOSITORY              TAG       IMAGE ID       CREATED         SIZE</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="go">mariadb                 10.11     58df8de36e1c   8 months ago    403MB</span>
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="go">photoprism/photoprism   latest    c7bf390f2ce9   9 months ago    1.84GB</span>
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="go">website                 latest    e4ff4dff6768   14 months ago   57.5MB</span>
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="go">&lt;none&gt;                  &lt;none&gt;    e000dde7140f   14 months ago   57.5MB</span>
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="go">nginx                   alpine    2bc7edbc3cf2   15 months ago   40.7MB</span>
</span></code></pre></div>
<p>These all begin very old leftovers, they are all to be
thoroughly removed:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="gp"># </span>apt-get<span class="w"> </span>purge<span class="w"> </span>-y<span class="w"> </span>docker.io<span class="w"> </span>docker-compose<span class="w"> </span>containerd<span class="w"> </span>runc
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="go">The following packages were automatically installed and are no longer required:</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="go">  bridge-utils pigz python3-docker python3-dockerpty python3-dotenv python3-jsonschema</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="go">  python3-pyrsistent python3-texttable python3-websocket ubuntu-fan</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="go">Use 'apt autoremove' to remove them.</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="go">The following packages will be REMOVED:</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="go">  containerd* docker-compose* docker.io* runc*</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="go">0 upgraded, 0 newly installed, 4 to remove and 2 not upgraded.</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="go">After this operation, 266 MB disk space will be freed.</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a><span class="gp gp-VirtualEnv">(Reading database ... 636455 files and directories currently installed.)</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a><span class="go">Removing docker.io (24.0.5-0ubuntu1~22.04.1) ...</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a><span class="go">'/usr/share/docker.io/contrib/nuke-graph-directory.sh' -&gt; '/var/lib/docker/nuke-graph-directory.sh'</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a><span class="go">Warning: Stopping docker.service, but it can still be activated by:</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a><span class="go">  docker.socket</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a><span class="go">Removing containerd (1.7.2-0ubuntu1~22.04.1) ...</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a><span class="go">Removing docker-compose (1.29.2-1) ...</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a><span class="go">Removing runc (1.1.7-0ubuntu1~22.04.2) ...</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a><span class="go">Processing triggers for man-db (2.10.2-1) ...</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a><span class="gp gp-VirtualEnv">(Reading database ... 636121 files and directories currently installed.)</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a><span class="go">Purging configuration files for docker.io (24.0.5-0ubuntu1~22.04.1) ...</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#__codelineno-7-24"></a>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#__codelineno-7-25"></a><span class="go">Nuking /var/lib/docker ...</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#__codelineno-7-26"></a><span class="go">  (if this is wrong, press Ctrl+C NOW!)</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#__codelineno-7-27"></a>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#__codelineno-7-28"></a><span class="go">+ sleep 10</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#__codelineno-7-29"></a>
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#__codelineno-7-30"></a><span class="go">+ rm -rf /var/lib/docker/buildkit /var/lib/docker/containers /var/lib/docker/engine-id /var/lib/docker/image /var/lib/docker/network /var/lib/docker/nuke-graph-directory.sh /var/lib/docker/overlay2 /var/lib/docker/plugins /var/lib/docker/runtimes /var/lib/docker/swarm /var/lib/docker/tmp /var/lib/docker/trust /var/lib/docker/volumes</span>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#__codelineno-7-31"></a><span class="go">dpkg: warning: while removing docker.io, directory '/etc/docker' not empty so not removed</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#__codelineno-7-32"></a><span class="go">Purging configuration files for containerd (1.7.2-0ubuntu1~22.04.1) ...</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#__codelineno-7-33"></a>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#__codelineno-7-34"></a><span class="gp"># </span>rm<span class="w"> </span>-rf<span class="w"> </span>/var/lib/containerd<span class="w"> </span>/var/lib/docker/
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#__codelineno-7-35"></a>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#__codelineno-7-36"></a><span class="gp"># </span>apt<span class="w"> </span>autoremove<span class="w"> </span>-y
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#__codelineno-7-37"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#__codelineno-7-38"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39" href="#__codelineno-7-39"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-7-40"><a id="__codelineno-7-40" name="__codelineno-7-40" href="#__codelineno-7-40"></a><span class="go">The following packages will be REMOVED:</span>
</span><span id="__span-7-41"><a id="__codelineno-7-41" name="__codelineno-7-41" href="#__codelineno-7-41"></a><span class="go">  bridge-utils pigz python3-docker python3-dockerpty python3-dotenv python3-jsonschema</span>
</span><span id="__span-7-42"><a id="__codelineno-7-42" name="__codelineno-7-42" href="#__codelineno-7-42"></a><span class="go">  python3-pyrsistent python3-texttable python3-websocket ubuntu-fan</span>
</span><span id="__span-7-43"><a id="__codelineno-7-43" name="__codelineno-7-43" href="#__codelineno-7-43"></a><span class="go">0 upgraded, 0 newly installed, 10 to remove and 2 not upgraded.</span>
</span><span id="__span-7-44"><a id="__codelineno-7-44" name="__codelineno-7-44" href="#__codelineno-7-44"></a><span class="go">After this operation, 1,896 kB disk space will be freed.</span>
</span><span id="__span-7-45"><a id="__codelineno-7-45" name="__codelineno-7-45" href="#__codelineno-7-45"></a><span class="gp gp-VirtualEnv">(Reading database ... 636120 files and directories currently installed.)</span>
</span><span id="__span-7-46"><a id="__codelineno-7-46" name="__codelineno-7-46" href="#__codelineno-7-46"></a><span class="go">Removing ubuntu-fan (0.12.16) ...</span>
</span><span id="__span-7-47"><a id="__codelineno-7-47" name="__codelineno-7-47" href="#__codelineno-7-47"></a><span class="go">ubuntu-fan: removing default /etc/network/fan configuration</span>
</span><span id="__span-7-48"><a id="__codelineno-7-48" name="__codelineno-7-48" href="#__codelineno-7-48"></a><span class="go">Removing bridge-utils (1.7-1ubuntu3) ...</span>
</span><span id="__span-7-49"><a id="__codelineno-7-49" name="__codelineno-7-49" href="#__codelineno-7-49"></a><span class="go">Removing pigz (2.6-1) ...</span>
</span><span id="__span-7-50"><a id="__codelineno-7-50" name="__codelineno-7-50" href="#__codelineno-7-50"></a><span class="go">Removing python3-docker (5.0.3-1) ...</span>
</span><span id="__span-7-51"><a id="__codelineno-7-51" name="__codelineno-7-51" href="#__codelineno-7-51"></a><span class="go">Removing python3-dockerpty (0.4.1-2) ...</span>
</span><span id="__span-7-52"><a id="__codelineno-7-52" name="__codelineno-7-52" href="#__codelineno-7-52"></a><span class="go">Removing python3-dotenv (0.19.2-1) ...</span>
</span><span id="__span-7-53"><a id="__codelineno-7-53" name="__codelineno-7-53" href="#__codelineno-7-53"></a><span class="go">Removing python3-jsonschema (3.2.0-0ubuntu2) ...</span>
</span><span id="__span-7-54"><a id="__codelineno-7-54" name="__codelineno-7-54" href="#__codelineno-7-54"></a><span class="go">Removing python3-pyrsistent:amd64 (0.18.1-1build1) ...</span>
</span><span id="__span-7-55"><a id="__codelineno-7-55" name="__codelineno-7-55" href="#__codelineno-7-55"></a><span class="go">Removing python3-texttable (1.6.4-1) ...</span>
</span><span id="__span-7-56"><a id="__codelineno-7-56" name="__codelineno-7-56" href="#__codelineno-7-56"></a><span class="go">Removing python3-websocket (1.2.3-1) ...</span>
</span><span id="__span-7-57"><a id="__codelineno-7-57" name="__codelineno-7-57" href="#__codelineno-7-57"></a><span class="go">Processing triggers for man-db (2.10.2-1) ...</span>
</span></code></pre></div>
<p>With all those old packages out of the we, we proceed to
set up and install Docker Engine from 
<a href="https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository">Docker's apt repository</a>.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="gp"># </span>curl<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">  </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">  </span>-o<span class="w"> </span>/etc/apt/keyrings/docker.asc
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="gp"># </span><span class="nb">echo</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">  </span><span class="s2">"deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="gp">  $</span><span class="s2">(. /etc/os-release &amp;&amp; echo "</span><span class="nv">$VERSION_CODENAME</span><span class="s2">") stable"</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">  </span>tee<span class="w"> </span>/etc/apt/sources.list.d/docker.list
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="go">deb [arch=amd64 signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu   jammy stable</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="gp"># </span>apt-get<span class="w"> </span>update
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="go">...</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="go">Get:10 https://esm.ubuntu.com/apps/ubuntu jammy-apps-security InRelease [7,553 B]</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="go">Get:14 https://esm.ubuntu.com/infra/ubuntu jammy-infra-updates InRelease [7,449 B]</span>
</span></code></pre></div>
<details class="terminal">
<summary><code># apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</code></summary>
<div class="language-console highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="gp"># </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">  </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io<span class="w"> </span>docker-buildx-plugin<span class="w"> </span>docker-compose-plugin
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="go">Reading package lists... Done</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="go">Building dependency tree... Done</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="go">Reading state information... Done</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="go">The following additional packages will be installed:</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="go">  docker-ce-rootless-extras libslirp0 pigz slirp4netns</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="go">Suggested packages:</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="go">  aufs-tools cgroupfs-mount | cgroup-lite</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="go">The following NEW packages will be installed:</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="go">  containerd.io docker-buildx-plugin docker-ce docker-ce-cli docker-ce-rootless-extras</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="go">  docker-compose-plugin libslirp0 pigz slirp4netns</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="go">0 upgraded, 9 newly installed, 0 to remove and 2 not upgraded.</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="go">Need to get 121 MB of archives.</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="go">After this operation, 434 MB of additional disk space will be used.</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="go">Get:1 http://archive.ubuntu.com/ubuntu jammy/universe amd64 pigz amd64 2.6-1 [63.6 kB]</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="go">Get:2 https://download.docker.com/linux/ubuntu jammy/stable amd64 containerd.io amd64 1.6.31-1 [29.8 MB]</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="go">Get:3 http://archive.ubuntu.com/ubuntu jammy/main amd64 libslirp0 amd64 4.6.1-1build1 [61.5 kB]</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="go">Get:4 http://archive.ubuntu.com/ubuntu jammy/universe amd64 slirp4netns amd64 1.0.1-2 [28.2 kB]</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a><span class="go">Get:5 https://download.docker.com/linux/ubuntu jammy/stable amd64 docker-buildx-plugin amd64 0.14.0-1~ubuntu.22.04~jammy [29.7 MB]</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a><span class="go">Get:6 https://download.docker.com/linux/ubuntu jammy/stable amd64 docker-ce-cli amd64 5:26.1.2-1~ubuntu.22.04~jammy [14.6 MB]</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a><span class="go">Get:7 https://download.docker.com/linux/ubuntu jammy/stable amd64 docker-ce amd64 5:26.1.2-1~ubuntu.22.04~jammy [25.3 MB]</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a><span class="go">Get:8 https://download.docker.com/linux/ubuntu jammy/stable amd64 docker-ce-rootless-extras amd64 5:26.1.2-1~ubuntu.22.04~jammy [9,319 kB]</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a><span class="go">Get:9 https://download.docker.com/linux/ubuntu jammy/stable amd64 docker-compose-plugin amd64 2.27.0-1~ubuntu.22.04~jammy [12.5 MB]</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a><span class="go">Fetched 121 MB in 1s (95.8 MB/s)                </span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a><span class="go">Selecting previously unselected package pigz.</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a><span class="gp gp-VirtualEnv">(Reading database ... 635829 files and directories currently installed.)</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a><span class="go">Preparing to unpack .../0-pigz_2.6-1_amd64.deb ...</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a><span class="go">Unpacking pigz (2.6-1) ...</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a><span class="go">Selecting previously unselected package containerd.io.</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a><span class="go">Preparing to unpack .../1-containerd.io_1.6.31-1_amd64.deb ...</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a><span class="go">Unpacking containerd.io (1.6.31-1) ...</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a><span class="go">Selecting previously unselected package docker-buildx-plugin.</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a><span class="go">Preparing to unpack .../2-docker-buildx-plugin_0.14.0-1~ubuntu.22.04~jammy_amd64.deb ...</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a><span class="go">Unpacking docker-buildx-plugin (0.14.0-1~ubuntu.22.04~jammy) ...</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a><span class="go">Selecting previously unselected package docker-ce-cli.</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a><span class="go">Preparing to unpack .../3-docker-ce-cli_5%3a26.1.2-1~ubuntu.22.04~jammy_amd64.deb ...</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a><span class="go">Unpacking docker-ce-cli (5:26.1.2-1~ubuntu.22.04~jammy) ...</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a><span class="go">Selecting previously unselected package docker-ce.</span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a><span class="go">Preparing to unpack .../4-docker-ce_5%3a26.1.2-1~ubuntu.22.04~jammy_amd64.deb ...</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a><span class="go">Unpacking docker-ce (5:26.1.2-1~ubuntu.22.04~jammy) ...</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#__codelineno-9-42"></a><span class="go">Selecting previously unselected package docker-ce-rootless-extras.</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#__codelineno-9-43"></a><span class="go">Preparing to unpack .../5-docker-ce-rootless-extras_5%3a26.1.2-1~ubuntu.22.04~jammy_amd64.deb ...</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#__codelineno-9-44"></a><span class="go">Unpacking docker-ce-rootless-extras (5:26.1.2-1~ubuntu.22.04~jammy) ...</span>
</span><span id="__span-9-45"><a id="__codelineno-9-45" name="__codelineno-9-45" href="#__codelineno-9-45"></a><span class="go">Selecting previously unselected package docker-compose-plugin.</span>
</span><span id="__span-9-46"><a id="__codelineno-9-46" name="__codelineno-9-46" href="#__codelineno-9-46"></a><span class="go">Preparing to unpack .../6-docker-compose-plugin_2.27.0-1~ubuntu.22.04~jammy_amd64.deb ...</span>
</span><span id="__span-9-47"><a id="__codelineno-9-47" name="__codelineno-9-47" href="#__codelineno-9-47"></a><span class="go">Unpacking docker-compose-plugin (2.27.0-1~ubuntu.22.04~jammy) ...</span>
</span><span id="__span-9-48"><a id="__codelineno-9-48" name="__codelineno-9-48" href="#__codelineno-9-48"></a><span class="go">Selecting previously unselected package libslirp0:amd64.</span>
</span><span id="__span-9-49"><a id="__codelineno-9-49" name="__codelineno-9-49" href="#__codelineno-9-49"></a><span class="go">Preparing to unpack .../7-libslirp0_4.6.1-1build1_amd64.deb ...</span>
</span><span id="__span-9-50"><a id="__codelineno-9-50" name="__codelineno-9-50" href="#__codelineno-9-50"></a><span class="go">Unpacking libslirp0:amd64 (4.6.1-1build1) ...</span>
</span><span id="__span-9-51"><a id="__codelineno-9-51" name="__codelineno-9-51" href="#__codelineno-9-51"></a><span class="go">Selecting previously unselected package slirp4netns.</span>
</span><span id="__span-9-52"><a id="__codelineno-9-52" name="__codelineno-9-52" href="#__codelineno-9-52"></a><span class="go">Preparing to unpack .../8-slirp4netns_1.0.1-2_amd64.deb ...</span>
</span><span id="__span-9-53"><a id="__codelineno-9-53" name="__codelineno-9-53" href="#__codelineno-9-53"></a><span class="go">Unpacking slirp4netns (1.0.1-2) ...</span>
</span><span id="__span-9-54"><a id="__codelineno-9-54" name="__codelineno-9-54" href="#__codelineno-9-54"></a><span class="go">Setting up docker-buildx-plugin (0.14.0-1~ubuntu.22.04~jammy) ...</span>
</span><span id="__span-9-55"><a id="__codelineno-9-55" name="__codelineno-9-55" href="#__codelineno-9-55"></a><span class="go">Setting up containerd.io (1.6.31-1) ...</span>
</span><span id="__span-9-56"><a id="__codelineno-9-56" name="__codelineno-9-56" href="#__codelineno-9-56"></a><span class="go">Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service â†’ /lib/systemd/system/containerd.service.</span>
</span><span id="__span-9-57"><a id="__codelineno-9-57" name="__codelineno-9-57" href="#__codelineno-9-57"></a><span class="go">Setting up docker-compose-plugin (2.27.0-1~ubuntu.22.04~jammy) ...</span>
</span><span id="__span-9-58"><a id="__codelineno-9-58" name="__codelineno-9-58" href="#__codelineno-9-58"></a><span class="go">Setting up docker-ce-cli (5:26.1.2-1~ubuntu.22.04~jammy) ...</span>
</span><span id="__span-9-59"><a id="__codelineno-9-59" name="__codelineno-9-59" href="#__codelineno-9-59"></a><span class="go">Setting up libslirp0:amd64 (4.6.1-1build1) ...</span>
</span><span id="__span-9-60"><a id="__codelineno-9-60" name="__codelineno-9-60" href="#__codelineno-9-60"></a><span class="go">Setting up pigz (2.6-1) ...</span>
</span><span id="__span-9-61"><a id="__codelineno-9-61" name="__codelineno-9-61" href="#__codelineno-9-61"></a><span class="go">Setting up docker-ce-rootless-extras (5:26.1.2-1~ubuntu.22.04~jammy) ...</span>
</span><span id="__span-9-62"><a id="__codelineno-9-62" name="__codelineno-9-62" href="#__codelineno-9-62"></a><span class="go">Setting up slirp4netns (1.0.1-2) ...</span>
</span><span id="__span-9-63"><a id="__codelineno-9-63" name="__codelineno-9-63" href="#__codelineno-9-63"></a><span class="go">Setting up docker-ce (5:26.1.2-1~ubuntu.22.04~jammy) ...</span>
</span><span id="__span-9-64"><a id="__codelineno-9-64" name="__codelineno-9-64" href="#__codelineno-9-64"></a><span class="go">Created symlink /etc/systemd/system/multi-user.target.wants/docker.service â†’ /lib/systemd/system/docker.service.</span>
</span><span id="__span-9-65"><a id="__codelineno-9-65" name="__codelineno-9-65" href="#__codelineno-9-65"></a><span class="go">Created symlink /etc/systemd/system/sockets.target.wants/docker.socket â†’ /lib/systemd/system/docker.socket.</span>
</span><span id="__span-9-66"><a id="__codelineno-9-66" name="__codelineno-9-66" href="#__codelineno-9-66"></a><span class="go">Could not execute systemctl:  at /usr/bin/deb-systemd-invoke line 142.</span>
</span><span id="__span-9-67"><a id="__codelineno-9-67" name="__codelineno-9-67" href="#__codelineno-9-67"></a><span class="go">Processing triggers for man-db (2.10.2-1) ...</span>
</span><span id="__span-9-68"><a id="__codelineno-9-68" name="__codelineno-9-68" href="#__codelineno-9-68"></a><span class="go">Processing triggers for libc-bin (2.35-0ubuntu3.7) ...</span>
</span></code></pre></div>
</details>
<p>Aftet this the following packages are newly installed,
from Docker's official distribution:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="gp"># </span><span class="k">for</span><span class="w"> </span>pkg<span class="w"> </span><span class="k">in</span><span class="w"> </span>docker.io<span class="w"> </span>docker-doc<span class="w"> </span>docker-compose<span class="w"> </span>docker-compose-v2<span class="w"> </span>podman-docker<span class="w"> </span>containerd<span class="w"> </span>runc<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io<span class="w"> </span>docker-buildx-plugin<span class="w"> </span>docker-compose-plugin<span class="w"> </span>docker-ce-rootless-extras<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">   </span>dpkg<span class="w"> </span>-l<span class="w"> </span><span class="nv">$pkg</span><span class="w"> </span><span class="m">2</span>&gt;/dev/null<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>^ii<span class="se">\</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="k">done</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="go">ii  docker-ce      5:26.1.2-1~ubuntu.22.04~jammy amd64        Docker: the open-source application container engine</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="go">ii  docker-ce-cli  5:26.1.2-1~ubuntu.22.04~jammy amd64        Docker CLI: the open-source application container engine</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="go">ii  containerd.io  1.6.31-1     amd64        An open and reliable container runtime</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="go">ii  docker-buildx-plugin 0.14.0-1~ubuntu.22.04~jammy amd64        Docker Buildx cli plugin.</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="go">ii  docker-compose-plugin 2.27.0-1~ubuntu.22.04~jammy amd64        Docker Compose (V2) plugin for the Docker CLI.</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="go">ii  docker-ce-rootless-extras 5:26.1.2-1~ubuntu.22.04~jammy amd64        Rootless support for Docker.</span>
</span></code></pre></div>
<p><strong>However</strong>, <em>we're not done yet</em>; Docker Engine is
<strong>not actually working</strong> at this point.</p>
<p>Trying to verify that the Docker Engine installation is
successful by running the <code>hello-world</code> image, turns out
the Docker daemon is not yet running:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="gp"># </span>docker<span class="w"> </span>run<span class="w"> </span>hello-world
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="go">docker: Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?.</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="go">See 'docker run --help'.</span>
</span></code></pre></div>
<p>Indeed the service is not running:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="gp"># </span>systemctl<span class="w"> </span>status<span class="w"> </span>docker
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="go">Ã— docker.service - Docker Application Container Engine</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="go">     Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="go">     Active: failed (Result: exit-code) since Sun 2024-05-12 09:18:02 CEST; 5min ago</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="go">TriggeredBy: Ã— docker.socket</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="go">       Docs: https://docs.docker.com</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="go">    Process: 1402955 ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock (code=exited, status=1/FAILURE)</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="go">   Main PID: 1402955 (code=exited, status=1/FAILURE)</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="go">        CPU: 41ms</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="go">May 12 09:18:02 rapture systemd[1]: docker.service: Scheduled restart job, restart counter is at 3.</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="go">May 12 09:18:02 rapture systemd[1]: Stopped Docker Application Container Engine.</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="go">May 12 09:18:02 rapture systemd[1]: docker.service: Start request repeated too quickly.</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="go">May 12 09:18:02 rapture systemd[1]: docker.service: Failed with result 'exit-code'.</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="go">May 12 09:18:02 rapture systemd[1]: Failed to start Docker Application Container Engine.</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a><span class="gp"># </span>ls<span class="w"> </span>-l<span class="w"> </span>/run/containerd/containerd.sock<span class="w"> </span>/var/run/docker.sock
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="go">srw-rw---- 1 root root   0 May 12 09:17 /run/containerd/containerd.sock</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="go">srw-rw---- 1 root docker 0 May 11 22:29 /var/run/docker.sock</span>
</span></code></pre></div>
<p>Both sockets exist, but apparently <code>dockerd</code> has a hard
time start the firs time and needs
<a href="https://github.com/docker/for-linux/issues/535">to be kicked up</a>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="gp"># </span>systemctl<span class="w"> </span>restart<span class="w"> </span>docker
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="gp"># </span>systemctl<span class="w"> </span>status<span class="w"> </span>docker
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="go">â— docker.service - Docker Application Container Engine</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="go">     Loaded: loaded (/lib/systemd/system/docker.service; enabled; vendor preset: enabled)</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="go">     Active: active (running) since Sun 2024-05-12 09:33:02 CEST; 1s ago</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="go">TriggeredBy: â— docker.socket</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="go">       Docs: https://docs.docker.com</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="go">   Main PID: 1690331 (dockerd)</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="go">      Tasks: 22</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="go">     Memory: 30.6M</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="go">        CPU: 152ms</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="go">     CGroup: /system.slice/docker.service</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="go">             â””â”€1690331 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="gp"># </span>docker<span class="w"> </span>version
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="go">Client: Docker Engine - Community</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="go"> Version:           26.1.2</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="go"> API version:       1.45</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="go"> Go version:        go1.21.10</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a><span class="go"> Git commit:        211e74b</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="go"> Built:             Wed May  8 13:59:59 2024</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="go"> OS/Arch:           linux/amd64</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="go"> Context:           default</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="go">Server: Docker Engine - Community</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="go"> Engine:</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="go">  Version:          26.1.2</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a><span class="go">  API version:      1.45 (minimum version 1.24)</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a><span class="go">  Go version:       go1.21.10</span>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a><span class="go">  Git commit:       ef1912d</span>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a><span class="go">  Built:            Wed May  8 13:59:59 2024</span>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a><span class="go">  OS/Arch:          linux/amd64</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a><span class="go">  Experimental:     false</span>
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a><span class="go"> containerd:</span>
</span><span id="__span-13-35"><a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="go">  Version:          1.6.31</span>
</span><span id="__span-13-36"><a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="go">  GitCommit:        e377cd56a71523140ca6ae87e30244719194a521</span>
</span><span id="__span-13-37"><a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a><span class="go"> runc:</span>
</span><span id="__span-13-38"><a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a><span class="go">  Version:          1.1.12</span>
</span><span id="__span-13-39"><a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a><span class="go">  GitCommit:        v1.1.12-0-g51d5e94</span>
</span><span id="__span-13-40"><a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a><span class="go"> docker-init:</span>
</span><span id="__span-13-41"><a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a><span class="go">  Version:          0.19.0</span>
</span><span id="__span-13-42"><a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a><span class="go">  GitCommit:        de40ad0</span>
</span></code></pre></div>
<p>Now, finally, the <code>hello-world</code> example does work:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="gp"># </span>docker<span class="w"> </span>run<span class="w"> </span>hello-world
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="go">Unable to find image 'hello-world:latest' locally</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="go">latest: Pulling from library/hello-world</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="go">c1ec31eb5944: Pull complete </span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="go">Digest: sha256:a26bff933ddc26d5cdf7faa98b4ae1e3ec20c4985e6f87ac0973052224d24302</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="go">Status: Downloaded newer image for hello-world:latest</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="go">Hello from Docker!</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="go">This message shows that your installation appears to be working correctly.</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="go">To generate this message, Docker took the following steps:</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="go"> 1. The Docker client contacted the Docker daemon.</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="go"> 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="go">    (amd64)</span>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="go"> 3. The Docker daemon created a new container from that image which runs the</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="go">    executable that produces the output you are currently reading.</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="go"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="go">    to your terminal.</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="go">To try something more ambitious, you can run an Ubuntu container with:</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="gp"> $ </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>ubuntu<span class="w"> </span>bash
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="go">Share images, automate workflows, and more with a free Docker ID:</span>
</span><span id="__span-14-24"><a id="__codelineno-14-24" name="__codelineno-14-24" href="#__codelineno-14-24"></a><span class="go"> https://hub.docker.com/</span>
</span><span id="__span-14-25"><a id="__codelineno-14-25" name="__codelineno-14-25" href="#__codelineno-14-25"></a>
</span><span id="__span-14-26"><a id="__codelineno-14-26" name="__codelineno-14-26" href="#__codelineno-14-26"></a><span class="go">For more examples and ideas, visit:</span>
</span><span id="__span-14-27"><a id="__codelineno-14-27" name="__codelineno-14-27" href="#__codelineno-14-27"></a><span class="go"> https://docs.docker.com/get-started/</span>
</span><span id="__span-14-28"><a id="__codelineno-14-28" name="__codelineno-14-28" href="#__codelineno-14-28"></a>
</span><span id="__span-14-29"><a id="__codelineno-14-29" name="__codelineno-14-29" href="#__codelineno-14-29"></a><span class="gp"># </span>docker<span class="w"> </span>images<span class="w"> </span>
</span><span id="__span-14-30"><a id="__codelineno-14-30" name="__codelineno-14-30" href="#__codelineno-14-30"></a><span class="go">REPOSITORY    TAG       IMAGE ID       CREATED         SIZE</span>
</span><span id="__span-14-31"><a id="__codelineno-14-31" name="__codelineno-14-31" href="#__codelineno-14-31"></a><span class="go">hello-world   latest    d2c94e258dcb   12 months ago   13.3kB</span>
</span></code></pre></div>
<h4 id="configuration-tweaks-for-containerd-and-docker">Configuration tweaks for containerd and Docker</h4>
<p>With <code>containerd</code> installed and running, the next step is
to update its configuration to</p>
<ul>
<li>Enable the use of <a href="https://v1-27.docs.kubernetes.io/docs/setup/production-environment/container-runtimes/#containerd-systemd"><code>systemd</code> cgroup driver</a>.</li>
<li>Enable CRI integration, which is disabled by default
    when installing <code>containerd</code> from Ubuntu packages,
    but is needed to use <code>containerd</code> with Kubernetes.</li>
<li>Move <code>/var/lib/containerd</code> to a bigger file system,
    this PC has most disk space mounted under <code>/home</code>.</li>
</ul>
<div class="language-console highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="gp"># </span>systemctl<span class="w"> </span>stop<span class="w"> </span>containerd
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="gp"># </span>cp<span class="w"> </span>-a<span class="w"> </span>/var/lib/containerd/<span class="w"> </span>/home/lib/
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="gp"># </span>containerd<span class="w"> </span>config<span class="w"> </span>default<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">'s:root = "/var/lib/:root = "/home/lib/:'</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">'s/disabled_plugins.*/disabled_plugins = []/'</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span><span class="s1">'s/SystemdCgroup = false/SystemdCgroup = true/'</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w"> </span>&gt;<span class="w"> </span>/etc/containerd/config.toml
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="gp"># </span>mv<span class="w"> </span>/var/lib/containerd<span class="w">  </span>/var/lib/DO_NOT_USE_containerd
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="gp"># </span>systemctl<span class="w"> </span>start<span class="w"> </span>containerd
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To create a <strong>good</strong> <code>/etc/containerd/config.toml</code> one <strong>must</strong> do so by
modifying the <strong>default</strong> configuration. Using the running configuration
(with <code>containerd config dump</code>) will produce an <strong>invalid configuration</strong>
with an empty <code>runtime_type</code> where that is not allowed. This leads to
<a href="https://github.com/containerd/containerd/issues/6964">containerd issue #6964: default configuration isn't working</a>,
which makes <code>kubelet</code> failing to running any images,
and <code>kubeadm</code> fails to initialize the control pane.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Despite a misleading note in the 1.26
documentation, there is no need to manually configure the 
<a href="https://v1-27.docs.kubernetes.io/docs/tasks/administer-cluster/kubeadm/configure-cgroup-driver/#configuring-the-kubelet-cgroup-driver">cgroup driver for kubelet</a>.
because, already since v1.22,
<strong><code>kubeadm</code> defaults it to <code>systemd</code></strong>.</p>
</div>
<p>This would be a good time to do the same with 
<code>/var/lib/docker</code> and, when using BTRFS, add this
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/#important-tweak-for-btrfs">Important Tweak for BTRFS</a>.</p>
<p>Fist, create <code>/etc/docker/daemon.json</code> with this:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="w">  </span><span class="nt">"data-root"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/home/lib/docker"</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="w">  </span><span class="nt">"storage-driver"</span><span class="p">:</span><span class="w"> </span><span class="s2">"overlay2"</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="p">}</span>
</span></code></pre></div>
<p>Then, stop all <code>docker</code> and <code>containerd</code> services,
move <code>/var/lib/docker</code> and start services again:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="gp"># </span>docker<span class="w"> </span>info<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s1">'Storage Driver|Docker Root Dir'</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="go"> Storage Driver: overlay2</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="go"> Docker Root Dir: /var/lib/docker</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="gp"># </span>systemctl<span class="w"> </span>stop<span class="w"> </span>docker.service
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="gp"># </span>systemctl<span class="w"> </span>stop<span class="w"> </span>docker.socket
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="gp"># </span>systemctl<span class="w"> </span>stop<span class="w"> </span>containerd.service
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="gp"># </span>cp<span class="w"> </span>-a<span class="w"> </span>/var/lib/docker/<span class="w"> </span>/home/lib/
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="gp"># </span>mv<span class="w"> </span>/var/lib/docker<span class="w"> </span>/var/lib/DO_NOT_USE_docker
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="gp"># </span>systemctl<span class="w"> </span>start<span class="w"> </span>docker.socket
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="gp"># </span>systemctl<span class="w"> </span>start<span class="w"> </span>docker.service
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="gp"># </span>systemctl<span class="w"> </span>start<span class="w"> </span>containerd.service
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="gp"># </span>docker<span class="w"> </span>info<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s1">'Storage Driver|Docker Root Dir'</span>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="go"> Storage Driver: overlay2</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="go"> Docker Root Dir: /home/lib/docker</span>
</span></code></pre></div>
<p>Possibly because Docker was already using <code>overlay2</code>,
possibly because the root partition is not using BTRFS,
Docker images were not lost as
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/#ask-me-how-i-know">it happened in Lexicon</a>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>At the end of the
<a href="https://v1-27.docs.kubernetes.io/docs/setup/production-environment/container-runtimes/">Container runtimes</a>
documentation, it is suggested that the next step is to
install a <a href="https://v1-27.docs.kubernetes.io/docs/concepts/cluster-administration/networking/#how-to-implement-the-kubernetes-networking-model">network plugin</a>.
However, this should not be done before
<strong>bootstrapping</strong> the cluster (see next).</p>
</div>
<h2 id="bootstrap-the-cluster-with-kubeadm">Bootstrap the cluster with <code>kubeadm</code></h2>
<p>Having already
<a href="https://v1-27.docs.kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl">installed kubeadm, kubelet and kubectl</a>
the next step is to initialize the cluster:
<a href="https://v1-27.docs.kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/">Creating acluster with kubeadm</a>.</p>
<h3 id="initialize-control-plane">Initialize control-plane</h3>
<p>Having reviewed the requirements and having installed all
the components already (see above), we proceed to
<a href="https://v1-27.docs.kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#initializing-your-control-plane-node">Initializing your control-plane node</a> with:</p>
<ul>
<li><code>--cri-socket=/run/containerd/containerd.sock</code> to make
   sure Kubernetes uses the <code>containerd</code> runtime.</li>
<li><code>--pod-network-cidr=10.244.0.0/16</code> as
   <a href="https://github.com/flannel-io/flannel/blob/master/Documentation/kubernetes.md">required by flannel</a>,
   which is the <a href="#network-plugin">network plugin</a> to be
   installed later.</li>
</ul>
<p>Note that before initializing the control panel,
the <code>kubelet</code> service is not running:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="gp"># </span>systemctl<span class="w"> </span>status<span class="w"> </span>kubelet
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="go">â— kubelet.service - kubelet: The Kubernetes Node Agent</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="go">     Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="go">    Drop-In: /usr/lib/systemd/system/kubelet.service.d</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="go">             â””â”€10-kubeadm.conf</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="go">     Active: activating (auto-restart) (Result: exit-code) since Sun 2024-05-12 11:57:52 CEST; 4s ago</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="go">       Docs: https://kubernetes.io/docs/</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="go">    Process: 243927 ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS (code=exited, status=1/FAILURE)</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="go">   Main PID: 243927 (code=exited, status=1/FAILURE)</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="go">        CPU: 43ms</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="gp"># </span>kubeadm<span class="w"> </span>init<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="w">  </span>--cri-socket<span class="o">=</span>/run/containerd/containerd.sock<span class="w"> </span><span class="se">\</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a><span class="w">  </span>--pod-network-cidr<span class="o">=</span><span class="m">10</span>.244.0.0/16
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a><span class="go">W0512 12:51:35.811501 1168278 initconfiguration.go:119] Usage of CRI endpoints without URL scheme is deprecated and can cause kubelet errors in the future. Automatically prepending scheme "unix" to the "criSocket" with value "/run/containerd/containerd.sock". Please update your configuration!</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a><span class="go">I0512 12:51:36.359676 1168278 version.go:256] remote version is much newer: v1.30.0; falling back to: stable-1.26</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a><span class="go">[init] Using Kubernetes version: v1.26.15</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a><span class="go">[preflight] Running pre-flight checks</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a><span class="go">[preflight] Pulling images required for setting up a Kubernetes cluster</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a><span class="go">[preflight] This might take a minute or two, depending on the speed of your internet connection</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a><span class="go">[preflight] You can also perform this action in beforehand using 'kubeadm config images pull'</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a><span class="go">[certs] Using certificateDir folder "/etc/kubernetes/pki"</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#__codelineno-18-24"></a><span class="go">[certs] Generating "ca" certificate and key</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#__codelineno-18-25"></a><span class="go">[certs] Generating "apiserver" certificate and key</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#__codelineno-18-26"></a><span class="go">[certs] apiserver serving cert is signed for DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local rapture] and IPs [10.96.0.1 10.0.0.2]</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#__codelineno-18-27"></a><span class="go">[certs] Generating "apiserver-kubelet-client" certificate and key</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#__codelineno-18-28"></a><span class="go">[certs] Generating "front-proxy-ca" certificate and key</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#__codelineno-18-29"></a><span class="go">[certs] Generating "front-proxy-client" certificate and key</span>
</span><span id="__span-18-30"><a id="__codelineno-18-30" name="__codelineno-18-30" href="#__codelineno-18-30"></a><span class="go">[certs] Generating "etcd/ca" certificate and key</span>
</span><span id="__span-18-31"><a id="__codelineno-18-31" name="__codelineno-18-31" href="#__codelineno-18-31"></a><span class="go">[certs] Generating "etcd/server" certificate and key</span>
</span><span id="__span-18-32"><a id="__codelineno-18-32" name="__codelineno-18-32" href="#__codelineno-18-32"></a><span class="go">[certs] etcd/server serving cert is signed for DNS names [localhost rapture] and IPs [10.0.0.2 127.0.0.1 ::1]</span>
</span><span id="__span-18-33"><a id="__codelineno-18-33" name="__codelineno-18-33" href="#__codelineno-18-33"></a><span class="go">[certs] Generating "etcd/peer" certificate and key</span>
</span><span id="__span-18-34"><a id="__codelineno-18-34" name="__codelineno-18-34" href="#__codelineno-18-34"></a><span class="go">[certs] etcd/peer serving cert is signed for DNS names [localhost rapture] and IPs [10.0.0.2 127.0.0.1 ::1]</span>
</span><span id="__span-18-35"><a id="__codelineno-18-35" name="__codelineno-18-35" href="#__codelineno-18-35"></a><span class="go">[certs] Generating "etcd/healthcheck-client" certificate and key</span>
</span><span id="__span-18-36"><a id="__codelineno-18-36" name="__codelineno-18-36" href="#__codelineno-18-36"></a><span class="go">[certs] Generating "apiserver-etcd-client" certificate and key</span>
</span><span id="__span-18-37"><a id="__codelineno-18-37" name="__codelineno-18-37" href="#__codelineno-18-37"></a><span class="go">[certs] Generating "sa" key and public key</span>
</span><span id="__span-18-38"><a id="__codelineno-18-38" name="__codelineno-18-38" href="#__codelineno-18-38"></a><span class="go">[kubeconfig] Using kubeconfig folder "/etc/kubernetes"</span>
</span><span id="__span-18-39"><a id="__codelineno-18-39" name="__codelineno-18-39" href="#__codelineno-18-39"></a><span class="go">[kubeconfig] Writing "admin.conf" kubeconfig file</span>
</span><span id="__span-18-40"><a id="__codelineno-18-40" name="__codelineno-18-40" href="#__codelineno-18-40"></a><span class="go">[kubeconfig] Writing "kubelet.conf" kubeconfig file</span>
</span><span id="__span-18-41"><a id="__codelineno-18-41" name="__codelineno-18-41" href="#__codelineno-18-41"></a><span class="go">[kubeconfig] Writing "controller-manager.conf" kubeconfig file</span>
</span><span id="__span-18-42"><a id="__codelineno-18-42" name="__codelineno-18-42" href="#__codelineno-18-42"></a><span class="go">[kubeconfig] Writing "scheduler.conf" kubeconfig file</span>
</span><span id="__span-18-43"><a id="__codelineno-18-43" name="__codelineno-18-43" href="#__codelineno-18-43"></a><span class="go">[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"</span>
</span><span id="__span-18-44"><a id="__codelineno-18-44" name="__codelineno-18-44" href="#__codelineno-18-44"></a><span class="go">[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"</span>
</span><span id="__span-18-45"><a id="__codelineno-18-45" name="__codelineno-18-45" href="#__codelineno-18-45"></a><span class="go">[kubelet-start] Starting the kubelet</span>
</span><span id="__span-18-46"><a id="__codelineno-18-46" name="__codelineno-18-46" href="#__codelineno-18-46"></a><span class="go">[control-plane] Using manifest folder "/etc/kubernetes/manifests"</span>
</span><span id="__span-18-47"><a id="__codelineno-18-47" name="__codelineno-18-47" href="#__codelineno-18-47"></a><span class="go">[control-plane] Creating static Pod manifest for "kube-apiserver"</span>
</span><span id="__span-18-48"><a id="__codelineno-18-48" name="__codelineno-18-48" href="#__codelineno-18-48"></a><span class="go">[control-plane] Creating static Pod manifest for "kube-controller-manager"</span>
</span><span id="__span-18-49"><a id="__codelineno-18-49" name="__codelineno-18-49" href="#__codelineno-18-49"></a><span class="go">[control-plane] Creating static Pod manifest for "kube-scheduler"</span>
</span><span id="__span-18-50"><a id="__codelineno-18-50" name="__codelineno-18-50" href="#__codelineno-18-50"></a><span class="go">[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"</span>
</span><span id="__span-18-51"><a id="__codelineno-18-51" name="__codelineno-18-51" href="#__codelineno-18-51"></a><span class="go">[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests". This can take up to 4m0s</span>
</span><span id="__span-18-52"><a id="__codelineno-18-52" name="__codelineno-18-52" href="#__codelineno-18-52"></a><span class="go">[apiclient] All control plane components are healthy after 5.501819 seconds</span>
</span><span id="__span-18-53"><a id="__codelineno-18-53" name="__codelineno-18-53" href="#__codelineno-18-53"></a><span class="go">[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace</span>
</span><span id="__span-18-54"><a id="__codelineno-18-54" name="__codelineno-18-54" href="#__codelineno-18-54"></a><span class="go">[kubelet] Creating a ConfigMap "kubelet-config" in namespace kube-system with the configuration for the kubelets in the cluster</span>
</span><span id="__span-18-55"><a id="__codelineno-18-55" name="__codelineno-18-55" href="#__codelineno-18-55"></a><span class="go">[upload-certs] Skipping phase. Please see --upload-certs</span>
</span><span id="__span-18-56"><a id="__codelineno-18-56" name="__codelineno-18-56" href="#__codelineno-18-56"></a><span class="go">[mark-control-plane] Marking the node rapture as control-plane by adding the labels: [node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]</span>
</span><span id="__span-18-57"><a id="__codelineno-18-57" name="__codelineno-18-57" href="#__codelineno-18-57"></a><span class="go">[mark-control-plane] Marking the node rapture as control-plane by adding the taints [node-role.kubernetes.io/control-plane:NoSchedule]</span>
</span><span id="__span-18-58"><a id="__codelineno-18-58" name="__codelineno-18-58" href="#__codelineno-18-58"></a><span class="go">[bootstrap-token] Using token: wjnord.g9lpm4heieilydn7</span>
</span><span id="__span-18-59"><a id="__codelineno-18-59" name="__codelineno-18-59" href="#__codelineno-18-59"></a><span class="go">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span>
</span><span id="__span-18-60"><a id="__codelineno-18-60" name="__codelineno-18-60" href="#__codelineno-18-60"></a><span class="go">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to get nodes</span>
</span><span id="__span-18-61"><a id="__codelineno-18-61" name="__codelineno-18-61" href="#__codelineno-18-61"></a><span class="go">[bootstrap-token] Configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span>
</span><span id="__span-18-62"><a id="__codelineno-18-62" name="__codelineno-18-62" href="#__codelineno-18-62"></a><span class="go">[bootstrap-token] Configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span>
</span><span id="__span-18-63"><a id="__codelineno-18-63" name="__codelineno-18-63" href="#__codelineno-18-63"></a><span class="go">[bootstrap-token] Configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span>
</span><span id="__span-18-64"><a id="__codelineno-18-64" name="__codelineno-18-64" href="#__codelineno-18-64"></a><span class="go">[bootstrap-token] Creating the "cluster-info" ConfigMap in the "kube-public" namespace</span>
</span><span id="__span-18-65"><a id="__codelineno-18-65" name="__codelineno-18-65" href="#__codelineno-18-65"></a><span class="go">[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key</span>
</span><span id="__span-18-66"><a id="__codelineno-18-66" name="__codelineno-18-66" href="#__codelineno-18-66"></a><span class="go">[addons] Applied essential addon: CoreDNS</span>
</span><span id="__span-18-67"><a id="__codelineno-18-67" name="__codelineno-18-67" href="#__codelineno-18-67"></a><span class="go">[addons] Applied essential addon: kube-proxy</span>
</span><span id="__span-18-68"><a id="__codelineno-18-68" name="__codelineno-18-68" href="#__codelineno-18-68"></a>
</span><span id="__span-18-69"><a id="__codelineno-18-69" name="__codelineno-18-69" href="#__codelineno-18-69"></a><span class="go">Your Kubernetes control-plane has initialized successfully!</span>
</span><span id="__span-18-70"><a id="__codelineno-18-70" name="__codelineno-18-70" href="#__codelineno-18-70"></a>
</span><span id="__span-18-71"><a id="__codelineno-18-71" name="__codelineno-18-71" href="#__codelineno-18-71"></a><span class="go">To start using your cluster, you need to run the following as a regular user:</span>
</span><span id="__span-18-72"><a id="__codelineno-18-72" name="__codelineno-18-72" href="#__codelineno-18-72"></a>
</span><span id="__span-18-73"><a id="__codelineno-18-73" name="__codelineno-18-73" href="#__codelineno-18-73"></a><span class="go">  mkdir -p $HOME/.kube</span>
</span><span id="__span-18-74"><a id="__codelineno-18-74" name="__codelineno-18-74" href="#__codelineno-18-74"></a><span class="go">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span>
</span><span id="__span-18-75"><a id="__codelineno-18-75" name="__codelineno-18-75" href="#__codelineno-18-75"></a><span class="go">  sudo chown $(id -u):$(id -g) $HOME/.kube/config</span>
</span><span id="__span-18-76"><a id="__codelineno-18-76" name="__codelineno-18-76" href="#__codelineno-18-76"></a>
</span><span id="__span-18-77"><a id="__codelineno-18-77" name="__codelineno-18-77" href="#__codelineno-18-77"></a><span class="go">Alternatively, if you are the root user, you can run:</span>
</span><span id="__span-18-78"><a id="__codelineno-18-78" name="__codelineno-18-78" href="#__codelineno-18-78"></a>
</span><span id="__span-18-79"><a id="__codelineno-18-79" name="__codelineno-18-79" href="#__codelineno-18-79"></a><span class="go">  export KUBECONFIG=/etc/kubernetes/admin.conf</span>
</span><span id="__span-18-80"><a id="__codelineno-18-80" name="__codelineno-18-80" href="#__codelineno-18-80"></a>
</span><span id="__span-18-81"><a id="__codelineno-18-81" name="__codelineno-18-81" href="#__codelineno-18-81"></a><span class="go">You should now deploy a pod network to the cluster.</span>
</span><span id="__span-18-82"><a id="__codelineno-18-82" name="__codelineno-18-82" href="#__codelineno-18-82"></a><span class="go">Run "kubectl apply -f [podnetwork].yaml" with one of the options listed at:</span>
</span><span id="__span-18-83"><a id="__codelineno-18-83" name="__codelineno-18-83" href="#__codelineno-18-83"></a><span class="go">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span>
</span><span id="__span-18-84"><a id="__codelineno-18-84" name="__codelineno-18-84" href="#__codelineno-18-84"></a>
</span><span id="__span-18-85"><a id="__codelineno-18-85" name="__codelineno-18-85" href="#__codelineno-18-85"></a><span class="go">Then you can join any number of worker nodes by running the following on each as root:</span>
</span><span id="__span-18-86"><a id="__codelineno-18-86" name="__codelineno-18-86" href="#__codelineno-18-86"></a>
</span><span id="__span-18-87"><a id="__codelineno-18-87" name="__codelineno-18-87" href="#__codelineno-18-87"></a><span class="go">kubeadm join 10.0.0.2:6443 --token wjnord.g9lpm4heieilydn7 \</span>
</span><span id="__span-18-88"><a id="__codelineno-18-88" name="__codelineno-18-88" href="#__codelineno-18-88"></a><span class="go">        --discovery-token-ca-cert-hash sha256:bfe7582cfdf2d60c74c18da6aedfa7d5943b314cedd0ee25af996aecbd5a0c0f </span>
</span></code></pre></div>
<p>Now <code>kubelet</code> is running, if only reporting that
<strong>Container runtime network not ready</strong>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="gp"># </span>systemctl<span class="w"> </span>status<span class="w"> </span>kubelet
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="go">â— kubelet.service - kubelet: The Kubernetes Node Agent</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="go">     Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled)</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="go">    Drop-In: /usr/lib/systemd/system/kubelet.service.d</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="go">             â””â”€10-kubeadm.conf</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="go">     Active: active (running) since Sun 2024-05-12 12:52:00 CEST; 3min 27s ago</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="go">       Docs: https://kubernetes.io/docs/</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="go">   Main PID: 1176576 (kubelet)</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="go">      Tasks: 23 (limit: 38142)</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="go">     Memory: 40.8M</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="go">        CPU: 3.311s</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="go">     CGroup: /system.slice/kubelet.service</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a><span class="go">             â””â”€1176576 /usr/bin/kubelet --bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf --config=/var/lib/kubelet/config.yaml --container-runtime-endpoint=unix:///run/containerd/containerd.sock --pod-infra-container-image=registry.k8s.io/pause:3.9</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="go">May 12 12:54:41 rapture kubelet[1176576]: E0512 12:54:41.015172 1176576 kubelet.go:2475] "Container runtime network not ready" networkReady="NetworkReady=false reason:NetworkPluginNotReady message:Network plugin returns error: cni plugin not initialized"</span>
</span></code></pre></div>
<p>We can see all the containers already running:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="gp"># </span>crictl<span class="w"> </span>--runtime-endpoint<span class="w"> </span>unix:///run/containerd/containerd.sock<span class="w"> </span>ps<span class="w"> </span>-a<span class="w"> </span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="go">CONTAINER           IMAGE               CREATED             STATE               NAME                      ATTEMPT             POD ID              POD</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="go">d87c94df74a28       6c84132270a33       5 minutes ago       Running             kube-proxy                0                   51688b22b87e1       kube-proxy-tszr7</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="go">7513bd021911b       a0eed15eed449       5 minutes ago       Running             etcd                      0                   96b9a9ca6948e       etcd-rapture</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="go">641df12c76b68       5626d764f1326       5 minutes ago       Running             kube-scheduler            0                   6fd11b2b44804       kube-scheduler-rapture</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="go">ef7ad9f56205e       61669ae28d85c       5 minutes ago       Running             kube-apiserver            0                   e460715dc3a14       kube-apiserver-rapture</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="go">4244471dc3642       3b418eef6821c       5 minutes ago       Running             kube-controller-manager   0                   3f3e222d2483a       kube-controller-manager-rapture</span>
</span></code></pre></div>
<p>Confirm the flag is sent in
<code>/var/lib/kubelet/kubeadm-flags.env</code>
to use the desired container runtime:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="gp"># </span>grep<span class="w"> </span>container-runtime<span class="w"> </span>/var/lib/kubelet/kubeadm-flags.env
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="go">KUBELET_KUBEADM_ARGS="--container-runtime-endpoint=unix:/run/containerd/containerd.sock --pod-infra-container-image=registry.k8s.io/pause:3.9"</span>
</span></code></pre></div>
<p>And check the cluster status. As <code>root</code> one can simply point
<code>KUBECONFIG</code> to the cluster's <code>admin.conf</code>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="gp"># </span><span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span>/etc/kubernetes/admin.conf
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="gp"># </span>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="go">Kubernetes control plane is running at https://10.0.0.6:6443</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="go">CoreDNS is running at https://10.0.0.6:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="go">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>
</span></code></pre></div>
<p>To run <code>kubectl</code> as non-root, make a copy of that file under
your own <code>~/.kube</code> directory:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="gp">$ </span>mkdir<span class="w"> </span><span class="nv">$HOME</span>/.kube
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="gp">$ </span>sudo<span class="w"> </span>cp<span class="w"> </span>-f<span class="w"> </span>/etc/kubernetes/admin.conf<span class="w"> </span><span class="nv">$HOME</span>/.kube/config
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="gp">$ </span>sudo<span class="w"> </span>chown<span class="w"> </span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span>:<span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="w"> </span><span class="nv">$HOME</span>/.kube/config
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="gp">$ </span>ls<span class="w"> </span>-l<span class="w"> </span><span class="nv">$HOME</span>/.kube/config
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="go">-rw------- 1 coder coder 5659 Feb 19   2023 /home/coder/.kube/config</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="gp">$ </span>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="go">Kubernetes control plane is running at https://10.0.0.6:6443</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="go">CoreDNS is running at https://10.0.0.6:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="go">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span>
</span></code></pre></div>
<p>And <em>now</em> we can take care of the <em>container runtime network</em>.</p>
<h3 id="network-plugin">Network plugin</h3>
<p><a href="https://v1-27.docs.kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#pod-network">Installing a Pod network add-on</a>
is indeed the very next step after
<em>initializing the control-plane node</em>.</p>
<p>Once again, far from being clear and offering a
direction to follow, the documentation simply points to
<a href="https://v1-27.docs.kubernetes.io/docs/concepts/cluster-administration/addons/#networking-and-network-policy">a non-exhaustive list of networking addons</a>
supported by Kubernetes, without much of a hint as to
which one/s may be a good choice for each scenario.</p>
<p>Having no desire to study multiple network plugins, lets
just install
<a href="https://github.com/flannel-io/flannel?tab=readme-ov-file#getting-started-on-kubernetes">Flannel</a>,
following the recommendation from 
<a href="https://computingforgeeks.com/install-kubernetes-cluster-ubuntu-jammy/">Computing for Geeks</a> and
<a href="https://linuxconfig.org/how-to-install-kubernetes-on-ubuntu-22-04-jammy-jellyfish-linux">LinuxConfig</a>.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="gp">$ </span>wget<span class="w"> </span>https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>kube-flannel.yml
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="go">namespace/kube-flannel created</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="go">serviceaccount/flannel created</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="go">clusterrole.rbac.authorization.k8s.io/flannel created</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/flannel created</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="go">configmap/kube-flannel-cfg created</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="go">daemonset.apps/kube-flannel-ds created</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>kube-flannel
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="go">NAME                        READY   STATUS    RESTARTS   AGE</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a><span class="go">pod/kube-flannel-ds-bbhn8   1/1     Running   0          14s</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a><span class="go">NAME                             DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR   AGE</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="go">daemonset.apps/kube-flannel-ds   1         1         1       1            1           &lt;none&gt;          14s</span>
</span></code></pre></div>
<h3 id="enable-single-node-cluster-as-worker-node">Enable single-node cluster as Worker node</h3>
<p>Before anything else is allowed to run in this cluster,
<a href="https://v1-27.docs.kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#control-plane-node-isolation">Control plane node isolation</a>
must be setup. By default, for security reasons, the cluster will
not schedule Pods to run in this node because it is running
the control plane. This is reflected by the <strong>Taints</strong>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="go">NAME      STATUS   ROLES           AGE   VERSION</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="go">rapture   Ready    control-plane   38m   v1.26.15</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>node<span class="w"> </span>rapture
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="go">Name:               rapture</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="go">Roles:              control-plane</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="go">Labels:             beta.kubernetes.io/arch=amd64</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#__codelineno-25-9"></a><span class="go">                    beta.kubernetes.io/os=linux</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#__codelineno-25-10"></a><span class="go">                    kubernetes.io/arch=amd64</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#__codelineno-25-11"></a><span class="go">                    kubernetes.io/hostname=rapture</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#__codelineno-25-12"></a><span class="go">                    kubernetes.io/os=linux</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#__codelineno-25-13"></a><span class="go">                    node-role.kubernetes.io/control-plane=</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#__codelineno-25-14"></a><span class="go">                    node.kubernetes.io/exclude-from-external-load-balancers=</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#__codelineno-25-15"></a><span class="go">Annotations:        flannel.alpha.coreos.com/backend-data: {"VNI":1,"VtepMAC":"d6:46:a2:fe:00:f8"}</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#__codelineno-25-16"></a><span class="go">                    flannel.alpha.coreos.com/backend-type: vxlan</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#__codelineno-25-17"></a><span class="go">                    flannel.alpha.coreos.com/kube-subnet-manager: true</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#__codelineno-25-18"></a><span class="go">                    flannel.alpha.coreos.com/public-ip: 10.0.0.2</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#__codelineno-25-19"></a><span class="go">                    kubeadm.alpha.kubernetes.io/cri-socket: unix:///run/containerd/containerd.sock</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#__codelineno-25-20"></a><span class="go">                    node.alpha.kubernetes.io/ttl: 0</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#__codelineno-25-21"></a><span class="go">                    volumes.kubernetes.io/controller-managed-attach-detach: true</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#__codelineno-25-22"></a><span class="go">CreationTimestamp:  Sun, 12 May 2024 12:51:57 +0200</span>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#__codelineno-25-23"></a><span class="go">Taints:             node-role.kubernetes.io/control-plane:NoSchedule</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#__codelineno-25-24"></a><span class="go">...</span>
</span></code></pre></div>
<p>Remove this taint to allow other pods to be scheduled:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>--all<span class="w"> </span>node-role.kubernetes.io/control-plane-
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="go">node/rapture untainted</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>node<span class="w"> </span>rapture<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-i<span class="w"> </span>taint
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="go">Taints:             &lt;none&gt;</span>
</span></code></pre></div>
<h4 id="test-pod-scheduling">Test Pod Scheduling</h4>
<p>At this point the cluster is ready to run pods, here is a simple test:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://k8s.io/examples/pods/commands.yaml
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="go">pod/command-demo created</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="go">NAME               READY   STATUS      RESTARTS   AGE</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="go">pod/command-demo   0/1     Completed   0          10s</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="go">NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="go">service/kubernetes   ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP   64m</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="gp">$ </span>kubectl<span class="w"> </span>events<span class="w"> </span>pods
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="go">LAST SEEN   TYPE     REASON      OBJECT             MESSAGE</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="go">35m         Normal   NodeReady   Node/rapture       Node rapture status is now: NodeReady</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="go">20s         Normal   Scheduled   Pod/command-demo   Successfully assigned default/command-demo to rapture</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a><span class="go">19s         Normal   Pulling     Pod/command-demo   Pulling image "debian"</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a><span class="go">15s         Normal   Pulled      Pod/command-demo   Successfully pulled image "debian" in 4.165178746s (4.165185238s including waiting)</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a><span class="go">15s         Normal   Created     Pod/command-demo   Created container command-demo-container</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a><span class="go">15s         Normal   Started     Pod/command-demo   Started container command-demo-container</span>
</span></code></pre></div>
<p>With the cluster now ready to run pods and services, we
can move on to installing more components that will be
used by the actual services:
<a href="#metallb-load-balancer">MetalLB Load Balancer</a>,
<a href="#kubernets-dashboard">Kubernets Dashboard</a>,
<a href="#ingress-controller">Ingress Controller</a>, with
<a href="#https-with-lets-encrypt">HTTPS with Letâ€™s Encrypt</a> and
a <a href="#localpath-pv-provisioner">LocalPath PV provisioner</a>
for simple persistent storage in local file systems.</p>
<h4 id="do-not-kubeadm-join">DO NOT <code>kubeadm join</code></h4>
<p><a href="https://v1-27.docs.kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/#join-nodes">Joining your nodes</a>
is only to be done by <strong>other</strong> nodes, no the master.
The master node is <em>already joined</em> and <code>kubeadm</code>
<a href="https://kodekloud.com/community/t/kubeadm-join-fails/337178/3">will not allow joining itself <em>again</em></a>.</p>
<p>Trying to do so, by running the <code>kubeadm join</code> command
provided by <code>kubeadm init</code> will fail:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="gp"># </span>kubeadm<span class="w"> </span>join<span class="w"> </span><span class="m">10</span>.0.0.2:6443<span class="w"> </span>--token<span class="w"> </span>wjnord.g9lpm4heieilydn7<span class="w"> </span><span class="se">\</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">        </span>--discovery-token-ca-cert-hash<span class="w"> </span>sha256:bfe7582cfdf2d60c74c18da6aedfa7d5943b314cedd0ee25af996aecbd5a0c0f
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="go">[preflight] Running pre-flight checks</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="go">error execution phase preflight: [preflight] Some fatal errors occurred:</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="go">        [ERROR FileAvailable--etc-kubernetes-kubelet.conf]: /etc/kubernetes/kubelet.conf already exists</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="go">        [ERROR Port-10250]: Port 10250 is in use</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="go">        [ERROR FileAvailable--etc-kubernetes-pki-ca.crt]: /etc/kubernetes/pki/ca.crt already exists</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="go">[preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...`</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="go">To see the stack trace of this error execute with --v=5 or higher</span>
</span></code></pre></div>
<p>In order to <em>resolve</em> those pre-flight checks one would
have to <code>kubeadm reset</code> which would only undo the work!</p>
<h2 id="metallb-load-balancer">MetalLB Load Balancer</h2>
<p>A Load Balancer is going to be necessary for the
<a href="#kubernets-dashboard">Dashboard</a>
and other services, to expose individual services via open
ports on the server (<code>NodePort</code>) or virtual IP addresses.
<a href="https://metallb.universe.tf/installation/#installation-by-manifest">Installation By Manifest</a>
is as simple as applying the provided manifest:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="gp">$ </span>wget<span class="w"> </span>https://raw.githubusercontent.com/metallb/metallb/v0.14.5/config/manifests/metallb-native.yaml
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>metallb-native.yaml
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="go">namespace/metallb-system created</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bfdprofiles.metallb.io created</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bgpadvertisements.metallb.io created</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/bgppeers.metallb.io created</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/communities.metallb.io created</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/ipaddresspools.metallb.io created</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/l2advertisements.metallb.io created</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a><span class="go">customresourcedefinition.apiextensions.k8s.io/servicel2statuses.metallb.io created</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="go">serviceaccount/controller created</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="go">serviceaccount/speaker created</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="go">role.rbac.authorization.k8s.io/controller created</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="go">role.rbac.authorization.k8s.io/pod-lister created</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="go">clusterrole.rbac.authorization.k8s.io/metallb-system:controller created</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="go">clusterrole.rbac.authorization.k8s.io/metallb-system:speaker created</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="go">rolebinding.rbac.authorization.k8s.io/controller created</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="go">rolebinding.rbac.authorization.k8s.io/pod-lister created</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/metallb-system:controller created</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/metallb-system:speaker created</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="go">configmap/metallb-excludel2 created</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="go">secret/metallb-webhook-cert created</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="go">service/metallb-webhook-service created</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#__codelineno-29-25"></a><span class="go">deployment.apps/controller created</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#__codelineno-29-26"></a><span class="go">daemonset.apps/speaker created</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#__codelineno-29-27"></a><span class="go">validatingwebhookconfiguration.admissionregistration.k8s.io/metallb-webhook-configuration created</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>YAML files for MetalLB will be stored for
future reference, under <code>1.26/metallb</code> in the
<a href="#github-repository">GitHub repository</a>.</p>
</div>
<p>MetalLB remains idle until configured, which is done by
deploying resources into its namespace (<code>metallb-system</code>).
In this PC, a small range of IP addresses is advertised via
<a href="https://metallb.universe.tf/configuration/#layer-2-configuration">Layer 2 Configuration</a>, which does not
not require the IPs to be bound to the network interfaces:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">metallb/ipaddress_pools.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb.io/v1beta1</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IPAddressPool</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rapture-pool</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb-system</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">  </span><span class="nt">addresses</span><span class="p">:</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.220-192.168.0.229</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="nn">---</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb.io/v1beta1</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">L2Advertisement</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">l2-advert</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">metallb-system</span>
</span></code></pre></div></td></tr></table></div>
<p>Store this configuration in a separate, host-specific file (<code>ipaddress-pool-rapture.yaml</code>) and apply it:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>ipaddress-pool-rapture.yaml
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="go">ipaddresspool.metallb.io/rapture-pool created</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="go">l2advertisement.metallb.io/l2-advert created</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>l2advertisements.metallb.io<span class="w"> </span>-n<span class="w"> </span>metallb-system
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="go">NAME        IPADDRESSPOOLS   IPADDRESSPOOL SELECTORS   INTERFACES</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="go">l2-advert</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>ipaddresspools.metallb.io<span class="w"> </span>-n<span class="w"> </span>metallb-system
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="go">NAME           AUTO ASSIGN   AVOID BUGGY IPS   ADDRESSES</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="go">rapture-pool   true          false             ["192.168.0.220-192.168.0.229"]</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>ipaddresspools.metallb.io<span class="w"> </span>rapture-pool<span class="w"> </span>-n<span class="w"> </span>metallb-system
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="go">Name:         rapture-pool</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="go">Namespace:    metallb-system</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="go">Labels:       &lt;none&gt;</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="go">Annotations:  &lt;none&gt;</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="go">API Version:  metallb.io/v1beta1</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="go">Kind:         IPAddressPool</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="go">Metadata:</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="go">  Creation Timestamp:  2024-05-12T13:34:20Z</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="go">  Generation:          1</span>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="go">  Managed Fields:</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#__codelineno-31-24"></a><span class="go">    API Version:  metallb.io/v1beta1</span>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#__codelineno-31-25"></a><span class="go">    Fields Type:  FieldsV1</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#__codelineno-31-26"></a><span class="go">    fieldsV1:</span>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#__codelineno-31-27"></a><span class="go">      f:metadata:</span>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#__codelineno-31-28"></a><span class="go">        f:annotations:</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#__codelineno-31-29"></a><span class="go">          .:</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#__codelineno-31-30"></a><span class="go">          f:kubectl.kubernetes.io/last-applied-configuration:</span>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#__codelineno-31-31"></a><span class="go">      f:spec:</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#__codelineno-31-32"></a><span class="go">        .:</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33" href="#__codelineno-31-33"></a><span class="go">        f:addresses:</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34" href="#__codelineno-31-34"></a><span class="go">        f:autoAssign:</span>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35" href="#__codelineno-31-35"></a><span class="go">        f:avoidBuggyIPs:</span>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36" href="#__codelineno-31-36"></a><span class="go">    Manager:         kubectl-client-side-apply</span>
</span><span id="__span-31-37"><a id="__codelineno-31-37" name="__codelineno-31-37" href="#__codelineno-31-37"></a><span class="go">    Operation:       Update</span>
</span><span id="__span-31-38"><a id="__codelineno-31-38" name="__codelineno-31-38" href="#__codelineno-31-38"></a><span class="go">    Time:            2024-05-12T13:34:20Z</span>
</span><span id="__span-31-39"><a id="__codelineno-31-39" name="__codelineno-31-39" href="#__codelineno-31-39"></a><span class="go">  Resource Version:  13194</span>
</span><span id="__span-31-40"><a id="__codelineno-31-40" name="__codelineno-31-40" href="#__codelineno-31-40"></a><span class="go">  UID:               979ae8fc-7cad-48df-9c2c-744c242a5075</span>
</span><span id="__span-31-41"><a id="__codelineno-31-41" name="__codelineno-31-41" href="#__codelineno-31-41"></a><span class="go">Spec:</span>
</span><span id="__span-31-42"><a id="__codelineno-31-42" name="__codelineno-31-42" href="#__codelineno-31-42"></a><span class="go">  Addresses:</span>
</span><span id="__span-31-43"><a id="__codelineno-31-43" name="__codelineno-31-43" href="#__codelineno-31-43"></a><span class="go">    192.168.0.220-192.168.0.229</span>
</span><span id="__span-31-44"><a id="__codelineno-31-44" name="__codelineno-31-44" href="#__codelineno-31-44"></a><span class="go">  Auto Assign:       true</span>
</span><span id="__span-31-45"><a id="__codelineno-31-45" name="__codelineno-31-45" href="#__codelineno-31-45"></a><span class="go">  Avoid Buggy I Ps:  false</span>
</span><span id="__span-31-46"><a id="__codelineno-31-46" name="__codelineno-31-46" href="#__codelineno-31-46"></a><span class="go">Events:              &lt;none&gt;</span>
</span></code></pre></div>
<p>The range <strong>192.168.0.220-192.168.0.229</strong> is based on the
local DHCP server being configured to lease 228 addresses
starting with 192.168.0.2. The current active leases are
reserved so they donâ€™t change, and the range 122-140 are
just not leased so far. The reason to use IPs from the leased
range is that the router only allows adding port forwarding
rules for those. This range is intentionally on the same
network range and subnet as the DHCP server so that no
routing is required to reach MetalLB IP addresses.</p>
<h2 id="kubernets-dashboard">Kubernets Dashboard</h2>
<p>The first service to leverage all the above infrastructure,
including virtual IP addresses from the
<a href="#metallb-load-balancer">MetalLB Load Balancer</a>, is the
<a href="https://v1-27.docs.kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Kubernetes Dashboard</a>.</p>
<p>Once again, this service is deployed by manifest:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="gp">$ </span>wget<span class="w"> </span>-O<span class="w"> </span>kubernetes-dashboard.yaml<span class="w"> </span><span class="se">\</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">  </span>https://raw.githubusercontent.com/kubernetes/dashboard/v2.7.0/aio/deploy/recommended.yaml
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>YAML files for MetalLB will be stored for
future reference, under <code>1.26/dashboard</code> in the
<a href="#github-repository">GitHub repository</a>.</p>
</div>
<p>In this case to make the dashboard easily available in the
local network, we edit the deployment to add <code>type: LoadBalancer</code>
to the <code>kubernetes-dashboard</code> <strong>service</strong> (line 30):</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">kubernetes-dashboard.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-33-30">30</a></span>
<span class="normal"><a href="#__codelineno-33-31">31</a></span>
<span class="normal"><a href="#__codelineno-33-32">32</a></span>
<span class="normal"><a href="#__codelineno-33-33">33</a></span>
<span class="normal"><a href="#__codelineno-33-34">34</a></span>
<span class="normal"><a href="#__codelineno-33-35">35</a></span>
<span class="normal"><a href="#__codelineno-33-36">36</a></span>
<span class="normal"><a href="#__codelineno-33-37">37</a></span>
<span class="normal"><a href="#__codelineno-33-38">38</a></span>
<span class="normal"><a href="#__codelineno-33-39">39</a></span>
<span class="normal"><a href="#__codelineno-33-40">40</a></span>
<span class="normal"><a href="#__codelineno-33-41">41</a></span>
<span class="normal"><a href="#__codelineno-33-42">42</a></span>
<span class="normal"><a href="#__codelineno-33-43">43</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-33-32"><a id="__codelineno-33-32" name="__codelineno-33-32"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-33-33"><a id="__codelineno-33-33" name="__codelineno-33-33"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-33-34"><a id="__codelineno-33-34" name="__codelineno-33-34"></a><span class="w">    </span><span class="nt">k8s-app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-33-35"><a id="__codelineno-33-35" name="__codelineno-33-35"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-33-36"><a id="__codelineno-33-36" name="__codelineno-33-36"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span><span id="__span-33-37"><a id="__codelineno-33-37" name="__codelineno-33-37"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-33-38"><a id="__codelineno-33-38" name="__codelineno-33-38"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span><span id="__span-33-39"><a id="__codelineno-33-39" name="__codelineno-33-39"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-33-40"><a id="__codelineno-33-40" name="__codelineno-33-40"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span><span id="__span-33-41"><a id="__codelineno-33-41" name="__codelineno-33-41"></a><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8443</span>
</span><span id="__span-33-42"><a id="__codelineno-33-42" name="__codelineno-33-42"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-33-43"><a id="__codelineno-33-43" name="__codelineno-33-43"></a><span class="w">    </span><span class="nt">k8s-app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes-dashboard</span>
</span></code></pre></div></td></tr></table></div>
<p>After applying this deployment, a virtual IP address will
be assign to it, where the dashboard can be accessed:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>kubernetes-dashboard.yaml
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="go">namespace/kubernetes-dashboard created</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="go">serviceaccount/kubernetes-dashboard created</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="go">service/kubernetes-dashboard created</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="go">secret/kubernetes-dashboard-certs created</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="go">secret/kubernetes-dashboard-csrf created</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="go">secret/kubernetes-dashboard-key-holder created</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="go">configmap/kubernetes-dashboard-settings created</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="go">role.rbac.authorization.k8s.io/kubernetes-dashboard created</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="go">clusterrole.rbac.authorization.k8s.io/kubernetes-dashboard created</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="go">rolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/kubernetes-dashboard created</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="go">deployment.apps/kubernetes-dashboard created</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="go">service/dashboard-metrics-scraper created</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="go">deployment.apps/dashboard-metrics-scraper created</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>kubernetes-dashboard
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="go">NAME                        TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)         AGE</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a><span class="go">dashboard-metrics-scraper   ClusterIP      10.107.131.104   &lt;none&gt;          8000/TCP        32s</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="go">kubernetes-dashboard        LoadBalancer   10.107.235.155   192.168.0.229   443:30480/TCP   32s</span>
</span></code></pre></div>
<p>The dashboard is accessible at <a href="https://192.168.0.229">https://192.168.0.229</a>
but not exactly accessible without a login token:</p>
<p><a class="glightbox" href="../../../../media/2024-05-12-single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/kubernetes-dashboard-login.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Kubernetes Dashboard login page" src="../../../../media/2024-05-12-single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/kubernetes-dashboard-login.png"></a></p>
<p>The <a href="https://kubernetes.io/docs/admin/authentication/">Authentication</a>
link is broken; the documentation that seems most relevant to
authenticating Service Accounts to acess the dashboard is the
<a href="https://v1-27.docs.kubernetes.io/docs/reference/access-authn-authz/authentication/">Authenticating</a> page, which
does not quite explain how to create a Service Account,
grant it access to the dashboard <em>and then</em> obtain a token.
Neither does the documentation to
<a href="https://v1-27.docs.kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Deploy <strong>and Access</strong> the Kubernetes Dashboard</a>.</p>
<p>For this, I really had to resort to the
<a href="https://computingforgeeks.com/create-admin-user-to-access-kubernetes-dashboard/">Creating Kubernetes Admin User for Accessing Dashboard</a>
article. To create a Service Account and grant it access to
everything (the <code>cluster-admin</code> roles), apply the following
manifest as <code>admin-sa-rbac.yaml</code></p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">admin-sa-rbac.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-35-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-35-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-35-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-35-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-35-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-35-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-35-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-35-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-35-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-35-10">10</a></span>
<span class="normal"><a href="#__codelineno-35-11">11</a></span>
<span class="normal"><a href="#__codelineno-35-12">12</a></span>
<span class="normal"><a href="#__codelineno-35-13">13</a></span>
<span class="normal"><a href="#__codelineno-35-14">14</a></span>
<span class="normal"><a href="#__codelineno-35-15">15</a></span>
<span class="normal"><a href="#__codelineno-35-16">16</a></span>
<span class="normal"><a href="#__codelineno-35-17">17</a></span>
<span class="normal"><a href="#__codelineno-35-18">18</a></span>
<span class="normal"><a href="#__codelineno-35-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8sadmin</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="nn">---</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io/v1</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRoleBinding</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8sadmin</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="nt">roleRef</span><span class="p">:</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="w">  </span><span class="nt">apiGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">rbac.authorization.k8s.io</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterRole</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster-admin</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="nt">subjects</span><span class="p">:</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ServiceAccount</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">k8sadmin</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19"></a><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kube-system</span>
</span></code></pre></div></td></tr></table></div>
<div class="language-console highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>admin-sa-rbac.yaml
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="go">serviceaccount/k8sadmin created</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/k8sadmin created</span>
</span></code></pre></div>
<p>Now one can create a token for the <code>k8sadmin</code> user and use it
to access the dashboard:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>create<span class="w"> </span>token<span class="w"> </span>k8sadmin<span class="w"> </span>-n<span class="w"> </span>kube-system
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="go">eyJhbGciOiJSUzI1NiIsImtpZCI6IkktZ05rdlNzcVNzb1F0S3VYYmo3TXlpMjdTU2ktUUhpSzQwcUNLOTBRMXMifQ.eyJhdWQiOlsiaHR0cHM6Ly9rdWJlcm5ldGVzLmRlZmF1bHQuc3ZjLmNsdXN0ZXIubG9jYWwiXSwiZXhwIjoxNzE1NTMwNTQyLCJpYXQiOjE3MTU1MjY5NDIsImlzcyI6Imh0dHBzOi8va3ViZXJuZXRlcy5kZWZhdWx0LnN2Yy5jbHVzdGVyLmxvY2FsIiwia3ViZXJuZXRlcy5pbyI6eyJuYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsInNlcnZpY2VhY2NvdW50Ijp7Im5hbWUiOiJrOHNhZG1pbiIsInVpZCI6IjJjMDliOTU3LTBhYzItNDQyNy05YjA2LWFiZDBhMmI5OTJhNyJ9fSwibmJmIjoxNzE1NTI2OTQyLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06azhzYWRtaW4ifQ.e6aAjUZvHvtZCN-QJAwFVt0I9pDklXC0La8RA-SjWTguEuAm0YbTgeOkRUKzb1q5_lkYIvpVyFN_E5z5IH1s6ygWdcWqS_RYtsmdQGr7iBTbpk-2cZb3bmt-mZkfDkYGgThNbzYoQ2gqXHSYnRtQKH2Spz6j_xt3G42IL1WGrfZIrdfBcLnkRBe1-l76qt1i0mq1wDwcSR2XAi3EpaOF-65f19__DYY4nt2JkhgxixpC-TZCLOXTfOAmbfbLoR07BmLZxw97Y85tvtYj1un7vQmgeDTBmWqtHIV4hYBlgH4ljUNIZg11GWECkOcd6UrHHtG8IG3REh87dAF2eD5Ysw</span>
</span></code></pre></div>
<p><a class="glightbox" href="../../../../media/2024-05-12-single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/kubernetes-dashboard-home.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Kubernetes Dashboard home page" src="../../../../media/2024-05-12-single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/kubernetes-dashboard-home.png"></a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>At this point the SSL certificate is not yet valid, this will be
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/#add-ingress-for-kubernetes-dashboard">addressed later</a>
by accessing the dashboard via an
<a href="#ingress-controller">Ingress Controller</a> with
<a href="#https-with-lets-encrypt">HTTPS</a>.</p>
</div>
<h2 id="ingress-controller">Ingress Controller</h2>
<p>An Nginx Ingress Controller will be used to redirect <strong>HTTPS</strong>
requests to different services depending on the <code>Host:</code> header,
while all those requests will be hitting the same IP address.</p>
<p>Download the deployment manifest following the
<a href="https://kubernetes.github.io/ingress-nginx/deploy/">Installation Guide</a>
from
<a href="https://github.com/kubernetes/ingress-nginx">kubernetes/ingress-nginx</a></p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="gp">$ </span>wget<span class="w"> </span>-O<span class="w"> </span>nginx-ingress-controller.yaml<span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">  </span>https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.10.1/deploy/static/provider/cloud/deploy.yaml
</span></code></pre></div>
<p>To serve HTTPS requests on a single IP address, the
<code>ingress-nginx-controller</code> <strong>service</strong> must be created with
<code>type: LoadBalancer</code>. As it happens, the <code>v1.10.1</code> manifest
already has this property set in line 366:</p>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">nginx-ingress-controller.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-39-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-39-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-39-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-39-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-39-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-39-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-39-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-39-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-39-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-39-10">10</a></span>
<span class="normal"><a href="#__codelineno-39-11">11</a></span>
<span class="normal"><a href="#__codelineno-39-12">12</a></span>
<span class="normal"><a href="#__codelineno-39-13">13</a></span>
<span class="normal"><a href="#__codelineno-39-14">14</a></span>
<span class="normal"><a href="#__codelineno-39-15">15</a></span>
<span class="normal"><a href="#__codelineno-39-16">16</a></span>
<span class="normal"><a href="#__codelineno-39-17">17</a></span>
<span class="normal"><a href="#__codelineno-39-18">18</a></span>
<span class="normal"><a href="#__codelineno-39-19">19</a></span>
<span class="normal"><a href="#__codelineno-39-20">20</a></span>
<span class="normal"><a href="#__codelineno-39-21">21</a></span>
<span class="normal"><a href="#__codelineno-39-22">22</a></span>
<span class="normal"><a href="#__codelineno-39-23">23</a></span>
<span class="normal"><a href="#__codelineno-39-24">24</a></span>
<span class="normal"><a href="#__codelineno-39-25">25</a></span>
<span class="normal"><a href="#__codelineno-39-26">26</a></span>
<span class="normal"><a href="#__codelineno-39-27">27</a></span>
<span class="normal"><a href="#__codelineno-39-28">28</a></span>
<span class="normal"><a href="#__codelineno-39-29">29</a></span>
<span class="normal"><a href="#__codelineno-39-30">30</a></span>
<span class="normal"><a href="#__codelineno-39-31">31</a></span>
<span class="normal"><a href="#__codelineno-39-32">32</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controller</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7"></a><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="w">    </span><span class="nt">app.kubernetes.io/part-of</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9"></a><span class="w">    </span><span class="nt">app.kubernetes.io/version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1.10.1</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx-controller</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13"></a><span class="w">  </span><span class="nt">externalTrafficPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Local</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14"></a><span class="w">  </span><span class="nt">ipFamilies</span><span class="p">:</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IPv4</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16"></a><span class="w">  </span><span class="nt">ipFamilyPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SingleStack</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">appProtocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">appProtocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https</span>
</span><span id="__span-39-28"><a id="__codelineno-39-28" name="__codelineno-39-28"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-39-29"><a id="__codelineno-39-29" name="__codelineno-39-29"></a><span class="w">    </span><span class="nt">app.kubernetes.io/component</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">controller</span>
</span><span id="__span-39-30"><a id="__codelineno-39-30" name="__codelineno-39-30"></a><span class="w">    </span><span class="nt">app.kubernetes.io/instance</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
</span><span id="__span-39-31"><a id="__codelineno-39-31" name="__codelineno-39-31"></a><span class="w">    </span><span class="nt">app.kubernetes.io/name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-nginx</span>
</span><span id="__span-39-32"><a id="__codelineno-39-32" name="__codelineno-39-32"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span></code></pre></div></td></tr></table></div>
<p>After applying this deployment, another virtual IP address
is assigned to the <code>ingress-nginx-controller</code> service and
there is NGinx happily returning 404 Not found:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w">  </span>nginx-ingress-controller.yaml
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="go">namespace/ingress-nginx created</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="go">serviceaccount/ingress-nginx created</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="go">serviceaccount/ingress-nginx-admission created</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="go">role.rbac.authorization.k8s.io/ingress-nginx created</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="go">role.rbac.authorization.k8s.io/ingress-nginx-admission created</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="go">clusterrole.rbac.authorization.k8s.io/ingress-nginx created</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="go">clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="go">rolebinding.rbac.authorization.k8s.io/ingress-nginx created</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="go">rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="go">clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="go">configmap/ingress-nginx-controller created</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="go">service/ingress-nginx-controller created</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="go">service/ingress-nginx-controller-admission created</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="go">deployment.apps/ingress-nginx-controller created</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="go">job.batch/ingress-nginx-admission-create created</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="go">job.batch/ingress-nginx-admission-patch created</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="go">ingressclass.networking.k8s.io/nginx created</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a><span class="go">validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created</span>
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a>
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>ingress-nginx
</span><span id="__span-40-23"><a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a><span class="go">NAME                                 TYPE           CLUSTER-IP     EXTERNAL-IP     PORT(S)                      AGE</span>
</span><span id="__span-40-24"><a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a><span class="go">ingress-nginx-controller             LoadBalancer   10.97.59.176   192.168.0.228   80:30706/TCP,443:30199/TCP   28s</span>
</span><span id="__span-40-25"><a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a><span class="go">ingress-nginx-controller-admission   ClusterIP      10.98.208.0    &lt;none&gt;          443/TCP                      28s</span>
</span><span id="__span-40-26"><a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a>
</span><span id="__span-40-27"><a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a><span class="gp">$ </span>curl<span class="w"> </span>http://192.168.0.228/
</span><span id="__span-40-28"><a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a><span class="go">&lt;html&gt;</span>
</span><span id="__span-40-29"><a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a><span class="go">&lt;head&gt;&lt;title&gt;404 Not Found&lt;/title&gt;&lt;/head&gt;</span>
</span><span id="__span-40-30"><a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a><span class="go">&lt;body&gt;</span>
</span><span id="__span-40-31"><a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a><span class="go">&lt;center&gt;&lt;h1&gt;404 Not Found&lt;/h1&gt;&lt;/center&gt;</span>
</span><span id="__span-40-32"><a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a><span class="go">&lt;hr&gt;&lt;center&gt;nginx&lt;/center&gt;</span>
</span><span id="__span-40-33"><a id="__codelineno-40-33" name="__codelineno-40-33" href="#__codelineno-40-33"></a><span class="go">&lt;/body&gt;</span>
</span><span id="__span-40-34"><a id="__codelineno-40-34" name="__codelineno-40-34" href="#__codelineno-40-34"></a><span class="go">&lt;/html&gt;</span>
</span></code></pre></div>
<h2 id="https-with-lets-encrypt">HTTPS with Letâ€™s Encrypt</h2>
<p>The
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/#kubernetes-setup">Kubernetes setup for Letâ€™s Encrypt in Lexicon</a>
was riddled with <em>first-time issues</em>, but I was able to
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/#add-ingress-for-kubernetes-dashboard">Add Ingress for Kubernetes Dashboard</a>
and setup en entirely
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/#monthly-renewal-of-certificates-automated"><em>automated</em> monthly renewal of certificates</a>.
However, the entire <em>Letâ€™s Encrypt</em> system to obtain and
renew certificates relies on external requests reaching the
NGinx controller, which is precisely some to avoid here.</p>
<p>If and when it becomes necessary, the setup can be replicated
even if that involves manually renewing certifidates each
month. While any other external requests would not be routed
to this PC, <code>/etc/hosts</code> can be used to map rapture.uu.am
to the NGinx LoadBalancer IP (192.168.0.228) so that
<em>external-looking</em> URLs can be used for this internal traffic.</p>
<p>In the meantime, <code>/etc/hosts</code> can be used to map specific
subdomains to the LoadBalancer IPs of individual services, e.g.
k8s.rapture.uu.am can be mapped to 192.168.0.229 so that
the dashboard is accessible at
<a href="https://k8s.rapture.uu.am/">https://k8s.rapture.uu.am/</a>.</p>
<h2 id="localpath-pv-provisioner">LocalPath PV provisioner</h2>
<p>By default, a Kubernetes cluster is not set up to provide storage to pods. This was problematic for a while, especially
when trying to 
<a href="https://docs.gitlab.com/charts/installation/deployment.html">deploy GitLab with Helm</a>
without first taking the time to
<a href="https://docs.gitlab.com/charts/installation/storage.html">Configure storage for the GitLab chart</a>.</p>
<p>Before finding out that the
<a href="https://docs.gitlab.com/charts/">GitLab Helm chart</a> requires
more CPU to be allocated than available, I spent some time to
setup a
<a href="../../../../2023/03/25/single-node-kubernetes-cluster-on-ubuntu-server-lexicon/#localpath-pv-provisioner">LocalPath PV provisioner in Lexicon</a>
but this was never really used. In the end, <strong>all</strong> services
deployed in Lexicon are using <code>storageClassName: manual</code> with
<code>hostPath</code> pointing to specific directories in local file
systems.</p>
<p>This may become necessary in the future, e.g. when installing
GitLab, at which point the setup can be replicated in this PC,
but that may be more appropriate to capture along with the work
to fullfil all other
<a href="https://docs.gitlab.com/charts/installation/tools.html">GitLab chart prerequisites</a>.</p>
<h2 id="audiobookshelf">Audiobookshelf</h2>
<p><a href="../../../02/28/audiobookshelf-on-kubernetes/">Audiobookshelf</a> may be a good example to
check much better a service runs having many more CPU cores
available. For this test, the deployment is limited to just
audiobooks (no podcasts), stored under a different path
(<code>/home/new-ssd</code>) for faster storage (see monitoring below),
and served via <code>LoadBalancer</code> IP:</p>
<details class="k8s">
<summary>Kubernetes deployment: <code>audiobookshelf.yaml</code></summary>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">audiobookshelf.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-1">  1</a></span>
<span class="normal"><a href="#__codelineno-41-2">  2</a></span>
<span class="normal"><a href="#__codelineno-41-3">  3</a></span>
<span class="normal"><a href="#__codelineno-41-4">  4</a></span>
<span class="normal"><a href="#__codelineno-41-5">  5</a></span>
<span class="normal"><a href="#__codelineno-41-6">  6</a></span>
<span class="normal"><a href="#__codelineno-41-7">  7</a></span>
<span class="normal"><a href="#__codelineno-41-8">  8</a></span>
<span class="normal"><a href="#__codelineno-41-9">  9</a></span>
<span class="normal"><a href="#__codelineno-41-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-41-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-41-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-41-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-41-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-41-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-41-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-41-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-41-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-41-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-41-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-41-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-41-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-41-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-41-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-41-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-41-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-41-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-41-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-41-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-41-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-41-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-41-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-41-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-41-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-41-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-41-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-41-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-41-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-41-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-41-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-41-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-41-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-41-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-41-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-41-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-41-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-41-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-41-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-41-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-41-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-41-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-41-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-41-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-41-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-41-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-41-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-41-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-41-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-41-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-41-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-41-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-41-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-41-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-41-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-41-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-41-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-41-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-41-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-41-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-41-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-41-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-41-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-41-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-41-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-41-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-41-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-41-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-41-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-41-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-41-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-41-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-41-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-41-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-41-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-41-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-41-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-41-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-41-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-41-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-41-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-41-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-41-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-41-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-41-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-41-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-41-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-41-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-41-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-41-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-41-100">100</a></span>
<span class="normal"><a href="#__codelineno-41-101">101</a></span>
<span class="normal"><a href="#__codelineno-41-102">102</a></span>
<span class="normal"><a href="#__codelineno-41-103">103</a></span>
<span class="normal"><a href="#__codelineno-41-104">104</a></span>
<span class="normal"><a href="#__codelineno-41-105">105</a></span>
<span class="normal"><a href="#__codelineno-41-106">106</a></span>
<span class="normal"><a href="#__codelineno-41-107">107</a></span>
<span class="normal"><a href="#__codelineno-41-108">108</a></span>
<span class="normal"><a href="#__codelineno-41-109">109</a></span>
<span class="normal"><a href="#__codelineno-41-110">110</a></span>
<span class="normal"><a href="#__codelineno-41-111">111</a></span>
<span class="normal"><a href="#__codelineno-41-112">112</a></span>
<span class="normal"><a href="#__codelineno-41-113">113</a></span>
<span class="normal"><a href="#__codelineno-41-114">114</a></span>
<span class="normal"><a href="#__codelineno-41-115">115</a></span>
<span class="normal"><a href="#__codelineno-41-116">116</a></span>
<span class="normal"><a href="#__codelineno-41-117">117</a></span>
<span class="normal"><a href="#__codelineno-41-118">118</a></span>
<span class="normal"><a href="#__codelineno-41-119">119</a></span>
<span class="normal"><a href="#__codelineno-41-120">120</a></span>
<span class="normal"><a href="#__codelineno-41-121">121</a></span>
<span class="normal"><a href="#__codelineno-41-122">122</a></span>
<span class="normal"><a href="#__codelineno-41-123">123</a></span>
<span class="normal"><a href="#__codelineno-41-124">124</a></span>
<span class="normal"><a href="#__codelineno-41-125">125</a></span>
<span class="normal"><a href="#__codelineno-41-126">126</a></span>
<span class="normal"><a href="#__codelineno-41-127">127</a></span>
<span class="normal"><a href="#__codelineno-41-128">128</a></span>
<span class="normal"><a href="#__codelineno-41-129">129</a></span>
<span class="normal"><a href="#__codelineno-41-130">130</a></span>
<span class="normal"><a href="#__codelineno-41-131">131</a></span>
<span class="normal"><a href="#__codelineno-41-132">132</a></span>
<span class="normal"><a href="#__codelineno-41-133">133</a></span>
<span class="normal"><a href="#__codelineno-41-134">134</a></span>
<span class="normal"><a href="#__codelineno-41-135">135</a></span>
<span class="normal"><a href="#__codelineno-41-136">136</a></span>
<span class="normal"><a href="#__codelineno-41-137">137</a></span>
<span class="normal"><a href="#__codelineno-41-138">138</a></span>
<span class="normal"><a href="#__codelineno-41-139">139</a></span>
<span class="normal"><a href="#__codelineno-41-140">140</a></span>
<span class="normal"><a href="#__codelineno-41-141">141</a></span>
<span class="normal"><a href="#__codelineno-41-142">142</a></span>
<span class="normal"><a href="#__codelineno-41-143">143</a></span>
<span class="normal"><a href="#__codelineno-41-144">144</a></span>
<span class="normal"><a href="#__codelineno-41-145">145</a></span>
<span class="normal"><a href="#__codelineno-41-146">146</a></span>
<span class="normal"><a href="#__codelineno-41-147">147</a></span>
<span class="normal"><a href="#__codelineno-41-148">148</a></span>
<span class="normal"><a href="#__codelineno-41-149">149</a></span>
<span class="normal"><a href="#__codelineno-41-150">150</a></span>
<span class="normal"><a href="#__codelineno-41-151">151</a></span>
<span class="normal"><a href="#__codelineno-41-152">152</a></span>
<span class="normal"><a href="#__codelineno-41-153">153</a></span>
<span class="normal"><a href="#__codelineno-41-154">154</a></span>
<span class="normal"><a href="#__codelineno-41-155">155</a></span>
<span class="normal"><a href="#__codelineno-41-156">156</a></span>
<span class="normal"><a href="#__codelineno-41-157">157</a></span>
<span class="normal"><a href="#__codelineno-41-158">158</a></span>
<span class="normal"><a href="#__codelineno-41-159">159</a></span>
<span class="normal"><a href="#__codelineno-41-160">160</a></span>
<span class="normal"><a href="#__codelineno-41-161">161</a></span>
<span class="normal"><a href="#__codelineno-41-162">162</a></span>
<span class="normal"><a href="#__codelineno-41-163">163</a></span>
<span class="normal"><a href="#__codelineno-41-164">164</a></span>
<span class="normal"><a href="#__codelineno-41-165">165</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5"></a><span class="nn">---</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-config</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-41-15"><a id="__codelineno-41-15" name="__codelineno-41-15"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-41-16"><a id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-41-17"><a id="__codelineno-41-17" name="__codelineno-41-17"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-41-18"><a id="__codelineno-41-18" name="__codelineno-41-18"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-41-19"><a id="__codelineno-41-19" name="__codelineno-41-19"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/audiobookshelf/config</span>
</span><span id="__span-41-20"><a id="__codelineno-41-20" name="__codelineno-41-20"></a><span class="nn">---</span>
</span><span id="__span-41-21"><a id="__codelineno-41-21" name="__codelineno-41-21"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-41-22"><a id="__codelineno-41-22" name="__codelineno-41-22"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-41-23"><a id="__codelineno-41-23" name="__codelineno-41-23"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-24"><a id="__codelineno-41-24" name="__codelineno-41-24"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-metadata</span>
</span><span id="__span-41-25"><a id="__codelineno-41-25" name="__codelineno-41-25"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-26"><a id="__codelineno-41-26" name="__codelineno-41-26"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-27"><a id="__codelineno-41-27" name="__codelineno-41-27"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-41-28"><a id="__codelineno-41-28" name="__codelineno-41-28"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-41-29"><a id="__codelineno-41-29" name="__codelineno-41-29"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-41-30"><a id="__codelineno-41-30" name="__codelineno-41-30"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-41-31"><a id="__codelineno-41-31" name="__codelineno-41-31"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-41-32"><a id="__codelineno-41-32" name="__codelineno-41-32"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-41-33"><a id="__codelineno-41-33" name="__codelineno-41-33"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-41-34"><a id="__codelineno-41-34" name="__codelineno-41-34"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/audiobookshelf/metadata</span>
</span><span id="__span-41-35"><a id="__codelineno-41-35" name="__codelineno-41-35"></a><span class="nn">---</span>
</span><span id="__span-41-36"><a id="__codelineno-41-36" name="__codelineno-41-36"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-41-37"><a id="__codelineno-41-37" name="__codelineno-41-37"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-41-38"><a id="__codelineno-41-38" name="__codelineno-41-38"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-39"><a id="__codelineno-41-39" name="__codelineno-41-39"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-audiobooks</span>
</span><span id="__span-41-40"><a id="__codelineno-41-40" name="__codelineno-41-40"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-41"><a id="__codelineno-41-41" name="__codelineno-41-41"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-42"><a id="__codelineno-41-42" name="__codelineno-41-42"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-41-43"><a id="__codelineno-41-43" name="__codelineno-41-43"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-41-44"><a id="__codelineno-41-44" name="__codelineno-41-44"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-41-45"><a id="__codelineno-41-45" name="__codelineno-41-45"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-41-46"><a id="__codelineno-41-46" name="__codelineno-41-46"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-41-47"><a id="__codelineno-41-47" name="__codelineno-41-47"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-41-48"><a id="__codelineno-41-48" name="__codelineno-41-48"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-41-49"><a id="__codelineno-41-49" name="__codelineno-41-49"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/new-ssd/audio/Audiobooks</span>
</span><span id="__span-41-50"><a id="__codelineno-41-50" name="__codelineno-41-50"></a><span class="nn">---</span>
</span><span id="__span-41-51"><a id="__codelineno-41-51" name="__codelineno-41-51"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-41-52"><a id="__codelineno-41-52" name="__codelineno-41-52"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-41-53"><a id="__codelineno-41-53" name="__codelineno-41-53"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-54"><a id="__codelineno-41-54" name="__codelineno-41-54"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-config</span>
</span><span id="__span-41-55"><a id="__codelineno-41-55" name="__codelineno-41-55"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-56"><a id="__codelineno-41-56" name="__codelineno-41-56"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-57"><a id="__codelineno-41-57" name="__codelineno-41-57"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-41-58"><a id="__codelineno-41-58" name="__codelineno-41-58"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-config</span>
</span><span id="__span-41-59"><a id="__codelineno-41-59" name="__codelineno-41-59"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-41-60"><a id="__codelineno-41-60" name="__codelineno-41-60"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-41-61"><a id="__codelineno-41-61" name="__codelineno-41-61"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-41-62"><a id="__codelineno-41-62" name="__codelineno-41-62"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-41-63"><a id="__codelineno-41-63" name="__codelineno-41-63"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-41-64"><a id="__codelineno-41-64" name="__codelineno-41-64"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-41-65"><a id="__codelineno-41-65" name="__codelineno-41-65"></a><span class="nn">---</span>
</span><span id="__span-41-66"><a id="__codelineno-41-66" name="__codelineno-41-66"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-41-67"><a id="__codelineno-41-67" name="__codelineno-41-67"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-41-68"><a id="__codelineno-41-68" name="__codelineno-41-68"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-69"><a id="__codelineno-41-69" name="__codelineno-41-69"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-metadata</span>
</span><span id="__span-41-70"><a id="__codelineno-41-70" name="__codelineno-41-70"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-71"><a id="__codelineno-41-71" name="__codelineno-41-71"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-72"><a id="__codelineno-41-72" name="__codelineno-41-72"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-41-73"><a id="__codelineno-41-73" name="__codelineno-41-73"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-metadata</span>
</span><span id="__span-41-74"><a id="__codelineno-41-74" name="__codelineno-41-74"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-41-75"><a id="__codelineno-41-75" name="__codelineno-41-75"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-41-76"><a id="__codelineno-41-76" name="__codelineno-41-76"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-41-77"><a id="__codelineno-41-77" name="__codelineno-41-77"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-41-78"><a id="__codelineno-41-78" name="__codelineno-41-78"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-41-79"><a id="__codelineno-41-79" name="__codelineno-41-79"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-41-80"><a id="__codelineno-41-80" name="__codelineno-41-80"></a><span class="nn">---</span>
</span><span id="__span-41-81"><a id="__codelineno-41-81" name="__codelineno-41-81"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-41-82"><a id="__codelineno-41-82" name="__codelineno-41-82"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-41-83"><a id="__codelineno-41-83" name="__codelineno-41-83"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-84"><a id="__codelineno-41-84" name="__codelineno-41-84"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-audiobooks</span>
</span><span id="__span-41-85"><a id="__codelineno-41-85" name="__codelineno-41-85"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-86"><a id="__codelineno-41-86" name="__codelineno-41-86"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-87"><a id="__codelineno-41-87" name="__codelineno-41-87"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-41-88"><a id="__codelineno-41-88" name="__codelineno-41-88"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pv-audiobooks</span>
</span><span id="__span-41-89"><a id="__codelineno-41-89" name="__codelineno-41-89"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-41-90"><a id="__codelineno-41-90" name="__codelineno-41-90"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-41-91"><a id="__codelineno-41-91" name="__codelineno-41-91"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-41-92"><a id="__codelineno-41-92" name="__codelineno-41-92"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-41-93"><a id="__codelineno-41-93" name="__codelineno-41-93"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-41-94"><a id="__codelineno-41-94" name="__codelineno-41-94"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-41-95"><a id="__codelineno-41-95" name="__codelineno-41-95"></a><span class="nn">---</span>
</span><span id="__span-41-96"><a id="__codelineno-41-96" name="__codelineno-41-96"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-41-97"><a id="__codelineno-41-97" name="__codelineno-41-97"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-41-98"><a id="__codelineno-41-98" name="__codelineno-41-98"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-99"><a id="__codelineno-41-99" name="__codelineno-41-99"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-41-100"><a id="__codelineno-41-100" name="__codelineno-41-100"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-101"><a id="__codelineno-41-101" name="__codelineno-41-101"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-102"><a id="__codelineno-41-102" name="__codelineno-41-102"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-103"><a id="__codelineno-41-103" name="__codelineno-41-103"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-104"><a id="__codelineno-41-104" name="__codelineno-41-104"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-41-105"><a id="__codelineno-41-105" name="__codelineno-41-105"></a><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-41-106"><a id="__codelineno-41-106" name="__codelineno-41-106"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-41-107"><a id="__codelineno-41-107" name="__codelineno-41-107"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-41-108"><a id="__codelineno-41-108" name="__codelineno-41-108"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-109"><a id="__codelineno-41-109" name="__codelineno-41-109"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-41-110"><a id="__codelineno-41-110" name="__codelineno-41-110"></a><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span>
</span><span id="__span-41-111"><a id="__codelineno-41-111" name="__codelineno-41-111"></a><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-41-112"><a id="__codelineno-41-112" name="__codelineno-41-112"></a><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-41-113"><a id="__codelineno-41-113" name="__codelineno-41-113"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
</span><span id="__span-41-114"><a id="__codelineno-41-114" name="__codelineno-41-114"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-41-115"><a id="__codelineno-41-115" name="__codelineno-41-115"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-116"><a id="__codelineno-41-116" name="__codelineno-41-116"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-41-117"><a id="__codelineno-41-117" name="__codelineno-41-117"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-118"><a id="__codelineno-41-118" name="__codelineno-41-118"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-119"><a id="__codelineno-41-119" name="__codelineno-41-119"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-41-120"><a id="__codelineno-41-120" name="__codelineno-41-120"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/advplyr/audiobookshelf:latest</span>
</span><span id="__span-41-121"><a id="__codelineno-41-121" name="__codelineno-41-121"></a><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-41-122"><a id="__codelineno-41-122" name="__codelineno-41-122"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-123"><a id="__codelineno-41-123" name="__codelineno-41-123"></a><span class="w">          </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-41-124"><a id="__codelineno-41-124" name="__codelineno-41-124"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PORT</span>
</span><span id="__span-41-125"><a id="__codelineno-41-125" name="__codelineno-41-125"></a><span class="w">            </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"8888"</span>
</span><span id="__span-41-126"><a id="__codelineno-41-126" name="__codelineno-41-126"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-41-127"><a id="__codelineno-41-127" name="__codelineno-41-127"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8888</span>
</span><span id="__span-41-128"><a id="__codelineno-41-128" name="__codelineno-41-128"></a><span class="w">          </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-41-129"><a id="__codelineno-41-129" name="__codelineno-41-129"></a><span class="w">          </span><span class="nt">stdin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-41-130"><a id="__codelineno-41-130" name="__codelineno-41-130"></a><span class="w">          </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-41-131"><a id="__codelineno-41-131" name="__codelineno-41-131"></a><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-41-132"><a id="__codelineno-41-132" name="__codelineno-41-132"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/config</span>
</span><span id="__span-41-133"><a id="__codelineno-41-133" name="__codelineno-41-133"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-config</span>
</span><span id="__span-41-134"><a id="__codelineno-41-134" name="__codelineno-41-134"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/metadata</span>
</span><span id="__span-41-135"><a id="__codelineno-41-135" name="__codelineno-41-135"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-metadata</span>
</span><span id="__span-41-136"><a id="__codelineno-41-136" name="__codelineno-41-136"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/audiobooks</span>
</span><span id="__span-41-137"><a id="__codelineno-41-137" name="__codelineno-41-137"></a><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-audiobooks</span>
</span><span id="__span-41-138"><a id="__codelineno-41-138" name="__codelineno-41-138"></a><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span>
</span><span id="__span-41-139"><a id="__codelineno-41-139" name="__codelineno-41-139"></a><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-41-140"><a id="__codelineno-41-140" name="__codelineno-41-140"></a><span class="w">            </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1006</span>
</span><span id="__span-41-141"><a id="__codelineno-41-141" name="__codelineno-41-141"></a><span class="w">            </span><span class="nt">runAsGroup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1006</span>
</span><span id="__span-41-142"><a id="__codelineno-41-142" name="__codelineno-41-142"></a><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-41-143"><a id="__codelineno-41-143" name="__codelineno-41-143"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-41-144"><a id="__codelineno-41-144" name="__codelineno-41-144"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-config</span>
</span><span id="__span-41-145"><a id="__codelineno-41-145" name="__codelineno-41-145"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-41-146"><a id="__codelineno-41-146" name="__codelineno-41-146"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-config</span>
</span><span id="__span-41-147"><a id="__codelineno-41-147" name="__codelineno-41-147"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-metadata</span>
</span><span id="__span-41-148"><a id="__codelineno-41-148" name="__codelineno-41-148"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-41-149"><a id="__codelineno-41-149" name="__codelineno-41-149"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-metadata</span>
</span><span id="__span-41-150"><a id="__codelineno-41-150" name="__codelineno-41-150"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-audiobooks</span>
</span><span id="__span-41-151"><a id="__codelineno-41-151" name="__codelineno-41-151"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-41-152"><a id="__codelineno-41-152" name="__codelineno-41-152"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-pvc-audiobooks</span>
</span><span id="__span-41-153"><a id="__codelineno-41-153" name="__codelineno-41-153"></a><span class="nn">---</span>
</span><span id="__span-41-154"><a id="__codelineno-41-154" name="__codelineno-41-154"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-41-155"><a id="__codelineno-41-155" name="__codelineno-41-155"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-41-156"><a id="__codelineno-41-156" name="__codelineno-41-156"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-157"><a id="__codelineno-41-157" name="__codelineno-41-157"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf-svc</span>
</span><span id="__span-41-158"><a id="__codelineno-41-158" name="__codelineno-41-158"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span><span id="__span-41-159"><a id="__codelineno-41-159" name="__codelineno-41-159"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-160"><a id="__codelineno-41-160" name="__codelineno-41-160"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span><span id="__span-41-161"><a id="__codelineno-41-161" name="__codelineno-41-161"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-41-162"><a id="__codelineno-41-162" name="__codelineno-41-162"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id="__span-41-163"><a id="__codelineno-41-163" name="__codelineno-41-163"></a><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8888</span>
</span><span id="__span-41-164"><a id="__codelineno-41-164" name="__codelineno-41-164"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-41-165"><a id="__codelineno-41-165" name="__codelineno-41-165"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audiobookshelf</span>
</span></code></pre></div></td></tr></table></div>
</details>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>YAML files for Rapture-specific deployments will be
stored for future reference, under <code>1.26/rapture</code> in the
<a href="#github-repository">GitHub repository</a>, while the original
deployment for Lexicon will be under <code>1.26/lexicon</code>.</p>
</div>
<p>As in Lexicon, the service runs as a dedicated
<code>audiobookshelf</code> user with its own persistent storage under
<code>/home/k8s/audiobookshelf</code> which must be created manually:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="gp"># </span>useradd<span class="w"> </span>-u<span class="w"> </span><span class="m">1006</span><span class="w"> </span>-d<span class="w"> </span>/home/k8s/audiobookshelf<span class="w"> </span>-s<span class="w"> </span>/usr/sbin/nologin<span class="w"> </span>audiobookshelf
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="gp"># </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/k8s/audiobookshelf/config<span class="w"> </span>/home/k8s/audiobookshelf/metadata
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="gp"># </span>chown<span class="w"> </span>-R<span class="w"> </span>audiobookshelf.audiobookshelf<span class="w"> </span>/home/k8s/audiobookshelf
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="gp"># </span>ls<span class="w"> </span>-lan<span class="w"> </span>/home/k8s/audiobookshelf
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="go">total 0</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="go">drwxr-xr-x 1 1006 1006 28 May 12 20:51 .</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="go">drwxr-xr-x 1    0    0 28 May 12 20:51 ..</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="go">drwxr-xr-x 1 1006 1006  0 May 12 20:51 config</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="go">drwxr-xr-x 1 1006 1006  0 May 12 20:51 metadata</span>
</span></code></pre></div>
<p>Once the dedicate user is ready, apply the manifest:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>audiobookshelf.yaml
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="go">namespace/audiobookshelf created</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="go">persistentvolume/audiobookshelf-pv-config created</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="go">persistentvolume/audiobookshelf-pv-metadata created</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="go">persistentvolume/audiobookshelf-pv-audiobooks created</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="go">persistentvolumeclaim/audiobookshelf-pvc-config created</span>
</span><span id="__span-43-7"><a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="go">persistentvolumeclaim/audiobookshelf-pvc-metadata created</span>
</span><span id="__span-43-8"><a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="go">persistentvolumeclaim/audiobookshelf-pvc-audiobooks created</span>
</span><span id="__span-43-9"><a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a><span class="go">deployment.apps/audiobookshelf created</span>
</span><span id="__span-43-10"><a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="go">service/audiobookshelf-svc created</span>
</span><span id="__span-43-11"><a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a>
</span><span id="__span-43-12"><a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>audiobookshelf
</span><span id="__span-43-13"><a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="go">NAME                 TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)        AGE</span>
</span><span id="__span-43-14"><a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a><span class="go">audiobookshelf-svc   LoadBalancer   10.102.116.166   192.168.0.221   80:31059/TCP   47s</span>
</span></code></pre></div>
<p>The service is soon available at
<a href="http://192.168.0.221/">http://192.168.0.221/</a>,
or more conveniently at
<a href="http://abs.rapture.uu.am/">http://abs.rapture.uu.am/</a>
after mapping this in <code>/etc/hosts</code>. After setting the
password for the <code>root</code> user and logging in, create a new
library (Audiobooks) and scan it:</p>
<p><a class="glightbox" href="../../../../media/2024-05-12-single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/rapture-audiobookshelf-root-login.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Audiobookshelf start screen" src="../../../../media/2024-05-12-single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/rapture-audiobookshelf-root-login.png"></a></p>
<p><a class="glightbox" href="../../../../media/2024-05-12-single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/rapture-audiobookshelf-new-library.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Audiobookshelf Create Library page" src="../../../../media/2024-05-12-single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/rapture-audiobookshelf-new-library.png"></a></p>
<p>At this point something interesting happened: originally the
audiobooks were read from <code>/home/depot</code> which is slow storage,
so I stopped the deployment with <code>kubectl delete</code>, updated the
path to read audiobooks from the faster SSD storage, applied
the manifest again and the scan finished much faster.</p>
<p>Monitoring shows that scanning a library is mostly IO-bound,
with CPU usage going only near 400% (at a short spike) for
<code>ffprobe</code> but never above 100% for the service itself (<code>node</code>):</p>
<p><a class="glightbox" href="../../../../media/2024-05-12-single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/rapture-audiobookshelf-monitoring.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Audiobookshelf CPU and I/O usage in monitoring" src="../../../../media/2024-05-12-single-node-kubernetes-cluster-on-ubuntu-studio-desktop-rapture/rapture-audiobookshelf-monitoring.png"></a></p>
<p>Showing the list of books seems to go a lot faster, even though
it does not seem to require much of the CPU. Perhaps the big
difference is in the amount of metadata to fetch from storage:
Audiobookshelf in Lexicon has much more detailed metadata,
Audiobookshelf in Rapture has only what is embeded in the audio
files.</p>
<h3 id="migration-from-lexicon">Migration from Lexicon</h3>
<p>Copying all that metadata from Lexicon to Rapture could be an
interesting exercise, and possibly a way to back it up. It is
possible to replace the entire <code>/home/k8s/audiobookshelf</code> in
Rapture with that from Lexicon, so long as the original 
contents are entirely removed:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="gp"># </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>audiobookshelf.yaml<span class="w"> </span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="go">namespace "audiobookshelf" deleted</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="go">persistentvolume "audiobookshelf-pv-config" deleted</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="go">persistentvolume "audiobookshelf-pv-metadata" deleted</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="go">persistentvolume "audiobookshelf-pv-audiobooks" deleted</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="go">persistentvolumeclaim "audiobookshelf-pvc-config" deleted</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="go">persistentvolumeclaim "audiobookshelf-pvc-metadata" deleted</span>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="go">persistentvolumeclaim "audiobookshelf-pvc-audiobooks" deleted</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="go">deployment.apps "audiobookshelf" deleted</span>
</span><span id="__span-44-10"><a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="go">service "audiobookshelf-svc" deleted</span>
</span><span id="__span-44-11"><a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>
</span><span id="__span-44-12"><a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="gp"># </span>cp<span class="w"> </span>-a<span class="w"> </span>/home/k8s/audiobookshelf/<span class="w"> </span>/home/k8s/audiobookshelf_backup
</span><span id="__span-44-13"><a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="gp"># </span>rm<span class="w"> </span>-rf<span class="w"> </span>/home/k8s/audiobookshelf/*/*
</span><span id="__span-44-14"><a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="gp"># </span>rsync<span class="w"> </span>-uva<span class="w"> </span>lexicon:/home/k8s/audiobookshelf/*<span class="w"> </span>/home/k8s/audiobookshelf/
</span><span id="__span-44-15"><a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>
</span><span id="__span-44-16"><a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="gp"># </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>audiobookshelf.yaml<span class="w"> </span>
</span><span id="__span-44-17"><a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="go">namespace/audiobookshelf created</span>
</span><span id="__span-44-18"><a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="go">persistentvolume/audiobookshelf-pv-config created</span>
</span><span id="__span-44-19"><a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="go">persistentvolume/audiobookshelf-pv-metadata created</span>
</span><span id="__span-44-20"><a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="go">persistentvolume/audiobookshelf-pv-audiobooks created</span>
</span><span id="__span-44-21"><a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="go">persistentvolumeclaim/audiobookshelf-pvc-config created</span>
</span><span id="__span-44-22"><a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a><span class="go">persistentvolumeclaim/audiobookshelf-pvc-metadata created</span>
</span><span id="__span-44-23"><a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a><span class="go">persistentvolumeclaim/audiobookshelf-pvc-audiobooks created</span>
</span><span id="__span-44-24"><a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="go">deployment.apps/audiobookshelf created</span>
</span><span id="__span-44-25"><a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a><span class="go">service/audiobookshelf-svc created</span>
</span></code></pre></div>
<p>This <em>migration</em> leaves the service in Rapture no longer
accessible for the <code>root</code> user, while others keep their
access and even reading process. The service runs faster on
Rapture, especially when listing <em>Authors</em> with all their
photos, but even then Rapture does take a while to load all
the photos and runs hotter even though the service barely
reaches 150% of CPU utilization.</p>
<p>The process can be used in case of need, albeit having to
<a href="https://www.audiobookshelf.org/faq/server/#how-can-i-reset-a-password">reset the <code>root</code> password by editing the SQLite database</a>:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="gp"># </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>audiobookshelf.yaml<span class="w"> </span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="gp"># </span><span class="nb">cd</span><span class="w"> </span>/home/k8s/audiobookshelf/config/
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="gp"># </span>cp<span class="w"> </span>absdatabase.sqlite<span class="w"> </span>absdatabase.sqlite.bak
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a><span class="gp"># </span>sqlite3<span class="w"> </span>absdatabase.sqlite
</span></code></pre></div>
<p>In the <code>sqlite</code> prompt:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="k">update</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">pash</span><span class="o">=</span><span class="k">NULL</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">username</span><span class="o">=</span><span class="s1">'root'</span><span class="p">;</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="p">.</span><span class="n">exit</span>
</span></code></pre></div>
<p>Then <code>kubectl apply</code> again and the user <code>root</code> can login
<strong>without</strong> entering a password; but should then set one
immediately.</p>
<p>The database and metadata can be re-synced again, so long as
the service is not running:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="gp"># </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>audiobookshelf.yaml<span class="w"> </span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="gp"># </span>rsync<span class="w"> </span>-uva<span class="w"> </span>lexicon:/home/k8s/audiobookshelf/*<span class="w"> </span>/home/k8s/audiobookshelf/
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="gp"># </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>audiobookshelf.yaml<span class="w"> </span>
</span></code></pre></div>
<h2 id="plex-media-server">Plex Media Server</h2>
<p>Migrating the Plex Media Server in Rapture to Kubernetes would
be a repetition of the same exercise already done for the 
<a href="../../../../2023/09/16/migrating-a-plex-media-server-to-kubernetes/#kubernetes">Plex Media Server deployment in Lexicon</a>, with only a few changes:</p>
<ul>
<li>Audio files are stored under <code>/home/raid/audio</code> but some
    of the libraries are pointing to <code>/home/depot/audio</code></li>
<li>Video files are stored under <code>/home/raid/video</code> but some
    of the libraries are pointing to <code>/home/depot/video</code> while
    others are pointing to <code>/media/video</code> (a very old path).</li>
<li>The <code>loadBalancerIP</code> must be set to the next available IP
    from <a href="#metallb-load-balancer">MetalLB</a>. Run
    <code>kubectl get svc -A</code> and check the <code>EXTERNAL-IP</code> column
    to find which ones are in use already, then pick the next.</li>
<li>Adjust the <code>PUID</code> variable to match the UID of the <code>plex</code>
    user (<strong>999</strong>).</li>
<li>A fresh new <code>PLEX_CLAIM</code> token has to be obtained from
    <a href="https://www.plex.tv/claim/">plex.tv/claim</a> as it expires
    in just 4 minutes.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This setup assumes the <code>plex</code> user (and group)
already exists with ID <strong>998</strong>; otherwise either create them
with that ID or update the <code>PGID</code> and <code>PUID</code> variables in the
manifest to match the actual <code>plex</code> user (and group) IDs.</p>
</div>
<p>Create the plex-owned directory for its database (<code>/config</code>),
stop the old server and copy over its database:</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="gp"># </span>systemctl<span class="w"> </span>stop<span class="w"> </span>plexmediaserver.service
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="gp"># </span>systemctl<span class="w"> </span>disable<span class="w"> </span>plexmediaserver.service
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="go">Removed /etc/systemd/system/multi-user.target.wants/plexmediaserver.service.</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="gp"># </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/k8s/plexmediaserver
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="gp"># </span>cp<span class="w"> </span>-a<span class="w"> </span>/var/lib/plexmediaserver/Library<span class="w"> </span>/home/k8s/plexmediaserver/
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="gp"># </span>chown<span class="w"> </span>-R<span class="w"> </span>plex.plex<span class="w"> </span>/home/k8s/plexmediaserver
</span></code></pre></div>
<p>And now, <em>just</em> before deploying the new server, go to
<a href="https://www.plex.tv/claim/">plex.tv/claim</a> to get a fresh new
claim token and set the <code>PLEX_CLAIM</code> variable to it; <em>then</em>
apply the deployment:</p>
<details class="k8s">
<summary>Kubernetes deployment: <code>plex-media-server.yaml</code></summary>
<div class="language-yaml highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">plex-media-server.yaml</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-49-1">  1</a></span>
<span class="normal"><a href="#__codelineno-49-2">  2</a></span>
<span class="normal"><a href="#__codelineno-49-3">  3</a></span>
<span class="normal"><a href="#__codelineno-49-4">  4</a></span>
<span class="normal"><a href="#__codelineno-49-5">  5</a></span>
<span class="normal"><a href="#__codelineno-49-6">  6</a></span>
<span class="normal"><a href="#__codelineno-49-7">  7</a></span>
<span class="normal"><a href="#__codelineno-49-8">  8</a></span>
<span class="normal"><a href="#__codelineno-49-9">  9</a></span>
<span class="normal"><a href="#__codelineno-49-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-49-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-49-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-49-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-49-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-49-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-49-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-49-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-49-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-49-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-49-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-49-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-49-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-49-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-49-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-49-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-49-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-49-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-49-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-49-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-49-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-49-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-49-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-49-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-49-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-49-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-49-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-49-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-49-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-49-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-49-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-49-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-49-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-49-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-49-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-49-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-49-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-49-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-49-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-49-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-49-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-49-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-49-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-49-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-49-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-49-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-49-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-49-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-49-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-49-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-49-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-49-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-49-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-49-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-49-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-49-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-49-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-49-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-49-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-49-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-49-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-49-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-49-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-49-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-49-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-49-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-49-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-49-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-49-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-49-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-49-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-49-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-49-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-49-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-49-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-49-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-49-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-49-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-49-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-49-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-49-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-49-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-49-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-49-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-49-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-49-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-49-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-49-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-49-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-49-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-49-100">100</a></span>
<span class="normal"><a href="#__codelineno-49-101">101</a></span>
<span class="normal"><a href="#__codelineno-49-102">102</a></span>
<span class="normal"><a href="#__codelineno-49-103">103</a></span>
<span class="normal"><a href="#__codelineno-49-104">104</a></span>
<span class="normal"><a href="#__codelineno-49-105">105</a></span>
<span class="normal"><a href="#__codelineno-49-106">106</a></span>
<span class="normal"><a href="#__codelineno-49-107">107</a></span>
<span class="normal"><a href="#__codelineno-49-108">108</a></span>
<span class="normal"><a href="#__codelineno-49-109">109</a></span>
<span class="normal"><a href="#__codelineno-49-110">110</a></span>
<span class="normal"><a href="#__codelineno-49-111">111</a></span>
<span class="normal"><a href="#__codelineno-49-112">112</a></span>
<span class="normal"><a href="#__codelineno-49-113">113</a></span>
<span class="normal"><a href="#__codelineno-49-114">114</a></span>
<span class="normal"><a href="#__codelineno-49-115">115</a></span>
<span class="normal"><a href="#__codelineno-49-116">116</a></span>
<span class="normal"><a href="#__codelineno-49-117">117</a></span>
<span class="normal"><a href="#__codelineno-49-118">118</a></span>
<span class="normal"><a href="#__codelineno-49-119">119</a></span>
<span class="normal"><a href="#__codelineno-49-120">120</a></span>
<span class="normal"><a href="#__codelineno-49-121">121</a></span>
<span class="normal"><a href="#__codelineno-49-122">122</a></span>
<span class="normal"><a href="#__codelineno-49-123">123</a></span>
<span class="normal"><a href="#__codelineno-49-124">124</a></span>
<span class="normal"><a href="#__codelineno-49-125">125</a></span>
<span class="normal"><a href="#__codelineno-49-126">126</a></span>
<span class="normal"><a href="#__codelineno-49-127">127</a></span>
<span class="normal"><a href="#__codelineno-49-128">128</a></span>
<span class="normal"><a href="#__codelineno-49-129">129</a></span>
<span class="normal"><a href="#__codelineno-49-130">130</a></span>
<span class="normal"><a href="#__codelineno-49-131">131</a></span>
<span class="normal"><a href="#__codelineno-49-132">132</a></span>
<span class="normal"><a href="#__codelineno-49-133">133</a></span>
<span class="normal"><a href="#__codelineno-49-134">134</a></span>
<span class="normal"><a href="#__codelineno-49-135">135</a></span>
<span class="normal"><a href="#__codelineno-49-136">136</a></span>
<span class="normal"><a href="#__codelineno-49-137">137</a></span>
<span class="normal"><a href="#__codelineno-49-138">138</a></span>
<span class="normal"><a href="#__codelineno-49-139">139</a></span>
<span class="normal"><a href="#__codelineno-49-140">140</a></span>
<span class="normal"><a href="#__codelineno-49-141">141</a></span>
<span class="normal"><a href="#__codelineno-49-142">142</a></span>
<span class="normal"><a href="#__codelineno-49-143">143</a></span>
<span class="normal"><a href="#__codelineno-49-144">144</a></span>
<span class="normal"><a href="#__codelineno-49-145">145</a></span>
<span class="normal"><a href="#__codelineno-49-146">146</a></span>
<span class="normal"><a href="#__codelineno-49-147">147</a></span>
<span class="normal"><a href="#__codelineno-49-148">148</a></span>
<span class="normal"><a href="#__codelineno-49-149">149</a></span>
<span class="normal"><a href="#__codelineno-49-150">150</a></span>
<span class="normal"><a href="#__codelineno-49-151">151</a></span>
<span class="normal"><a href="#__codelineno-49-152">152</a></span>
<span class="normal"><a href="#__codelineno-49-153">153</a></span>
<span class="normal"><a href="#__codelineno-49-154">154</a></span>
<span class="normal"><a href="#__codelineno-49-155">155</a></span>
<span class="normal"><a href="#__codelineno-49-156">156</a></span>
<span class="normal"><a href="#__codelineno-49-157">157</a></span>
<span class="normal"><a href="#__codelineno-49-158">158</a></span>
<span class="normal"><a href="#__codelineno-49-159">159</a></span>
<span class="normal"><a href="#__codelineno-49-160">160</a></span>
<span class="normal"><a href="#__codelineno-49-161">161</a></span>
<span class="normal"><a href="#__codelineno-49-162">162</a></span>
<span class="normal"><a href="#__codelineno-49-163">163</a></span>
<span class="normal"><a href="#__codelineno-49-164">164</a></span>
<span class="normal"><a href="#__codelineno-49-165">165</a></span>
<span class="normal"><a href="#__codelineno-49-166">166</a></span>
<span class="normal"><a href="#__codelineno-49-167">167</a></span>
<span class="normal"><a href="#__codelineno-49-168">168</a></span>
<span class="normal"><a href="#__codelineno-49-169">169</a></span>
<span class="normal"><a href="#__codelineno-49-170">170</a></span>
<span class="normal"><a href="#__codelineno-49-171">171</a></span>
<span class="normal"><a href="#__codelineno-49-172">172</a></span>
<span class="normal"><a href="#__codelineno-49-173">173</a></span>
<span class="normal"><a href="#__codelineno-49-174">174</a></span>
<span class="normal"><a href="#__codelineno-49-175">175</a></span>
<span class="normal"><a href="#__codelineno-49-176">176</a></span>
<span class="normal"><a href="#__codelineno-49-177">177</a></span>
<span class="normal"><a href="#__codelineno-49-178">178</a></span>
<span class="normal"><a href="#__codelineno-49-179">179</a></span>
<span class="normal"><a href="#__codelineno-49-180">180</a></span>
<span class="normal"><a href="#__codelineno-49-181">181</a></span>
<span class="normal"><a href="#__codelineno-49-182">182</a></span>
<span class="normal"><a href="#__codelineno-49-183">183</a></span>
<span class="normal"><a href="#__codelineno-49-184">184</a></span>
<span class="normal"><a href="#__codelineno-49-185">185</a></span>
<span class="normal"><a href="#__codelineno-49-186">186</a></span>
<span class="normal"><a href="#__codelineno-49-187">187</a></span>
<span class="normal"><a href="#__codelineno-49-188">188</a></span>
<span class="normal"><a href="#__codelineno-49-189">189</a></span>
<span class="normal"><a href="#__codelineno-49-190">190</a></span>
<span class="normal"><a href="#__codelineno-49-191">191</a></span>
<span class="normal"><a href="#__codelineno-49-192">192</a></span>
<span class="normal"><a href="#__codelineno-49-193">193</a></span>
<span class="normal"><a href="#__codelineno-49-194">194</a></span>
<span class="normal"><a href="#__codelineno-49-195">195</a></span>
<span class="normal"><a href="#__codelineno-49-196">196</a></span>
<span class="normal"><a href="#__codelineno-49-197">197</a></span>
<span class="normal"><a href="#__codelineno-49-198">198</a></span>
<span class="normal"><a href="#__codelineno-49-199">199</a></span>
<span class="normal"><a href="#__codelineno-49-200">200</a></span>
<span class="normal"><a href="#__codelineno-49-201">201</a></span>
<span class="normal"><a href="#__codelineno-49-202">202</a></span>
<span class="normal"><a href="#__codelineno-49-203">203</a></span>
<span class="normal"><a href="#__codelineno-49-204">204</a></span>
<span class="normal"><a href="#__codelineno-49-205">205</a></span>
<span class="normal"><a href="#__codelineno-49-206">206</a></span>
<span class="normal"><a href="#__codelineno-49-207">207</a></span>
<span class="normal"><a href="#__codelineno-49-208">208</a></span>
<span class="normal"><a href="#__codelineno-49-209">209</a></span>
<span class="normal"><a href="#__codelineno-49-210">210</a></span>
<span class="normal"><a href="#__codelineno-49-211">211</a></span>
<span class="normal"><a href="#__codelineno-49-212">212</a></span>
<span class="normal"><a href="#__codelineno-49-213">213</a></span>
<span class="normal"><a href="#__codelineno-49-214">214</a></span>
<span class="normal"><a href="#__codelineno-49-215">215</a></span>
<span class="normal"><a href="#__codelineno-49-216">216</a></span>
<span class="normal"><a href="#__codelineno-49-217">217</a></span>
<span class="normal"><a href="#__codelineno-49-218">218</a></span>
<span class="normal"><a href="#__codelineno-49-219">219</a></span>
<span class="normal"><a href="#__codelineno-49-220">220</a></span>
<span class="normal"><a href="#__codelineno-49-221">221</a></span>
<span class="normal"><a href="#__codelineno-49-222">222</a></span>
<span class="normal"><a href="#__codelineno-49-223">223</a></span>
<span class="normal"><a href="#__codelineno-49-224">224</a></span>
<span class="normal"><a href="#__codelineno-49-225">225</a></span>
<span class="normal"><a href="#__codelineno-49-226">226</a></span>
<span class="normal"><a href="#__codelineno-49-227">227</a></span>
<span class="normal"><a href="#__codelineno-49-228">228</a></span>
<span class="normal"><a href="#__codelineno-49-229">229</a></span>
<span class="normal"><a href="#__codelineno-49-230">230</a></span>
<span class="normal"><a href="#__codelineno-49-231">231</a></span>
<span class="normal"><a href="#__codelineno-49-232">232</a></span>
<span class="normal"><a href="#__codelineno-49-233">233</a></span>
<span class="normal"><a href="#__codelineno-49-234">234</a></span>
<span class="normal"><a href="#__codelineno-49-235">235</a></span>
<span class="normal"><a href="#__codelineno-49-236">236</a></span>
<span class="normal"><a href="#__codelineno-49-237">237</a></span>
<span class="normal"><a href="#__codelineno-49-238">238</a></span>
<span class="normal"><a href="#__codelineno-49-239">239</a></span>
<span class="normal"><a href="#__codelineno-49-240">240</a></span>
<span class="normal"><a href="#__codelineno-49-241">241</a></span>
<span class="normal"><a href="#__codelineno-49-242">242</a></span>
<span class="normal"><a href="#__codelineno-49-243">243</a></span>
<span class="normal"><a href="#__codelineno-49-244">244</a></span>
<span class="normal"><a href="#__codelineno-49-245">245</a></span>
<span class="normal"><a href="#__codelineno-49-246">246</a></span>
<span class="normal"><a href="#__codelineno-49-247">247</a></span>
<span class="normal"><a href="#__codelineno-49-248">248</a></span>
<span class="normal"><a href="#__codelineno-49-249">249</a></span>
<span class="normal"><a href="#__codelineno-49-250">250</a></span>
<span class="normal"><a href="#__codelineno-49-251">251</a></span>
<span class="normal"><a href="#__codelineno-49-252">252</a></span>
<span class="normal"><a href="#__codelineno-49-253">253</a></span>
<span class="normal"><a href="#__codelineno-49-254">254</a></span>
<span class="normal"><a href="#__codelineno-49-255">255</a></span>
<span class="normal"><a href="#__codelineno-49-256">256</a></span>
<span class="normal"><a href="#__codelineno-49-257">257</a></span>
<span class="normal"><a href="#__codelineno-49-258">258</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="nn">---</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pv-config</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/k8s/plexmediaserver</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20"></a><span class="nn">---</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pv-data-audio</span>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500Gi</span>
</span><span id="__span-49-30"><a id="__codelineno-49-30" name="__codelineno-49-30"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-49-31"><a id="__codelineno-49-31" name="__codelineno-49-31"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-49-32"><a id="__codelineno-49-32" name="__codelineno-49-32"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-49-33"><a id="__codelineno-49-33" name="__codelineno-49-33"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-49-34"><a id="__codelineno-49-34" name="__codelineno-49-34"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/raid/audio</span>
</span><span id="__span-49-35"><a id="__codelineno-49-35" name="__codelineno-49-35"></a><span class="nn">---</span>
</span><span id="__span-49-36"><a id="__codelineno-49-36" name="__codelineno-49-36"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-49-37"><a id="__codelineno-49-37" name="__codelineno-49-37"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolume</span>
</span><span id="__span-49-38"><a id="__codelineno-49-38" name="__codelineno-49-38"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-39"><a id="__codelineno-49-39" name="__codelineno-49-39"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pv-data-video</span>
</span><span id="__span-49-40"><a id="__codelineno-49-40" name="__codelineno-49-40"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-41"><a id="__codelineno-49-41" name="__codelineno-49-41"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-49-42"><a id="__codelineno-49-42" name="__codelineno-49-42"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-49-43"><a id="__codelineno-49-43" name="__codelineno-49-43"></a><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span>
</span><span id="__span-49-44"><a id="__codelineno-49-44" name="__codelineno-49-44"></a><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500Gi</span>
</span><span id="__span-49-45"><a id="__codelineno-49-45" name="__codelineno-49-45"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-49-46"><a id="__codelineno-49-46" name="__codelineno-49-46"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-49-47"><a id="__codelineno-49-47" name="__codelineno-49-47"></a><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Retain</span>
</span><span id="__span-49-48"><a id="__codelineno-49-48" name="__codelineno-49-48"></a><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span>
</span><span id="__span-49-49"><a id="__codelineno-49-49" name="__codelineno-49-49"></a><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/raid/video</span>
</span><span id="__span-49-50"><a id="__codelineno-49-50" name="__codelineno-49-50"></a><span class="nn">---</span>
</span><span id="__span-49-51"><a id="__codelineno-49-51" name="__codelineno-49-51"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-49-52"><a id="__codelineno-49-52" name="__codelineno-49-52"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-49-53"><a id="__codelineno-49-53" name="__codelineno-49-53"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-54"><a id="__codelineno-49-54" name="__codelineno-49-54"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pvc-config</span>
</span><span id="__span-49-55"><a id="__codelineno-49-55" name="__codelineno-49-55"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-56"><a id="__codelineno-49-56" name="__codelineno-49-56"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-49-57"><a id="__codelineno-49-57" name="__codelineno-49-57"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-49-58"><a id="__codelineno-49-58" name="__codelineno-49-58"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pv-config</span>
</span><span id="__span-49-59"><a id="__codelineno-49-59" name="__codelineno-49-59"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-49-60"><a id="__codelineno-49-60" name="__codelineno-49-60"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-49-61"><a id="__codelineno-49-61" name="__codelineno-49-61"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-49-62"><a id="__codelineno-49-62" name="__codelineno-49-62"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-49-63"><a id="__codelineno-49-63" name="__codelineno-49-63"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-49-64"><a id="__codelineno-49-64" name="__codelineno-49-64"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span><span id="__span-49-65"><a id="__codelineno-49-65" name="__codelineno-49-65"></a><span class="nn">---</span>
</span><span id="__span-49-66"><a id="__codelineno-49-66" name="__codelineno-49-66"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-49-67"><a id="__codelineno-49-67" name="__codelineno-49-67"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-49-68"><a id="__codelineno-49-68" name="__codelineno-49-68"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-69"><a id="__codelineno-49-69" name="__codelineno-49-69"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pvc-data-audio</span>
</span><span id="__span-49-70"><a id="__codelineno-49-70" name="__codelineno-49-70"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-71"><a id="__codelineno-49-71" name="__codelineno-49-71"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-49-72"><a id="__codelineno-49-72" name="__codelineno-49-72"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-49-73"><a id="__codelineno-49-73" name="__codelineno-49-73"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pv-data-audio</span>
</span><span id="__span-49-74"><a id="__codelineno-49-74" name="__codelineno-49-74"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-49-75"><a id="__codelineno-49-75" name="__codelineno-49-75"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-49-76"><a id="__codelineno-49-76" name="__codelineno-49-76"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-49-77"><a id="__codelineno-49-77" name="__codelineno-49-77"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-49-78"><a id="__codelineno-49-78" name="__codelineno-49-78"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-49-79"><a id="__codelineno-49-79" name="__codelineno-49-79"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500Gi</span>
</span><span id="__span-49-80"><a id="__codelineno-49-80" name="__codelineno-49-80"></a><span class="nn">---</span>
</span><span id="__span-49-81"><a id="__codelineno-49-81" name="__codelineno-49-81"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-49-82"><a id="__codelineno-49-82" name="__codelineno-49-82"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-49-83"><a id="__codelineno-49-83" name="__codelineno-49-83"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-84"><a id="__codelineno-49-84" name="__codelineno-49-84"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pvc-data-video</span>
</span><span id="__span-49-85"><a id="__codelineno-49-85" name="__codelineno-49-85"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-86"><a id="__codelineno-49-86" name="__codelineno-49-86"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-49-87"><a id="__codelineno-49-87" name="__codelineno-49-87"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">manual</span>
</span><span id="__span-49-88"><a id="__codelineno-49-88" name="__codelineno-49-88"></a><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pv-data-video</span>
</span><span id="__span-49-89"><a id="__codelineno-49-89" name="__codelineno-49-89"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-49-90"><a id="__codelineno-49-90" name="__codelineno-49-90"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
</span><span id="__span-49-91"><a id="__codelineno-49-91" name="__codelineno-49-91"></a><span class="w">  </span><span class="nt">volumeMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Filesystem</span>
</span><span id="__span-49-92"><a id="__codelineno-49-92" name="__codelineno-49-92"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-49-93"><a id="__codelineno-49-93" name="__codelineno-49-93"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-49-94"><a id="__codelineno-49-94" name="__codelineno-49-94"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500Gi</span>
</span><span id="__span-49-95"><a id="__codelineno-49-95" name="__codelineno-49-95"></a><span class="nn">---</span>
</span><span id="__span-49-96"><a id="__codelineno-49-96" name="__codelineno-49-96"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-49-97"><a id="__codelineno-49-97" name="__codelineno-49-97"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-49-98"><a id="__codelineno-49-98" name="__codelineno-49-98"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-99"><a id="__codelineno-49-99" name="__codelineno-49-99"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-49-100"><a id="__codelineno-49-100" name="__codelineno-49-100"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-101"><a id="__codelineno-49-101" name="__codelineno-49-101"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-102"><a id="__codelineno-49-102" name="__codelineno-49-102"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-103"><a id="__codelineno-49-103" name="__codelineno-49-103"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-49-104"><a id="__codelineno-49-104" name="__codelineno-49-104"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-49-105"><a id="__codelineno-49-105" name="__codelineno-49-105"></a><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-49-106"><a id="__codelineno-49-106" name="__codelineno-49-106"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-49-107"><a id="__codelineno-49-107" name="__codelineno-49-107"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-49-108"><a id="__codelineno-49-108" name="__codelineno-49-108"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-109"><a id="__codelineno-49-109" name="__codelineno-49-109"></a><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span>
</span><span id="__span-49-110"><a id="__codelineno-49-110" name="__codelineno-49-110"></a><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span>
</span><span id="__span-49-111"><a id="__codelineno-49-111" name="__codelineno-49-111"></a><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-49-112"><a id="__codelineno-49-112" name="__codelineno-49-112"></a><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-49-113"><a id="__codelineno-49-113" name="__codelineno-49-113"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RollingUpdate</span>
</span><span id="__span-49-114"><a id="__codelineno-49-114" name="__codelineno-49-114"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-49-115"><a id="__codelineno-49-115" name="__codelineno-49-115"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-116"><a id="__codelineno-49-116" name="__codelineno-49-116"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-49-117"><a id="__codelineno-49-117" name="__codelineno-49-117"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-118"><a id="__codelineno-49-118" name="__codelineno-49-118"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-49-119"><a id="__codelineno-49-119" name="__codelineno-49-119"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-49-120"><a id="__codelineno-49-120" name="__codelineno-49-120"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plex-config</span>
</span><span id="__span-49-121"><a id="__codelineno-49-121" name="__codelineno-49-121"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-49-122"><a id="__codelineno-49-122" name="__codelineno-49-122"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pvc-config</span>
</span><span id="__span-49-123"><a id="__codelineno-49-123" name="__codelineno-49-123"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-audio</span>
</span><span id="__span-49-124"><a id="__codelineno-49-124" name="__codelineno-49-124"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-49-125"><a id="__codelineno-49-125" name="__codelineno-49-125"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pvc-data-audio</span>
</span><span id="__span-49-126"><a id="__codelineno-49-126" name="__codelineno-49-126"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-video</span>
</span><span id="__span-49-127"><a id="__codelineno-49-127" name="__codelineno-49-127"></a><span class="w">        </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-49-128"><a id="__codelineno-49-128" name="__codelineno-49-128"></a><span class="w">          </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver-pvc-data-video</span>
</span><span id="__span-49-129"><a id="__codelineno-49-129" name="__codelineno-49-129"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-49-130"><a id="__codelineno-49-130" name="__codelineno-49-130"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-49-131"><a id="__codelineno-49-131" name="__codelineno-49-131"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PLEX_CLAIM</span>
</span><span id="__span-49-132"><a id="__codelineno-49-132" name="__codelineno-49-132"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">claim-vwSJ5pLyxPQVKKRPvVDk</span>
</span><span id="__span-49-133"><a id="__codelineno-49-133" name="__codelineno-49-133"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PGID</span>
</span><span id="__span-49-134"><a id="__codelineno-49-134" name="__codelineno-49-134"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"998"</span>
</span><span id="__span-49-135"><a id="__codelineno-49-135" name="__codelineno-49-135"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PUID</span>
</span><span id="__span-49-136"><a id="__codelineno-49-136" name="__codelineno-49-136"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">"999"</span>
</span><span id="__span-49-137"><a id="__codelineno-49-137" name="__codelineno-49-137"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VERSION</span>
</span><span id="__span-49-138"><a id="__codelineno-49-138" name="__codelineno-49-138"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
</span><span id="__span-49-139"><a id="__codelineno-49-139" name="__codelineno-49-139"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ</span>
</span><span id="__span-49-140"><a id="__codelineno-49-140" name="__codelineno-49-140"></a><span class="w">          </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Europe/Amsterdam</span>
</span><span id="__span-49-141"><a id="__codelineno-49-141" name="__codelineno-49-141"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ghcr.io/linuxserver/plex</span>
</span><span id="__span-49-142"><a id="__codelineno-49-142" name="__codelineno-49-142"></a><span class="w">        </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-49-143"><a id="__codelineno-49-143" name="__codelineno-49-143"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-144"><a id="__codelineno-49-144" name="__codelineno-49-144"></a><span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-49-145"><a id="__codelineno-49-145" name="__codelineno-49-145"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32400</span>
</span><span id="__span-49-146"><a id="__codelineno-49-146" name="__codelineno-49-146"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pms-web</span>
</span><span id="__span-49-147"><a id="__codelineno-49-147" name="__codelineno-49-147"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-49-148"><a id="__codelineno-49-148" name="__codelineno-49-148"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32469</span>
</span><span id="__span-49-149"><a id="__codelineno-49-149" name="__codelineno-49-149"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dlna-tcp</span>
</span><span id="__span-49-150"><a id="__codelineno-49-150" name="__codelineno-49-150"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-49-151"><a id="__codelineno-49-151" name="__codelineno-49-151"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1900</span>
</span><span id="__span-49-152"><a id="__codelineno-49-152" name="__codelineno-49-152"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dlna-udp</span>
</span><span id="__span-49-153"><a id="__codelineno-49-153" name="__codelineno-49-153"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-154"><a id="__codelineno-49-154" name="__codelineno-49-154"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3005</span>
</span><span id="__span-49-155"><a id="__codelineno-49-155" name="__codelineno-49-155"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plex-companion</span>
</span><span id="__span-49-156"><a id="__codelineno-49-156" name="__codelineno-49-156"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class="w">  </span>
</span><span id="__span-49-157"><a id="__codelineno-49-157" name="__codelineno-49-157"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5353</span>
</span><span id="__span-49-158"><a id="__codelineno-49-158" name="__codelineno-49-158"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">discovery-udp</span>
</span><span id="__span-49-159"><a id="__codelineno-49-159" name="__codelineno-49-159"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span><span class="w">  </span>
</span><span id="__span-49-160"><a id="__codelineno-49-160" name="__codelineno-49-160"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8324</span>
</span><span id="__span-49-161"><a id="__codelineno-49-161" name="__codelineno-49-161"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plex-roku</span>
</span><span id="__span-49-162"><a id="__codelineno-49-162" name="__codelineno-49-162"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class="w">  </span>
</span><span id="__span-49-163"><a id="__codelineno-49-163" name="__codelineno-49-163"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32410</span>
</span><span id="__span-49-164"><a id="__codelineno-49-164" name="__codelineno-49-164"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gdm-32410</span>
</span><span id="__span-49-165"><a id="__codelineno-49-165" name="__codelineno-49-165"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-166"><a id="__codelineno-49-166" name="__codelineno-49-166"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32412</span>
</span><span id="__span-49-167"><a id="__codelineno-49-167" name="__codelineno-49-167"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gdm-32412</span>
</span><span id="__span-49-168"><a id="__codelineno-49-168" name="__codelineno-49-168"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-169"><a id="__codelineno-49-169" name="__codelineno-49-169"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32413</span>
</span><span id="__span-49-170"><a id="__codelineno-49-170" name="__codelineno-49-170"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gdm-32413</span>
</span><span id="__span-49-171"><a id="__codelineno-49-171" name="__codelineno-49-171"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-172"><a id="__codelineno-49-172" name="__codelineno-49-172"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32414</span>
</span><span id="__span-49-173"><a id="__codelineno-49-173" name="__codelineno-49-173"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gdm-32414</span>
</span><span id="__span-49-174"><a id="__codelineno-49-174" name="__codelineno-49-174"></a><span class="w">          </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-175"><a id="__codelineno-49-175" name="__codelineno-49-175"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-49-176"><a id="__codelineno-49-176" name="__codelineno-49-176"></a><span class="w">        </span><span class="nt">stdin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-49-177"><a id="__codelineno-49-177" name="__codelineno-49-177"></a><span class="w">        </span><span class="nt">tty</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-49-178"><a id="__codelineno-49-178" name="__codelineno-49-178"></a><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-49-179"><a id="__codelineno-49-179" name="__codelineno-49-179"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/config</span>
</span><span id="__span-49-180"><a id="__codelineno-49-180" name="__codelineno-49-180"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plex-config</span>
</span><span id="__span-49-181"><a id="__codelineno-49-181" name="__codelineno-49-181"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/depot/audio</span>
</span><span id="__span-49-182"><a id="__codelineno-49-182" name="__codelineno-49-182"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-audio</span>
</span><span id="__span-49-183"><a id="__codelineno-49-183" name="__codelineno-49-183"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/depot/video</span>
</span><span id="__span-49-184"><a id="__codelineno-49-184" name="__codelineno-49-184"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-video</span>
</span><span id="__span-49-185"><a id="__codelineno-49-185" name="__codelineno-49-185"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/raid/audio</span>
</span><span id="__span-49-186"><a id="__codelineno-49-186" name="__codelineno-49-186"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-audio</span>
</span><span id="__span-49-187"><a id="__codelineno-49-187" name="__codelineno-49-187"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/raid/video</span>
</span><span id="__span-49-188"><a id="__codelineno-49-188" name="__codelineno-49-188"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-video</span>
</span><span id="__span-49-189"><a id="__codelineno-49-189" name="__codelineno-49-189"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/media/video</span>
</span><span id="__span-49-190"><a id="__codelineno-49-190" name="__codelineno-49-190"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data-video</span>
</span><span id="__span-49-191"><a id="__codelineno-49-191" name="__codelineno-49-191"></a><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-49-192"><a id="__codelineno-49-192" name="__codelineno-49-192"></a><span class="nn">---</span>
</span><span id="__span-49-193"><a id="__codelineno-49-193" name="__codelineno-49-193"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-49-194"><a id="__codelineno-49-194" name="__codelineno-49-194"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-49-195"><a id="__codelineno-49-195" name="__codelineno-49-195"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-196"><a id="__codelineno-49-196" name="__codelineno-49-196"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plex-udp</span>
</span><span id="__span-49-197"><a id="__codelineno-49-197" name="__codelineno-49-197"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-198"><a id="__codelineno-49-198" name="__codelineno-49-198"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-49-199"><a id="__codelineno-49-199" name="__codelineno-49-199"></a><span class="w">    </span><span class="nt">metallb.universe.tf/allow-shared-ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-200"><a id="__codelineno-49-200" name="__codelineno-49-200"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-49-201"><a id="__codelineno-49-201" name="__codelineno-49-201"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-49-202"><a id="__codelineno-49-202" name="__codelineno-49-202"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-203"><a id="__codelineno-49-203" name="__codelineno-49-203"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-49-204"><a id="__codelineno-49-204" name="__codelineno-49-204"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1900</span>
</span><span id="__span-49-205"><a id="__codelineno-49-205" name="__codelineno-49-205"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1900</span>
</span><span id="__span-49-206"><a id="__codelineno-49-206" name="__codelineno-49-206"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dlna-udp</span>
</span><span id="__span-49-207"><a id="__codelineno-49-207" name="__codelineno-49-207"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-208"><a id="__codelineno-49-208" name="__codelineno-49-208"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5353</span>
</span><span id="__span-49-209"><a id="__codelineno-49-209" name="__codelineno-49-209"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5353</span>
</span><span id="__span-49-210"><a id="__codelineno-49-210" name="__codelineno-49-210"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">discovery-udp</span>
</span><span id="__span-49-211"><a id="__codelineno-49-211" name="__codelineno-49-211"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-212"><a id="__codelineno-49-212" name="__codelineno-49-212"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32410</span>
</span><span id="__span-49-213"><a id="__codelineno-49-213" name="__codelineno-49-213"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32410</span>
</span><span id="__span-49-214"><a id="__codelineno-49-214" name="__codelineno-49-214"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gdm-32410</span>
</span><span id="__span-49-215"><a id="__codelineno-49-215" name="__codelineno-49-215"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-216"><a id="__codelineno-49-216" name="__codelineno-49-216"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32412</span>
</span><span id="__span-49-217"><a id="__codelineno-49-217" name="__codelineno-49-217"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32412</span>
</span><span id="__span-49-218"><a id="__codelineno-49-218" name="__codelineno-49-218"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gdm-32412</span>
</span><span id="__span-49-219"><a id="__codelineno-49-219" name="__codelineno-49-219"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-220"><a id="__codelineno-49-220" name="__codelineno-49-220"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32413</span>
</span><span id="__span-49-221"><a id="__codelineno-49-221" name="__codelineno-49-221"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32413</span>
</span><span id="__span-49-222"><a id="__codelineno-49-222" name="__codelineno-49-222"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gdm-32413</span>
</span><span id="__span-49-223"><a id="__codelineno-49-223" name="__codelineno-49-223"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-224"><a id="__codelineno-49-224" name="__codelineno-49-224"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32414</span>
</span><span id="__span-49-225"><a id="__codelineno-49-225" name="__codelineno-49-225"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32414</span>
</span><span id="__span-49-226"><a id="__codelineno-49-226" name="__codelineno-49-226"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gdm-32414</span>
</span><span id="__span-49-227"><a id="__codelineno-49-227" name="__codelineno-49-227"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UDP</span>
</span><span id="__span-49-228"><a id="__codelineno-49-228" name="__codelineno-49-228"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span><span id="__span-49-229"><a id="__codelineno-49-229" name="__codelineno-49-229"></a><span class="w">  </span><span class="nt">loadBalancerIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.221</span><span class="w">  </span><span class="c1"># Should be one from the MetalLB range and the same as the TCP service.</span>
</span><span id="__span-49-230"><a id="__codelineno-49-230" name="__codelineno-49-230"></a><span class="nn">---</span>
</span><span id="__span-49-231"><a id="__codelineno-49-231" name="__codelineno-49-231"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-49-232"><a id="__codelineno-49-232" name="__codelineno-49-232"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-49-233"><a id="__codelineno-49-233" name="__codelineno-49-233"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-234"><a id="__codelineno-49-234" name="__codelineno-49-234"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plex-tcp</span>
</span><span id="__span-49-235"><a id="__codelineno-49-235" name="__codelineno-49-235"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-236"><a id="__codelineno-49-236" name="__codelineno-49-236"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-49-237"><a id="__codelineno-49-237" name="__codelineno-49-237"></a><span class="w">    </span><span class="nt">metallb.universe.tf/allow-shared-ip</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-238"><a id="__codelineno-49-238" name="__codelineno-49-238"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-49-239"><a id="__codelineno-49-239" name="__codelineno-49-239"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-49-240"><a id="__codelineno-49-240" name="__codelineno-49-240"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plexserver</span>
</span><span id="__span-49-241"><a id="__codelineno-49-241" name="__codelineno-49-241"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">                      </span>
</span><span id="__span-49-242"><a id="__codelineno-49-242" name="__codelineno-49-242"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32400</span>
</span><span id="__span-49-243"><a id="__codelineno-49-243" name="__codelineno-49-243"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32400</span>
</span><span id="__span-49-244"><a id="__codelineno-49-244" name="__codelineno-49-244"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pms-web</span>
</span><span id="__span-49-245"><a id="__codelineno-49-245" name="__codelineno-49-245"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-49-246"><a id="__codelineno-49-246" name="__codelineno-49-246"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3005</span>
</span><span id="__span-49-247"><a id="__codelineno-49-247" name="__codelineno-49-247"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3005</span>
</span><span id="__span-49-248"><a id="__codelineno-49-248" name="__codelineno-49-248"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plex-companion</span>
</span><span id="__span-49-249"><a id="__codelineno-49-249" name="__codelineno-49-249"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8324</span>
</span><span id="__span-49-250"><a id="__codelineno-49-250" name="__codelineno-49-250"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">plex-roku</span>
</span><span id="__span-49-251"><a id="__codelineno-49-251" name="__codelineno-49-251"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8324</span><span class="w">  </span>
</span><span id="__span-49-252"><a id="__codelineno-49-252" name="__codelineno-49-252"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span><span class="w">  </span>
</span><span id="__span-49-253"><a id="__codelineno-49-253" name="__codelineno-49-253"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32469</span>
</span><span id="__span-49-254"><a id="__codelineno-49-254" name="__codelineno-49-254"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32469</span>
</span><span id="__span-49-255"><a id="__codelineno-49-255" name="__codelineno-49-255"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dlna-tcp</span>
</span><span id="__span-49-256"><a id="__codelineno-49-256" name="__codelineno-49-256"></a><span class="w">    </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-49-257"><a id="__codelineno-49-257" name="__codelineno-49-257"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</span><span id="__span-49-258"><a id="__codelineno-49-258" name="__codelineno-49-258"></a><span class="w">  </span><span class="nt">loadBalancerIP</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.221</span><span class="w">  </span><span class="c1"># Should be one from the MetalLB range and the same as the UDP service.</span>
</span></code></pre></div></td></tr></table></div>
</details>
<div class="language-console highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>plex-media-server.yaml<span class="w"> </span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="go">namespace/plexserver created</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="go">persistentvolume/plexserver-pv-config created</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="go">persistentvolume/plexserver-pv-data-audio created</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="go">persistentvolume/plexserver-pv-data-video created</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#__codelineno-50-6"></a><span class="go">persistentvolumeclaim/plexserver-pvc-config created</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#__codelineno-50-7"></a><span class="go">persistentvolumeclaim/plexserver-pvc-data-audio created</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#__codelineno-50-8"></a><span class="go">persistentvolumeclaim/plexserver-pvc-data-video created</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#__codelineno-50-9"></a><span class="go">deployment.apps/plexserver created</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#__codelineno-50-10"></a><span class="go">service/plex-udp created</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#__codelineno-50-11"></a><span class="go">service/plex-tcp created</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#__codelineno-50-12"></a>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#__codelineno-50-13"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>plexserver
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#__codelineno-50-14"></a><span class="go">NAME       TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)                                                                                         AGE</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#__codelineno-50-15"></a><span class="go">plex-tcp   LoadBalancer   10.100.110.149   192.168.0.221   32400:30939/TCP,3005:30159/TCP,8324:30278/TCP,32469:30767/TCP                                   7m19s</span>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#__codelineno-50-16"></a><span class="go">plex-udp   LoadBalancer   10.97.4.51       192.168.0.221   1900:32446/UDP,5353:31607/UDP,32410:31569/UDP,32412:32246/UDP,32413:31588/UDP,32414:32331/UDP   7m19s</span>
</span></code></pre></div>
<p>Plex web app is now available at
<a href="http://192.168.0.221:32400/web">http://192.168.0.221:32400/web</a>
and the next steps are to</p>
<ol>
<li>Log in with the same Plex account from the old server.</li>
<li>Enable remote access.</li>
</ol>
<p>Normally Plex is able to establish the necessary port forwarding via UPnP, but in this case that doesnâ€™t seem to work. The port forwarding rule can be added manually to the router and then Manually specify public port in the Plex settings under <strong>Settings &gt; Remote Access</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This step may require connecting directly to the web
interface from the local network, via
<a href="http://192.168.0.221:32400/web">http://192.168.0.221:32400/web</a>.</p>
</div>
<p><strong>However</strong>, to do this <a href="#metallb-load-balancer">MetalLB</a> must
be updated to include at least a few IP addresses overlapping
with the range supported by the router (e.g. 192.168.0.<strong>221</strong>)
so that it can be reached via port <strong>23240</strong>.</p>
<div class="language-console highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="gp">$ </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>rapture/plex-media-server.yaml
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>metallb/ipaddress-pool-rapture.yaml<span class="w"> </span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a><span class="go">ipaddresspool.metallb.io/rapture-pool configured</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="go">l2advertisement.metallb.io/l2-advert unchanged</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="gp">$ </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>rapture/plex-media-server.yaml
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-A<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-v<span class="w"> </span><span class="s1">'&lt;none&gt;'</span>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="go">NAMESPACE              NAME                                 TYPE           CLUSTER-IP       EXTERNAL-IP     PORT(S)                                                                                         AGE</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="go">audiobookshelf         audiobookshelf-svc                   LoadBalancer   10.100.173.108   192.168.0.221   80:32696/TCP                                                                                    4h58m</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="go">ingress-nginx          ingress-nginx-controller             LoadBalancer   10.97.59.176     192.168.0.228   80:30706/TCP,443:30199/TCP                                                                      6d23h</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="go">kubernetes-dashboard   kubernetes-dashboard                 LoadBalancer   10.107.235.155   192.168.0.229   443:30480/TCP                                                                                   7d</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="go">plexserver             plex-tcp                             LoadBalancer   10.97.83.71      192.168.0.222   32400:30505/TCP,3005:30299/TCP,8324:31277/TCP,32469:31987/TCP                                   6d16h</span>
</span><span id="__span-51-15"><a id="__codelineno-51-15" name="__codelineno-51-15" href="#__codelineno-51-15"></a><span class="go">plexserver             plex-udp                             LoadBalancer   10.100.30.101    192.168.0.222   1900:31197/UDP,5353:32649/UDP,32410:32214/UDP,32412:32151/UDP,32413:32713/UDP,32414:32543/UDP   6d16h</span>
</span></code></pre></div></div>


  


  



      
    </article>
  </div>

          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2019-2025 Ponder Stibbons
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["content.code.copy", "search.highlight", "search.suggest"], "search": "../../../../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>